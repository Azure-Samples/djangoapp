 
//@ sourceURL=/js/require.js 
/*
 RequireJS 2.1.6 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 Available via the MIT or new BSD license.
 see: http://github.com/jrburke/requirejs for details
*/
var requirejs,require,define;
(function(ba){function J(b){return"[object Function]"===N.call(b)}function K(b){return"[object Array]"===N.call(b)}function z(b,c){if(b){var d;for(d=0;d<b.length&&(!b[d]||!c(b[d],d,b));d+=1);}}function O(b,c){if(b){var d;for(d=b.length-1;-1<d&&(!b[d]||!c(b[d],d,b));d-=1);}}function t(b,c){return ha.call(b,c)}function m(b,c){return t(b,c)&&b[c]}function H(b,c){for(var d in b)if(t(b,d)&&c(b[d],d))break}function S(b,c,d,m){c&&H(c,function(c,l){if(d||!t(b,l))m&&"string"!==typeof c?(b[l]||(b[l]={}),S(b[l],
c,d,m)):b[l]=c});return b}function v(b,c){return function(){return c.apply(b,arguments)}}function ca(b){throw b;}function da(b){if(!b)return b;var c=ba;z(b.split("."),function(b){c=c[b]});return c}function B(b,c,d,m){c=Error(c+"\nhttp://requirejs.org/docs/errors.html#"+b);c.requireType=b;c.requireModules=m;d&&(c.originalError=d);return c}function ia(b){function c(a,f,C){var e,n,b,c,d,T,k,g=f&&f.split("/");e=g;var l=j.map,h=l&&l["*"];if(a&&"."===a.charAt(0))if(f){e=m(j.pkgs,f)?g=[f]:g.slice(0,g.length-
1);f=a=e.concat(a.split("/"));for(e=0;f[e];e+=1)if(n=f[e],"."===n)f.splice(e,1),e-=1;else if(".."===n)if(1===e&&(".."===f[2]||".."===f[0]))break;else 0<e&&(f.splice(e-1,2),e-=2);e=m(j.pkgs,f=a[0]);a=a.join("/");e&&a===f+"/"+e.main&&(a=f)}else 0===a.indexOf("./")&&(a=a.substring(2));if(C&&l&&(g||h)){f=a.split("/");for(e=f.length;0<e;e-=1){b=f.slice(0,e).join("/");if(g)for(n=g.length;0<n;n-=1)if(C=m(l,g.slice(0,n).join("/")))if(C=m(C,b)){c=C;d=e;break}if(c)break;!T&&(h&&m(h,b))&&(T=m(h,b),k=e)}!c&&
T&&(c=T,d=k);c&&(f.splice(0,d,c),a=f.join("/"))}return a}function d(a){A&&z(document.getElementsByTagName("script"),function(f){if(f.getAttribute("data-requiremodule")===a&&f.getAttribute("data-requirecontext")===k.contextName)return f.parentNode.removeChild(f),!0})}function p(a){var f=m(j.paths,a);if(f&&K(f)&&1<f.length)return d(a),f.shift(),k.require.undef(a),k.require([a]),!0}function g(a){var f,b=a?a.indexOf("!"):-1;-1<b&&(f=a.substring(0,b),a=a.substring(b+1,a.length));return[f,a]}function l(a,
f,b,e){var n,D,i=null,d=f?f.name:null,l=a,h=!0,j="";a||(h=!1,a="_@r"+(N+=1));a=g(a);i=a[0];a=a[1];i&&(i=c(i,d,e),D=m(r,i));a&&(i?j=D&&D.normalize?D.normalize(a,function(a){return c(a,d,e)}):c(a,d,e):(j=c(a,d,e),a=g(j),i=a[0],j=a[1],b=!0,n=k.nameToUrl(j)));b=i&&!D&&!b?"_unnormalized"+(O+=1):"";return{prefix:i,name:j,parentMap:f,unnormalized:!!b,url:n,originalName:l,isDefine:h,id:(i?i+"!"+j:j)+b}}function s(a){var f=a.id,b=m(q,f);b||(b=q[f]=new k.Module(a));return b}function u(a,f,b){var e=a.id,n=m(q,
e);if(t(r,e)&&(!n||n.defineEmitComplete))"defined"===f&&b(r[e]);else if(n=s(a),n.error&&"error"===f)b(n.error);else n.on(f,b)}function w(a,f){var b=a.requireModules,e=!1;if(f)f(a);else if(z(b,function(f){if(f=m(q,f))f.error=a,f.events.error&&(e=!0,f.emit("error",a))}),!e)h.onError(a)}function x(){U.length&&(ja.apply(I,[I.length-1,0].concat(U)),U=[])}function y(a){delete q[a];delete W[a]}function G(a,f,b){var e=a.map.id;a.error?a.emit("error",a.error):(f[e]=!0,z(a.depMaps,function(e,c){var d=e.id,
g=m(q,d);g&&(!a.depMatched[c]&&!b[d])&&(m(f,d)?(a.defineDep(c,r[d]),a.check()):G(g,f,b))}),b[e]=!0)}function E(){var a,f,b,e,n=(b=1E3*j.waitSeconds)&&k.startTime+b<(new Date).getTime(),c=[],i=[],g=!1,l=!0;if(!X){X=!0;H(W,function(b){a=b.map;f=a.id;if(b.enabled&&(a.isDefine||i.push(b),!b.error))if(!b.inited&&n)p(f)?g=e=!0:(c.push(f),d(f));else if(!b.inited&&(b.fetched&&a.isDefine)&&(g=!0,!a.prefix))return l=!1});if(n&&c.length)return b=B("timeout","Load timeout for modules: "+c,null,c),b.contextName=
k.contextName,w(b);l&&z(i,function(a){G(a,{},{})});if((!n||e)&&g)if((A||ea)&&!Y)Y=setTimeout(function(){Y=0;E()},50);X=!1}}function F(a){t(r,a[0])||s(l(a[0],null,!0)).init(a[1],a[2])}function L(a){var a=a.currentTarget||a.srcElement,b=k.onScriptLoad;a.detachEvent&&!Z?a.detachEvent("onreadystatechange",b):a.removeEventListener("load",b,!1);b=k.onScriptError;(!a.detachEvent||Z)&&a.removeEventListener("error",b,!1);return{node:a,id:a&&a.getAttribute("data-requiremodule")}}function M(){var a;for(x();I.length;){a=
I.shift();if(null===a[0])return w(B("mismatch","Mismatched anonymous define() module: "+a[a.length-1]));F(a)}}var X,$,k,P,Y,j={waitSeconds:7,baseUrl:"./",paths:{},pkgs:{},shim:{},config:{}},q={},W={},aa={},I=[],r={},V={},N=1,O=1;P={require:function(a){return a.require?a.require:a.require=k.makeRequire(a.map)},exports:function(a){a.usingExports=!0;if(a.map.isDefine)return a.exports?a.exports:a.exports=r[a.map.id]={}},module:function(a){return a.module?a.module:a.module={id:a.map.id,uri:a.map.url,config:function(){var b=
m(j.pkgs,a.map.id);return(b?m(j.config,a.map.id+"/"+b.main):m(j.config,a.map.id))||{}},exports:r[a.map.id]}}};$=function(a){this.events=m(aa,a.id)||{};this.map=a;this.shim=m(j.shim,a.id);this.depExports=[];this.depMaps=[];this.depMatched=[];this.pluginMaps={};this.depCount=0};$.prototype={init:function(a,b,c,e){e=e||{};if(!this.inited){this.factory=b;if(c)this.on("error",c);else this.events.error&&(c=v(this,function(a){this.emit("error",a)}));this.depMaps=a&&a.slice(0);this.errback=c;this.inited=
!0;this.ignore=e.ignore;e.enabled||this.enabled?this.enable():this.check()}},defineDep:function(a,b){this.depMatched[a]||(this.depMatched[a]=!0,this.depCount-=1,this.depExports[a]=b)},fetch:function(){if(!this.fetched){this.fetched=!0;k.startTime=(new Date).getTime();var a=this.map;if(this.shim)k.makeRequire(this.map,{enableBuildCallback:!0})(this.shim.deps||[],v(this,function(){return a.prefix?this.callPlugin():this.load()}));else return a.prefix?this.callPlugin():this.load()}},load:function(){var a=
this.map.url;V[a]||(V[a]=!0,k.load(this.map.id,a))},check:function(){if(this.enabled&&!this.enabling){var a,b,c=this.map.id;b=this.depExports;var e=this.exports,n=this.factory;if(this.inited)if(this.error)this.emit("error",this.error);else{if(!this.defining){this.defining=!0;if(1>this.depCount&&!this.defined){if(J(n)){if(this.events.error&&this.map.isDefine||h.onError!==ca)try{e=k.execCb(c,n,b,e)}catch(d){a=d}else e=k.execCb(c,n,b,e);this.map.isDefine&&((b=this.module)&&void 0!==b.exports&&b.exports!==
this.exports?e=b.exports:void 0===e&&this.usingExports&&(e=this.exports));if(a)return a.requireMap=this.map,a.requireModules=this.map.isDefine?[this.map.id]:null,a.requireType=this.map.isDefine?"define":"require",w(this.error=a)}else e=n;this.exports=e;if(this.map.isDefine&&!this.ignore&&(r[c]=e,h.onResourceLoad))h.onResourceLoad(k,this.map,this.depMaps);y(c);this.defined=!0}this.defining=!1;this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=
!0)}}else this.fetch()}},callPlugin:function(){var a=this.map,b=a.id,d=l(a.prefix);this.depMaps.push(d);u(d,"defined",v(this,function(e){var n,d;d=this.map.name;var g=this.map.parentMap?this.map.parentMap.name:null,C=k.makeRequire(a.parentMap,{enableBuildCallback:!0});if(this.map.unnormalized){if(e.normalize&&(d=e.normalize(d,function(a){return c(a,g,!0)})||""),e=l(a.prefix+"!"+d,this.map.parentMap),u(e,"defined",v(this,function(a){this.init([],function(){return a},null,{enabled:!0,ignore:!0})})),
d=m(q,e.id)){this.depMaps.push(e);if(this.events.error)d.on("error",v(this,function(a){this.emit("error",a)}));d.enable()}}else n=v(this,function(a){this.init([],function(){return a},null,{enabled:!0})}),n.error=v(this,function(a){this.inited=!0;this.error=a;a.requireModules=[b];H(q,function(a){0===a.map.id.indexOf(b+"_unnormalized")&&y(a.map.id)});w(a)}),n.fromText=v(this,function(e,c){var d=a.name,g=l(d),i=Q;c&&(e=c);i&&(Q=!1);s(g);t(j.config,b)&&(j.config[d]=j.config[b]);try{h.exec(e)}catch(D){return w(B("fromtexteval",
"fromText eval for "+b+" failed: "+D,D,[b]))}i&&(Q=!0);this.depMaps.push(g);k.completeLoad(d);C([d],n)}),e.load(a.name,C,n,j)}));k.enable(d,this);this.pluginMaps[d.id]=d},enable:function(){W[this.map.id]=this;this.enabling=this.enabled=!0;z(this.depMaps,v(this,function(a,b){var c,e;if("string"===typeof a){a=l(a,this.map.isDefine?this.map:this.map.parentMap,!1,!this.skipMap);this.depMaps[b]=a;if(c=m(P,a.id)){this.depExports[b]=c(this);return}this.depCount+=1;u(a,"defined",v(this,function(a){this.defineDep(b,
a);this.check()}));this.errback&&u(a,"error",v(this,this.errback))}c=a.id;e=q[c];!t(P,c)&&(e&&!e.enabled)&&k.enable(a,this)}));H(this.pluginMaps,v(this,function(a){var b=m(q,a.id);b&&!b.enabled&&k.enable(a,this)}));this.enabling=!1;this.check()},on:function(a,b){var c=this.events[a];c||(c=this.events[a]=[]);c.push(b)},emit:function(a,b){z(this.events[a],function(a){a(b)});"error"===a&&delete this.events[a]}};k={config:j,contextName:b,registry:q,defined:r,urlFetched:V,defQueue:I,Module:$,makeModuleMap:l,
nextTick:h.nextTick,onError:w,configure:function(a){a.baseUrl&&"/"!==a.baseUrl.charAt(a.baseUrl.length-1)&&(a.baseUrl+="/");var b=j.pkgs,c=j.shim,e={paths:!0,config:!0,map:!0};H(a,function(a,b){e[b]?"map"===b?(j.map||(j.map={}),S(j[b],a,!0,!0)):S(j[b],a,!0):j[b]=a});a.shim&&(H(a.shim,function(a,b){K(a)&&(a={deps:a});if((a.exports||a.init)&&!a.exportsFn)a.exportsFn=k.makeShimExports(a);c[b]=a}),j.shim=c);a.packages&&(z(a.packages,function(a){a="string"===typeof a?{name:a}:a;b[a.name]={name:a.name,
location:a.location||a.name,main:(a.main||"main").replace(ka,"").replace(fa,"")}}),j.pkgs=b);H(q,function(a,b){!a.inited&&!a.map.unnormalized&&(a.map=l(b))});if(a.deps||a.callback)k.require(a.deps||[],a.callback)},makeShimExports:function(a){return function(){var b;a.init&&(b=a.init.apply(ba,arguments));return b||a.exports&&da(a.exports)}},makeRequire:function(a,f){function d(e,c,g){var i,j;f.enableBuildCallback&&(c&&J(c))&&(c.__requireJsBuild=!0);if("string"===typeof e){if(J(c))return w(B("requireargs",
"Invalid require call"),g);if(a&&t(P,e))return P[e](q[a.id]);if(h.get)return h.get(k,e,a,d);i=l(e,a,!1,!0);i=i.id;return!t(r,i)?w(B("notloaded",'Module name "'+i+'" has not been loaded yet for context: '+b+(a?"":". Use require([])"))):r[i]}M();k.nextTick(function(){M();j=s(l(null,a));j.skipMap=f.skipMap;j.init(e,c,g,{enabled:!0});E()});return d}f=f||{};S(d,{isBrowser:A,toUrl:function(b){var d,f=b.lastIndexOf("."),g=b.split("/")[0];if(-1!==f&&(!("."===g||".."===g)||1<f))d=b.substring(f,b.length),b=
b.substring(0,f);return k.nameToUrl(c(b,a&&a.id,!0),d,!0)},defined:function(b){return t(r,l(b,a,!1,!0).id)},specified:function(b){b=l(b,a,!1,!0).id;return t(r,b)||t(q,b)}});a||(d.undef=function(b){x();var c=l(b,a,!0),d=m(q,b);delete r[b];delete V[c.url];delete aa[b];d&&(d.events.defined&&(aa[b]=d.events),y(b))});return d},enable:function(a){m(q,a.id)&&s(a).enable()},completeLoad:function(a){var b,c,e=m(j.shim,a)||{},d=e.exports;for(x();I.length;){c=I.shift();if(null===c[0]){c[0]=a;if(b)break;b=!0}else c[0]===
a&&(b=!0);F(c)}c=m(q,a);if(!b&&!t(r,a)&&c&&!c.inited){if(j.enforceDefine&&(!d||!da(d)))return p(a)?void 0:w(B("nodefine","No define call for "+a,null,[a]));F([a,e.deps||[],e.exportsFn])}E()},nameToUrl:function(a,b,c){var d,g,l,i,k,p;if(h.jsExtRegExp.test(a))i=a+(b||"");else{d=j.paths;g=j.pkgs;i=a.split("/");for(k=i.length;0<k;k-=1)if(p=i.slice(0,k).join("/"),l=m(g,p),p=m(d,p)){K(p)&&(p=p[0]);i.splice(0,k,p);break}else if(l){a=a===l.name?l.location+"/"+l.main:l.location;i.splice(0,k,a);break}i=i.join("/");
i+=b||(/\?/.test(i)||c?"":".js");i=("/"===i.charAt(0)||i.match(/^[\w\+\.\-]+:/)?"":j.baseUrl)+i}return j.urlArgs?i+((-1===i.indexOf("?")?"?":"&")+j.urlArgs):i},load:function(a,b){h.load(k,a,b)},execCb:function(a,b,c,d){return b.apply(d,c)},onScriptLoad:function(a){if("load"===a.type||la.test((a.currentTarget||a.srcElement).readyState))R=null,a=L(a),k.completeLoad(a.id)},onScriptError:function(a){var b=L(a);if(!p(b.id))return w(B("scripterror","Script error for: "+b.id,a,[b.id]))}};k.require=k.makeRequire();
return k}var h,x,y,E,L,F,R,M,s,ga,ma=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/mg,na=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,fa=/\.js$/,ka=/^\.\//;x=Object.prototype;var N=x.toString,ha=x.hasOwnProperty,ja=Array.prototype.splice,A=!!("undefined"!==typeof window&&navigator&&window.document),ea=!A&&"undefined"!==typeof importScripts,la=A&&"PLAYSTATION 3"===navigator.platform?/^complete$/:/^(complete|loaded)$/,Z="undefined"!==typeof opera&&"[object Opera]"===opera.toString(),G={},u={},U=[],Q=
!1;if("undefined"===typeof define){if("undefined"!==typeof requirejs){if(J(requirejs))return;u=requirejs;requirejs=void 0}"undefined"!==typeof require&&!J(require)&&(u=require,require=void 0);h=requirejs=function(b,c,d,p){var g,l="_";!K(b)&&"string"!==typeof b&&(g=b,K(c)?(b=c,c=d,d=p):b=[]);g&&g.context&&(l=g.context);(p=m(G,l))||(p=G[l]=h.s.newContext(l));g&&p.configure(g);return p.require(b,c,d)};h.config=function(b){return h(b)};h.nextTick="undefined"!==typeof setTimeout?function(b){setTimeout(b,
4)}:function(b){b()};require||(require=h);h.version="2.1.6";h.jsExtRegExp=/^\/|:|\?|\.js$/;h.isBrowser=A;x=h.s={contexts:G,newContext:ia};h({});z(["toUrl","undef","defined","specified"],function(b){h[b]=function(){var c=G._;return c.require[b].apply(c,arguments)}});if(A&&(y=x.head=document.getElementsByTagName("head")[0],E=document.getElementsByTagName("base")[0]))y=x.head=E.parentNode;h.onError=ca;h.load=function(b,c,d){var h=b&&b.config||{},g;if(A)return g=h.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml",
"html:script"):document.createElement("script"),g.type=h.scriptType||"text/javascript",g.charset="utf-8",g.async=!0,g.setAttribute("data-requirecontext",b.contextName),g.setAttribute("data-requiremodule",c),g.attachEvent&&!(g.attachEvent.toString&&0>g.attachEvent.toString().indexOf("[native code"))&&!Z?(Q=!0,g.attachEvent("onreadystatechange",b.onScriptLoad)):(g.addEventListener("load",b.onScriptLoad,!1),g.addEventListener("error",b.onScriptError,!1)),g.src=d,M=g,E?y.insertBefore(g,E):y.appendChild(g),
M=null,g;if(ea)try{importScripts(d),b.completeLoad(c)}catch(l){b.onError(B("importscripts","importScripts failed for "+c+" at "+d,l,[c]))}};A&&O(document.getElementsByTagName("script"),function(b){y||(y=b.parentNode);if(L=b.getAttribute("data-main"))return s=L,u.baseUrl||(F=s.split("/"),s=F.pop(),ga=F.length?F.join("/")+"/":"./",u.baseUrl=ga),s=s.replace(fa,""),h.jsExtRegExp.test(s)&&(s=L),u.deps=u.deps?u.deps.concat(s):[s],!0});define=function(b,c,d){var h,g;"string"!==typeof b&&(d=c,c=b,b=null);
K(c)||(d=c,c=null);!c&&J(d)&&(c=[],d.length&&(d.toString().replace(ma,"").replace(na,function(b,d){c.push(d)}),c=(1===d.length?["require"]:["require","exports","module"]).concat(c)));if(Q){if(!(h=M))R&&"interactive"===R.readyState||O(document.getElementsByTagName("script"),function(b){if("interactive"===b.readyState)return R=b}),h=R;h&&(b||(b=h.getAttribute("data-requiremodule")),g=G[h.getAttribute("data-requirecontext")])}(g?g.defQueue:U).push([b,c,d])};define.amd={jQuery:!0};h.exec=function(b){return eval(b)};
h(u)}})(this);
; 
 
//@ sourceURL=/js/underscore-1.4.4.min.js 
(function(){var n=this,t=n._,r={},e=Array.prototype,u=Object.prototype,i=Function.prototype,a=e.push,o=e.slice,c=e.concat,l=u.toString,f=u.hasOwnProperty,s=e.forEach,p=e.map,h=e.reduce,v=e.reduceRight,d=e.filter,g=e.every,m=e.some,y=e.indexOf,b=e.lastIndexOf,x=Array.isArray,_=Object.keys,j=i.bind,w=function(n){return n instanceof w?n:this instanceof w?(this._wrapped=n,void 0):new w(n)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=w),exports._=w):n._=w,w.VERSION="1.4.4";var A=w.each=w.forEach=function(n,t,e){if(null!=n)if(s&&n.forEach===s)n.forEach(t,e);else if(n.length===+n.length){for(var u=0,i=n.length;i>u;u++)if(t.call(e,n[u],u,n)===r)return}else for(var a in n)if(w.has(n,a)&&t.call(e,n[a],a,n)===r)return};w.map=w.collect=function(n,t,r){var e=[];return null==n?e:p&&n.map===p?n.map(t,r):(A(n,function(n,u,i){e[e.length]=t.call(r,n,u,i)}),e)};var O="Reduce of empty array with no initial value";w.reduce=w.foldl=w.inject=function(n,t,r,e){var u=arguments.length>2;if(null==n&&(n=[]),h&&n.reduce===h)return e&&(t=w.bind(t,e)),u?n.reduce(t,r):n.reduce(t);if(A(n,function(n,i,a){u?r=t.call(e,r,n,i,a):(r=n,u=!0)}),!u)throw new TypeError(O);return r},w.reduceRight=w.foldr=function(n,t,r,e){var u=arguments.length>2;if(null==n&&(n=[]),v&&n.reduceRight===v)return e&&(t=w.bind(t,e)),u?n.reduceRight(t,r):n.reduceRight(t);var i=n.length;if(i!==+i){var a=w.keys(n);i=a.length}if(A(n,function(o,c,l){c=a?a[--i]:--i,u?r=t.call(e,r,n[c],c,l):(r=n[c],u=!0)}),!u)throw new TypeError(O);return r},w.find=w.detect=function(n,t,r){var e;return E(n,function(n,u,i){return t.call(r,n,u,i)?(e=n,!0):void 0}),e},w.filter=w.select=function(n,t,r){var e=[];return null==n?e:d&&n.filter===d?n.filter(t,r):(A(n,function(n,u,i){t.call(r,n,u,i)&&(e[e.length]=n)}),e)},w.reject=function(n,t,r){return w.filter(n,function(n,e,u){return!t.call(r,n,e,u)},r)},w.every=w.all=function(n,t,e){t||(t=w.identity);var u=!0;return null==n?u:g&&n.every===g?n.every(t,e):(A(n,function(n,i,a){return(u=u&&t.call(e,n,i,a))?void 0:r}),!!u)};var E=w.some=w.any=function(n,t,e){t||(t=w.identity);var u=!1;return null==n?u:m&&n.some===m?n.some(t,e):(A(n,function(n,i,a){return u||(u=t.call(e,n,i,a))?r:void 0}),!!u)};w.contains=w.include=function(n,t){return null==n?!1:y&&n.indexOf===y?n.indexOf(t)!=-1:E(n,function(n){return n===t})},w.invoke=function(n,t){var r=o.call(arguments,2),e=w.isFunction(t);return w.map(n,function(n){return(e?t:n[t]).apply(n,r)})},w.pluck=function(n,t){return w.map(n,function(n){return n[t]})},w.where=function(n,t,r){return w.isEmpty(t)?r?null:[]:w[r?"find":"filter"](n,function(n){for(var r in t)if(t[r]!==n[r])return!1;return!0})},w.findWhere=function(n,t){return w.where(n,t,!0)},w.max=function(n,t,r){if(!t&&w.isArray(n)&&n[0]===+n[0]&&65535>n.length)return Math.max.apply(Math,n);if(!t&&w.isEmpty(n))return-1/0;var e={computed:-1/0,value:-1/0};return A(n,function(n,u,i){var a=t?t.call(r,n,u,i):n;a>=e.computed&&(e={value:n,computed:a})}),e.value},w.min=function(n,t,r){if(!t&&w.isArray(n)&&n[0]===+n[0]&&65535>n.length)return Math.min.apply(Math,n);if(!t&&w.isEmpty(n))return 1/0;var e={computed:1/0,value:1/0};return A(n,function(n,u,i){var a=t?t.call(r,n,u,i):n;e.computed>a&&(e={value:n,computed:a})}),e.value},w.shuffle=function(n){var t,r=0,e=[];return A(n,function(n){t=w.random(r++),e[r-1]=e[t],e[t]=n}),e};var k=function(n){return w.isFunction(n)?n:function(t){return t[n]}};w.sortBy=function(n,t,r){var e=k(t);return w.pluck(w.map(n,function(n,t,u){return{value:n,index:t,criteria:e.call(r,n,t,u)}}).sort(function(n,t){var r=n.criteria,e=t.criteria;if(r!==e){if(r>e||r===void 0)return 1;if(e>r||e===void 0)return-1}return n.index<t.index?-1:1}),"value")};var F=function(n,t,r,e){var u={},i=k(t||w.identity);return A(n,function(t,a){var o=i.call(r,t,a,n);e(u,o,t)}),u};w.groupBy=function(n,t,r){return F(n,t,r,function(n,t,r){(w.has(n,t)?n[t]:n[t]=[]).push(r)})},w.countBy=function(n,t,r){return F(n,t,r,function(n,t){w.has(n,t)||(n[t]=0),n[t]++})},w.sortedIndex=function(n,t,r,e){r=null==r?w.identity:k(r);for(var u=r.call(e,t),i=0,a=n.length;a>i;){var o=i+a>>>1;u>r.call(e,n[o])?i=o+1:a=o}return i},w.toArray=function(n){return n?w.isArray(n)?o.call(n):n.length===+n.length?w.map(n,w.identity):w.values(n):[]},w.size=function(n){return null==n?0:n.length===+n.length?n.length:w.keys(n).length},w.first=w.head=w.take=function(n,t,r){return null==n?void 0:null==t||r?n[0]:o.call(n,0,t)},w.initial=function(n,t,r){return o.call(n,0,n.length-(null==t||r?1:t))},w.last=function(n,t,r){return null==n?void 0:null==t||r?n[n.length-1]:o.call(n,Math.max(n.length-t,0))},w.rest=w.tail=w.drop=function(n,t,r){return o.call(n,null==t||r?1:t)},w.compact=function(n){return w.filter(n,w.identity)};var R=function(n,t,r){return A(n,function(n){w.isArray(n)?t?a.apply(r,n):R(n,t,r):r.push(n)}),r};w.flatten=function(n,t){return R(n,t,[])},w.without=function(n){return w.difference(n,o.call(arguments,1))},w.uniq=w.unique=function(n,t,r,e){w.isFunction(t)&&(e=r,r=t,t=!1);var u=r?w.map(n,r,e):n,i=[],a=[];return A(u,function(r,e){(t?e&&a[a.length-1]===r:w.contains(a,r))||(a.push(r),i.push(n[e]))}),i},w.union=function(){return w.uniq(c.apply(e,arguments))},w.intersection=function(n){var t=o.call(arguments,1);return w.filter(w.uniq(n),function(n){return w.every(t,function(t){return w.indexOf(t,n)>=0})})},w.difference=function(n){var t=c.apply(e,o.call(arguments,1));return w.filter(n,function(n){return!w.contains(t,n)})},w.zip=function(){for(var n=o.call(arguments),t=w.max(w.pluck(n,"length")),r=Array(t),e=0;t>e;e++)r[e]=w.pluck(n,""+e);return r},w.object=function(n,t){if(null==n)return{};for(var r={},e=0,u=n.length;u>e;e++)t?r[n[e]]=t[e]:r[n[e][0]]=n[e][1];return r},w.indexOf=function(n,t,r){if(null==n)return-1;var e=0,u=n.length;if(r){if("number"!=typeof r)return e=w.sortedIndex(n,t),n[e]===t?e:-1;e=0>r?Math.max(0,u+r):r}if(y&&n.indexOf===y)return n.indexOf(t,r);for(;u>e;e++)if(n[e]===t)return e;return-1},w.lastIndexOf=function(n,t,r){if(null==n)return-1;var e=null!=r;if(b&&n.lastIndexOf===b)return e?n.lastIndexOf(t,r):n.lastIndexOf(t);for(var u=e?r:n.length;u--;)if(n[u]===t)return u;return-1},w.range=function(n,t,r){1>=arguments.length&&(t=n||0,n=0),r=arguments[2]||1;for(var e=Math.max(Math.ceil((t-n)/r),0),u=0,i=Array(e);e>u;)i[u++]=n,n+=r;return i},w.bind=function(n,t){if(n.bind===j&&j)return j.apply(n,o.call(arguments,1));var r=o.call(arguments,2);return function(){return n.apply(t,r.concat(o.call(arguments)))}},w.partial=function(n){var t=o.call(arguments,1);return function(){return n.apply(this,t.concat(o.call(arguments)))}},w.bindAll=function(n){var t=o.call(arguments,1);return 0===t.length&&(t=w.functions(n)),A(t,function(t){n[t]=w.bind(n[t],n)}),n},w.memoize=function(n,t){var r={};return t||(t=w.identity),function(){var e=t.apply(this,arguments);return w.has(r,e)?r[e]:r[e]=n.apply(this,arguments)}},w.delay=function(n,t){var r=o.call(arguments,2);return setTimeout(function(){return n.apply(null,r)},t)},w.defer=function(n){return w.delay.apply(w,[n,1].concat(o.call(arguments,1)))},w.throttle=function(n,t){var r,e,u,i,a=0,o=function(){a=new Date,u=null,i=n.apply(r,e)};return function(){var c=new Date,l=t-(c-a);return r=this,e=arguments,0>=l?(clearTimeout(u),u=null,a=c,i=n.apply(r,e)):u||(u=setTimeout(o,l)),i}},w.debounce=function(n,t,r){var e,u;return function(){var i=this,a=arguments,o=function(){e=null,r||(u=n.apply(i,a))},c=r&&!e;return clearTimeout(e),e=setTimeout(o,t),c&&(u=n.apply(i,a)),u}},w.once=function(n){var t,r=!1;return function(){return r?t:(r=!0,t=n.apply(this,arguments),n=null,t)}},w.wrap=function(n,t){return function(){var r=[n];return a.apply(r,arguments),t.apply(this,r)}},w.compose=function(){var n=arguments;return function(){for(var t=arguments,r=n.length-1;r>=0;r--)t=[n[r].apply(this,t)];return t[0]}},w.after=function(n,t){return 0>=n?t():function(){return 1>--n?t.apply(this,arguments):void 0}},w.keys=_||function(n){if(n!==Object(n))throw new TypeError("Invalid object");var t=[];for(var r in n)w.has(n,r)&&(t[t.length]=r);return t},w.values=function(n){var t=[];for(var r in n)w.has(n,r)&&t.push(n[r]);return t},w.pairs=function(n){var t=[];for(var r in n)w.has(n,r)&&t.push([r,n[r]]);return t},w.invert=function(n){var t={};for(var r in n)w.has(n,r)&&(t[n[r]]=r);return t},w.functions=w.methods=function(n){var t=[];for(var r in n)w.isFunction(n[r])&&t.push(r);return t.sort()},w.extend=function(n){return A(o.call(arguments,1),function(t){if(t)for(var r in t)n[r]=t[r]}),n},w.pick=function(n){var t={},r=c.apply(e,o.call(arguments,1));return A(r,function(r){r in n&&(t[r]=n[r])}),t},w.omit=function(n){var t={},r=c.apply(e,o.call(arguments,1));for(var u in n)w.contains(r,u)||(t[u]=n[u]);return t},w.defaults=function(n){return A(o.call(arguments,1),function(t){if(t)for(var r in t)null==n[r]&&(n[r]=t[r])}),n},w.clone=function(n){return w.isObject(n)?w.isArray(n)?n.slice():w.extend({},n):n},w.tap=function(n,t){return t(n),n};var I=function(n,t,r,e){if(n===t)return 0!==n||1/n==1/t;if(null==n||null==t)return n===t;n instanceof w&&(n=n._wrapped),t instanceof w&&(t=t._wrapped);var u=l.call(n);if(u!=l.call(t))return!1;switch(u){case"[object String]":return n==t+"";case"[object Number]":return n!=+n?t!=+t:0==n?1/n==1/t:n==+t;case"[object Date]":case"[object Boolean]":return+n==+t;case"[object RegExp]":return n.source==t.source&&n.global==t.global&&n.multiline==t.multiline&&n.ignoreCase==t.ignoreCase}if("object"!=typeof n||"object"!=typeof t)return!1;for(var i=r.length;i--;)if(r[i]==n)return e[i]==t;r.push(n),e.push(t);var a=0,o=!0;if("[object Array]"==u){if(a=n.length,o=a==t.length)for(;a--&&(o=I(n[a],t[a],r,e)););}else{var c=n.constructor,f=t.constructor;if(c!==f&&!(w.isFunction(c)&&c instanceof c&&w.isFunction(f)&&f instanceof f))return!1;for(var s in n)if(w.has(n,s)&&(a++,!(o=w.has(t,s)&&I(n[s],t[s],r,e))))break;if(o){for(s in t)if(w.has(t,s)&&!a--)break;o=!a}}return r.pop(),e.pop(),o};w.isEqual=function(n,t){return I(n,t,[],[])},w.isEmpty=function(n){if(null==n)return!0;if(w.isArray(n)||w.isString(n))return 0===n.length;for(var t in n)if(w.has(n,t))return!1;return!0},w.isElement=function(n){return!(!n||1!==n.nodeType)},w.isArray=x||function(n){return"[object Array]"==l.call(n)},w.isObject=function(n){return n===Object(n)},A(["Arguments","Function","String","Number","Date","RegExp"],function(n){w["is"+n]=function(t){return l.call(t)=="[object "+n+"]"}}),w.isArguments(arguments)||(w.isArguments=function(n){return!(!n||!w.has(n,"callee"))}),"function"!=typeof/./&&(w.isFunction=function(n){return"function"==typeof n}),w.isFinite=function(n){return isFinite(n)&&!isNaN(parseFloat(n))},w.isNaN=function(n){return w.isNumber(n)&&n!=+n},w.isBoolean=function(n){return n===!0||n===!1||"[object Boolean]"==l.call(n)},w.isNull=function(n){return null===n},w.isUndefined=function(n){return n===void 0},w.has=function(n,t){return f.call(n,t)},w.noConflict=function(){return n._=t,this},w.identity=function(n){return n},w.times=function(n,t,r){for(var e=Array(n),u=0;n>u;u++)e[u]=t.call(r,u);return e},w.random=function(n,t){return null==t&&(t=n,n=0),n+Math.floor(Math.random()*(t-n+1))};var M={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};M.unescape=w.invert(M.escape);var S={escape:RegExp("["+w.keys(M.escape).join("")+"]","g"),unescape:RegExp("("+w.keys(M.unescape).join("|")+")","g")};w.each(["escape","unescape"],function(n){w[n]=function(t){return null==t?"":(""+t).replace(S[n],function(t){return M[n][t]})}}),w.result=function(n,t){if(null==n)return null;var r=n[t];return w.isFunction(r)?r.call(n):r},w.mixin=function(n){A(w.functions(n),function(t){var r=w[t]=n[t];w.prototype[t]=function(){var n=[this._wrapped];return a.apply(n,arguments),D.call(this,r.apply(w,n))}})};var N=0;w.uniqueId=function(n){var t=++N+"";return n?n+t:t},w.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var T=/(.)^/,q={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},B=/\\|'|\r|\n|\t|\u2028|\u2029/g;w.template=function(n,t,r){var e;r=w.defaults({},r,w.templateSettings);var u=RegExp([(r.escape||T).source,(r.interpolate||T).source,(r.evaluate||T).source].join("|")+"|$","g"),i=0,a="__p+='";n.replace(u,function(t,r,e,u,o){return a+=n.slice(i,o).replace(B,function(n){return"\\"+q[n]}),r&&(a+="'+\n((__t=("+r+"))==null?'':_.escape(__t))+\n'"),e&&(a+="'+\n((__t=("+e+"))==null?'':__t)+\n'"),u&&(a+="';\n"+u+"\n__p+='"),i=o+t.length,t}),a+="';\n",r.variable||(a="with(obj||{}){\n"+a+"}\n"),a="var __t,__p='',__j=Array.prototype.join,"+"print=function(){__p+=__j.call(arguments,'');};\n"+a+"return __p;\n";try{e=Function(r.variable||"obj","_",a)}catch(o){throw o.source=a,o}if(t)return e(t,w);var c=function(n){return e.call(this,n,w)};return c.source="function("+(r.variable||"obj")+"){\n"+a+"}",c},w.chain=function(n){return w(n).chain()};var D=function(n){return this._chain?w(n).chain():n};w.mixin(w),A(["pop","push","reverse","shift","sort","splice","unshift"],function(n){var t=e[n];w.prototype[n]=function(){var r=this._wrapped;return t.apply(r,arguments),"shift"!=n&&"splice"!=n||0!==r.length||delete r[0],D.call(this,r)}}),A(["concat","join","slice"],function(n){var t=e[n];w.prototype[n]=function(){return D.call(this,t.apply(this._wrapped,arguments))}}),w.extend(w.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}).call(this);; 
 
//@ sourceURL=/js/backbone-1.0.0.min.js 
(function(){var t=this;var e=t.Backbone;var i=[];var r=i.push;var s=i.slice;var n=i.splice;var a;if(typeof exports!=="undefined"){a=exports}else{a=t.Backbone={}}a.VERSION="1.0.0";var h=t._;if(!h&&typeof require!=="undefined")h=require("underscore");a.$=t.jQuery||t.Zepto||t.ender||t.$;a.noConflict=function(){t.Backbone=e;return this};a.emulateHTTP=false;a.emulateJSON=false;var o=a.Events={on:function(t,e,i){if(!l(this,"on",t,[e,i])||!e)return this;this._events||(this._events={});var r=this._events[t]||(this._events[t]=[]);r.push({callback:e,context:i,ctx:i||this});return this},once:function(t,e,i){if(!l(this,"once",t,[e,i])||!e)return this;var r=this;var s=h.once(function(){r.off(t,s);e.apply(this,arguments)});s._callback=e;return this.on(t,s,i)},off:function(t,e,i){var r,s,n,a,o,u,c,f;if(!this._events||!l(this,"off",t,[e,i]))return this;if(!t&&!e&&!i){this._events={};return this}a=t?[t]:h.keys(this._events);for(o=0,u=a.length;o<u;o++){t=a[o];if(n=this._events[t]){this._events[t]=r=[];if(e||i){for(c=0,f=n.length;c<f;c++){s=n[c];if(e&&e!==s.callback&&e!==s.callback._callback||i&&i!==s.context){r.push(s)}}}if(!r.length)delete this._events[t]}}return this},trigger:function(t){if(!this._events)return this;var e=s.call(arguments,1);if(!l(this,"trigger",t,e))return this;var i=this._events[t];var r=this._events.all;if(i)c(i,e);if(r)c(r,arguments);return this},stopListening:function(t,e,i){var r=this._listeners;if(!r)return this;var s=!e&&!i;if(typeof e==="object")i=this;if(t)(r={})[t._listenerId]=t;for(var n in r){r[n].off(e,i,this);if(s)delete this._listeners[n]}return this}};var u=/\s+/;var l=function(t,e,i,r){if(!i)return true;if(typeof i==="object"){for(var s in i){t[e].apply(t,[s,i[s]].concat(r))}return false}if(u.test(i)){var n=i.split(u);for(var a=0,h=n.length;a<h;a++){t[e].apply(t,[n[a]].concat(r))}return false}return true};var c=function(t,e){var i,r=-1,s=t.length,n=e[0],a=e[1],h=e[2];switch(e.length){case 0:while(++r<s)(i=t[r]).callback.call(i.ctx);return;case 1:while(++r<s)(i=t[r]).callback.call(i.ctx,n);return;case 2:while(++r<s)(i=t[r]).callback.call(i.ctx,n,a);return;case 3:while(++r<s)(i=t[r]).callback.call(i.ctx,n,a,h);return;default:while(++r<s)(i=t[r]).callback.apply(i.ctx,e)}};var f={listenTo:"on",listenToOnce:"once"};h.each(f,function(t,e){o[e]=function(e,i,r){var s=this._listeners||(this._listeners={});var n=e._listenerId||(e._listenerId=h.uniqueId("l"));s[n]=e;if(typeof i==="object")r=this;e[t](i,r,this);return this}});o.bind=o.on;o.unbind=o.off;h.extend(a,o);var d=a.Model=function(t,e){var i;var r=t||{};e||(e={});this.cid=h.uniqueId("c");this.attributes={};h.extend(this,h.pick(e,p));if(e.parse)r=this.parse(r,e)||{};if(i=h.result(this,"defaults")){r=h.defaults({},r,i)}this.set(r,e);this.changed={};this.initialize.apply(this,arguments)};var p=["url","urlRoot","collection"];h.extend(d.prototype,o,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(t){return h.clone(this.attributes)},sync:function(){return a.sync.apply(this,arguments)},get:function(t){return this.attributes[t]},escape:function(t){return h.escape(this.get(t))},has:function(t){return this.get(t)!=null},set:function(t,e,i){var r,s,n,a,o,u,l,c;if(t==null)return this;if(typeof t==="object"){s=t;i=e}else{(s={})[t]=e}i||(i={});if(!this._validate(s,i))return false;n=i.unset;o=i.silent;a=[];u=this._changing;this._changing=true;if(!u){this._previousAttributes=h.clone(this.attributes);this.changed={}}c=this.attributes,l=this._previousAttributes;if(this.idAttribute in s)this.id=s[this.idAttribute];for(r in s){e=s[r];if(!h.isEqual(c[r],e))a.push(r);if(!h.isEqual(l[r],e)){this.changed[r]=e}else{delete this.changed[r]}n?delete c[r]:c[r]=e}if(!o){if(a.length)this._pending=true;for(var f=0,d=a.length;f<d;f++){this.trigger("change:"+a[f],this,c[a[f]],i)}}if(u)return this;if(!o){while(this._pending){this._pending=false;this.trigger("change",this,i)}}this._pending=false;this._changing=false;return this},unset:function(t,e){return this.set(t,void 0,h.extend({},e,{unset:true}))},clear:function(t){var e={};for(var i in this.attributes)e[i]=void 0;return this.set(e,h.extend({},t,{unset:true}))},hasChanged:function(t){if(t==null)return!h.isEmpty(this.changed);return h.has(this.changed,t)},changedAttributes:function(t){if(!t)return this.hasChanged()?h.clone(this.changed):false;var e,i=false;var r=this._changing?this._previousAttributes:this.attributes;for(var s in t){if(h.isEqual(r[s],e=t[s]))continue;(i||(i={}))[s]=e}return i},previous:function(t){if(t==null||!this._previousAttributes)return null;return this._previousAttributes[t]},previousAttributes:function(){return h.clone(this._previousAttributes)},fetch:function(t){t=t?h.clone(t):{};if(t.parse===void 0)t.parse=true;var e=this;var i=t.success;t.success=function(r){if(!e.set(e.parse(r,t),t))return false;if(i)i(e,r,t);e.trigger("sync",e,r,t)};R(this,t);return this.sync("read",this,t)},save:function(t,e,i){var r,s,n,a=this.attributes;if(t==null||typeof t==="object"){r=t;i=e}else{(r={})[t]=e}if(r&&(!i||!i.wait)&&!this.set(r,i))return false;i=h.extend({validate:true},i);if(!this._validate(r,i))return false;if(r&&i.wait){this.attributes=h.extend({},a,r)}if(i.parse===void 0)i.parse=true;var o=this;var u=i.success;i.success=function(t){o.attributes=a;var e=o.parse(t,i);if(i.wait)e=h.extend(r||{},e);if(h.isObject(e)&&!o.set(e,i)){return false}if(u)u(o,t,i);o.trigger("sync",o,t,i)};R(this,i);s=this.isNew()?"create":i.patch?"patch":"update";if(s==="patch")i.attrs=r;n=this.sync(s,this,i);if(r&&i.wait)this.attributes=a;return n},destroy:function(t){t=t?h.clone(t):{};var e=this;var i=t.success;var r=function(){e.trigger("destroy",e,e.collection,t)};t.success=function(s){if(t.wait||e.isNew())r();if(i)i(e,s,t);if(!e.isNew())e.trigger("sync",e,s,t)};if(this.isNew()){t.success();return false}R(this,t);var s=this.sync("delete",this,t);if(!t.wait)r();return s},url:function(){var t=h.result(this,"urlRoot")||h.result(this.collection,"url")||U();if(this.isNew())return t;return t+(t.charAt(t.length-1)==="/"?"":"/")+encodeURIComponent(this.id)},parse:function(t,e){return t},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return this.id==null},isValid:function(t){return this._validate({},h.extend(t||{},{validate:true}))},_validate:function(t,e){if(!e.validate||!this.validate)return true;t=h.extend({},this.attributes,t);var i=this.validationError=this.validate(t,e)||null;if(!i)return true;this.trigger("invalid",this,i,h.extend(e||{},{validationError:i}));return false}});var v=["keys","values","pairs","invert","pick","omit"];h.each(v,function(t){d.prototype[t]=function(){var e=s.call(arguments);e.unshift(this.attributes);return h[t].apply(h,e)}});var g=a.Collection=function(t,e){e||(e={});if(e.url)this.url=e.url;if(e.model)this.model=e.model;if(e.comparator!==void 0)this.comparator=e.comparator;this._reset();this.initialize.apply(this,arguments);if(t)this.reset(t,h.extend({silent:true},e))};var m={add:true,remove:true,merge:true};var y={add:true,merge:false,remove:false};h.extend(g.prototype,o,{model:d,initialize:function(){},toJSON:function(t){return this.map(function(e){return e.toJSON(t)})},sync:function(){return a.sync.apply(this,arguments)},add:function(t,e){return this.set(t,h.defaults(e||{},y))},remove:function(t,e){t=h.isArray(t)?t.slice():[t];e||(e={});var i,r,s,n;for(i=0,r=t.length;i<r;i++){n=this.get(t[i]);if(!n)continue;delete this._byId[n.id];delete this._byId[n.cid];s=this.indexOf(n);this.models.splice(s,1);this.length--;if(!e.silent){e.index=s;n.trigger("remove",n,this,e)}this._removeReference(n)}return this},set:function(t,e){e=h.defaults(e||{},m);if(e.parse)t=this.parse(t,e);if(!h.isArray(t))t=t?[t]:[];var i,s,a,o,u,l;var c=e.at;var f=this.comparator&&c==null&&e.sort!==false;var d=h.isString(this.comparator)?this.comparator:null;var p=[],v=[],g={};for(i=0,s=t.length;i<s;i++){if(!(a=this._prepareModel(t[i],e)))continue;if(u=this.get(a)){if(e.remove)g[u.cid]=true;if(e.merge){u.set(a.attributes,e);if(f&&!l&&u.hasChanged(d))l=true}}else if(e.add){p.push(a);a.on("all",this._onModelEvent,this);this._byId[a.cid]=a;if(a.id!=null)this._byId[a.id]=a}}if(e.remove){for(i=0,s=this.length;i<s;++i){if(!g[(a=this.models[i]).cid])v.push(a)}if(v.length)this.remove(v,e)}if(p.length){if(f)l=true;this.length+=p.length;if(c!=null){n.apply(this.models,[c,0].concat(p))}else{r.apply(this.models,p)}}if(l)this.sort({silent:true});if(e.silent)return this;for(i=0,s=p.length;i<s;i++){(a=p[i]).trigger("add",a,this,e)}if(l)this.trigger("sort",this,e);return this},reset:function(t,e){e||(e={});for(var i=0,r=this.models.length;i<r;i++){this._removeReference(this.models[i])}e.previousModels=this.models;this._reset();this.add(t,h.extend({silent:true},e));if(!e.silent)this.trigger("reset",this,e);return this},push:function(t,e){t=this._prepareModel(t,e);this.add(t,h.extend({at:this.length},e));return t},pop:function(t){var e=this.at(this.length-1);this.remove(e,t);return e},unshift:function(t,e){t=this._prepareModel(t,e);this.add(t,h.extend({at:0},e));return t},shift:function(t){var e=this.at(0);this.remove(e,t);return e},slice:function(t,e){return this.models.slice(t,e)},get:function(t){if(t==null)return void 0;return this._byId[t.id!=null?t.id:t.cid||t]},at:function(t){return this.models[t]},where:function(t,e){if(h.isEmpty(t))return e?void 0:[];return this[e?"find":"filter"](function(e){for(var i in t){if(t[i]!==e.get(i))return false}return true})},findWhere:function(t){return this.where(t,true)},sort:function(t){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");t||(t={});if(h.isString(this.comparator)||this.comparator.length===1){this.models=this.sortBy(this.comparator,this)}else{this.models.sort(h.bind(this.comparator,this))}if(!t.silent)this.trigger("sort",this,t);return this},sortedIndex:function(t,e,i){e||(e=this.comparator);var r=h.isFunction(e)?e:function(t){return t.get(e)};return h.sortedIndex(this.models,t,r,i)},pluck:function(t){return h.invoke(this.models,"get",t)},fetch:function(t){t=t?h.clone(t):{};if(t.parse===void 0)t.parse=true;var e=t.success;var i=this;t.success=function(r){var s=t.reset?"reset":"set";i[s](r,t);if(e)e(i,r,t);i.trigger("sync",i,r,t)};R(this,t);return this.sync("read",this,t)},create:function(t,e){e=e?h.clone(e):{};if(!(t=this._prepareModel(t,e)))return false;if(!e.wait)this.add(t,e);var i=this;var r=e.success;e.success=function(s){if(e.wait)i.add(t,e);if(r)r(t,s,e)};t.save(null,e);return t},parse:function(t,e){return t},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0;this.models=[];this._byId={}},_prepareModel:function(t,e){if(t instanceof d){if(!t.collection)t.collection=this;return t}e||(e={});e.collection=this;var i=new this.model(t,e);if(!i._validate(t,e)){this.trigger("invalid",this,t,e);return false}return i},_removeReference:function(t){if(this===t.collection)delete t.collection;t.off("all",this._onModelEvent,this)},_onModelEvent:function(t,e,i,r){if((t==="add"||t==="remove")&&i!==this)return;if(t==="destroy")this.remove(e,r);if(e&&t==="change:"+e.idAttribute){delete this._byId[e.previous(e.idAttribute)];if(e.id!=null)this._byId[e.id]=e}this.trigger.apply(this,arguments)}});var _=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","indexOf","shuffle","lastIndexOf","isEmpty","chain"];h.each(_,function(t){g.prototype[t]=function(){var e=s.call(arguments);e.unshift(this.models);return h[t].apply(h,e)}});var w=["groupBy","countBy","sortBy"];h.each(w,function(t){g.prototype[t]=function(e,i){var r=h.isFunction(e)?e:function(t){return t.get(e)};return h[t](this.models,r,i)}});var b=a.View=function(t){this.cid=h.uniqueId("view");this._configure(t||{});this._ensureElement();this.initialize.apply(this,arguments);this.delegateEvents()};var x=/^(\S+)\s*(.*)$/;var E=["model","collection","el","id","attributes","className","tagName","events"];h.extend(b.prototype,o,{tagName:"div",$:function(t){return this.$el.find(t)},initialize:function(){},render:function(){return this},remove:function(){this.$el.remove();this.stopListening();return this},setElement:function(t,e){if(this.$el)this.undelegateEvents();this.$el=t instanceof a.$?t:a.$(t);this.el=this.$el[0];if(e!==false)this.delegateEvents();return this},delegateEvents:function(t){if(!(t||(t=h.result(this,"events"))))return this;this.undelegateEvents();for(var e in t){var i=t[e];if(!h.isFunction(i))i=this[t[e]];if(!i)continue;var r=e.match(x);var s=r[1],n=r[2];i=h.bind(i,this);s+=".delegateEvents"+this.cid;if(n===""){this.$el.on(s,i)}else{this.$el.on(s,n,i)}}return this},undelegateEvents:function(){this.$el.off(".delegateEvents"+this.cid);return this},_configure:function(t){if(this.options)t=h.extend({},h.result(this,"options"),t);h.extend(this,h.pick(t,E));this.options=t},_ensureElement:function(){if(!this.el){var t=h.extend({},h.result(this,"attributes"));if(this.id)t.id=h.result(this,"id");if(this.className)t["class"]=h.result(this,"className");var e=a.$("<"+h.result(this,"tagName")+">").attr(t);this.setElement(e,false)}else{this.setElement(h.result(this,"el"),false)}}});a.sync=function(t,e,i){var r=k[t];h.defaults(i||(i={}),{emulateHTTP:a.emulateHTTP,emulateJSON:a.emulateJSON});var s={type:r,dataType:"json"};if(!i.url){s.url=h.result(e,"url")||U()}if(i.data==null&&e&&(t==="create"||t==="update"||t==="patch")){s.contentType="application/json";s.data=JSON.stringify(i.attrs||e.toJSON(i))}if(i.emulateJSON){s.contentType="application/x-www-form-urlencoded";s.data=s.data?{model:s.data}:{}}if(i.emulateHTTP&&(r==="PUT"||r==="DELETE"||r==="PATCH")){s.type="POST";if(i.emulateJSON)s.data._method=r;var n=i.beforeSend;i.beforeSend=function(t){t.setRequestHeader("X-HTTP-Method-Override",r);if(n)return n.apply(this,arguments)}}if(s.type!=="GET"&&!i.emulateJSON){s.processData=false}if(s.type==="PATCH"&&window.ActiveXObject&&!(window.external&&window.external.msActiveXFilteringEnabled)){s.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")}}var o=i.xhr=a.ajax(h.extend(s,i));e.trigger("request",e,o,i);return o};var k={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};a.ajax=function(){return a.$.ajax.apply(a.$,arguments)};var S=a.Router=function(t){t||(t={});if(t.routes)this.routes=t.routes;this._bindRoutes();this.initialize.apply(this,arguments)};var $=/\((.*?)\)/g;var T=/(\(\?)?:\w+/g;var H=/\*\w+/g;var A=/[\-{}\[\]+?.,\\\^$|#\s]/g;h.extend(S.prototype,o,{initialize:function(){},route:function(t,e,i){if(!h.isRegExp(t))t=this._routeToRegExp(t);if(h.isFunction(e)){i=e;e=""}if(!i)i=this[e];var r=this;a.history.route(t,function(s){var n=r._extractParameters(t,s);i&&i.apply(r,n);r.trigger.apply(r,["route:"+e].concat(n));r.trigger("route",e,n);a.history.trigger("route",r,e,n)});return this},navigate:function(t,e){a.history.navigate(t,e);return this},_bindRoutes:function(){if(!this.routes)return;this.routes=h.result(this,"routes");var t,e=h.keys(this.routes);while((t=e.pop())!=null){this.route(t,this.routes[t])}},_routeToRegExp:function(t){t=t.replace(A,"\\$&").replace($,"(?:$1)?").replace(T,function(t,e){return e?t:"([^/]+)"}).replace(H,"(.*?)");return new RegExp("^"+t+"$")},_extractParameters:function(t,e){var i=t.exec(e).slice(1);return h.map(i,function(t){return t?decodeURIComponent(t):null})}});var I=a.History=function(){this.handlers=[];h.bindAll(this,"checkUrl");if(typeof window!=="undefined"){this.location=window.location;this.history=window.history}};var N=/^[#\/]|\s+$/g;var P=/^\/+|\/+$/g;var O=/msie [\w.]+/;var C=/\/$/;I.started=false;h.extend(I.prototype,o,{interval:50,getHash:function(t){var e=(t||this).location.href.match(/#(.*)$/);return e?e[1]:""},getFragment:function(t,e){if(t==null){if(this._hasPushState||!this._wantsHashChange||e){t=this.location.pathname;var i=this.root.replace(C,"");if(!t.indexOf(i))t=t.substr(i.length)}else{t=this.getHash()}}return t.replace(N,"")},start:function(t){if(I.started)throw new Error("Backbone.history has already been started");I.started=true;this.options=h.extend({},{root:"/"},this.options,t);this.root=this.options.root;this._wantsHashChange=this.options.hashChange!==false;this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var e=this.getFragment();var i=document.documentMode;var r=O.exec(navigator.userAgent.toLowerCase())&&(!i||i<=7);this.root=("/"+this.root+"/").replace(P,"/");if(r&&this._wantsHashChange){this.iframe=a.$('<div class="embed-container"> <iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow;this.navigate(e)}if(this._hasPushState){a.$(window).on("popstate",this.checkUrl)}else if(this._wantsHashChange&&"onhashchange"in window&&!r){a.$(window).on("hashchange",this.checkUrl)}else if(this._wantsHashChange){this._checkUrlInterval=setInterval(this.checkUrl,this.interval)}this.fragment=e;var s=this.location;var n=s.pathname.replace(/[^\/]$/,"$&/")===this.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!n){this.fragment=this.getFragment(null,true);this.location.replace(this.root+this.location.search+"#"+this.fragment);return true}else if(this._wantsPushState&&this._hasPushState&&n&&s.hash){this.fragment=this.getHash().replace(N,"");this.history.replaceState({},document.title,this.root+this.fragment+s.search)}if(!this.options.silent)return this.loadUrl()},stop:function(){a.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl);clearInterval(this._checkUrlInterval);I.started=false},route:function(t,e){this.handlers.unshift({route:t,callback:e})},checkUrl:function(t){var e=this.getFragment();if(e===this.fragment&&this.iframe){e=this.getFragment(this.getHash(this.iframe))}if(e===this.fragment)return false;if(this.iframe)this.navigate(e);this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(t){var e=this.fragment=this.getFragment(t);var i=h.any(this.handlers,function(t){if(t.route.test(e)){t.callback(e);return true}});return i},navigate:function(t,e){if(!I.started)return false;if(!e||e===true)e={trigger:e};t=this.getFragment(t||"");if(this.fragment===t)return;this.fragment=t;var i=this.root+t;if(this._hasPushState){this.history[e.replace?"replaceState":"pushState"]({},document.title,i)}else if(this._wantsHashChange){this._updateHash(this.location,t,e.replace);if(this.iframe&&t!==this.getFragment(this.getHash(this.iframe))){if(!e.replace)this.iframe.document.open().close();this._updateHash(this.iframe.location,t,e.replace)}}else{return this.location.assign(i)}if(e.trigger)this.loadUrl(t)},_updateHash:function(t,e,i){if(i){var r=t.href.replace(/(javascript:|#).*$/,"");t.replace(r+"#"+e)}else{t.hash="#"+e}}});a.history=new I;var j=function(t,e){var i=this;var r;if(t&&h.has(t,"constructor")){r=t.constructor}else{r=function(){return i.apply(this,arguments)}}h.extend(r,i,e);var s=function(){this.constructor=r};s.prototype=i.prototype;r.prototype=new s;if(t)h.extend(r.prototype,t);r.__super__=i.prototype;return r};d.extend=g.extend=S.extend=b.extend=I.extend=j;var U=function(){throw new Error('A "url" property or function must be specified')};var R=function(t,e){var i=e.error;e.error=function(r){if(i)i(t,r,e);t.trigger("error",t,r,e)}}}).call(this);
/*
//@ sourceMappingURL=backbone-min.map
*/; 
 
//@ sourceURL=/js/mustache-0.5.0.js 
/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */
var Mustache = (typeof module !== "undefined" && module.exports) || {};

(function (exports) {

  exports.name = "mustache.js";
  exports.version = "0.5.0-dev";
  exports.tags = ["{{", "}}"];
  exports.parse = parse;
  exports.compile = compile;
  exports.render = render;
  exports.clearCache = clearCache;

  // This is here for backwards compatibility with 0.4.x.
  exports.to_html = function (template, view, partials, send) {
    var result = render(template, view, partials);

    if (typeof send === "function") {
      send(result);
    } else {
      return result;
    }
  };

  var _toString = Object.prototype.toString;
  var _isArray = Array.isArray;
  var _forEach = Array.prototype.forEach;
  var _trim = String.prototype.trim;

  var isArray;
  if (_isArray) {
    isArray = _isArray;
  } else {
    isArray = function (obj) {
      return _toString.call(obj) === "[object Array]";
    };
  }

  var forEach;
  if (_forEach) {
    forEach = function (obj, callback, scope) {
      return _forEach.call(obj, callback, scope);
    };
  } else {
    forEach = function (obj, callback, scope) {
      for (var i = 0, len = obj.length; i < len; ++i) {
        callback.call(scope, obj[i], i, obj);
      }
    };
  }

  var spaceRe = /^\s*$/;

  function isWhitespace(string) {
    return spaceRe.test(string);
  }

  var trim;
  if (_trim) {
    trim = function (string) {
      return string == null ? "" : _trim.call(string);
    };
  } else {
    var trimLeft, trimRight;

    if (isWhitespace("\xA0")) {
      trimLeft = /^\s+/;
      trimRight = /\s+$/;
    } else {
      // IE doesn't match non-breaking spaces with \s, thanks jQuery.
      trimLeft = /^[\s\xA0]+/;
      trimRight = /[\s\xA0]+$/;
    }

    trim = function (string) {
      return string == null ? "" :
        String(string).replace(trimLeft, "").replace(trimRight, "");
    };
  }

  var escapeMap = {
    "&": "&amp;",
    "<": "&lt;",
    ">": "&gt;",
    '"': '&quot;',
    "'": '&#39;'
  };

  function escapeHTML(string) {
    return String(string).replace(/&(?!\w+;)|[<>"']/g, function (s) {
      return escapeMap[s] || s;
    });
  }

  /**
   * Adds the `template`, `line`, and `file` properties to the given error
   * object and alters the message to provide more useful debugging information.
   */
  function debug(e, template, line, file) {
    file = file || "<template>";

    var lines = template.split("\n"),
        start = Math.max(line - 3, 0),
        end = Math.min(lines.length, line + 3),
        context = lines.slice(start, end);

    var c;
    for (var i = 0, len = context.length; i < len; ++i) {
      c = i + start + 1;
      context[i] = (c === line ? " >> " : "    ") + context[i];
    }

    e.template = template;
    e.line = line;
    e.file = file;
    e.message = [file + ":" + line, context.join("\n"), "", e.message].join("\n");

    return e;
  }

  /**
   * Looks up the value of the given `name` in the given context `stack`.
   */
  function lookup(name, stack, defaultValue) {
    if (name === ".") {
      return stack[stack.length - 1];
    }

    var names = name.split(".");
    var lastIndex = names.length - 1;
    var target = names[lastIndex];

    var value, context, i = stack.length, j, localStack;
    while (i) {
      localStack = stack.slice(0);
      context = stack[--i];

      j = 0;
      while (j < lastIndex) {
        context = context[names[j++]];

        if (context == null) {
          break;
        }

        localStack.push(context);
      }

      if (context && typeof context === "object" && target in context) {
        value = context[target];
        break;
      }
    }

    // If the value is a function, call it in the current context.
    if (typeof value === "function") {
      value = value.call(localStack[localStack.length - 1]);
    }

    if (value == null)  {
      return defaultValue;
    }

    return value;
  }

  function renderSection(name, stack, callback, inverted) {
    var buffer = "";
    var value =  lookup(name, stack);

    if (inverted) {
      // From the spec: inverted sections may render text once based on the
      // inverse value of the key. That is, they will be rendered if the key
      // doesn't exist, is false, or is an empty list.
      if (value == null || value === false || (isArray(value) && value.length === 0)) {
        buffer += callback();
      }
    } else if (isArray(value)) {
      forEach(value, function (value) {
        stack.push(value);
        buffer += callback();
        stack.pop();
      });
    } else if (typeof value === "object") {
      stack.push(value);
      buffer += callback();
      stack.pop();
    } else if (typeof value === "function") {
      var scope = stack[stack.length - 1];
      var scopedRender = function (template) {
        return render(template, scope);
      };
      buffer += value.call(scope, callback(), scopedRender) || "";
    } else if (value) {
      buffer += callback();
    }

    return buffer;
  }

  /**
   * Parses the given `template` and returns the source of a function that,
   * with the proper arguments, will render the template. Recognized options
   * include the following:
   *
   *   - file     The name of the file the template comes from (displayed in
   *              error messages)
   *   - tags     An array of open and close tags the `template` uses. Defaults
   *              to the value of Mustache.tags
   *   - debug    Set `true` to log the body of the generated function to the
   *              console
   *   - space    Set `true` to preserve whitespace from lines that otherwise
   *              contain only a {{tag}}. Defaults to `false`
   */
  function parse(template, options) {
    options = options || {};

    var tags = options.tags || exports.tags,
        openTag = tags[0],
        closeTag = tags[tags.length - 1];

    var code = [
      'var buffer = "";', // output buffer
      "\nvar line = 1;", // keep track of source line number
      "\ntry {",
      '\nbuffer += "'
    ];

    var spaces = [],      // indices of whitespace in code on the current line
        hasTag = false,   // is there a {{tag}} on the current line?
        nonSpace = false; // is there a non-space char on the current line?

    // Strips all space characters from the code array for the current line
    // if there was a {{tag}} on it and otherwise only spaces.
    var stripSpace = function () {
      if (hasTag && !nonSpace && !options.space) {
        while (spaces.length) {
          code.splice(spaces.pop(), 1);
        }
      } else {
        spaces = [];
      }

      hasTag = false;
      nonSpace = false;
    };

    var sectionStack = [], updateLine, nextOpenTag, nextCloseTag;

    var setTags = function (source) {
      tags = trim(source).split(/\s+/);
      nextOpenTag = tags[0];
      nextCloseTag = tags[tags.length - 1];
    };

    var includePartial = function (source) {
      code.push(
        '";',
        updateLine,
        '\nvar partial = partials["' + trim(source) + '"];',
        '\nif (partial) {',
        '\n  buffer += render(partial,stack[stack.length - 1],partials);',
        '\n}',
        '\nbuffer += "'
      );
    };

    var openSection = function (source, inverted) {
      var name = trim(source);

      if (name === "") {
        throw debug(new Error("Section name may not be empty"), template, line, options.file);
      }

      sectionStack.push({name: name, inverted: inverted});

      code.push(
        '";',
        updateLine,
        '\nvar name = "' + name + '";',
        '\nvar callback = (function () {',
        '\n  return function () {',
        '\n    var buffer = "";',
        '\nbuffer += "'
      );
    };

    var openInvertedSection = function (source) {
      openSection(source, true);
    };

    var closeSection = function (source) {
      var name = trim(source);
      var openName = sectionStack.length != 0 && sectionStack[sectionStack.length - 1].name;

      if (!openName || name != openName) {
        throw debug(new Error('Section named "' + name + '" was never opened'), template, line, options.file);
      }

      var section = sectionStack.pop();

      code.push(
        '";',
        '\n    return buffer;',
        '\n  };',
        '\n})();'
      );

      if (section.inverted) {
        code.push("\nbuffer += renderSection(name,stack,callback,true);");
      } else {
        code.push("\nbuffer += renderSection(name,stack,callback);");
      }

      code.push('\nbuffer += "');
    };

    var sendPlain = function (source) {
      code.push(
        '";',
        updateLine,
        '\nbuffer += lookup("' + trim(source) + '",stack,"");',
        '\nbuffer += "'
      );
    };

    var sendEscaped = function (source) {
      code.push(
        '";',
        updateLine,
        '\nbuffer += escapeHTML(lookup("' + trim(source) + '",stack,""));',
        '\nbuffer += "'
      );
    };

    var line = 1, c, callback;
    for (var i = 0, len = template.length; i < len; ++i) {
      if (template.slice(i, i + openTag.length) === openTag) {
        i += openTag.length;
        c = template.substr(i, 1);
        updateLine = '\nline = ' + line + ';';
        nextOpenTag = openTag;
        nextCloseTag = closeTag;
        hasTag = true;

        switch (c) {
        case "!": // comment
          i++;
          callback = null;
          break;
        case "=": // change open/close tags, e.g. {{=<% %>=}}
          i++;
          closeTag = "=" + closeTag;
          callback = setTags;
          break;
        case ">": // include partial
          i++;
          callback = includePartial;
          break;
        case "#": // start section
          i++;
          callback = openSection;
          break;
        case "^": // start inverted section
          i++;
          callback = openInvertedSection;
          break;
        case "/": // end section
          i++;
          callback = closeSection;
          break;
        case "{": // plain variable
          closeTag = "}" + closeTag;
          // fall through
        case "&": // plain variable
          i++;
          nonSpace = true;
          callback = sendPlain;
          break;
        default: // escaped variable
          nonSpace = true;
          callback = sendEscaped;
        }

        var end = template.indexOf(closeTag, i);

        if (end === -1) {
          throw debug(new Error('Tag "' + openTag + '" was not closed properly'), template, line, options.file);
        }

        var source = template.substring(i, end);

        if (callback) {
          callback(source);
        }

        // Maintain line count for \n in source.
        var n = 0;
        while (~(n = source.indexOf("\n", n))) {
          line++;
          n++;
        }

        i = end + closeTag.length - 1;
        openTag = nextOpenTag;
        closeTag = nextCloseTag;
      } else {
        c = template.substr(i, 1);

        switch (c) {
        case '"':
        case "\\":
          nonSpace = true;
          code.push("\\" + c);
          break;
        case "\r":
          // Ignore carriage returns.
          break;
        case "\n":
          spaces.push(code.length);
          code.push("\\n");
          stripSpace(); // Check for whitespace on the current line.
          line++;
          break;
        default:
          if (isWhitespace(c)) {
            spaces.push(code.length);
          } else {
            nonSpace = true;
          }

          code.push(c);
        }
      }
    }

    if (sectionStack.length != 0) {
      throw debug(new Error('Section "' + sectionStack[sectionStack.length - 1].name + '" was not closed properly'), template, line, options.file);
    }

    // Clean up any whitespace from a closing {{tag}} that was at the end
    // of the template without a trailing \n.
    stripSpace();

    code.push(
      '";',
      "\nreturn buffer;",
      "\n} catch (e) { throw {error: e, line: line}; }"
    );

    // Ignore `buffer += "";` statements.
    var body = code.join("").replace(/buffer \+= "";\n/g, "");

    if (options.debug) {
      if (typeof console != "undefined" && console.log) {
        console.log(body);
      } else if (typeof print === "function") {
        print(body);
      }
    }

    return body;
  }

  /**
   * Used by `compile` to generate a reusable function for the given `template`.
   */
  function _compile(template, options) {
    var args = "view,partials,stack,lookup,escapeHTML,renderSection,render";
    var body = parse(template, options);
    var fn = new Function(args, body);

    // This anonymous function wraps the generated function so we can do
    // argument coercion, setup some variables, and handle any errors
    // encountered while executing it.
    return function (view, partials) {
      partials = partials || {};

      var stack = [view]; // context stack

      try {
        return fn(view, partials, stack, lookup, escapeHTML, renderSection, render);
      } catch (e) {
        throw debug(e.error, template, e.line, options.file);
      }
    };
  }

  // Cache of pre-compiled templates.
  var _cache = {};

  /**
   * Clear the cache of compiled templates.
   */
  function clearCache() {
    _cache = {};
  }

  /**
   * Compiles the given `template` into a reusable function using the given
   * `options`. In addition to the options accepted by Mustache.parse,
   * recognized options include the following:
   *
   *   - cache    Set `false` to bypass any pre-compiled version of the given
   *              template. Otherwise, a given `template` string will be cached
   *              the first time it is parsed
   */
  function compile(template, options) {
    options = options || {};

    // Use a pre-compiled version from the cache if we have one.
    if (options.cache !== false) {
      if (!_cache[template]) {
        _cache[template] = _compile(template, options);
      }

      return _cache[template];
    }

    return _compile(template, options);
  }

  /**
   * High-level function that renders the given `template` using the given
   * `view` and `partials`. If you need to use any of the template options (see
   * `compile` above), you must compile in a separate step, and then call that
   * compiled function.
   */
  function render(template, view, partials) {
    return compile(template)(view, partials);
  }

})(Mustache);
; 
 
//@ sourceURL=/js/ICanHaz-no-mustache-0.10.2.min.js 
(function(){(function(){function g(a){return"".trim?a.trim():a.replace(/^\s+/,"").replace(/\s+$/,"")}var b={VERSION:"0.10.2",templates:{},$:"undefined"!==typeof window?window.jQuery||window.Zepto||null:null,addTemplate:function(a,d){if("object"===typeof a)for(var e in a)this.addTemplate(e,a[e]);else b[a]?console.error("Invalid name: "+a+"."):b.templates[a]?console.error('Template "'+a+'  " exists'):(b.templates[a]=d,b[a]=function(c,d){c=c||{};var e=Mustache.to_html(b.templates[a],c,b.templates);return b.$&&
!d?b.$(g(e)):e})},clearAll:function(){for(var a in b.templates)delete b[a];b.templates={}},refresh:function(){b.clearAll();b.grabTemplates()},grabTemplates:function(){var a,d,e=document.getElementsByTagName("script"),c,f=[];a=0;for(d=e.length;a<d;a++)if((c=e[a])&&c.innerHTML&&c.id&&("text/html"===c.type||"text/x-icanhaz"===c.type))b.addTemplate(c.id,g(c.innerHTML)),f.unshift(c);a=0;for(d=f.length;a<d;a++)f[a].parentNode.removeChild(f[a])}};"undefined"!==typeof exports?("undefined"!==typeof module&&
module.exports&&(exports=module.exports=b),exports.ich=b):this.ich=b;"undefined"!==typeof document&&(b.$?b.$(function(){b.grabTemplates()}):document.addEventListener("DOMContentLoaded",function(){b.grabTemplates()},!0))})()})();; 
 
//@ sourceURL=/js/bootstrap-tooltip.js 
!function($){var Tooltip=function(element,options){this.init("tooltip",element,options)};Tooltip.prototype={constructor:Tooltip,init:function(type,element,options){var eventIn,eventOut;this.type=type;this.$element=$(element);this.options=this.getOptions(options);this.enabled=true;if(this.options.trigger!="manual"){eventIn=this.options.trigger=="hover"?"mouseenter":"focus";eventOut=this.options.trigger=="hover"?"mouseleave":"blur";this.$element.on(eventIn,this.options.selector,$.proxy(this.enter,this));this.$element.on(eventOut,this.options.selector,$.proxy(this.leave,this))}this.options.selector?(this._options=$.extend({},this.options,{trigger:"manual",selector:""})):this.fixTitle()},getOptions:function(options){options=$.extend({},$.fn[this.type].defaults,options,this.$element.data());if(options.delay&&typeof options.delay=="number"){options.delay={show:options.delay,hide:options.delay}}return options},enter:function(e){var self=$(e.currentTarget)[this.type](this._options).data(this.type);if(!self.options.delay||!self.options.delay.show){self.show()}else{self.hoverState="in";setTimeout(function(){if(self.hoverState=="in"){self.show()}},self.options.delay.show)}},leave:function(e){var self=$(e.currentTarget)[this.type](this._options).data(this.type);if(!self.options.delay||!self.options.delay.hide){self.hide()}else{self.hoverState="out";setTimeout(function(){if(self.hoverState=="out"){self.hide()}},self.options.delay.hide)}},show:function(){var $tip,inside,pos,actualWidth,actualHeight,placement,tp;if(this.options.disableIfInside&&this.$element.closest(this.options.disableIfInside).length>0){return}if(this.hasContent()&&this.enabled){$tip=this.tip();this.setContent();if(this.options.animation){$tip.addClass("fade")}placement=typeof this.options.placement=="function"?this.options.placement.call(this,$tip[0],this.$element[0]):this.options.placement;inside=/in/.test(placement);$tip.remove().css({top:0,left:0,display:"block"}).appendTo(inside?this.$element:document.body);pos=this.getPosition(inside);actualWidth=$tip[0].offsetWidth;actualHeight=$tip[0].offsetHeight;switch(inside?placement.split(" ")[1]:placement){case"bottom":tp={top:pos.top+pos.height,left:pos.left+pos.width/2-actualWidth/2};break;case"top":tp={top:pos.top-actualHeight,left:pos.left+pos.width/2-actualWidth/2};break;case"left":tp={top:pos.top+pos.height/2-actualHeight/2,left:pos.left-actualWidth};break;case"right":tp={top:pos.top+pos.height/2-actualHeight/2,left:pos.left+pos.width};break}$tip.css(tp).addClass(placement).addClass("in");if(placement=="bottom"&&actualWidth+pos.left>=$(window).width()){var arrowPos=this.$element.offset().left+this.$element.outerWidth(true)/2-$tip.offset().left;$tip.children(".tooltip-arrow").css("left",arrowPos+"px")}if(pos.left==0&&pos.top==0){this.hide()}}},setContent:function(){var $tip=this.tip();$tip.find(".tooltip-inner")[this.options.html?"html":"text"](this.getTitle());$tip.removeClass("fade in top bottom left right")},hide:function(){var that=this,$tip=this.tip();$tip.removeClass("in");function removeWithAnimation(){var timeout=setTimeout(function(){$tip.off($.support.transition.end).remove()},500);$tip.one($.support.transition.end,function(){clearTimeout(timeout);$tip.remove()})}$.support.transition&&this.$tip.hasClass("fade")?removeWithAnimation():$tip.remove()},fixTitle:function(){var $e=this.$element;if($e.attr("title")||typeof($e.attr("data-original-title"))!="string"){$e.attr("data-original-title",$e.attr("title")||"").removeAttr("title")}},hasContent:function(){return this.getTitle()},getPosition:function(inside){if(!this.$element.is(":visible")){return{top:0,left:0,width:1,height:1}}return $.extend({},(inside?{top:0,left:0}:this.$element.offset()),{width:this.$element[0].offsetWidth,height:this.$element[0].offsetHeight})},getTitle:function(){var title,$e=this.$element,o=this.options;title=$e.attr("data-original-title")||(typeof o.title=="function"?o.title.call($e[0]):o.title);title=title.toString().replace(/(^\s*|\s*$)/,"");return title},tip:function(){return this.$tip=this.$tip||$(this.options.template)},validate:function(){if(!this.$element[0].parentNode){this.hide();this.$element=null;this.options=null}},enable:function(){this.enabled=true},disable:function(){this.enabled=false},toggleEnabled:function(){this.enabled=!this.enabled},toggle:function(){this[this.tip().hasClass("in")?"hide":"show"]()}};$.fn.tooltip=function(option){return this.each(function(){var $this=$(this),data=$this.data("tooltip"),options=typeof option=="object"&&option;if(!data){$this.data("tooltip",(data=new Tooltip(this,options)))}if(typeof option=="string"){data[option]()}})};$.fn.tooltip.Constructor=Tooltip;$.fn.tooltip.defaults={animation:true,delay:0,html:false,selector:false,placement:"top",trigger:"hover",title:"",template:'<div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',disableIfInside:".NoToolTip"}}(window.jQuery);; 
 
//@ sourceURL=/js/utils.js 
function isFunction(a){return typeof a=="function"}function isNull(a){return typeof a=="object"&&!a}function isNumber(a){return typeof a=="number"&&isFinite(a)}function isObject(a){return(typeof a=="object"&&!!a)||isFunction(a)}function isString(a){return typeof a=="string"}function isUndefined(a){return typeof a=="undefined"}function isDefined(a){return typeof a!="undefined"}function isNode(a){return typeof a=="object"&&isString(a.nodeName)}function isHTMLElement(a){return isNode(a)&&a.nodeType==1}var kMenuBarHiColor="#dda";function ArrayIndexOf(arr,obj){if(Array.indexOf){return arr.indexOf(obj)}for(var i=0;i<arr.length;i++){if(arr[i]==obj){return i}}return -1}function NocaseEqual(a,b){return a.toLowerCase()==b.toLowerCase()}var kELEMENT_NODE=1;var kATTRIBUTE_NODE=2;var kTEXT_NODE=3;var kCOMMENT_NODE=8;function DOMnodeTypeName(node){if(!isNode(node)){return"*not a Node*"}switch(node.nodeType){case kELEMENT_NODE:return"#element";case kATTRIBUTE_NODE:return"#attr";case kTEXT_NODE:return"#text";case kCOMMENT_NODE:return"#comment";default:return"NodeType="+node.nodeType}}var gMenuInvokingElem=null;var gCurrentMenuSet=0;var gCurrentMenu=null;var gCurrentMenuBase=null;var gPopupDivStack=new Array();var gXMLhttpPool=new Array();var gXMLhttpPoolStatus=new Array();var kxhFree=0;var kxhInUse=1;function XMLhttpGetAvailable(){var n=XMLhttpGetConnection();if(n>=0){return n}throw ("QuickBase javascript error: Unable to establish an http connection.")}function XMLhttpGetConnection(){for(var n=0;n<gXMLhttpPool.length;++n){if(gXMLhttpPoolStatus[n]==kxhFree){gXMLhttpPoolStatus[n]=kxhInUse;return n}}var n=gXMLhttpPool.length;if(n>=32){return -1}gXMLhttpPool[n]=XMLhttpGetInstance();if(gXMLhttpPool[n]){gXMLhttpPoolStatus[n]=kxhInUse;return n}return -1}function XMLhttpGetInstance(){var XMLhttpInstance=null;try{XMLhttpInstance=new XMLHttpRequest();if(XMLhttpInstance){return XMLhttpInstance}}catch(e){}try{XMLhttpInstance=new ActiveXObject("Msxml2.XMLHTTP");if(XMLhttpInstance){return XMLhttpInstance}}catch(e){}try{XMLhttpInstance=new ActiveXObject("Microsoft.XMLHTTP");if(XMLhttpInstance){return XMLhttpInstance}}catch(e){}return null}function jaxreq(url){this.url=url;this.params=[];this.success=false;this.qbnode=null;this.errcode=-1;this.errtext="";this.errdetails="";this.contenttype="text/xml";this.qbnodeName="qdbapi";this.method="POST";this.responsetext="";this.successMsg="";this.failureMsg="";this.popup=null;this.successURL="";this.redirectDelay=700}jaxreq.prototype.SetSuccessMsg=function(s){this.successMsg=s};jaxreq.prototype.SetFailureMsg=function(s){this.failureMsg=s};jaxreq.prototype.SetPopup=function(p){this.popup=p};jaxreq.prototype.SetContentType=function(s){this.contenttype=s};jaxreq.prototype.SetSuccessURL=function(s){this.successURL=s};jaxreq.prototype.SetRedirectDelay=function(n){this.redirectDelay=n};jaxreq.prototype.SetParams=function(s){this.params=s};jaxreq.prototype.SetQBnodeName=function(s){this.qbnodeName=s};jaxreq.prototype.SetMethodToGET=function(){this.method="GET"};jaxreq.prototype.GetXML=function(){return this.qbnode};var kAutoRefresh=true;function JaxSyncCmd(url,autoRefresh){var jax=new jaxreq(url);jax.DoSyncCmd();if(autoRefresh){if(jax.success){RefreshPage()}else{jax.ShowErrAlert()}}return jax}function JaxSyncCmdEx(jax,autoRefresh){jax.DoSyncCmd();if(autoRefresh){if(jax.success){RefreshPage()}else{jax.ShowErrAlert()}}return jax}function RefreshPage(){var newHREF=location.href;if(StringEndsWith(newHREF,"#")){newHREF=newHREF.substr(0,newHREF.length-1)}var spos=newHREF.toUpperCase().indexOf("&ORIGIID=");if(spos!=-1){var epos=newHREF.indexOf("&",spos+7);if(epos==-1){newHREF=newHREF.substr(0,spos)}else{newHREF=newHREF.substr(0,spos)+newHREF.substr(epos)}}location=newHREF}function SetLocation(newloc){try{location=newloc}catch(e){return false}return true}function JaxAsyncCmd(url,callback){var jax=new jaxreq(url);jax.DoAsyncCmd(callback);return jax}var gSyncXMLhttp=null;jaxreq.prototype.DoSyncCmd=function(){this.success=false;this.qbnode=null;this.errcode=-1;this.errtext="";this.errdetails="";if(gSyncXMLhttp==null||IsGecko()){gSyncXMLhttp=XMLhttpGetInstance()}this.xhn=-1;if(gSyncXMLhttp){gSyncXMLhttp.open(this.method,this.url,false);gSyncXMLhttp.setRequestHeader("Content-Type",this.contenttype);if(this.contenttype=="text/xml"){this.params="<qdbapi>"+this.params.join("")+"</qdbapi>"}gSyncXMLhttp.send(this.params);this.responsetext=gSyncXMLhttp.responseText;var xmlp=gSyncXMLhttp.responseXML;if(xmlp){this.qbnode=xmlp.getElementsByTagName(this.qbnodeName)[0]}this.errdetails=this.GetValue("errdetail");this.errcode=Number(this.GetValue("errcode"));this.errtext=this.GetValue("errtext");if(this.errcode==0){this.success=true}if(this.popup){HidePopupDiv(this.popup)}if(this.errcode==0){var delay=0;if(this.successMsg!=""){ShowConfirmationMsg(this.successMsg);delay=this.redirectDelay}if(this.successURL!=""){setTimeout("location = '"+this.successURL+"'",delay)}else{if(this.successMsg!=""){setTimeout("location=location",delay)}}}else{if(this.failureMsg!=""){var details=this.errdetails;if(details!=null&&details!=""){details="<br><br>"+details}else{details=""}QBalert(this.failureMsg+details)}}}return this.success};var gJaxArray=new Array();function InsertJax(jax){var len=gJaxArray.length;for(var n=0;n<len;n++){if(gJaxArray[n]==null){gJaxArray[n]=jax;return n}}var n=gJaxArray.length;gJaxArray[n]=jax;return n}jaxreq.prototype.DoAsyncCmd=function(callback,withAlert){this.success=false;this.qbnode=null;this.errcode=-1;this.usercallback=callback;this.withAlert=withAlert;this.xhn=XMLhttpGetAvailable();var XMLhttp=gXMLhttpPool[this.xhn];if(XMLhttp){XMLhttp.open(this.method,this.url,true);XMLhttp.setRequestHeader("Content-Type",this.contenttype);if(this.contenttype=="text/xml"){this.params="<qdbapi>"+this.params.join("")+"</qdbapi>"}var n=InsertJax(this);if(n==0){XMLhttp.onreadystatechange=StdCallback0}if(n==1){XMLhttp.onreadystatechange=StdCallback1}if(n==2){XMLhttp.onreadystatechange=StdCallback2}if(n==3){XMLhttp.onreadystatechange=StdCallback3}if(n==4){XMLhttp.onreadystatechange=StdCallback4}if(n==5){XMLhttp.onreadystatechange=StdCallback5}if(n==6){XMLhttp.onreadystatechange=StdCallback6}if(n==7){XMLhttp.onreadystatechange=StdCallback7}if(n==8){XMLhttp.onreadystatechange=StdCallback8}if(n==9){XMLhttp.onreadystatechange=StdCallback9}if(n==10){XMLhttp.onreadystatechange=StdCallback10}if(n==11){XMLhttp.onreadystatechange=StdCallback11}if(n==12){XMLhttp.onreadystatechange=StdCallback12}if(n==13){XMLhttp.onreadystatechange=StdCallback13}if(n==14){XMLhttp.onreadystatechange=StdCallback14}if(n==15){XMLhttp.onreadystatechange=StdCallback15}if(n==16){XMLhttp.onreadystatechange=StdCallback16}if(n==17){XMLhttp.onreadystatechange=StdCallback17}if(n==18){XMLhttp.onreadystatechange=StdCallback18}if(n==19){XMLhttp.onreadystatechange=StdCallback19}if(n==20){XMLhttp.onreadystatechange=StdCallback20}if(n==21){XMLhttp.onreadystatechange=StdCallback21}if(n==22){XMLhttp.onreadystatechange=StdCallback22}if(n==23){XMLhttp.onreadystatechange=StdCallback23}if(n==24){XMLhttp.onreadystatechange=StdCallback24}if(n==25){XMLhttp.onreadystatechange=StdCallback25}if(n==26){XMLhttp.onreadystatechange=StdCallback26}if(n==27){XMLhttp.onreadystatechange=StdCallback27}if(n==28){XMLhttp.onreadystatechange=StdCallback28}if(n==29){XMLhttp.onreadystatechange=StdCallback29}if(n==30){XMLhttp.onreadystatechange=StdCallback30}if(n==31){XMLhttp.onreadystatechange=StdCallback31}XMLhttp.send(this.params)}return this.success};function StdCallback0(){StdCallback(0)}function StdCallback1(){StdCallback(1)}function StdCallback2(){StdCallback(2)}function StdCallback3(){StdCallback(3)}function StdCallback4(){StdCallback(4)}function StdCallback5(){StdCallback(5)}function StdCallback6(){StdCallback(6)}function StdCallback7(){StdCallback(7)}function StdCallback8(){StdCallback(8)}function StdCallback9(){StdCallback(9)}function StdCallback10(){StdCallback(10)}function StdCallback11(){StdCallback(11)}function StdCallback12(){StdCallback(12)}function StdCallback13(){StdCallback(13)}function StdCallback14(){StdCallback(14)}function StdCallback15(){StdCallback(15)}function StdCallback16(){StdCallback(16)}function StdCallback17(){StdCallback(17)}function StdCallback18(){StdCallback(18)}function StdCallback19(){StdCallback(19)}function StdCallback20(){StdCallback(20)}function StdCallback21(){StdCallback(21)}function StdCallback22(){StdCallback(22)}function StdCallback23(){StdCallback(23)}function StdCallback24(){StdCallback(24)}function StdCallback25(){StdCallback(25)}function StdCallback26(){StdCallback(26)}function StdCallback27(){StdCallback(27)}function StdCallback28(){StdCallback(28)}function StdCallback29(){StdCallback(29)}function StdCallback30(){StdCallback(30)}function StdCallback31(){StdCallback(31)}function StdCallback(n){var jax=gJaxArray[n];if(jax){var XMLhttp=gXMLhttpPool[jax.xhn];if(XMLhttp&&XMLhttp.readyState==4){if(jax.usercallback){var xmlp=XMLhttp.responseXML;if(xmlp){jax.qbnode=xmlp.getElementsByTagName(jax.qbnodeName)[0];if(jax.qbnode==null&&jax.withAlert){QBalert("<div class=redhead>Unable to Contact QuickBase.</div>Please wait and try again in a few minutes.");return}jax.errcode=Number(jax.GetValue("errcode"));jax.errtext=jax.GetValue("errtext");jax.errdetails=jax.GetValue("errdetail");if(jax.errcode==0){jax.success=true}jax.usercallback(jax)}}gXMLhttpPoolStatus[jax.xhn]=kxhFree;gJaxArray[n]=null}}}jaxreq.prototype.ShowErrAlert=function(){if(this.errcode!=0){var errdetail=this.GetValue("errdetail");if(errdetail){QBalert(errdetail)}else{QBalert("Operation failed: error code = "+this.errcode+" ("+this.errtext+")")}}};jaxreq.prototype.HasValue=function(varname){return(this.GetValue(varname)!=null)};jaxreq.prototype.GetValue=function(varname,notFoundValue){if(this.qbnode&&this.qbnode.hasChildNodes){if(this.qbnode.childNodes.length>20){if(!this.fastValues){this.BuildFastValues()}if(typeof this.fastValues[varname]!="undefined"){return this.fastValues[varname]}}else{for(var p=0;p<this.qbnode.childNodes.length;++p){var node=this.qbnode.childNodes[p];if(node.nodeType==kNodeTypeNode&&node.nodeName==varname){var nodeValue="";var clen=node.childNodes.length;for(var c=0;c<clen;++c){if(node.childNodes[c].nodeType==kNodeTypeText){nodeValue+=node.childNodes[c].nodeValue}}return nodeValue}}}}if(notFoundValue){return notFoundValue}return null};jaxreq.prototype.GetValueDeep=function(tree,startNode,varname,notFoundValue){var nodes=this.GetChildNodes(tree,startNode,notFoundValue);return this.GetValueFromTree(nodes,varname,notFoundValue)};jaxreq.prototype.GetValueFromTree=function(tree,varname,notFoundValue){if(tree&&tree.hasChildNodes){for(var p=0;p<tree.childNodes.length;++p){var node=tree.childNodes[p];if(node.nodeType==kNodeTypeText){continue}if(node.nodeType==kNodeTypeNode&&node.nodeName==varname){var nodeValue="";var clen=node.childNodes.length;for(var c=0;c<clen;++c){if(node.childNodes[c].nodeType==kNodeTypeText){nodeValue+=node.childNodes[c].nodeValue}}return nodeValue}}}if(notFoundValue){return notFoundValue}return null};jaxreq.prototype.GetChildNodes=function(tree,startNode,notFoundValue){if(tree&&tree.hasChildNodes){for(var p=0;p<tree.childNodes.length;++p){var node=tree.childNodes[p];if(node.nodeType==kNodeTypeText){continue}var clen=node.childNodes.length;if(node.nodeType==kNodeTypeNode&&node.nodeName==startNode){return node}if(clen>0){var nodes=this.GetChildNodes(node,startNode,notFoundValue);if(!nodes||nodes==notFoundValue){continue}else{return nodes}}}}if(notFoundValue){return notFoundValue}return null};jaxreq.prototype.BuildFastValues=function(){this.fastValues=new Object();if(this.qbnode&&this.qbnode.hasChildNodes){for(var p=0;p<this.qbnode.childNodes.length;++p){var node=this.qbnode.childNodes[p];if(node.nodeType==kNodeTypeNode){var nodeValue="";var clen=node.childNodes.length;for(var c=0;c<clen;++c){if(node.childNodes[c].nodeType==kNodeTypeText){nodeValue+=node.childNodes[c].nodeValue}}this.fastValues[node.nodeName]=nodeValue}}}};jaxreq.prototype.DumpPairs=function(){var s="";if(this.qbnode&&this.qbnode.hasChildNodes){for(var p=0;p<this.qbnode.childNodes.length;++p){var node=this.qbnode.childNodes[p];if(node.nodeType==kNodeTypeNode){var nodeValue="";var clen=node.childNodes.length;for(var c=0;c<clen;++c){if(node.childNodes[c].nodeType==kNodeTypeText){nodeValue+=node.childNodes[c].nodeValue}}s+=node.nodeName+" = "+nodeValue+"\n"}}}return s};jaxreq.prototype.AddDataValue=function(name,value){var s=String(value);s=s.replace(/[\x03\v\f\x12\x13\x14]/g,"");this.params.push("<"+name+">"+XMLEncode(s)+"</"+name+">")};jaxreq.prototype.AddValue=function(name,value){this.params.push("<"+name+">"+XMLEncode(String(value))+"</"+name+">")};jaxreq.prototype.AddValues=function(vals){for(var v in vals){if(v.constructor==String){this.AddValue(v,vals[v])}}};jaxreq.prototype.AddValueFromForm=function(name){this.AddValue(name,GetValue(name))};jaxreq.prototype.AssembleChunks=function(prefix){var numChunks=this.GetValue("_"+prefix+"_numChunks");var section=this.GetXML();var fulltext="";var prefixLen=prefix.length;if(section.hasChildNodes){for(var p=0;p<section.childNodes.length;++p){if(section.childNodes[p].nodeType==1){var nodeName=section.childNodes[p].nodeName;if(nodeName.substr(0,prefixLen)==prefix&&section.childNodes[p].hasChildNodes){fulltext+=section.childNodes[p].childNodes[0].nodeValue}}}}return fulltext};var kWithAlert=true;var kWithoutAlert=false;var kNodeTypeNode=1;var kNodeTypeText=3;function XMLhttpValuesToForm(qbnode){if(qbnode.hasChildNodes){for(var p=0;p<qbnode.childNodes.length;++p){var node=qbnode.childNodes[p];if(node.nodeType==kNodeTypeNode){var nodeValue="";var nodeName=node.nodeName;var clen=node.childNodes.length;for(var c=0;c<clen;++c){if(node.childNodes[c].nodeType==kNodeTypeText){nodeValue+=node.childNodes[c].nodeValue}}SetValue(nodeName,nodeValue)}}}}function makeAnArray(a){var arr=new Array();for(var i=0;i<a.length;++i){arr.push(a[i])}return arr}function urlencode(s){var r=escape(s);var q=r.replace(/\+/g,"%2B");return q.replace(/\//g,"%2F")}function QuoteEscape(s){s=s.replace(/\"/g,'\\"');s=s.replace(/\'/g,"\\'");return s}function HTMLDecode(s){s=s.replace(/\xA0/g," ");s=s.replace(/&nbsp;/g," ");s=s.replace(/<BR>/g,"\r\n");s=s.replace(/<br>/g,"\r\n");s=s.replace(/&lt;/g,"<");s=s.replace(/&gt;/g,">");s=s.replace(/&amp;/g,"&");s=s.replace(/&quot;/g,'"');s=s.replace(/&#039;/g,"'");return s}function FixNewLines(s){s=s.replace(/<BR>/g,"\r\n");s=s.replace(/<char code="10"\/>/g,"");return s}function HTMLEncode(s,doPartial){if(s==null){return null}s=s.replace(/&/g,"&amp;");s=s.replace(/</g,"&lt;");s=s.replace(/>/g,"&gt;");if(doPartial){return s}s=s.replace(/  /g," &nbsp;");s=s.replace(/\r\n/g,"<BR>");s=s.replace(/\n/g,"<BR>");s=s.replace(/\r/g,"<BR>");s=s.replace(/"/g,"&quot;");s=s.replace(/'/g,"&#039;");return s}function StripAllTagsinSet(s,tagSet,strippedTags){var returnString="";for(var i=0;i<tagSet.length;i++){var spos=-1;var tag=tagSet[i];var openregex=new RegExp("<s*"+tag+".*>","i");var closeregex=new RegExp("</s*"+tag+"s*>","i");var opencloseregex=new RegExp("<s*"+tag+".*/>","i");while(true){if(s.search(opencloseregex)!=-1){s=s.replace(opencloseregex,"");if(strippedTags){strippedTags.push(tag)}break}else{if((spos=s.search(openregex))==-1){break}}if(strippedTags){strippedTags.push(tag)}returnString=s.substr(0,spos);var lpos=(s.substr(spos)).search(closeregex);if(lpos==-1){s=returnString;break}var offset=s.substr(lpos+spos).match(closeregex)[0].length;returnString+=s.substr(lpos+spos+offset);s=returnString}}return s}function RemoveJSFromHTML(s){var tagregex=new RegExp("javascript","i");return s.replace(tagregex,"")}function RemoveForbiddenTags(str,strippedTags){var tagSet=new Array("object","embed","frameset","frame","iframe","applet","html","body","script");str=StripAllTagsinSet(str,tagSet,strippedTags);str=RemoveJSFromHTML(str);return str}function XMLEncode(s){s=s.replace(/&/g,"&amp;");s=s.replace(/</g,"&lt;");s=s.replace(/>/g,"&gt;");s=s.replace(/"/g,"&quot;");s=s.replace(/'/g,"&#039;");return s}function XMLDecode(s){s=s.replace(/&amp;/g,"&");s=s.replace(/&lt;/g,"<");s=s.replace(/&gt;/g,">");s=s.replace(/&quot;/g,'"');s=s.replace(/&#039;/g,"'");return s}function ConvertCRLFtoBR(s){s=s.replace(/\r\n/g,"<BR>");s=s.replace(/\n/g,"<BR>");s=s.replace(/\r/g,"<BR>");return s}function GetURLParameterValue(url,name){name=name.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var regexS="[\\?&]"+name+"=([^&#]*)";var regex=new RegExp(regexS,"i");var results=regex.exec(url);if(results==null){return""}else{return results[1]}}function GetURLparam(url,pname){var pat="(.*)(&"+pname+"=[^&]*)(.*)";var re=new RegExp(pat);var rv=re.exec(url);var p1=RegExp.$1;if(rv!=null){return(RegExp.$2)}return null}function RemoveURLparam(url,pname){var pat="(.*)(&"+pname+"=[^&]*)(.*)";var re=new RegExp(pat,"i");var rv=re.exec(url);var p1=RegExp.$1;if(rv!=null){url=(RegExp.$1+RegExp.$3)}return url}function AddReplaceURLparam(url,pname,pval){if(typeof url=="object"){url=url.toString()}if(StringEndsWith(url,"#")){url=url.substr(0,url.length-1)}url=RemoveURLparam(url,pname);if(url.indexOf("?")==-1){return url+"?"+pname+"="+urlencode(pval)}else{return url+"&"+pname+"="+urlencode(pval)}}function OpenPopupWindow(callback,popupWindow){var reWork=new RegExp("object","gi");var objChild;if(popupWindow){objChild=popupWindow}else{try{objChild=window.open("","child","width=50,height=50,status=no,resizable=yes,top=10000,left=10000");objChild.close()}catch(e){}}var hasPopupBlocker=!reWork.test(String(objChild));if(hasPopupBlocker){QB.Dialog.confirm({title:"Pop-up Blocker Detected",contents:"Click the <b>Open Pop-up</b> button to view this pop-up.<p>To avoid this message in the future, please disable the pop-up blocker in your browser.",contentType:"html",id:"qbDialogPopupDetector",confirm:{text:"Open Pop-up",focused:true,click:function(){callback();$(this).dialog("close")}},cancel:{click:function(){$(this).dialog("close")}}})}else{if(callback&&!popupWindow){callback()}}}function DOMdumpNode(node,recurse,indent){if(!indent){indent=""}var text="";if(node){for(var k=0;k<node.childNodes.length;++k){var nodeType=node.childNodes[k].nodeType;var nodeName=node.childNodes[k].nodeName;var value=node.childNodes[k].nodeValue;if(value&&value.replace){value=value.replace(/\r/g,"\\r");value=value.replace(/\n/g,"\\n");value=value.replace(/\t/g,"\\t")}text=text+indent+"type: "+nodeType+"  name: "+nodeName+"    value: "+value+"\n";if(nodeType==1&&recurse){text=text+DOMdumpNode(node.childNodes[k],recurse,indent+"--")}}}return text}function DOMhasTag(node,tag){return DOMfindTag(node,tag)!=null}function DOMfindTag(node,tag,type){if(node==null){return null}var upperTag=tag.toUpperCase();for(var k=0;k<node.childNodes.length;++k){var cnode=node.childNodes[k];var nodeType=cnode.nodeType;var nodeName=cnode.nodeName;if(nodeType==1&&upperTag==nodeName.toUpperCase()){if(!type){return cnode}if(typeof cnode.type!="undefined"&&StringSame(type,cnode.type)){return cnode}}if(nodeType==1){var rv=DOMfindTag(cnode,tag,type);if(rv!=null){return rv}}}return null}function DOMfindNthTagNode(node,tag,n){if(node==null){return null}var count=0;var upperTag=tag.toUpperCase();for(var k=0;k<node.childNodes.length;++k){var nodeType=node.childNodes[k].nodeType;var nodeName=node.childNodes[k].nodeName;if(nodeType==kELEMENT_NODE&&upperTag==nodeName.toUpperCase()){if(count==n){return node.childNodes[k]}++count}}return null}function DOMfindChildByClass(node,tag,classname){return DOMfindChildByProp(node,tag,"classname",classname)}function DOMfindChildByID(node,tag,classname){return DOMfindChildByProp(node,tag,"id",classname)}function DOMfindChildByProp(node,tag,prop,value){if(node==null){return null}var upperTag=tag.toUpperCase();var upperPval=value.toUpperCase();for(var k=0;k<node.childNodes.length;++k){var childnode=node.childNodes[k];var nodeType=childnode.nodeType;var nodeName=childnode.nodeName.toUpperCase();if(nodeType==kELEMENT_NODE&&upperTag==nodeName){var pval=_DOMfindGetProp(childnode,prop);if(pval!=null&&upperPval==pval.toUpperCase()){return childnode}}}return null}function _DOMfindGetProp(node,prop){var lowerProp=prop.toLowerCase();if(lowerProp=="classname"){return node.className}if(lowerProp=="id"){return node.id}if(typeof node[prop]!="undefined"){return node[prop]}return GetHTMLattribute(node,prop,null)}function DOMfindParentByClass(node,className){while(node){var parentNode=node.parentNode;if(parentNode&&parentNode.className&&parentNode.className==className){return parentNode}node=parentNode}return null}function DOMfindTextInNode(node,ignoreCR,ignoreAllWhiteSpace){for(var k=0;k<node.childNodes.length;++k){var nodeType=node.childNodes[k].nodeType;if(nodeType==kELEMENT_NODE){var text=DOMfindTextInNode(node.childNodes[k],ignoreCR,ignoreAllWhiteSpace);if(text){return text}}if(nodeType==kTEXT_NODE){var text=node.childNodes[k].nodeValue;if(text!=""){if(ignoreCR&&text=="\n"){continue}if(ignoreAllWhiteSpace&&IsWhiteSpace(HTMLDecode(text))){continue}return text}}}return null}function DOMfindID(startNode,id,maxdepth){if(typeof maxdepth=="undefined"){var maxdepth=10000}if(startNode==null||maxdepth==0||!startNode.childNodes){return null}for(var k=0;k<startNode.childNodes.length;++k){var childnode=startNode.childNodes[k];var nodeType=childnode.nodeType;if(nodeType==1){if(childnode.id==id){return childnode}if(childnode.nodeName.toUpperCase()!="SELECT"){var foundnode=DOMfindID(childnode,id,maxdepth-1);if(foundnode!=null){return foundnode}}}}return null}function DOMfindClass(startNode,className,maxdepth){if(startNode==null||maxdepth==0||!startNode.childNodes){return null}var classNames=className.split(" ");for(var k=0;k<startNode.childNodes.length;++k){var childnode=startNode.childNodes[k];var nodeType=childnode.nodeType;if(nodeType==1){var childnodeClassNames=childnode.className.split(" ");var found;for(var i=0;i<classNames.length;++i){found=false;for(var j=0;j<childnodeClassNames.length;++j){if(classNames[i]==childnodeClassNames[j]){found=true;break}}if(!found){break}}if(found){return childnode}if(childnode.nodeName.toUpperCase()!="SELECT"){var foundnode=DOMfindClass(childnode,className,((maxdepth==undefined)?maxdepth:maxdepth-1));if(foundnode!=null){return foundnode}}}}return null}function DOMgetCellValue(row,n){var node=DOMfindNthTagNode(row,"TD",n);if(node){return DOMfindTextInNode(node)}return""}function DOMinnerText(node,ignoreCR,ignoreAllWhiteSpace){return DOMfindTextInNode(node,ignoreCR,ignoreAllWhiteSpace)}function DOMsetInnerText(node,text){for(var k=0;k<node.childNodes.length;++k){var nodeType=node.childNodes[k].nodeType;if(nodeType==3){node.childNodes[k].nodeValue=text;return}if(nodeType==1){var text=DOMsetInnerText(node.childNodes[k],text);return}}}function DOMgetChildElements(parentNode){var arr=new Array();for(var k=0;k<parentNode.childNodes.length;++k){var child=parentNode.childNodes[k];if(child.nodeType==1){arr.push(child)}}return arr}function DOMgetIndexOfNode(parentNode,childNode){var idx=0;for(var k=0;k<parentNode.childNodes.length;++k){var child=parentNode.childNodes[k];if(child.nodeType==1){if(child===childNode){return idx}++idx}}return -1}function DOMiter(){this.i=0;this.done=false}function DOMGetNamedValue(node,tag,iter){if(!iter){var iter=new DOMiter()}var text;var upperTag=tag.toUpperCase();for(var k=iter.i;k<node.childNodes.length;++k){var nodeType=node.childNodes[k].nodeType;var nodeName=node.childNodes[k].nodeName;if(nodeType==1&&(upperTag==""||upperTag==nodeName.toUpperCase())){iter.i=k+1;iter.done=false;iter.tag=nodeName;text=DOMfindTextInNode(node.childNodes[k]);return(text==null?"":text)}}iter.done=true;return null}function DOMdumpNameValuePairs(node,verbose){var s="";var iter=new Object();iter.i=0;iter.done=false;while(!iter.done){value=DOMGetNamedValue(node,"",iter);if(!iter.done&&(!isNull(value)||verbose)){s+=iter.tag+":\t"+value+"\n"}}return s}function QBselectSingleNode(snode,path){if(snode==null){return null}var a=path.split("/");var node=snode;var sub;if(typeof snode=="string"){node=getElementBy(snode)}for(var i=0;i<a.length;++i){var token=a[i];if(token==""){continue}var className="";var ID="";var prop="";var pval="";var p=token.indexOf("[");if(p==-1){var j=0;var tag=token}else{var q=token.indexOf("]");if(q!=-1&&q>p){tag=token.substr(0,p);sub=token.substr(p+1,q-p-1);var x=sub.indexOf("=");if(x==-1){j=Number(sub)}else{if(StringStartsWith(sub,"class=")){className=sub.substr(6)}else{if(StringStartsWith(sub,"id=")){ID=sub.substr(3)}else{prop=sub.substr(0,x);pval=sub.substr(x+1)}}}}}if(className!=""){node=DOMfindChildByClass(node,tag,className)}else{if(ID!=""){node=DOMfindChildByID(node,tag,ID)}else{if(prop!=""){node=DOMfindChildByProp(node,tag,prop,pval)}else{node=DOMfindNthTagNode(node,tag,j)}}}if(node==null){return null}}return node}function QBselectParentNode(snode,upath){if(snode==null){return null}var p=upath.indexOf("[");if(p==-1){var j=0;var tag=upath}else{var q=upath.indexOf("]");if(q!=-1&&q>p){j=Number(upath.substr(p+1,q-p-1));tag=upath.substr(0,p)}}var upperTag=tag.toUpperCase();var count=0;var node=snode;if(typeof snode=="string"){node=getElementBy(snode)}while(node){var parentNode=node.parentNode;if(parentNode&&parentNode.tagName&&parentNode.tagName.toUpperCase()==upperTag){if(count==j){return parentNode}++count}node=parentNode}return null}function QBselectParentNodeByClass(snode,tag,className){var uclassName=className.toUpperCase();var elem=snode;for(var n=0;n<20;++n){var elem=QBselectParentNode(elem,tag);if(elem==null){break}if(elem.className.toUpperCase()==uclassName){return elem}}return null}function CopyArray(dstArray,srcArray){dstArray.length=0;AppendArray(dstArray,srcArray)}function AppendArray(dstArray,srcArray){for(var n=0;n<srcArray.length;++n){dstArray.push(srcArray[n])}}function CopyObject(oldobj,shallow){var newobj=new Object();for(var n in oldobj){if(typeof oldobj[n]=="object"&&!shallow){newobj[n]=CopyObject(oldobj[n])}else{newobj[n]=oldobj[n]}}return newobj}function TableGetTbody(table){if(IsTag(table,"TBODY")){return table}else{if(table){var tbody=QBselectSingleNode(table,"tbody");if(tbody==null){tbody=document.createElement("tbody");table.appendChild(tbody)}return tbody}}return null}function TableRowAppend(tableOrTbody,newrow,prepend){var tbodyNode=TableGetTbody(tableOrTbody);if(tbodyNode==null){return null}if(newrow){if(!prepend){tbodyNode.appendChild(newrow)}else{if(tbodyNode.childNodes.length==0){tbodyNode.insertBefore(newrow,null)}else{tbodyNode.insertBefore(newrow,tbodyNode.childNodes[0])}}}else{newrow=tbodyNode.insertRow(prepend?0:tbodyNode.rows.length)}return newrow}function TableRowBuildout(row,numCells,defaultContents){for(var c=0;c<numCells;++c){var newcell=document.createElement("td");row.appendChild(newcell);if(defaultContents){SetInnerHTML(newcell,defaultContents)}}}function TableRowPrepend(table,newrow){return TableRowAppend(table,newrow,true)}function TableCellInsertAt(row,colIndex,text){var newcell=row.insertCell(colIndex);if(text){var tnode=row.ownerDocument.createTextNode(text);newcell.appendChild(tnode)}return newcell}function TableCellAppend(row,text){return TableCellInsertAt(row,-1,text)}function TableCellPrepend(row,text){return TableCellInsertAt(row,0,text)}function TableRemoveAllRows(table,leaveOne){var tbodyNode=TableGetTbody(table);if(IsGecko()&&tbodyNode==null){alert("No tbody node. table: "+table.id)}var end=(leaveOne?1:0);for(var k=table.rows.length-1;k>=end;--k){if(IsGecko()){table.deleteRow(k)}else{table.deleteRow()}}}function TableBuildOut(table,numRows,numCols){var tbodyNode=TableGetTbody(table);for(var r=0;r<numRows;++r){var newrow=document.createElement("tr");for(var c=0;c<numCols;++c){var newcell=document.createElement("td");newrow.appendChild(newcell)}tbodyNode.appendChild(newrow)}}function CloseColumn(table,colIndex,startRow){SetColumnStyle(table,colIndex,"display","none",startRow)}function OpenColumn(table,colIndex,startRow){SetColumnStyle(table,colIndex,"display","",startRow)}function SetColumnStyle(table,colIndex,prop,val,firstRowIndex){var tlen=table.rows.length;var start=(firstRowIndex?firstRowIndex:0);for(var k=start;k<tlen;++k){var cell=table.rows[k].cells[colIndex];if(cell){cell.style[prop]=val}}}function SetColumnWrap(table,colIndex,doWrap,firstRowIndex){var tlen=table.rows.length;var start=(firstRowIndex?firstRowIndex:0);for(var k=start;k<tlen;++k){var cell=table.rows[k].cells[colIndex];if(cell){cell.noWrap=!doWrap}}}function GetCell(table,r,c){if(table.rows.length>r&&table.rows[r].cells.length>c){return table.rows[r].cells[c]}return null}function GetCellWidget(tableORcell,r,c){if(IsTag(tableORcell,"TABLE")){var cell=GetCell(tableORcell,r,c)}else{var cell=tableORcell}if(cell){var elem=QBselectSingleNode(cell,"input");if(elem==null){elem=QBselectSingleNode(cell,"select")}if(elem==null){elem=QBselectSingleNode(cell,"textarea")}if(elem==null){elem=QBselectSingleNode(cell,"div/input")}return elem}return null}function GetValueFromCell(tableORcell,r,c){return GetValue(GetCellWidget(tableORcell,r,c))}function GetCellValue(tableORcell,r,c){return GetValueFromCell(tableORcell,r,c)}function SetCellInnerHTML(cell,html){if(!html||html.length==0){cell.innerHTML="&nbsp;"}else{cell.innerHTML=html}}function GetHTMLattribute(elemOrID,attrname,notFoundValue){var val=(typeof notFoundValue!="undefined"?notFoundValue:null);var elem=toElem(elemOrID);if(elem){if(elem.attributes){var item=elem.attributes.getNamedItem(attrname);if(item){val=item.nodeValue}}if(val==null&&typeof elem[attrname]!="undefined"){val=elem[attrname]}}if(typeof val=="string"){if(val=="true"){val=true}else{if(val=="false"){val=false}}}return val}function getNextPair(s,offset){var e=s.indexOf("; ",offset);if(e==-1){return s.substring(offset)}return s.substring(offset,e)}function hasCookie(cookieName){var nameLen=cookieName.length;var allcookies=document.cookie;var cLen=allcookies.length;var i=0;while(i<cLen){var pair=getNextPair(allcookies,i);if(pair.substring(0,nameLen)==cookieName){return 1}i=i+pair.length+2}return 0}function getCookieValue(cookieName,cookieSubName,notFoundValue){var allcookies=document.cookie;var returnVal=null;var pos=allcookies.indexOf(cookieName+"=");if(pos!=-1){var start=pos+cookieName.length+1;var end=allcookies.indexOf(";",start);if(end==-1){end=allcookies.length}var fullCookieVal=unescape(allcookies.substring(start,end));if(cookieSubName&&cookieSubName!=""){returnVal=GetAVPfromString(fullCookieVal,cookieSubName)}else{returnVal=fullCookieVal}}if(returnVal!=null){return returnVal}return(typeof notFoundValue!="undefined"?notFoundValue:"")}function SetCookie(cookieName,cookieValue,minutesToExpiration,cookiePath){if(typeof cookieValue!="string"){cookieValue=String(cookieValue)}if(StringContains(cookieValue,";")){alert("attempting to set a cookie with a semi-colon in the value");return}ExpireCookie(cookieName);if(minutesToExpiration){var d=new Date();d.setTime(d.getTime()+(minutesToExpiration*60*1000));var c=cookieName+"="+cookieValue+"; expires="+d.toGMTString()+((cookiePath)?"; path="+cookiePath:"");document.cookie=c}else{document.cookie=cookieName+"="+cookieValue+";"}}function SetSubCookie(cookieName,cookieSubName,cookieSubValue,minutesToExpiration,cookiePath){var cookieFullValue=getCookieValue(cookieName);cookieFullValue=SetAVPinString(cookieFullValue,cookieSubName,cookieSubValue);SetCookie(cookieName,cookieFullValue,minutesToExpiration,cookiePath)}function GetLocalVar(varName,notFoundValue){if(!varName){return(notFoundValue?notFoundValue:null)}return getCookieValue("localVars2",varName,notFoundValue)}function SetLocalVar(varName,varValue){SetSubCookie("localVars2",varName,varValue,60*24*100)}function GetCommonVar(varName,notFoundValue){if(!varName){return(notFoundValue?notFoundValue:null)}return getCookieValue("commonVars",varName,notFoundValue)}function SetCommonVar(varName,varValue){SetSubCookie("commonVars",varName,varValue,60*24*100,"/db/")}function ExpireCookie(cookieName){var d=new Date();d.setTime(d.getTime()-(60*1000));var c=cookieName+"=expiring; path=/; expires="+d.toGMTString();document.cookie=c;c=cookieName+"=expiring; expires="+d.toGMTString();document.cookie=c}function ExpireAllCookies(){var cnameArray=new Array();var allcookies=document.cookie;var pairArray=allcookies.split(";");for(var i=0;i<pairArray.length;++i){var pair=pairArray[i];var epos=pair.indexOf("=");if(epos==-1){break}cnameArray[i]=pair.substring(0,epos)}for(var k=0;k<cnameArray.length;++k){ExpireCookie(cnameArray[k]);defaultStatus=cnameArray[k]}}function getElementBy(nameORid){var elem=document.getElementById(nameORid);if(elem){return elem}var elems=document.getElementsByName(nameORid);if(elems.length>0){return elems[0]}return null}function toElem(elemParam){if(!elemParam){return elemParam}if(isString(elemParam)){return getElementBy(elemParam)}else{return elemParam}}function isOpenElem(elemName){var elem=toElem(elemName);if(elem){return(!StringSame(elem.style.display,"none"))}return false}function closeElem(elemName){var elem=toElem(elemName);if(elem&&elem.nodeName){elem.style.display="none";if(elem.parentNode.className=="appendOnlyFieldOuter"&&$.trim($(elem.parentNode).text())==""){elem.parentNode.style.display="none"}}}function openElem(elemName){var elem=toElem(elemName);if(elem&&elem.nodeName){elem.style.display="";if(elem.parentNode.className=="appendOnlyFieldOuter"){elem.parentNode.style.display=""}return true}return false}function openCloseElem(elemName,doOpen){var elem=toElem(elemName);if(!elem){return false}if(doOpen){elem.style.display=""}else{elem.style.display="none"}return doOpen}function togOpenCloseElem(elemName,plusMinusIcon){var elem=toElem(elemName);if(!elem){return false}if(elem.style.display==""){elem.style.display="none"}else{elem.style.display=""}setOpenCloseIcon(elem,plusMinusIcon);return(elem.style.display!="none")}function setOpenCloseIcon(elemName,plusMinusIcon){var elem=toElem(elemName);var icon=toElem(plusMinusIcon);if(icon&&elem){if(elem.style.display=="none"){SetInnerHTML(icon,"<img src='/i/plus.gif'>")}else{SetInnerHTML(icon,"<img src='/i/minus.gif'>")}}}function hideShowElem(elemName,doShow){var elem=toElem(elemName);if(!elem){return}if(doShow){elem.style.visibility="visible"}else{elem.style.visibility="hidden"}}function hideElem(elemName){var elem=toElem(elemName);if(!elem){return}elem.style.visibility="hidden"}function showElem(elemName){var elem=toElem(elemName);if(!elem){return}elem.style.visibility="visible"}function closeAndHideElem(elemName){var elem=toElem(elemName);if(elem){elem.style.display="none";elem.style.visibility="hidden"}}function openAndShowElem(elemName){var elem=toElem(elemName);if(elem){elem.style.display="";elem.style.visibility="visible"}}function isHiddenElem(elemName){var elem=toElem(elemName);if(elem){return(StringSame(elem.style.visibility,"hidden"))}return false}function GetMenuIndex(menu,val){for(var n=0;n<menu.length;n++){if(menu.options[n].value==val){return n}}return -1}function GetMenuIndexFromText(menu,text){for(var n=0;n<menu.length;n++){if(menu.options[n].text==text){return n}}return -1}function VeilElem(doVeil,elemName,elem2Name,padding,opacity,zIndex){var elem=toElem(elemName);if(elem==null){return null}if(elem2Name){var elem2=toElem(elem2Name)}var padAmt=(padding?padding:0);var opcAmt=(opacity?opacity:60);var veil=elem.qbVeil;if(!veil){var veil=document.createElement("div");veil.style.display="none";veil.style.position="absolute";veil.style.backgroundColor="#555";if(zIndex){veil.style.zIndex=zIndex}SetOpacity(veil,opcAmt);document.body.appendChild(veil);elem.qbVeil=veil}var b=GetBox(elem);veil.style.left=(b.left-padAmt)+"px";veil.style.top=(b.top-padAmt)+"px";if(elem2){b2=GetBox(elem2)}else{b2=b}veil.style.width=(b2.right-b.left+padAmt+padAmt)+"px";veil.style.height=(b2.bottom-b.top+padAmt+padAmt)+"px";openCloseElem(veil,doVeil);return veil}function SetOpacity(el,opcAmt){var elem=toElem(el);if(elem){elem.style.filter="alpha(opacity="+opcAmt+")";elem.style.opacity=String(opcAmt/100)}}function SetColor(el,val){var elem=toElem(el);if(elem){elem.style.color=val}}function SetBackgroundColor(el,val){var elem=toElem(el);if(elem){elem.style.backgroundColor=val}}function SetTitle(el,val){var elem=toElem(el);if(elem){elem.title=val}}function SetHREF(el,url){var elem=toElem(el);if(elem){elem.href=url}}function Blacken(elem,defaultValue){if(GetValue(elem)!=defaultValue){SetColor(elem,"black")}return true}function IsTag(el,tag){if(el&&el.tagName){return el.tagName.toUpperCase()==tag.toUpperCase()}return false}function EnableDisable(b,el){var elem=toElem(el);if(elem){elem.disabled=!b}}function EnableElems(){for(var n=0;n<arguments.length;++n){EnableDisable(true,arguments[n])}}function DisableElems(){for(var n=0;n<arguments.length;++n){EnableDisable(false,arguments[n])}}function EnableDisableCheckBox(b,el){var elem=toElem(el);if(elem){EnableDisable(b,el);var sib=elem.nextSibling;if(sib.nodeType==kNodeTypeText){sib=sib.nextSibling}if(IsTag(sib,"SPAN")){if(b){sib.style.color=""}else{sib.style.color="#999"}}}}function RestoreDefaultIf(elem,defaultValue){if(GetValue(elem)==""){SetValue(elem,defaultValue)}if(GetValue(elem)==defaultValue){SetColor(elem,"#555")}}function DoBlur(el){var elem=toElem(el);if(!elem){return}elem.blur()}function SetFocus(el){var elem=toElem(el);if(!elem||elem.type=="hidden"||!IsReallyVisible(elem)){return}elem.focus()}function SetSelect(el){var elem=toElem(el);if(!elem){return}elem.select()}function getSelectionLength(){var selectionLen=0;if(IsIE()&&document.selection){selectionLen=document.selection.createRange().text.length}else{selectionLen=document.getSelection().toString().length}return selectionLen}function HasFocus(el){var elem=toElem(el);if(!elem){return false}return(document.activeElement==elem)}function SetInsertionPointToEnd(widget){try{if(widget.createTextRange){var trange=widget.createTextRange();trange.moveStart("textedit",1);trange.select()}else{if(widget.setSelectionRange){var e=widget.value.length;widget.setSelectionRange(e,e);widget.focus()}}}catch(e){}}function SetInsertionPointToMousePos(widget){if(!IsIE()){widget.select();return}var trange=widget.createTextRange();var x=GetMouseX()-ScrollLeft();var y=GetMouseY()-ScrollTop();trange.moveToPoint(x,y);trange.select()}function InsertTextAtInsertionPoint(textarea,newtext,start,end){if(textarea.createTextRange&&document.selection){textarea.focus();document.selection.createRange().duplicate().text=newtext}else{var iStart=textarea.selectionStart;textarea.value=textarea.value.substring(0,iStart)+newtext+textarea.value.substring(textarea.selectionEnd,textarea.value.length);if(start==null||end==null){textarea.setSelectionRange(iStart+newtext.length,iStart+newtext.length)}else{textarea.setSelectionRange(iStart+start,iStart+end)}textarea.focus()}}function SetPosition(el,position){var elem=toElem(el);if(elem){elem.style.position=position}}function SetStyleVisibility(el,value){var elem=toElem(el);if(elem){elem.style.visibility=value}}function SetStyleDisplay(el,value){var elem=toElem(el);if(elem){elem.style.display=value}}function SetStyle(el,styleAttr,value){var elem=toElem(el);if(elem){elem.style[styleAttr]=value}}function GetNthOptionValue(sel,n){if(!sel){return null}if(sel.type!="select-one"&&sel.type!="select"){return null}if(sel.options.length<=n){return null}var value=sel.options[n].value;if(value==""){return sel.options[n].text}return value}function IsChecked(el){var elem=toElem(el);if(!elem){return false}return elem.checked}function IsClass(el,className){var elem=toElem(el);if(!elem||!elem.className){return false}return(elem.className==className)}function HasClass(el,className){var elem=toElem(el);if(!elem||!elem.className){return false}return(elem.className.indexOf(className)!=-1)}function GetSortedMvfOpts(elem){var selections=[];var selopt=$.merge([],$("option:selected",elem)).sort(function(a,b){return(a.text<b.text)?-1:((a.text>b.text)?1:0)});return selopt}function GetTextValue(el){var elem=toElem(el);if(!elem){return""}if(elem.type=="select-one"||elem.type=="select"){if(elem.selectedIndex>=0){return elem.options[elem.selectedIndex].text}else{return""}}else{if(elem.type=="select-multiple"){var selections=GetSortedMvfOpts(elem);var txt="";for(var j=0;j<selections.length;j++){if(txt!=""){txt+=" "+kDelimMVUserFieldData+" "}txt+=selections[j].text}return txt}else{if(elem.type=="checkbox"){return(elem.checked?"yes":"no")}}}return GetValue(elem)}function GetOptionText(el,value){var elem=toElem(el);if(elem){for(var n=0;n<elem.options.length;++n){if(elem.options[n].value==value){return elem.options[n].text}}}return""}function GetValue(el,straight){var elem=toElem(el);if(!elem){return""}if(elem.type=="select-one"||elem.type=="select"){if(elem.selectedIndex>=0){var value=elem.options[elem.selectedIndex].value;if(value==""){if(typeof straight=="undefined"||straight==false){return elem.options[elem.selectedIndex].text}}return value}else{return""}}if(elem.type=="select-multiple"){var value="";var selections=GetSortedMvfOpts(elem);for(var j=0;j<selections.length;j++){if(value!=""){value+=kDelimMVUserFieldData}value+=selections[j].value}return value}if(elem.type=="checkbox"){return elem.checked}return elem.value}function GetRadioValue(el){var elems=el;if(isString(el)){elems=document.getElementsByName(el)}if(!elems||elems.length==0){return""}var numItems=elems.length;for(var i=0;i<numItems;++i){var rb=elems[i];if(rb&&rb.checked){return rb.value}}return""}function SetRadioValue(el,value){var elems=el;if(isString(el)){elems=document.getElementsByName(el)}if(!elems||elems.length==0){return""}var numItems=elems.length;for(var i=0;i<numItems;++i){var rb=elems[i];if(rb&&rb.value==value){rb.checked=true;return}}return}function SetValue(el,val){var elem=toElem(el);if(!elem){return false}if(elem.type=="select-one"||elem.type=="select"){return SetMenuValue(el,val,true)}else{if(elem.type=="checkbox"||elem.type=="radio"){if(val==true||val=="true"||val=="yes"||val=="1"){elem.checked=true}else{if(val==false||val=="false"||val=="no"||val=="0"){elem.checked=false}}return true}else{if(elem.type=="select-multiple"){var selectedVals=(val=="")?[]:String(val).split(kDelimMVUserFieldData);selectedVals=arr2map(selectedVals);for(var i=0;i<elem.options.length;++i){elem.options[i].selected=elem.options[i].value in selectedVals}$(elem).multiselect("refresh");OnCHF(elem);return true}else{elem.value=val;return true}}}return false}function SetMenuValue(el,val,caseSensitive){var elem=toElem(el);if(!elem){return false}if(!caseSensitive){val=val.toUpperCase()}var len=elem.options.length;for(var n=0;n<len;++n){var elemVal=elem[n].value;if(elemVal==""){elemVal=elem[n].text}if(!caseSensitive){elemVal=elemVal.toUpperCase()}if(elemVal==val){var previousIndex=elem.selectedIndex;elem.selectedIndex=n;return true}}var previousIndex=elem.selectedIndex;elem.selectedIndex=0;return false}function SetInnerHTML(el,newHTML){var elem=toElem(el);if(elem){elem.innerHTML=newHTML;return true}return false}function GetInnerHTML(el){var elem=toElem(el);if(elem){return elem.innerHTML}return""}function SetAnchorText(el,text){var elem=toElem(el);if(elem){DOMsetInnerText(elem,text)}}function CopyAndReplaceMenu(fromMenu,oldMenu,skipEventsParam){if(oldMenu==null||fromMenu==null){return null}fromMenu=toElem(fromMenu);oldMenu=toElem(oldMenu);var doEvents=!(skipEventsParam||false);var parent=oldMenu.parentNode;var newmenu=fromMenu.cloneNode(true);newmenu.id=oldMenu.id;newmenu.name=oldMenu.name;if(doEvents){newmenu.onchange=oldMenu.onchange}oldMenu.id="";oldMenu.name="";if(doEvents){oldMenu.onchange=""}parent.replaceChild(newmenu,oldMenu);return newmenu}function CopyMenuOption(toOption,fromOption){toOption.value=fromOption.value;toOption.text=fromOption.text;toOption.disabled=fromOption.disabled;toOption.style.color=fromOption.style.color}function CopySelectMenuFromTo(fromMenu,toMenu){var sval=GetValue(toMenu);toMenu.length=fromMenu.length;for(var n=fromMenu.options.length-1;n>=0;--n){var topt=toMenu.options[n];var fopt=fromMenu.options[n];CopyMenuOption(topt,fopt)}SetValue(toMenu,sval)}function AddOption(menu,i,text,val){if(menu.options.length<i){menu.options.length=i}menu.options[i]=new Option(text,val)}function AppendMenuOption(menu,text,val,disabled,color){++menu.options.length;var i=menu.options.length-1;menu.options[i]=new Option(text,val);if(disabled){menu.options[i].disabled=true;menu.options[i].style.color="#777"}if(color&&color!=""){menu.options[i].style.color=color}}function AppendMenuDivider(menu,val){if(!val){var val=""}AppendMenuOption(menu,"-------------",val,true)}function SetMenuOptionDisabled(menu,index,disable){if(menu.options.length>index){menu.options[index].disabled=disable;menu.options[index].style.color=(disable?"#777":"")}}function EnableDisableMenuOption(menu,optionVal,enable){var len=menu.options.length;for(var i=0;i<len;++i){if(menu.options[i].value==optionVal){menu.options[i].disabled=!enable;menu.options[i].style.color=(enable?"":"#777");return i}}return -1}function SetMenuOptionText(menu,val,newtext){var len=menu.options.length;for(var i=0;i<len;++i){if(menu.options[i].value==val){menu.options[i].text=newtext}}}function InsertMenuOptionByText(menu,val,text,skipcount){var len=menu.options.length;var insertPos=-1;for(var i=skipcount;i<len;++i){if(menu.options[i].text.toLowerCase()>text.toLowerCase()){insertPos=i;break}}if(insertPos>-1){var saveValue=GetValue(menu);menu.options[len]=new Option("",0);for(var i=len;i>insertPos;--i){CopyMenuOption(menu.options[i],menu.options[i-1])}menu.options[insertPos]=new Option(text,val);SetValue(menu,saveValue)}return insertPos}function EnableDisableMenuOptionsAll(menu,enable){var len=menu.options.length;for(var i=0;i<len;++i){menu.options[i].disabled=!enable;menu.options[i].style.color=(enable?"":"#777")}}function SetMenuValueToFirstEnabled(menu){var len=menu.options.length;for(var i=0;i<len;++i){if(!menu.options[i].disabled){menu.selectedIndex=i;return}}}function IsMenuOptionEnabled(menu,optionVal){var len=menu.options.length;for(var i=0;i<len;++i){if(menu.options[i].value==optionVal){return !menu.options[i].disabled}}}function SwapMenuOptions(menu,a,b){if(a<0||b<0){return}var len=menu.options.length;if(a>=len||b>=len){return}var aSelected=(a==menu.selectedIndex);var bSelected=(b==menu.selectedIndex);var txt=menu.options[a].text;var val=menu.options[a].value;var dis=menu.options[a].disabled;var color=menu.options[a].style.color;menu.options[a].text=menu.options[b].text;menu.options[a].value=menu.options[b].value;menu.options[a].disabled=menu.options[b].disabled;menu.options[a].style.color=menu.options[b].style.color;menu.options[b].text=txt;menu.options[b].value=val;menu.options[b].disabled=dis;menu.options[b].style.color=color;if(aSelected){menu.selectedIndex=b}if(bSelected){menu.selectedIndex=a}}var gOldSelectedIndex=-1;var gOldSelectedValue=null;var gCurSelectElem=null;var gIsAddNewOptionSelected=false;function CaptureSelectStateIfSafari(ev){if($.browser.safari){CaptureSelectState(ev)}}function CaptureSelectState(ev){var srcElem=EvGetTarget(ev);if(srcElem&&srcElem.type&&(IsTag(srcElem,"select")||srcElem.type=="select-one"||srcElem.type=="select"||srcElem.parentNode.type=="select-one"||srcElem.parentNode.type=="select")){if(gIsAddNewOptionSelected){gIsAddNewOptionSelected=false;return}gOldSelectedIndex=srcElem.selectedIndex;gOldSelectedValue=GetValue(srcElem);gCurSelectElem=srcElem}else{gOldSelectedIndex=-1;gOldSelectedValue=null;gCurSelectElem=null}}function FixIfDividerSelected(sel){if(!sel){var sel=gCurSelectElem}if(!sel){return false}var si=sel.selectedIndex;if(si!=-1){var opt=sel.options[si];if(opt.disabled){ResetSelectIndex(sel);return true}}return false}function ResetSelectIndex(sel){if(!sel){var sel=gCurSelectElem}if(!sel){return}if(gOldSelectedIndex!=-1){sel.selectedIndex=gOldSelectedIndex}else{if(sel.selectedIndex>0){sel.selectedIndex--}else{if(sel.selectedIndex<sel.options.length-1){sel.selectedIndex++}else{sel.selectedIndex=-1}}}}function SetFocusToFirstElem(form){var numElems=form.elements.length;var i;for(i=0;i<numElems;i++){var t=form.elements[i].type;var visibility=true;var elem=form.elements[i];if(elem.name=="_newowner"){continue}if(!$(elem).is(":visible")){continue}if(t=="select"||t=="select-one"||t=="radio"||t=="checkbox"||t=="textarea"||t=="text"){if(t=="textarea"||t=="text"){form.elements[i].select()}try{form.elements[i].focus()}catch(err){}break}}}function IsReallyDisplayed(el,maxLevels){var elem=toElem(el);if(!elem){return false}if(typeof maxLevels=="undefined"){var maxLevels=100}var k;for(k=0;elem&&k<maxLevels;++k){if(elem.style&&StringSame(elem.style.display,"none")){return false}elem=elem.parentNode}return true}function IsReallyVisible(el,maxLevels){var elem=toElem(el);if(!elem){return false}if(typeof maxLevels=="undefined"){var maxLevels=100}var k;for(k=0;elem&&k<maxLevels;++k){if(elem.style&&(StringSame(elem.style.display,"none")||StringSame(elem.style.visibility,"hidden"))){return false}elem=elem.parentNode}return true}function IsVisible(el){var elem=toElem(el);if(!elem){return false}if(StringSame(elem.style.display,"none")||StringSame(elem.style.visibility,"hidden")){return false}return true}function RefreshElem(e){if(!IsIEmac()){return}if(!e){return}var wasDisabled=e.disabled;e.disabled=true;e.selectedIndex=e.selectedIndex;e.disabled=wasDisabled}function FormClear(form){if(typeof form=="string"){form=toElem(form)}var len=form.elements.length;for(var n=0;n<len;++n){var e=form.elements[n];if(e.tagName.toLowerCase()=="input"){var type=e.type.toLowerCase();if(type=="button"||type=="submit"){continue}}SetValue(e,"")}}var kFormExcludeInvisible=1;var kFormExcludeHidden=2;var kFormDoNotEncode=4;function FormValuesToQueryString(form,options){if(typeof form=="string"){form=toElem(form)}if(!options){options=0}var excludeInvisible=(options&kFormExcludeInvisible)!=0;var excludeHidden=(options&kFormExcludeHidden)!=0;var doNotEncode=(options&kFormDoNotEncode)!=0;var retval="";var len=form.elements.length;for(var n=0;n<len;++n){var e=form.elements[n];var etype="";var evalue;if(IsTag(e,"input")){etype=e.type.toLowerCase()}if(etype=="button"||etype=="submit"||etype=="reset"){continue}else{if(excludeHidden&&etype=="hidden"){continue}else{if(excludeInvisible&&!IsReallyVisible(e)){continue}else{if(etype=="radio"||etype=="checkbox"){if(e.checked){evalue=e.value}else{continue}}else{evalue=GetValue(e)}}}}var ename=(e.name?e.name:"");if(ename==""){ename=e.id}if(ename==""){continue}if(!evalue){evalue=""}if(!doNotEncode){evalue=urlencode(evalue)}if(retval!=""){retval+="&"}retval+=ename+"="+evalue+"\n"}return retval}function ExpandBoxToInclude(oldbox,newbox){if(newbox.top<oldbox.top){oldbox.top=newbox.top}if(newbox.left<oldbox.left){oldbox.left=newbox.left}if(newbox.bottom>oldbox.bottom){oldbox.bottom=newbox.bottom}if(newbox.right>oldbox.right){oldbox.right=newbox.right}}function DoBoxesOverlap(box1,box2){if(BoxIsEmpty(box1)||BoxIsEmpty(box2)){return false}if(box1.left>box2.right||box1.right<box2.left||box1.top>box2.bottom||box1.bottom<box2.top){return false}return true}function BoxObscuresBox(box1,box2){if(BoxIsEmpty(box1)||BoxIsEmpty(box2)){return false}if(box1.left>box2.left||box1.right<box2.right||box1.top>box2.top||box1.bottom<box2.bottom){return false}return true}function BoldIf(s,b){if(b){return"<b>"+s+"</b>"}return s}function ItalicizeIf(s,b){if(b){return"<i>"+s+"</i>"}return s}function HiliteDeliteLink(el,doHilite,hiliteColor,deliteColor){var elem=toElem(el);if(!elem){return}if(doHilite){elem.style.color=hiliteColor}else{elem.style.color=deliteColor}}function Hilite(elemOrID,hiliteColor,eraseBkgdImg){var elem=toElem(elemOrID);if(elem){if(!SameColor(elem.style.backgroundColor,hiliteColor)){elem.origBackgroundColor=elem.style.backgroundColor;elem.style.backgroundColor=hiliteColor;if(eraseBkgdImg){elem.origBackImage=elem.style.backgroundImage;elem.style.backgroundImage="url(/i/clear2x2.gif)"}}}}function Delite(elemOrID){var elem=toElem(elemOrID);if(elem){if(elem.origBackgroundColor){elem.style.backgroundColor=elem.origBackgroundColor}else{elem.style.backgroundColor=""}if(typeof elem.origBackImage!="undefined"){elem.style.backgroundImage=elem.origBackImage}}}function ElemSetClippedPosition(elem,l,t,clipTo){if(clipTo){var r=l+GetElemWidth(elem)-1;var b=t+GetElemHeight(elem)-1;if(r<GetElemLeft(clipTo)){l=GetElemLeft(clipTo)-GetElemWidth(elem)+1}else{if(l>GetElemRight(clipTo)){l=GetElemRight(clipTo)}}if(b<GetElemTop(clipTo)){t=GetElemTop(clipTo)-GetElemHeight(elem)+1}else{if(t>GetElemBottom(clipTo)){t=GetElemBottom(clipTo)}}}elem.style.left=l+"px";elem.style.top=t+"px"}function ElemSetTransparency(elem,opacityFraction){if(opacityFraction==undefined){opactityFraction=0.5}elem.style.opacity=opacityFraction;elem.style.MozOpacity=opacityFraction;elem.style.filter="Alpha("+Math.round(opacityFraction*100)+")"}function ElemClearTransparency(elem){ElemSetTransparency(elem,1)}function Center(el){var elem=toElem(el);elem.style.position="absolute";PositionX(elem,"center",0);PositionY(elem,"center",0)}function PositionX(el,relativeTo,offset){var elem=toElem(el);if(!elem){return}scrollLeft=ScrollLeft();scrollRight=ScrollRight();elemWid=elem.offsetWidth;if(relativeTo=="center"){scrollMid=(scrollLeft+scrollRight)/2;elem.style.left=(scrollMid-(elemWid/2)+offset)+"px"}else{if(relativeTo=="right"){elem.style.left=(scrollRight-(elemWid+offset))+"px"}else{elem.style.left=(scrollLeft+offset)+"px"}}}function PositionY(el,relativeTo,offset){var elem=toElem(el);if(!elem){return}var scrollTop=ScrollTop();var scrollBot=ScrollBot();elemHei=elem.offsetHeight;if(relativeTo=="center"){var scrollMid=(scrollTop+scrollBot)/2;elem.style.top=(scrollMid-(elemHei/2)+offset)+"px"}else{if(relativeTo=="upper40"){var doc40=(scrollTop*0.6)+(scrollBot*0.4);elem.style.top=(doc40-(elemHei/2)+offset)+"px"}else{if(relativeTo=="centerButAtMost"){var scrollMid=(scrollTop+scrollBot)/2;var newtop=scrollMid-(elemHei/2);if(newtop>offset){newtop=offset}elem.style.top=newtop+"px"}else{if(relativeTo=="bottom"){var newTop=(scrollBot-(elemHei+offset))+"px";if(elem.style.top!=newTop){elem.style.top=newTop}}else{elem.style.top=(scrollTop+offset)+"px"}}}}}function PositionBottomButNot(el,offset,bodyHeight){var elem=toElem(el);if(!elem){return}var scrollTop=ScrollTop();var scrollBot=ScrollBot();elemHei=elem.offsetHeight;var newTop=scrollBot-(elemHei+offset);if(newTop>bodyHeight){elem.style.top=newTop+"px"}else{elem.style.top=bodyHeight+"px"}}function IsOnScreen(elem){if(!elem){return false}var b=GetBox(elem);if(b.top>=ScrollTop()&&b.bottom<=ScrollBot()&&b.left>=ScrollLeft()&&b.right<=ScrollRight()){return true}return false}function ScrollBodyDivToShow(elem){if(!elem){return}if(gMainBodyDiv){$(window).scrollTop($(elem).offset().top-$(gMainBodyDiv).offset().top)}else{$(window).scrollTop($(elem).offset().top)}}function ScrollElem(el,amount){var elem=toElem(el);if(IsGecko()&&elem.style.overflow=="hidden"){elem.style.overflow="auto"}elem.scrollTop=elem.scrollTop+amount}function WindowWidth(){var wid;if(window.innerWidth){wid=window.innerWidth}else{if((IsQuirksMode()||IsOpera())&&document.body){wid=document.body.clientWidth}else{if(document.documentElement&&document.documentElement.clientWidth){wid=document.documentElement.clientWidth}else{if(document.body&&document.body.clientWidth){wid=document.body.clientWidth}else{wid=window.innerWidth}}}}return wid}function WindowHeight(){var hei;if(window.innerHeight){hei=window.innerHeight}else{if((IsQuirksMode()||IsOpera())&&document.body){hei=document.body.clientHeight}else{if(document.documentElement&&document.documentElement.clientHeight){hei=document.documentElement.clientHeight}else{if(document.body&&document.body.clientHeight){hei=document.body.clientHeight}else{hei=window.innerHeight}}}}return hei}function ScrollLeft(){var val=0;if(isNumber(window.pageXOffset)){val=window.pageXOffset}else{if(document.documentElement&&document.documentElement.scrollLeft){val=document.documentElement.scrollLeft}else{if(document.body){val=document.body.scrollLeft}}}return val}function ScrollRight(){return WindowWidth()+ScrollLeft()}function ScrollTop(){if(isNumber(window.pageYOffset)){val=window.pageYOffset}else{if(document.documentElement&&document.documentElement.scrollTop){val=document.documentElement.scrollTop}else{if(document.body){val=document.body.scrollTop}}}return val}function ScrollBot(){return WindowHeight()+ScrollTop()}function InsetBox(b,val){var xval=Min(val,(b.right-b.left)/2);var yval=Min(val,(b.bottom-b.top)/2);b.left+=xval;b.right-=xval;b.top+=yval;b.bottom-=yval}function OffsetBox(b,dx,dy){b.left+=dx;b.right+=dx;b.top+=dy;b.bottom+=dy}function EqualBox(b1,b2){if(b1==null||b2==null){return false}return(b1.left==b2.left&&b1.right==b2.right&&b1.top==b2.top&&b1.bottom==b2.bottom)}function CopyBox(b1,b2){if(b1==null||b2==null){return}b1.left=b2.left;b1.right=b2.right;b1.top=b2.top;b1.bottom=b2.bottom}function box_t(top,left,bottom,right){if(typeof top=="undefined"){BoxSetEmpty(this);return}this.top=top;this.left=left;this.bottom=bottom;this.right=right}function BoxSetEmpty(box){box.top=100000;box.left=100000;box.bottom=-100000;box.right=-100000}function BoxIsEmpty(box){if(box==null){return true}if(box.left>box.right||box.top>box.bottom){return true}return false}function GetElemHeight(elem){if(typeof elem=="string"){elem=toElem(elem)}if(elem==null){return 0}if(IsSafari()&&_SafariVersion<3&&elem.tagName.toUpperCase()=="TD"){var row=elem.parentNode;return GetRowHeight(row)}return elem.offsetHeight}function GetElemWidth(elem){if(typeof elem=="string"){elem=toElem(elem)}if(elem==null){return 0}return elem.offsetWidth}function GetElemTop(elem,relativeTo,log,withScroll){if(typeof elem=="string"){elem=toElem(elem)}var top=0;var item=elem;while(item){top+=item.offsetTop;if(log){ldi(item.id+"  "+item.tagName+"  "+item.offsetTop+"   "+item.offsetHeight)}if(withScroll){top-=item.scrollTop}if(!IsGecko()&&!IsSafari()){top+=item.clientTop}item=item.offsetParent}if(relativeTo){top-=GetElemTop(relativeTo,null,log,withScroll)}return top}function GetElemLeft(elem,relativeTo,log,withScroll){if(typeof elem=="string"){elem=toElem(elem)}var left=0;for(var item=elem;item;item=item.offsetParent){left+=item.offsetLeft;if(withScroll){left-=item.scrollLeft}if(!IsGecko()&&!IsSafari()){left+=item.clientLeft}}if(relativeTo){left-=GetElemLeft(relativeTo,null,log,withScroll)}return left}function GetElemBottom(elem,relativeTo,log,withScroll){return GetElemTop(elem,relativeTo,log,withScroll)+GetElemHeight(elem)-1}function GetElemRight(elem,relativeTo,log,withScroll){return GetElemLeft(elem,relativeTo,log,withScroll)+GetElemWidth(elem)-1}function GetBoxV2(elem,relativeTo){if(!_.isElement(elem)){return null}elem=$(elem);if(_.isElement(relativeTo)){relativeTo=$(relativeTo)}var result=new Object;var left=0;var top=0;var elemOffset=elem.offset();left+=elemOffset.left;top+=elemOffset.top;if(relativeTo&&elem!=relativeTo){top-=relativeTo.offset().top;left-=relativeTo.offset().left}result.left=left;result.top=top;result.right=left+elem.outerWidth();result.bottom=top+elem.outerHeight();return result}function GetBox(elem,relativeTo,log){return GetBoxV2(elem,relativeTo)}function DumpBox(elem){var s="";for(var item=elem;item;item=item.offsetParent){s+=item.tagName+"\tleft:"+item.offsetLeft+"\ttop:"+item.offsetTop;if(!IsGecko()&&!IsSafari()){s+="\tclientLeft:"+item.clientLeft;s+="\tclientTop:"+item.clientTop}s+="\n"}s+="\toffsetWidth:"+elem.offsetWidth+"\toffsetHeight:"+elem.offsetHeight;ldiv("DUMPBOX",s)}function SetBox(elem,b){if(typeof elem=="string"){elem=toElem(elem)}if(elem){elem.style.left=(b.left)+"px";elem.style.top=(b.top)+"px";elem.style.width=(b.right-b.left)+"px";elem.style.height=(b.bottom-b.top)+"px"}}function Box2Text(box){return"l:"+box.left+" t:"+box.top+" r:"+box.right+" b:"+box.bottom}function RCpoint(r,c){this.r=-1;this.c=-1;if(typeof r!="undefined"){this.r=r}if(typeof c!="undefined"){this.c=c}}new RCpoint();RCpoint.prototype.IsNull=function(){return(this.r==-1||this.c==-1)};RCpoint.prototype.SetNull=function(){this.r=-1};function IsNullPoint(rc){return(rc==null||rc.r==-1||rc.c==-1)}function RepositionMenu(elem,base,positioning){if(isFunction(positioning)){positioning(elem,base);return}var b=GetBox(base,null);var newtop=b.bottom;var newleft=b.left;if(positioning=="cascade"||positioning=="cascadeLeft"){newtop=(b.top-4);var rightSpace=WindowWidth()-b.right;var leftSpace=b.left;if((rightSpace>elem.offsetWidth||rightSpace>leftSpace)&&positioning=="cascade"){newleft=b.right}else{newleft=(b.left-elem.offsetWidth+6);if(newleft<0){newleft=0;elem.style.width=b.left}}}else{if(positioning=="pushRight"){newtop=b.bottom;newleft=(WindowWidth()-elem.offsetWidth-4)}else{if(positioning=="belowLeft"){newtop=b.bottom;newleft=(b.right-elem.offsetWidth+4)}else{if(b.left>ScrollRight()-elem.offsetWidth-4||positioning=="belowRight"){newleft=(b.right-elem.offsetWidth);newtop=b.bottom;if(newleft<0){if(positioning=="belowRight"){newLeft=0}else{newleft=b.left}}}else{if(b.bottom>300&&positioning!="below"){newleft=b.right;var bdOff=$("body").scrollTop();if(!bdOff){newtop=(b.top-20)}else{newtop=b.top}}}}}}if(newleft<0){newleft=0}elem.style.left=newleft+"px";elem.style.top=newtop+"px";if(IsTag(base,"A")){elem.style.top=newtop+4+"px"}}function GetStyleWidth(elem){if(elem.style&&elem.style.width){var wid=elem.style.width;if(StringEndsWith(wid,"px")){return parseInt(wid,10)}}var owid=elem.offsetWidth;elem.style.width=owid+"px";var offset=elem.offsetWidth-owid;elem.style.width=(owid-offset)+"px";return owid-offset}function GetStyleHeight(elem){if(elem.style&&elem.style.height){var hei=elem.style.height;if(StringEndsWith(hei,"px")){return parseInt(hei,10)}}var ohei=elem.offsetHeight;elem.style.height=ohei+"px";var offset=elem.offsetHeight-ohei;elem.style.height=(ohei-offset)+"px";return ohei-offset}function RepositionMenuByMouse(menu){var x=GetMouseX();var y=GetMouseY();var wid=GetStyleWidth(menu);var hei=menu.offsetHeight;if(IsIE()){var mHeight=$(menu).height();var mouseY=GetMouseY();if(mHeight+mouseY>WindowHeight()){$(menu).height(WindowHeight()-mouseY-4);menu.style.overflowY="auto"}}var windowRight=WindowWidth();if(x+wid>windowRight){menu.style.left=(x-wid)+"px"}else{menu.style.left=(x+4)+"px"}menu.style.width=wid+"px";menu.style.top=(y+1)+"px"}var kQBbeforeShow=1;var kQBafterShow=2;var kQBafterHide=3;function CallQBmenuProc(baseElem,how){if(baseElem){var menuProc=GetHTMLattribute(baseElem,"qbmenuproc");if(menuProc){var menuProcParams=GetHTMLattribute(baseElem,"qbmenuparams");if(menuProcParams){eval(menuProc+"("+how+",'"+menuProcParams+"')")}else{eval(menuProc+"("+how+")")}}}}function ShowMenu(menuOrID,base,clicked,menuSet,positioning){var menu=toElem(menuOrID);var baseElem=toElem(base);if(menu==null){return false}if(menu.parentNode!=document.body){if(menu.parentNode){menu.parentNode.removeChild(menu)}document.body.appendChild(menu)}menu.baseElem=baseElem;CallQBmenuProc(baseElem,kQBbeforeShow);var wasDisplayed=false;if(menu&&(clicked||gCurrentMenuSet==menuSet)){if(gCurrentMenu!=menu||clicked){if(clicked=="cascade"||clicked=="cascadeLeft"){menu.style.display="";RepositionMenu(menu,baseElem,clicked)}else{HideMenus();menu.style.display="";if(base=="mousePosition"){RepositionMenuByMouse(menu)}else{RepositionMenu(menu,baseElem,positioning)}if(clicked&&baseElem){gMenuInvokingElem=baseElem}gCurrentMenuSet=menuSet;gCurrentMenu=menu;gCurrentMenuBase=base}var bot=GetElemBottom(menu);var winhei=WindowHeight()+(window.scrollY||ScrollTop());var oldHasSbar=(menu.style.overflowY=="auto");if(bot>winhei-2&&!IsSafariMobile()){var top=GetElemTop(menu);var oldhei=bot-top;var newhei=winhei-top-2;var minhei=Math.min(100,oldhei);if(newhei<minhei){menu.style.top=(winhei-minhei)+"px";newhei=minhei}menu.style.height=newhei+"px";menu.style.overflowY="auto"}if(IsIE()){var newHasSbar=(menu.style.overflowY=="auto");if(newHasSbar!=oldHasSbar){menu.style.width=GetStyleWidth(menu)+"px"}}menu.style.visibility="visible";wasDisplayed=true;CallQBmenuProc(baseElem,kQBafterShow)}}return wasDisplayed}function HideMenus(){if(gCurrentMenu){if(gCurrentMenu.baseElem){Delite(gCurrentMenu.baseElem)}HideOneMenu(gCurrentMenu);CallQBmenuProc(gCurrentMenu.baseElem,kQBafterHide);gCurrentMenu=null}gMenuInvokingElem=null}function HideOneMenu(menuOrID){var menu=toElem(menuOrID);var menuObj=QBmenu2FromMenu(menu);if(menuObj){menuObj.Cleanup()}menu.style.visibility="hidden";menu.style.display="none";menu.style.height=""}function CleanPopMenu(menuOrID){var menu=toElem(menuOrID);if(!menu||menu.hasBeenCleaned){return}menu.hasBeenCleaned=true;var mainMenuCell=QBselectSingleNode(menu,"table/tbody/tr/td");if(mainMenuCell){var children=mainMenuCell.childNodes;for(var n=children.length-1;n>=0;--n){var node=children[n];if(node.nodeType==kTEXT_NODE&&IsWhiteSpace(node.nodeValue)){node.parentNode.removeChild(node)}}}}function HasVisiblePick(menuOrID){var menu=toElem(menuOrID);for(var n=0;n<1000;++n){var pick=QBselectSingleNode(menu,"table/tbody/tr/td/a["+n+"]");if(pick==null){break}if(IsVisible(pick)){return true}}return false}function funcname(f){var s="???";if(f.toString){s=f.toString();if(s){var p=s.match(/function (\w*)/);if(p&&p[1]){s=p[1]}if((s==null)||(s.length==0)){return"unknown"}if(StringStartsWith(s,"function")){var x=s.indexOf(")");if(x!=-1){s=Ellipsize(s,x+4)}}}}return s}function StackTrace(){var s="";for(var a=arguments.caller;a!=null;a=a.caller){s+=funcname(a.callee)+"\n"}return s}function SetCurrentMenuElem(elem,menuSet){if(elem){HideMenus();gCurrentMenu=elem;gCurrentMenuSet=menuSet}}function ShowFullBodyVeil(){var veil=VeilElem(true,document.body,null,null,55,10)}function HideFullBodyVeil(){VeilElem(false,document.body)}function popupDiv(elemORid){this.iElem=toElem(elemORid);this.iValign="upper40";this.iYoffset=0;this.iHalign="center";this.iXoffset=0;this.iMaxwid=600;this.iAutoHide=false;this.iAutoHideDelay=1000;this.iDoRepos=true;this.iMustSeeBox=null;this.iOnHide=null;this.iOnEnterKey=null;this.iAlwaysSelect=true;this.iAutoFocus=true;this.iElemWithFocus=null;if(this.iElem&&!this.iElem.iFixedForFF){FixPopupDivForFF(this.iElem)}}new popupDiv("");popupDiv.prototype.SetMaxwid=function(n){this.iMaxwid=n};popupDiv.prototype.SetXoffset=function(n){this.iXoffset=n};popupDiv.prototype.SetHalign=function(halign){this.iHalign=halign};popupDiv.prototype.SetYoffset=function(n){this.iYoffset=n};popupDiv.prototype.SetValign=function(valign){this.iValign=valign};popupDiv.prototype.SetMustSeeBox=function(box){this.iMustSeeBox=box};popupDiv.prototype.SetOnHide=function(dowhat){this.iOnHide=dowhat};popupDiv.prototype.SetOnEnterKey=function(dowhat){this.iOnEnterKey=dowhat};popupDiv.prototype.SetAutoHide=function(b){this.iAutoHide=b};popupDiv.prototype.SetAutoHideDelay=function(n){this.iAutoHideDelay=n};popupDiv.prototype.SetDoRepos=function(b){this.iDoRepos=b};popupDiv.prototype.SetAlwaysSelect=function(b){this.iAlwaysSelect=b};popupDiv.prototype.SetAutoFocus=function(b){this.iAutoFocus=b};popupDiv.prototype.SetCheckObscuresFunc=function(checkObscuresFunc){this.iCheckObscuresFunc=checkObscuresFunc};popupDiv.prototype.IDis=function(testID){return(this.iElem.id==testID)};popupDiv.prototype.Show=function(){if(!this.iElem){return null}var elem=this.iElem;HideMenus();this.RemoveFromStack();gPopupDivStack.push(this);this.iElemWithFocus=null;openElem(elem);var doFullBodyVeil=(typeof gSuppressBodyVeil=="undefined"||!gSuppressBodyVeil);if(doFullBodyVeil&&elem.parentNode&&!IsTag(elem.parentNode,"BODY")){elem.parentNode.removeChild(elem);document.body.appendChild(elem)}var newZindex=1500;for(var n=0;n<gPopupDivStack.length;++n){var stackElem=gPopupDivStack[n].iElem;if(stackElem&&stackElem!=elem&&stackElem.style&&stackElem.style.zIndex){var elemZ=Number(stackElem.style.zIndex);if(elemZ>=newZindex){newZindex=elemZ+1}}}elem.style.zIndex=newZindex;if(elem.offsetWidth>this.iMaxwid){elem.style.width=this.iMaxwid+"px"}var wid=elem.offsetWidth;if(!IsSafariMobile()){PositionX(elem,this.iHalign,this.iXoffset)}else{PositionX(elem,0,0)}if((IsGecko()||IsSafari())&&ScrollLeft()!=0){elem.style.width=wid+"px"}if(this.iDoRepos&&!IsSafariMobile()){PositionY(elem,this.iValign,this.iYoffset)}else{if(IsSafariMobile()){PositionY(elem,0,0)}}if(this.iCheckObscuresFunc||this.iMustSeeBox){this.AdjustPosition()}if(doFullBodyVeil){ShowFullBodyVeil()}showElem(elem);this.iShownStamp=new Date();if(this.iAutoFocus){var fe=DOMfindTag(elem,"input","text");if(fe==null){fe=DOMfindTag(elem,"textarea")}if(fe&&IsReallyVisible(fe)){if(this.iAlwaysSelect||GetValue(fe)==""){SetFocus(fe);SetSelect(fe)}}}return elem};popupDiv.prototype.AdjustPosition=function(){var offset=0;var incr=20;var obscures=true;while(obscures){var box=GetBox(this.iElem);if(box.top<ScrollTop()+20){offset=0;incr=-20}if(box.bottom>ScrollBot()){return}if(this.iCheckObscuresFunc){obscures=this.iCheckObscuresFunc(box)}else{obscures=BoxObscuresBox(box,this.iMustSeeBox)}if(obscures){offset-=incr;PositionY(this.iElem,this.iValign,offset+this.iYoffset)}}};popupDiv.prototype.RemoveFromStack=function(){for(var n=0;n<gPopupDivStack.length;++n){if(gPopupDivStack[n].iElem.id==this.iElem.id){gPopupDivStack.splice(n,1);return true}}return false};popupDiv.prototype.Hide=function(){closeElem(this.iElem);hideElem(this.iElem);this.RemoveFromStack();if(this.iElemWithFocus){this.iElemWithFocus.blur()}try{if(this.iOnHide){eval(this.iOnHide)}}catch(e){}if(gPopupDivStack.length==0){HideFullBodyVeil()}};popupDiv.prototype.AutoHide=function(){var elem=this.iElem;if(elem!=null&&this.iAutoHide){var now=new Date;var hasBeen1second=(now.getTime()-this.iShownStamp.getTime())>this.iAutoHideDelay;if((elem.style.visibility!="hidden")&&hasBeen1second&&!IsClickInElem(elem)){this.Hide()}}};function FixPopupDivForFF(pop){if(!IsGecko()){return}if(!pop.iFixedForFF){var i,node,fixnode,newDiv;node=pop.getElementsByTagName("input");for(i=0;i<node.length;i++){fixnode=node[i];if(typeof fixnode.type!="undefined"&&StringSame("text",fixnode.type)){if(fixnode.parentNode.style.overflow!="auto"){newDiv=document.createElement("DIV");newDiv.style.overflow="auto";fixnode.parentNode.replaceChild(newDiv,fixnode);newDiv.appendChild(fixnode)}}}node=pop.getElementsByTagName("textarea");for(i=0;i<node.length;i++){fixnode=node[i];if(fixnode.parentNode.style.overflow!="auto"){newDiv=document.createElement("DIV");newDiv.style.overflow="auto";fixnode.parentNode.replaceChild(newDiv,fixnode);newDiv.appendChild(fixnode)}}pop.iFixedForFF=true}}function ShowPopupDiv(elem){var popup=new popupDiv(elem);return popup.Show()}function HidePopupDiv(popupParam){var popup;var popupID;if(popupParam&&typeof popupParam=="string"){popupID=popupParam}else{if(popupParam&&IsTag(popupParam,"input")){var popupDiv=QBselectParentNodeByClass(popupParam,"div","PopBox");if(popupDiv){popupID=popupDiv.id}}}if(popupID){for(var n=0;n<gPopupDivStack.length;++n){if(gPopupDivStack[n].iElem.id==popupID){popup=gPopupDivStack[n];break}}}else{if(popupParam){popup=popupParam}else{popup=TopPopupDiv()}}if(popup){popup.Hide()}}function TopPopupDiv(){var n=gPopupDivStack.length;if(n>0){return gPopupDivStack[n-1]}return null}function QBmsg(htmlMsg,width){SetInnerHTML("qbMsgBody",htmlMsg);if(width){var div=getElementBy("qbMsgDiv");div.style.width=width}return ShowPopupDiv("qbMsgDiv")}function QBalert(htmlMsg,okCallback){if(okCallback){QB.Dialog.alert({contents:htmlMsg,contentType:"html",hideTitleBar:true,confirm:{click:okCallback},jqDialogOptions:{zIndex:1500}})}else{QB.Dialog.alert({contents:htmlMsg,hideTitleBar:true,contentType:"html",jqDialogOptions:{zIndex:1500}})}}var gQBconfYesAction;var gQBconfNoAction;function QBconfirm(htmlMsg,yesAction,noAction,yesButText,noButText){gQBconfYesAction=(yesAction?yesAction:null);gQBconfNoAction=(noAction?noAction:null);SetValue("confYesBut",(yesButText?yesButText:"   OK   "));SetValue("confNoBut",(noButText?noButText:"Cancel"));SetInnerHTML("qbConfSpan",htmlMsg);ShowPopupDiv("qbConfDiv")}function QBconfirmSmall(htmlMsg,yesAction,noAction,yesButText,noButText){gQBconfYesAction=(yesAction?yesAction:null);gQBconfNoAction=(noAction?noAction:null);SetValue("confSmallYesBut",(yesButText?yesButText:"   OK   "));SetValue("confSmallNoBut",(noButText?noButText:"Cancel"));SetInnerHTML("qbConfSmallSpan",htmlMsg);var popup=new popupDiv("qbConfSmallDiv");popup.SetValign("top");popup.SetHalign("left");popup.SetYoffset(GetMouseY()+10);popup.SetXoffset(GetMouseX()-80);return popup.Show()}function QBconfirmYesProc(){HidePopupDiv("qbConfDiv");HidePopupDiv("qbConfSmallDiv");if(isFunction(gQBconfYesAction)){gQBconfYesAction()}else{if(gQBconfYesAction){eval(gQBconfYesAction)}}}function QBconfirmNoProc(){HidePopupDiv("qbConfDiv");HidePopupDiv("qbConfSmallDiv");if(isFunction(gQBconfNoAction)){gQBconfNoAction()}else{if(gQBconfNoAction){eval(gQBconfNoAction)}}}var gQBpromptYesAction;var gQBpromptYesLocation;function QBpromptYesProc(){HidePopupDiv("qbPromptDiv");if(gQBpromptYesAction){eval(gQBpromptYesAction)}else{if(gQBpromptYesLocation){gQBpromptYesLocation+=urlencode(GetValue("qbPromptInput"));location=gQBpromptYesLocation}}}function QBprompt(htmlMsg,yesAction,paramName,yesURL,seedValue){var popup=new popupDiv("qbPromptDiv");popup.SetOnEnterKey("QBpromptYesProc()");if(seedValue){SetValue("qbPromptInput",seedValue)}SetInnerHTML("qbPromptMsg",htmlMsg);if(yesURL){gQBpromptYesLocation=yesURL+"&"+paramName+"="}else{gQBpromptYesLocation=null}if(yesAction){gQBpromptYesAction=yesAction}else{gQBpromptYesAction=null}popup.Show()}var gBusyPopup=null;function QBbusy(htmlMsg){$("#qbBusySpan").html(htmlMsg);gBusyPopup=$("#qbBusyDiv").show().dialog({modal:true,dialogClass:"QBBusy AlertBanner",resizable:false,height:"auto",minHeight:0,width:260});gBusyPopup.siblings("div.ui-dialog-titlebar").remove();document.body.style.cursor="wait"}function QBbusyHide(){if(gBusyPopup){gBusyPopup.dialog("close");gBusyPopup=null}document.body.style.cursor="default"}function QBradioDialog(heading,callback){this.contents="";this.index=1;this.callback=callback;this.pdiv=document.createElement("div");this.pdiv.id="QBpcDiv";this.pdiv.style.display="none";this.pdiv.style.visibility="hidden";this.pdiv.className="PopBox";this.pdiv.qbRD=this;this.ptable=document.createElement("table");TableBuildOut(this.ptable,3,2);this.ptable.rows[0].cells[0].innerHTML="<h5>"+heading+"</h5>";this.ptable.rows[2].cells[1].innerHTML="<input type=button value='   OK   ' onclick='_QBRD_OK(this)'> <input type=button value='Cancel' onclick='HidePopupDiv(this)'>";this.ptable.rows[2].cells[1].style.paddingTop="20px";this.pdiv.appendChild(this.ptable);document.body.appendChild(this.pdiv)}QBradioDialog.prototype.AddChoice=function(text,value){var val=(typeof value!="undefined"&&value!=null?value:this.index);this.contents+="<input type=radio name=qbpc value="+val+"> "+text+"<br>";this.index++};QBradioDialog.prototype.AddHTML=function(text){this.contents+=text};QBradioDialog.prototype.SetChoice=function(value){this.initialValue=value};QBradioDialog.prototype.Show=function(){this.ptable.rows[1].cells[0].innerHTML=this.contents;this.ptable.rows[1].cells[0].style.paddingLeft="20px";ShowPopupDiv(this.pdiv.id);if(this.initialValue){SetRadioValue("qbpc",this.initialValue)}};QBradioDialog.prototype.Hide=function(){HidePopupDiv(this.pdiv.id)};function _QBRD_OK(button){var pdiv=QBselectParentNode(button,"div");if(pdiv&&!pdiv.qbRD){pdiv=QBselectParentNode(pdiv,"div")}if(pdiv&&pdiv.qbRD&&pdiv.qbRD.callback){pdiv.qbRD.callback(GetRadioValue("qbpc"),pdiv.qbRD)}HidePopupDiv(pdiv.id)}var gfauxToolTipDiv;var gfauxToolTipText;function InitFauxToolTip(){if(gfauxToolTipDiv==null){gfauxToolTipDiv=getElementBy("fauxToolTipDiv")}if(gfauxToolTipText==null){gfauxToolTipText=getElementBy("fauxToolTipText")}}function HideFauxToolTip(){InitFauxToolTip();closeAndHideElem(gfauxToolTipDiv)}function ShowFauxToolTip(baseElem,text){InitFauxToolTip();SetInnerHTML(gfauxToolTipText,text);var b=GetBox(baseElem);openElem(gfauxToolTipDiv);gfauxToolTipDiv.style.width="";gfauxToolTipDiv.style.left=(b.right+5)+"px";gfauxToolTipDiv.style.top=(b.top)+"px";if(gfauxToolTipDiv.offsetWidth>400){gfauxToolTipDiv.style.width="400px"}var b2=GetBox(gfauxToolTipDiv);if(b2.right>WindowWidth()){gfauxToolTipDiv.style.left=(b.left+5)+"px";gfauxToolTipDiv.style.top=(b.bottom+2)+"px"}showElem(gfauxToolTipDiv)}var gEventX;var gEventY;var gEvent;function CaptureEventInfo(ev){var e=(ev?ev:window.event);gEvent=e;if(e!=null){gEventX=e.clientX+ScrollLeft();gEventY=e.clientY+ScrollTop();var popup=TopPopupDiv();if(popup){var target=EvGetTarget(e);if(target&&target.blur){popup.iElemWithFocus=target}}}}function GetMouseX(ev){var e=(ev?ev:window.event);if(!e){return gEventX}if(e.pageX){return e.pageX}else{if(e.clientX){return e.clientX+ScrollLeft()}else{if(e.offsetX){return -e.offsetX+1}}}return 0}function GetMouseY(ev){var e=(ev?ev:window.event);if(!e){return gEventY}if(e.pageY){return e.pageY}else{if(e.clientY){return e.clientY+ScrollTop()}else{if(e.offsetY){return -e.offsetY+1}}}return 0}function IsClickInElem(el,event,useClientCoords){var elem=toElem(el);if(elem){var targ=EvGetTarget(event);if(targ==elem){return true}var x=(useClientCoords&&event.clientX)?event.clientX:GetMouseX(event);var y=(useClientCoords&&event.clientY)?event.clientY:GetMouseY(event);return IsCoordInElem(x,y,elem)}return false}function IsCoordInElem(x,y,elem){var b=GetBox(elem);if(false){ldi("elem.id: "+elem.id+"    elem.tag: "+elem.tagName+"\nx: "+x+"   left/right: "+b.left+","+b.right+"      y: "+y+"   top/bottom: "+b.top+","+b.bottom+"\ne.pageX: "+event.pageX+"     e.clientX: "+event.clientX+"\n")}if(b.left<x&&b.right>x&&b.top<y&&b.bottom>y){return true}return false}function IsClickInOpenMenu(event){if(!gCurrentMenu){return false}return IsClickInElem(gCurrentMenu,event)}function IsTargetTag(e,tag){return(GetTagName(EvGetTarget(e)).toLowerCase()==tag.toLowerCase())}function GetTargetTag(e){return GetTagName(EvGetTarget(e))}function GetTargetID(e){var elem=EvGetTarget(e);if(elem){return elem.id}return""}function GetTagName(elem){if(elem&&elem.tagName){return elem.tagName.toLowerCase()}return""}Function.prototype.method=function(name,func){this.prototype[name]=func;return this};if(!isFunction(Array.prototype.splice)){Array.method("splice",function(s,d){var max=Math.max,min=Math.min,a=[],e,i=max(arguments.length-2,0),k=0,l=this.length,n,v,x;s=s||0;if(s<0){s+=l}s=max(min(s,l),0);d=max(min(isNumber(d)?d:l,l-s),0);v=i-d;n=l+v;while(k<d){e=this[s+k];if(!isUndefined(e)){a[k]=e}k+=1}x=l-s-d;if(v<0){k=s+i;while(x){this[k]=this[k-v];k+=1;x-=1}this.length=n}else{if(v>0){k=1;while(x){this[n-k]=this[l-k];k+=1;x-=1}}}for(k=0;k<i;++k){this[s+k]=arguments[k+2]}return a})}function AVPEscape(str){str=str.replace(/\$/g,"$d");str=str.replace(/~/g,"$t");str=str.replace(/=/g,"$e");str=str.replace(/#/g,"$h");return str}function AVPUnescape(str){str=str.replace(/\$d/g,"$");str=str.replace(/\$t/g,"~");str=str.replace(/\$e/g,"=");str=str.replace(/\$h/g,"#");return str}function SetAVPinString(s,attr,val){var attribute=AVPEscape(attr);var value=AVPEscape(String(val));var p=s.indexOf("~"+attribute+"=");if(p==-1){if(s==""){s="~"}s+=attribute+"="+value+"~";return s}var p2=p+attribute.length+2;var s2=s.substr(p2);var e=s2.indexOf("~");if(e==-1){return}s=s.substr(0,p)+"~"+attribute+"="+value+s2.substr(e);return s}function GetAVPfromString(s,attr,notThereValue){var attribute=AVPEscape(attr);var p=s.indexOf("~"+attribute+"=");if(p==-1){if(typeof notThereValue=="undefined"){var notThereValue=""}return notThereValue}var p2=p+attribute.length+2;var s2=s.substr(p2);var e=s2.indexOf("~");if(e==-1){return null}var value=s2.substr(0,e);return AVPUnescape(value)}function AttrList(str){if(typeof str!="string"||str.charAt(0)!="~"){return}var startPos=1;while(true){var endPos=str.indexOf("~",startPos);if(endPos==-1){return}var equalPos=str.indexOf("=",startPos);if(equalPos!=-1&&equalPos<endPos){var name=AVPUnescape(str.substring(startPos,equalPos));var value=AVPUnescape(str.substring(equalPos+1,endPos));this[name]=value}startPos=endPos+1}}AttrList.prototype.ToHTMLString=function(){var str="~";for(var name in this){var value=this[name];var doSave=true;switch(typeof value){case"string":break;case"number":value=String(value);break;case"boolean":value=value?"1":"0";break;default:doSave=false}if(doSave){str+=AVPEscape(name)+"="+AVPEscape(value)+"~"}}return str};function AttrListArray(arrayStr){var arr=Array();arr.ToHTMLString=AttrListArrayToHTMLString;if(typeof arrayStr!="string"||arrayStr.length==0){return arr}var startPos=0;while(true){var hashPos=arrayStr.indexOf("#",startPos);if(hashPos==-1){hashPos=arrayStr.length}arr.push(new AttrList(arrayStr.substring(startPos,hashPos)));if(hashPos>=arrayStr.length){break}startPos=hashPos+1}return arr}function AttrListArrayToHTMLString(){var str="";var firstTime=true;for(var i=0;i<this.length;++i){if(!firstTime){str+="#"}str+=this[i].ToHTMLString();firstTime=false}return str}function LooksLikePhoneNumber(phone){var stripped=phone.replace(/[\(\)\.\-\ ]/g,"");if(phone==""){return"Please enter a phone number."}else{if(isNaN(parseInt(stripped))){return"Please enter a valid phone number in the form (xxx)xxx-xxxx"}else{if(!(stripped.length==10)){return"Please enter a valid phone number in the form (xxx)xxx-xxxx"}}}return""}function LooksLikeEmailDomain(domain){var atpos=domain.indexOf("@");var dotpos=domain.lastIndexOf(".");var len=domain.length;var tld;if(len>dotpos+1){tld=domain.substring(dotpos+1,len)}if(len==0){return false}else{if(atpos==-1||atpos!=0||dotpos==-1||dotpos<atpos||dotpos==atpos+1||len<5||dotpos>=len-2){return false}else{if(tld.length>=3&&!validTopLevelDomain(tld)){return false}}}return true}function LooksLikeEmailAddress(email){var atpos=email.indexOf("@");var dotpos=email.lastIndexOf(".");var len=email.length;var tld;if(len>dotpos+1){tld=email.substring(dotpos+1,len)}if(len==0){return false}else{if(atpos==-1||dotpos==-1||dotpos<atpos||dotpos==atpos+1||len<5||dotpos>=len-2){return false}else{if(tld.length>=3&&!validTopLevelDomain(tld)){return false}}}return true}function validTopLevelDomain(tld){tld=tld.toUpperCase();return tld=="COM"||tld=="ORG"||tld=="NET"||tld=="EDU"||tld=="GOV"||tld=="BIZ"||tld=="PRO"||tld=="AERO"||tld=="INFO"||tld=="NAME"||tld=="COOP"||tld=="MUSEUM"||tld=="MIL"}function IsRFC822ValidEmail(sEmail){var sQtext="[^\\x0d\\x22\\x5c\\x80-\\xff]";var sDtext="[^\\x0d\\x5b-\\x5d\\x80-\\xff]";var sAtom="[^\\x00-\\x20\\x22\\x28\\x29\\x2c\\x2e\\x3a-\\x3c\\x3e\\x40\\x5b-\\x5d\\x7f-\\xff]+";var sQuotedPair="\\x5c[\\x00-\\x7f]";var sDomainLiteral="\\x5b("+sDtext+"|"+sQuotedPair+")*\\x5d";var sQuotedString="\\x22("+sQtext+"|"+sQuotedPair+")*\\x22";var sDomain_ref=sAtom;var sSubDomain="("+sDomain_ref+"|"+sDomainLiteral+")";var sWord="("+sAtom+"|"+sQuotedString+")";var sDomain=sSubDomain+"(\\x2e"+sSubDomain+")*";var sLocalPart=sWord+"(\\x2e"+sWord+")*";var sAddrSpec=sLocalPart+"\\x40"+sDomain;var sValidEmail="^"+sAddrSpec+"$";var reValidEmail=new RegExp(sValidEmail);if(reValidEmail.test(sEmail)){return true}return false}var kIrregularNouns=new Array();kIrregularNouns.alumnus="alumni";kIrregularNouns.analysis="analyses";kIrregularNouns.axis="axes";kIrregularNouns.basis="bases";kIrregularNouns.child="children";kIrregularNouns.criterion="criteria";kIrregularNouns.diagnosis="diagnoses";kIrregularNouns.genus="genera";kIrregularNouns.foot="feet";kIrregularNouns.fungus="fungi";kIrregularNouns.half="halves";kIrregularNouns.index="indices";kIrregularNouns.man="men";kIrregularNouns.medium="media";kIrregularNouns.movie="movies";kIrregularNouns.person="people";kIrregularNouns.potato="potatoes";kIrregularNouns.series="series";kIrregularNouns.species="species";kIrregularNouns.stimulus="stimuli";kIrregularNouns.stratum="strata";kIrregularNouns.syllabus="syllabi";kIrregularNouns.thesis="theses";kIrregularNouns.woman="women";function PluralToSingular(pluralNoun){if(pluralNoun==""){return""}var pluralNounLower=pluralNoun.toLowerCase();var singularNoun="";for(var n in kIrregularNouns){if(kIrregularNouns[n]==pluralNounLower){singularNoun=n;break}}var plen=pluralNoun.length;if(singularNoun==""){if(StringEndsWith(pluralNoun,"ches")||StringEndsWith(pluralNoun,"shes")||StringEndsWith(pluralNoun,"sses")||StringEndsWith(pluralNoun,"xes")){singularNoun=pluralNoun.substr(0,plen-2)}else{if(StringEndsWith(pluralNoun,"ies")){singularNoun=pluralNoun.substr(0,plen-3)+"y"}else{if(StringEndsWith(pluralNoun,"s")){singularNoun=pluralNoun.substr(0,plen-1)}}}}if(singularNoun==""){return pluralNoun}var slen=singularNoun.length;singularNoun=pluralNoun.charAt(0)+singularNoun.substr(1,slen-1);return singularNoun}function SingularToPlural(singularNoun){singularNoun=singularNoun.Trim();singularNounLower=singularNoun.toLowerCase();for(var n in kIrregularNouns){if(n==singularNounLower){return kIrregularNouns[n]}}var pluralNoun="";var len=singularNoun.length;if(len==0){return""}if(len==1){pluralNoun=singularNoun+"s"}else{if(StringEndsWith(singularNoun,"sh")||StringEndsWith(singularNoun,"x")||StringEndsWith(singularNoun,"ch")||StringEndsWith(singularNoun,"s")){pluralNoun=singularNoun+"es"}else{var lastChar=singularNounLower.charAt(len-1);var nextToLastChar=singularNounLower.charAt(len-2);if(lastChar=="y"&&!IsVowel(nextToLastChar)){pluralNoun=singularNoun.substr(0,len-1)+"ies"}}}if(pluralNoun==""){pluralNoun=singularNoun+"s"}return pluralNoun}function LooksLikePluralNoun(noun){var nounLower=noun.toLowerCase();if(StringEndsWith(nounLower,"s")&&!StringEndsWith(nounLower,"ss")){return true}for(var n in kIrregularNouns){if(kIrregularNouns[n]==nounLower){return true}}return false}function IsVowel(c){return(c=="a"||c=="e"||c=="i"||c=="o"||c=="u")}function LastFirst2FirstFirst(lastfirst){var p=lastfirst.lastIndexOf(",");if(p==-1){return lastfirst}return lastfirst.substr(p+1).Trim()+" "+lastfirst.substr(0,p).Trim()}function Commify(val){if(isNumber(val)){val=val.toString()}var a,b;for(var k=3;val.length>k;k=k+4){a=val.substr(0,val.length-k);b=val.substr(val.length-k,k);val=a+","+b}return val}var kAllowNumericChars="0123456789.";function NumericValue(s){if(isNumber(s)){return s}if(!isString(s)){return Number(s)}var s2="";var n=0;for(var x=0;x<s.length;++x){var c=s.charAt(x);if((kAllowNumericChars.indexOf(c)!=-1)||(x==0&&c=="+")||(x==0&&c=="-")){s2=s2+c}}return Number(s2)}function Numerize(num,singularNoun){if(Number(num)==1){return"1 "+singularNoun}return num+" "+SingularToPlural(singularNoun)}function ToBool(v){if(typeof v=="boolean"){return v}if(typeof v=="string"){var n=parseInt(v);if(!isNaN(n)){return(n!=0)}return(StringSame(v,"YES")||StringSame(v,"TRUE")||StringSame(v,"ON")||StringSame(v,"CHECKED"))}if(typeof v=="number"){return(v!=0)}return false}function ToOrdinalString(n){var ones=n%10;var tens=((n%100)-ones)/10;if(ones==1&&tens!=1){return n+"st"}else{if(ones==2&&tens!=1){return n+"nd"}else{if(ones==3&&tens!=1){return n+"rd"}}}return n+"th"}function Capitalize(v){var s=String(v);if(s==""){return""}return s.substr(0,1).toUpperCase()+s.substr(1)}function StringSame(s1,s2){if(s1==null&&s2==null){return true}if(s1==null||s2==null){return false}return s1.toUpperCase()==s2.toUpperCase()}function StringContains(s,sub){if(s.length==0){return false}if(s.length<sub.length){return false}return(s.toUpperCase().indexOf(sub.toUpperCase())!=-1)}function StringStartsWith(s,withWhat){if(s.length==0){return false}if(s.length<withWhat.length){return false}var sFront=s.substr(0,withWhat.length);return(sFront.toUpperCase()==withWhat.toUpperCase())}function StringEndsWith(s,withWhat){if(s.length<withWhat.length){return false}return(s.substr(s.length-withWhat.length).toLowerCase()==withWhat.toLowerCase())}function StringContainsNoun(s,noun){var altNoun=(LooksLikePluralNoun(noun)?PluralToSingular(noun):SingularToPlural(noun));return(StringContains(s,noun)||StringContains(s,altNoun))}function StringGetSuffix(s,prefix){var r="";var plen=prefix.length;if(s&&s.length>plen){if(s.substr(0,plen).toUpperCase()==prefix.toUpperCase()){r=s.substr(plen)}}return r}function StringGetAfterLast(s,marker){var index=s.lastIndexOf(marker)+1;var end="";if(index>0){end=s.substring(index)}return end}function Substitute(s,oldToken,newToken){var pat=oldToken;var re=new RegExp(pat);return s.replace(re,newToken)}function AppendStringWith(buildString,newPart,delim){if(buildString==""){return newPart}return buildString+delim+newPart}function IsAlpha(c){if(c>="A"&&c<="Z"){return true}if(c>="a"&&c<="z"){return true}return false}function IsDigit(c){if(c>="0"&&c<="9"){return true}return false}function SDencode(c){if(c=="\n"){return"\\n"}if(c=="\r"){return"\\r"}if(c==" "){return"space"}}function SDsubstr(s,n){var a=Max(0,n-8);var b=Min(n+8,s.length-1);if(b>a){var t=s.substr(a,b-a)}else{t=s}t=t.replace(/\r/g,"\\r");t=t.replace(/\n/g,"\\n");return t}function StringDiffMsg(s1,s2){if(s1==s2){return("strings are identical")}for(var n=0;n<s1.length;++n){if(n>=s2.length){return("strings are identical but s2 is shorter.\ns1["+n+"] = "+SDencode(s1.charAt(n))+"         "+SDsubstr(s1,n)+"\n")}if(s1.charAt(n)!=s2.charAt(n)){return("s1["+n+"] = "+SDencode(s1.charAt(n))+"         "+SDsubstr(s1,n)+"\ns2["+n+"] = "+SDencode(s2.charAt(n))+"         "+SDsubstr(s2,n)+"\n")}}return("strings are identical but s1 is shorter.\ns2["+n+"] = "+SDencode(s2.charAt(n))+"         "+SDsubstr(s2,n)+"\n")}function Ellipsize(s,maxlen){if(s.length<=maxlen){return s}return s.substr(0,maxlen-3)+"..."}String.prototype.LTrim=function(){return this.replace(/^\\s+/,"")};String.prototype.RTrim=function(){return this.replace(/\\s+$/,"")};String.prototype.Trim=function(){return this.replace(/^\\s+|\\s+$/g,"")};String.prototype.TrimSpaces=function(){return this.replace(/^ +| +$/g,"")};var SpacesRegEx=new RegExp(/^\s+|\s+$/g);function ob32encode(n){var value=Number(n);var s="";do{var v=value&31;var c=kOB32xlate.charAt(v);s=c+s;value=value>>5}while(value!=0);return s}var kOB32xlate="abcdefghijkmnpqrstuvwxyz23456789";function IsWhiteSpace(s){if(typeof s!="string"){return false}return(s==""||kWhiteSpaceRE.test(s))}var kWhiteSpaceRE=/^\s+$/;var gMonthNames=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var kDtOptWithTOD=1;var kDtOptNoTZOffset=2;var kDateFmt_MMDDYYYY_dash=0;var kDateFmt_MMDDYY_dash=1;var kDateFmt_DDMMYYYY_dash=2;var kDateFmt_DDMMYY_dash=3;var kDateFmt_YYYYMMDD_dash=4;function DateFmtToDatePickerString(){var formatString="mm-dd-yy";switch(gReqDateFormat){case kDateFmt_MMDDYY_dash:formatString="mm-dd-y";break;case kDateFmt_DDMMYYYY_dash:formatString="dd-mm-yy";break;case kDateFmt_DDMMYY_dash:formatString="dd-mm-y";break;case kDateFmt_YYYYMMDD_dash:formatString="yy-mm-dd";break}return formatString}function DateFmtToRangePickerString(){var formatString="MM-dd-yyyy";switch(gReqDateFormat){case kDateFmt_MMDDYY_dash:formatString="MM-dd-yy";break;case kDateFmt_DDMMYYYY_dash:formatString="dd-MM-yyyy";break;case kDateFmt_DDMMYY_dash:formatString="dd-MM-yy";break;case kDateFmt_YYYYMMDD_dash:formatString="yyyy-MM-dd";break}return formatString}function FormatDate(day,month,fullYear){var formattedDate="";var abbrevYear=String(fullYear).substr(2,2);var dash="-";switch(gReqDateFormat){case kDateFmt_MMDDYY_dash:formattedDate=month+dash+day+dash+abbrevYear;break;case kDateFmt_DDMMYYYY_dash:formattedDate=day+dash+month+dash+fullYear;break;case kDateFmt_DDMMYY_dash:formattedDate=day+dash+month+dash+abbrevYear;break;case kDateFmt_YYYYMMDD_dash:formattedDate=fullYear+dash+month+dash+day;break;default:formattedDate=month+dash+day+dash+fullYear;break}return formattedDate}function FormatDateTime(val){var s=gMonthNames[val.getMonth()]+" "+val.getDate()+", "+val.getFullYear();return s}function GetNow(){if(gReqTime==""){return new Date()}var start=(new Date(gReqTime)).getTime();var elapsed=(new Date()).getTime()-gStartLoadTime;return new Date(start+elapsed)}function GetTodayString(){return GetDateTimeString(GetNow())}function GetNowString(){return GetDateTimeString(GetNow(),kDtOptWithTOD)}function GetDateTimeString(dt,options){if(!options){var options=0}if((options&kDtOptNoTZOffset)!=0){dt.setTime(dt.valueOf())}else{dt.setTime(dt.valueOf()-gAppTimeZoneOffset+(dt.getTimezoneOffset()*60*1000))}var m=dt.getMonth()+1;if(m<10){m="0"+m}var d=dt.getDate();if(d<10){d="0"+d}var tod="";if((options&kDtOptWithTOD)!=0){var ampm="AM";var h=dt.getHours();if(h>=12){ampm="PM"}if(h>12){h-=12}if(h==0){h=12}var minutes=dt.getMinutes();if(minutes<10){minutes="0"+minutes}tod=" "+h+":"+minutes+" "+ampm}var s=FormatDate(d,m,dt.getFullYear())+tod;return s}var abd=new Object();var bbd=new Object();var adate=new Date();var bdate=new Date();function DateCompare(a,b,daysOffset){var av=ParseDate(a,abd);var bv=ParseDate(b,bbd);DaNanParsedDate(av);DaNanParsedDate(bv);if(daysOffset){adate.setFullYear(av.year,av.month-1,av.day);bdate.setFullYear(bv.year,bv.month-1,bv.day);var aval=adate.getTime();var bval=bdate.getTime();bval+=(daysOffset*24*60*60*1000);if(aval>bval){return 1}if(aval<bval){return -1}return 0}if(av.year>bv.year){return 1}if(av.year<bv.year){return -1}if(av.month>bv.month){return 1}if(av.month<bv.month){return -1}if(av.day>bv.day){return 1}if(av.day<bv.day){return -1}var ahour=RealHour(av.hour,StringSame(av.ampm,"AM"));var bhour=RealHour(bv.hour,StringSame(bv.ampm,"AM"));if(ahour>bhour){return 1}if(ahour<bhour){return -1}if(av.minute>bv.minute){return 1}if(av.minute<bv.minute){return -1}return 0}function RealHour(h,isAM){if(isAM&&h==12){return 0}else{if(!isAM&&h<12){return h+12}}return h}function IsDateBefore(a,b,daysOffset){return DateCompare(a,b,daysOffset)<0}function IsDateAfter(a,b,daysOffset){return DateCompare(a,b,daysOffset)>0}function DaNanParsedDate(pd){if(isNaN(pd.month)){pd.month=0}if(isNaN(pd.day)){pd.day=0}if(isNaN(pd.year)){pd.year=0}if(isNaN(pd.hour)){pd.hour=0}if(isNaN(pd.minute)){pd.minute=0}}function ParseDate(s,rv){if(!rv){var rv=new Object()}rv.month=Number.NaN;rv.day=Number.NaN;rv.year=Number.NaN;rv.hour=Number.NaN;rv.minute=Number.NaN;rv.AMPM="";rv.zone="";var toks=s.match(/\w+/g);if(!toks||toks.length==0){return rv}if(toks.length==1){rv.month=parseInt(s.substring(0,2),10);if(isNaN(rv.month)){rv.month=MonthNameToMonth(s)}else{rv.day=parseInt(s.substring(2,4),10);if(isNaN(parseInt(s.substring(4,8),10))){rv.year=parseInt(s.substring(4,6),10)}else{rv.year=parseInt(s.substring(4,8),10)}}}if(IsDayOfWeek(toks[0])){toks.shift()}if(toks.length>1){SetMDYBasedOnFmt(rv,parseInt(toks[0],10),parseInt(toks[1],10),parseInt(toks[2],10));if(isNaN(rv.month)){rv.month=MonthNameToMonth(toks[0])}}if(toks.length>=4){var time=toks[3].match(/(\d+)(?::(\d\d))?\s*([p]m?)?\s*([a-z]{3})?/i);if(null!=time){rv.hour=parseInt(time[1],10)+(time[3]?12:0);rv.minute=parseInt(time[2],10)||0;if(time[4]&&time[4].length==3){rv.zone=time[4]}}}if(toks.length>4){var time=toks[4].match(/(\d\d)?\s*([p]m?)?\s*([a-z]{3})?/i);if(null!=time){if(time[1]){rv.minute=parseInt(time[1],10)}if(time[2]){rv.hour+=12}if(time[3]&&time[3].lenght==3){rv.zone=time[3]}}if(toks.length>5){var m=toks[5].match(/([p]m?)?([a-z]{3})?/i);if(m&&m[1]){rv.hour+=12}if(m&&m[2]){rv.zone=m[2]}}if(toks.length>6){var z=toks[6].match(/([a-z]{3})/i);rv.zone=(z&&z[1])?z[1]:""}}if(rv.hour>12){rv.AMPM="PM";rv.hour-=12}if(null==rv.AMPM){rv.AMPM="AM"}rv.year=convertYearToFourDigits(rv.year);return rv}function convertYearToFourDigits(year){if(!isNaN(year)){if(year<50){year+=2000}else{if(year<100){year+=1900}}}return year}function SetMDYBasedOnFmt(parseDateObj,first,second,third){switch(gReqDateFormat){case kDateFmt_DDMMYYYY_dash:case kDateFmt_DDMMYY_dash:parseDateObj.day=first;parseDateObj.month=second;parseDateObj.year=third;break;case kDateFmt_YYYYMMDD_dash:parseDateObj.year=first;parseDateObj.month=second;parseDateObj.day=third;break;default:parseDateObj.month=first;parseDateObj.day=second;parseDateObj.year=third;break}}var kMonthAbbrevs=new Array("ja","fe","mar","ap","may","jun","jul","au","se","oc","no","de");var kDayOfWeekAbbrevs=new Array("mon","tue","wed","thu","fri","sat","sun");function MonthNameToMonth(s){for(var n=0;n<12;n++){if(StringStartsWith(s,kMonthAbbrevs[n])){return n+1}}return 0}function IsDayOfWeek(s){for(var n=0;n<kDayOfWeekAbbrevs.length;n++){if(StringStartsWith(s,kDayOfWeekAbbrevs[n])){return true}}return false}function Min(a,b){if(a<b){return a}return b}function Max(a,b){if(a>b){return a}return b}function MinMax(min,val,max){if(val<min){val=min}if(val>max){val=max}return val}function CSSfindStyleDef(className){if(!document.styleSheets[0]){return null}var conforms=false;if(document.styleSheets[0].cssRules){conforms=true}className=className.toLowerCase();for(var s=0;s<document.styleSheets.length;++s){var theRules=(conforms?document.styleSheets[s].cssRules:document.styleSheets[s].rules);var numRules=theRules.length;for(var r=0;r<numRules;++r){if(theRules[r].selectorText){var c=theRules[r].selectorText;if(c.toLowerCase()==className){return theRules[r].style}}else{if(theRules[r].cssRules){var rb=theRules[r].cssRules;for(var s1=0;s1<rb.length;++s1){var c=rb[s1].selectorText;if(c.toLowerCase()==className){return rl[s1].style}}}}}}return null}function loadCss(url){var link=document.createElement("link");link.type="text/css";link.rel="stylesheet";link.href=url;document.getElementsByTagName("head")[0].appendChild(link)}function CSSmodifyStyleDef(className,attr,value){var theStyle=CSSfindStyleDef(className);if(theStyle){theStyle[attr]=value;return true}return false}function EvGetCharCode(event){if(!event){event=window.event}if(event){if(event.keyCode){return event.keyCode}else{return event.which}}return 0}function EvIsCtrlKeyDown(event){if(!event){event=window.event}if(event){if(event.ctrlKey){return event.ctrlKey}}return false}function EvIsShiftKeyDown(event){if(!event){event=window.event}if(event){if(event.shiftKey){return event.shiftKey}}return false}function EvIsAltKeyDown(event){if(!event){event=window.event}if(event){if(event.altKey){return event.altKey}}return false}function EvIsMetaKeyDown(event){if(!event){event=window.event}if(event){if(event.metaKey){return event.metaKey}}return false}function EvCancelBubble(event){if(!event){event=window.event}if(event){if(event.stopPropagation){event.stopPropagation()}if(event.preventBubble){event.preventBubble()}event.cancelBubble=true}return true}function EvCancelAction(event){if(!event){event=window.event}if(event){if(event.preventDefault){event.preventDefault()}event.returnValue=false}return false}function EvCancelAll(event){EvCancelBubble(event);return EvCancelAction(event)}function EvGetTarget(event){if(!event){event=window.event}var targ=null;if(event){if(event.target){targ=event.target}else{if(event.srcElement){targ=event.srcElement}}}try{var x=targ.tagName}catch(e){targ=null}return targ}function EvIsRightButton(event){if(!event){event=window.event}if(event){if(IsGecko()){return(event.button==2)}return(event.button==2)}return false}function EvIsLeftButton(event){if(!event){event=window.event}if(event){return(event.button==1)}return false}var namedcolormap=new Object();namedcolormap.aliceblue="f0f8ff";namedcolormap.antiquewhite="faebd7";namedcolormap.aqua="00ffff";namedcolormap.aquamarine="7fffd4";namedcolormap.azure="f0ffff";namedcolormap.beige="f1ecc9";namedcolormap.bisque="ffe4c4";namedcolormap.black="000000";namedcolormap.blanchedalmond="ffebcd";namedcolormap.blue="519ef2";namedcolormap.blueviolet="8a2be2";namedcolormap.brown="a52a2a";namedcolormap.burlywood="deb887";namedcolormap.cadetblue="5f9ea0";namedcolormap.chartreuse="7fff00";namedcolormap.chocolate="d2691e";namedcolormap.coral="ff7f50";namedcolormap.cornflowerblue="6495ed";namedcolormap.cornsilk="fff8dc";namedcolormap.crimson="dc143c";namedcolormap.cyan="00ffff";namedcolormap.darkblue="00008b";namedcolormap.darkcyan="008b8b";namedcolormap.darkgoldenrod="b8860b";namedcolormap.darkgray="a9a9a9";namedcolormap.darkgreen="006400";namedcolormap.darkkhaki="bdb76b";namedcolormap.darkmagenta="8b008b";namedcolormap.darkolivegreen="556b2f";namedcolormap.darkorange="ff8c00";namedcolormap.darkorchid="9932cc";namedcolormap.darkred="8b0000";namedcolormap.darksalmon="e9967a";namedcolormap.darkseagreen="8fbc8f";namedcolormap.darkslateblue="483d8b";namedcolormap.darkslategray="2f4f4f";namedcolormap.darkturquoise="00ced1";namedcolormap.darkviolet="9400d3";namedcolormap.deeppink="ff1493";namedcolormap.deepskyblue="00bfff";namedcolormap.dimgray="696969";namedcolormap.dodgerblue="1e90ff";namedcolormap.feldspar="d19275";namedcolormap.firebrick="b22222";namedcolormap.floralwhite="fffaf0";namedcolormap.forestgreen="228b22";namedcolormap.fuchsia="ff00ff";namedcolormap.gainsboro="dcdcdc";namedcolormap.ghostwhite="f8f8ff";namedcolormap.gold="ffd700";namedcolormap.goldenrod="daa520";namedcolormap.gray="808080";namedcolormap.green="3dac39";namedcolormap.greenyellow="adff2f";namedcolormap.honeydew="f0fff0";namedcolormap.hotpink="ff69b4";namedcolormap["indianred "]="cd5c5c";namedcolormap["indigo "]="4b0082";namedcolormap.ivory="fffff0";namedcolormap.khaki="f0e68c";namedcolormap.lavender="e6e6fa";namedcolormap.lavenderblush="fff0f5";namedcolormap.lawngreen="7cfc00";namedcolormap.lemonchiffon="fffacd";namedcolormap.lightblue="add8e6";namedcolormap.lightcoral="f08080";namedcolormap.lightcyan="e0ffff";namedcolormap.lightgoldenrodyellow="fafad2";namedcolormap.lightgrey="d3d3d3";namedcolormap.lightgreen="90ee90";namedcolormap.lightpink="ffb6c1";namedcolormap.lightsalmon="ffa07a";namedcolormap.lightseagreen="20b2aa";namedcolormap.lightskyblue="87cefa";namedcolormap.lightslateblue="8470ff";namedcolormap.lightslategray="778899";namedcolormap.lightsteelblue="b0c4de";namedcolormap.lightyellow="ffffe0";namedcolormap.lime="00ff00";namedcolormap.limegreen="32cd32";namedcolormap.linen="faf0e6";namedcolormap.magenta="ff00ff";namedcolormap.maroon="800000";namedcolormap.mediumaquamarine="66cdaa";namedcolormap.mediumblue="0000cd";namedcolormap.mediumorchid="ba55d3";namedcolormap.mediumpurple="9370d8";namedcolormap.mediumseagreen="3cb371";namedcolormap.mediumslateblue="7b68ee";namedcolormap.mediumspringgreen="00fa9a";namedcolormap.mediumturquoise="48d1cc";namedcolormap.mediumvioletred="c71585";namedcolormap.midnightblue="191970";namedcolormap.mintcream="f5fffa";namedcolormap.mistyrose="ffe4e1";namedcolormap.moccasin="ffe4b5";namedcolormap.navajowhite="ffdead";namedcolormap.navy="000080";namedcolormap.oldlace="fdf5e6";namedcolormap.olive="8e9b41";namedcolormap.olivedrab="6b8e23";namedcolormap.orange="fa9421";namedcolormap.orangered="ff4500";namedcolormap.orchid="da70d6";namedcolormap.palegoldenrod="eee8aa";namedcolormap.palegreen="98fb98";namedcolormap.paleturquoise="afeeee";namedcolormap.palevioletred="d87093";namedcolormap.papayawhip="ffefd5";namedcolormap.peachpuff="ffdab9";namedcolormap.peru="cd853f";namedcolormap.pink="ffe7f5";namedcolormap.plum="dda0dd";namedcolormap.powderblue="b0e0e6";namedcolormap.purple="7b70b6";namedcolormap.red="d81702";namedcolormap.rosybrown="bc8f8f";namedcolormap.royalblue="4169e1";namedcolormap.saddlebrown="8b4513";namedcolormap.salmon="fa8072";namedcolormap.sandybrown="f4a460";namedcolormap.seagreen="2e8b57";namedcolormap.seashell="fff5ee";namedcolormap.sienna="a0522d";namedcolormap.silver="c0c0c0";namedcolormap.skyblue="87ceeb";namedcolormap.slateblue="6a5acd";namedcolormap.slategray="708090";namedcolormap.snow="fffafa";namedcolormap.springgreen="00ff7f";namedcolormap.steelblue="4682b4";namedcolormap.tan="d2c29c";namedcolormap.teal="008080";namedcolormap.thistle="d8bfd8";namedcolormap.tomato="ff6347";namedcolormap.turquoise="40e0d0";namedcolormap.violet="ee82ee";namedcolormap.violetred="d02090";namedcolormap.wheat="f5deb3";namedcolormap.white="ffffff";namedcolormap.whitesmoke="f5f5f5";namedcolormap.yellow="ffd04a";namedcolormap.yellowgreen="9acd32";function CalcColorType(c){if(StringStartsWith(c,"rgb")){return 1}else{if(StringStartsWith(c,"#")){if(c.length==7){return 2}else{if(c.length==4){return 3}}}}return 0}function toRGB(c){var result=new Object();result.r=-1;result.g=-1;result.b=-1;if(StringStartsWith(c,"rgb")){var p1=c.indexOf("(");if(p1==-1){return result}var p2=c.indexOf(", ",p1+1);if(p2==-1){return result}var p3=c.indexOf(", ",p2+2);if(p3==-1){return result}var p4=c.indexOf(")",p3+2);if(p4==-1){return result}result.r=parseInt(c.substr(p1+1,p2-p1-1),10);result.g=parseInt(c.substr(p2+1,p3-p2-1),10);result.b=parseInt(c.substr(p3+1,p4-p3-1),10)}else{if(StringStartsWith(c,"#")&&c.length==7){result.r=parseInt(c.substr(1,2),16);result.g=parseInt(c.substr(3,2),16);result.b=parseInt(c.substr(5,2),16)}else{if(StringStartsWith(c,"#")&&c.length==4){result.r=parseInt(c.substr(1,1)+c.substr(1,1),16);result.g=parseInt(c.substr(2,1)+c.substr(2,1),16);result.b=parseInt(c.substr(3,1)+c.substr(3,1),16)}}}return result}function SameColor(a,b){a=a.toLowerCase();b=b.toLowerCase();var Atype=CalcColorType(a);var Btype=CalcColorType(b);if(Atype==Btype){return(a==b)}var aRGB=toRGB(a);var bRGB=toRGB(b);return(aRGB.r==bRGB.r&&aRGB.g==bRGB.g&&aRGB.b==bRGB.b)}function ToComponent(x){var s=x.toString(16);if(s.length==1){s="0"+s}return s}function CheckAlphaLimits(a,rs,rd,gs,gd,bs,bd){if(a<1-rd/rs){a=1-rd/rs}if(a<1-gd/gs){a=1-gd/gs}if(a<1-bd/bs){a=1-bd/bs}return a}function Calc1Comp(s,d,a,inverse){var x;if(inverse){if(a<=0){x=d}else{x=(d-(s*(1-a)))/a}}else{x=(d*a)+(s*(1-a))}x=Math.round(x);if(x<0){alert("Error, x = "+x)}return x}function CalcBlend(result,s,d,alpha,inverse){var rs=parseInt(s.substr(0,2),16);var gs=parseInt(s.substr(2,2),16);var bs=parseInt(s.substr(4,2),16);var rd=parseInt(d.substr(0,2),16);var gd=parseInt(d.substr(2,2),16);var bd=parseInt(d.substr(4,2),16);var a=Number(alpha);if(inverse){a=CheckAlphaLimits(a,rs,rd,gs,gd,bs,bd)}var rx=Calc1Comp(rs,rd,a,inverse);var gx=Calc1Comp(gs,gd,a,inverse);var bx=Calc1Comp(bs,bd,a,inverse);result.alpha=a;result.rgb=ToComponent(rx)+ToComponent(gx)+ToComponent(bx)}function NormalizeColor(colorString){var isNamedColor=false;if(colorString.charAt(0)=="#"){colorString=colorString.substr(1,colorString.length-1)}else{if(StringStartsWith(colorString,"rgb(")){var p1=colorString.indexOf(",");var p2=colorString.indexOf(",",p1+1);var p3=colorString.indexOf(")");var r=Number(colorString.substr(4,p1-4));var g=Number(colorString.substr(p1+1,p2-p1-1));var b=Number(colorString.substr(p2+1,p3-p2-1));colorString=ToComponent(r)+ToComponent(g)+ToComponent(b)}else{colorString=namedcolormap[colorString.toLowerCase()];isNamedColor=true}}if(colorString.length==3&&!isNamedColor){var r=colorString.charAt(0);var g=colorString.charAt(1);var b=colorString.charAt(2);colorString=r+r+g+g+b+b}return colorString}var _gOverlayBase=new Object();var _gOverColor=new Object();var _gBlendCache=new Object();function GetBlend(overWhite,backColor,alpha){overWhite=NormalizeColor(overWhite);backColor=NormalizeColor(backColor);var alphaLabel=Math.round(alpha*1000).toString();var propname="_"+backColor+"_"+overWhite+"_"+alphaLabel;if(_gBlendCache[propname]==null){CalcBlend(_gOverlayBase,"ffffff",overWhite,alpha,true);CalcBlend(_gOverColor,backColor,_gOverlayBase.rgb,_gOverlayBase.alpha,false);_gBlendCache[propname]="#"+_gOverColor.rgb}return _gBlendCache[propname]}function Darken(color,percentage){var rgb=toRGB("#"+NormalizeColor(color));var hsv=RGBtoHSV(rgb);var factor=(100-percentage)/100;hsv.v=hsv.v*factor;rgb=HSVtoRGB(hsv);var result="#"+ToComponent(rgb.r)+ToComponent(rgb.g)+ToComponent(rgb.b);return result}function RGBtoHSV(rgb){var R=rgb.r;var G=rgb.g;var B=rgb.b;R=R/255;G=G/255;B=B/255;var max=R;if(G>max){max=G}if(B>max){max=B}var min=R;if(G<min){min=G}if(B<min){min=B}var mmm=max-min;var H=0;var S=0;var V=max;if(max!=0){S=1-(min/max)}if(mmm!=0){if(max==R){H=60*((G-B)/mmm)}else{if(max==G){H=(60*((B-R)/mmm))+120}else{if(max==B){H=(60*((R-G)/mmm))+240}}}}if(H<0){H=H+360}var hsv=new Object();hsv.h=H;hsv.s=S;hsv.v=V;return hsv}function HSVtoRGB(hsv){var H=hsv.h;var S=hsv.s;var V=hsv.v;var hi=Math.floor(H/60)%6;var f=(H/60)-hi;var p=V*(1-S);var q=V*(1-(f*S));var t=V*(1-((1-f)*S));var R;var G;var B;if(hi==0){R=V;G=t;B=p}if(hi==1){R=q;G=V;B=p}if(hi==2){R=p;G=V;B=t}if(hi==3){R=p;G=q;B=V}if(hi==4){R=t;G=p;B=V}if(hi==5){R=V;G=p;B=q}R=R*255;G=G*255;B=B*255;var rgb=new Object();rgb.r=Math.round(R,1);rgb.g=Math.round(G,1);rgb.b=Math.round(B,1);return rgb}function FindNearestVisibleRow(table,m,a,b){if(table.rows[m].style.display!="none"){return m}var x=m;var incr=1;var hasHitA=false;var hasHitB=false;while(!hasHitA||!hasHitB){x=m+incr;incr=-incr;if(incr>0){++incr}if(x<=a){hasHitA=true;continue}if(x>=b){hasHitB=true;continue}if(table.rows[x].style.display!="none"){return x}}return -1}var fcPT=new Object;function FindCell(theTable,ev,invisibleRows){if(theTable==null){return null}var x=GetMouseX(ev);var y=GetMouseY(ev);var parent=theTable.parentNode;if(parent.scrollLeft){x+=parent.scrollLeft}if(parent.scrollTop){y+=parent.scrollTop}if(gMainBodyDiv){if(gMainBodyDiv.scrollLeft){x+=gMainBodyDiv.scrollLeft}if(gMainBodyDiv.scrollTop){y+=gMainBodyDiv.scrollTop}}fcPT.r=-1;fcPT.c=-1;var numRows=theTable.rows.length;var top,right,bottom,left;var row=null;var rxA=-1;var rxB=numRows;var rxM;var rowM;var cellM;while(true){rxM=(rxA+rxB)>>1;if(rxM==rxA||rxM==rxB){break}if(invisibleRows){rxM=FindNearestVisibleRow(theTable,rxM,rxA,rxB);if(rxM==-1){return null}}rowM=theTable.rows[rxM];top=GetRowTop(rowM);bottom=top+GetRowHeight(rowM);if(y<=top){rxB=rxM}else{if(y>bottom){rxA=rxM}else{row=rowM;break}}}if(row){var numCols=row.cells.length;for(var c=0;c<numCols;++c){left=GetElemLeft(row.cells[c]);right=left+row.cells[c].offsetWidth;if(x>left&&x<=right){fcPT.r=rxM;fcPT.c=c;return fcPT}}}return null}function GetRowTop(row){if(!IsSafari()){return GetElemTop(row)}if(row.cells[0]){return GetElemTop(row.cells[0])}return 0}function GetRowHeight(row){if(!IsSafari()||_SafariVersion>=3){return row.offsetHeight}if(row.cells[0]){var nextrow=row.nextSibling;for(var n=0;n<3;++n){if(nextrow&&!IsTag(nextrow,"TR")){nextrow=nextrow.nextSibling}}if(nextrow==null){var table=row.parentNode;var bottom=GetElemTop(table)+GetElemHeight(table)}else{var bottom=GetElemTop(nextrow.cells[0])}return bottom-GetRowTop(row)}return 0}function Pad(what,howmuch){var padRight=true;if(typeof what=="number"){what=String(what);padRight=false}var pad="";for(var i=0;i<howmuch-what.length;++i){pad+=" "}if(padRight){return what+pad}return pad+what}function timer(name){this.name=name;this.start=new Date().getTime();this.prev=this.start}timer.prototype.log=function(text){this.now=new Date().getTime();var delta=this.now-this.prev;var prefix="";var suffix="";if(this.name){suffix=" ("+this.name+")"}if(text&&text!=""){prefix+=text+" "}ldi(Pad(prefix,15)+Pad(delta,5)+" ms     total: "+Pad(this.now-this.start,5)+" ms"+suffix);this.prev=new Date().getTime()};function IsQuirksMode(){if(document.compatMode=="CSS1Compat"||IsSafari()){return false}else{return true}}function addEvent(element,type,handler){if(element.addEventListener){element.addEventListener(type,handler,false)}else{if(element.attachEvent){element.attachEvent("on"+type,handler)}}}function removeEvent(element,type,handler){if(element.removeEventListener){element.removeEventListener(type,handler,false)}else{if(element.detachEvent){element.detachEvent(type,handler)}}}function IsOpera(){if(!bsniffed){BrowserSniff()}return _isOpera}function IsChrome(){if(!bsniffed){BrowserSniff()}return _isChrome}function IsGecko(){if(!bsniffed){BrowserSniff()}return _isGecko}function IsIE(){if(!bsniffed){BrowserSniff()}return _isIE}function IsIEmac(){if(!bsniffed){BrowserSniff()}return _isIE&&_isMac}function IsSafari(){if(!bsniffed){BrowserSniff()}return _isSafari}function IsMac(){if(!bsniffed){BrowserSniff()}return _isMac}function IsSafariMobile(){if(!bsniffed){BrowserSniff()}return _isSafariMobile}function GetBrowserVersion(){if(!bsniffed){BrowserSniff()}return _BrowserVersion}var bsniffed=false;function BrowserSniff(){if(bsniffed){return}var agt=navigator.userAgent.toLowerCase();_BrowserVersion=(agt.match(/.+(?:rv|it|ra|ie|me)[\/: ]([\d.]+)/)||[])[1];_isChrome=/chrome/.test(agt);_isSafari=/webkit/.test(agt)&&!_isChrome;_isOpera=/opera/.test(agt);_isSafariMobile=/iphone|ipod|android|ipad/.test(agt)||/^(?=.*(?=mobile))(?=.*(?=safari))/.test(agt);_isIE=/msie/.test(agt)&&!/opera/.test(agt)||/trident/.test(agt);_isIE_greater_than_7=/trident/.test(agt);_isGecko=/firefox[\/]/.test(agt)&&!/seamonkey[\/]/.test(agt);_isMac=/mac/.test(agt);if(_isIE_greater_than_7){var trident_base=4;var current_version=+agt.match(/trident\/(\d)/)[1];_BrowserVersion=trident_base+current_version;_IEversion=trident_base+current_version}if(_isIE&&!_isIE_greater_than_7){var a=agt.indexOf("msie");var p=agt.indexOf(";",a);if(p!=-1&&a!=-1){a=a+4;_IEversion=Number(agt.substr(a,p-a).Trim())}}if(_isSafari){_SafariVersion=2;var a=agt.indexOf("version/")+8;var b=agt.indexOf(".",a);var c=agt.indexOf(" ",a);if(c==-1){c=agt.length}_SafariVersion=(Number(agt.substring(a,b+2)));if(!_isChrome){_BrowserVersion=agt.substring(a,c)}}if(_isGecko){var a=agt.indexOf("firefox/");if(a!=-1){a+=8;var b=agt.indexOf(" ",a);if(b==-1){b=agt.length}_BrowserVersion=agt.substring(a,b)}}bsniffed=true}var _isOpera;var _isChrome;var _isGecko;var _isIE;var _isMac;var _isSafari;var _isSafariMobile;var _IEversion;var _SafariVersion;var _BrowserVersion;function setCompact(announcement,isCompact,animate){announcement=$(announcement);animate=typeof(animate)=="undefined"?true:animate;if(animate){announcement.find(isCompact?".Compact":".Verbose").hide("fast");announcement.find(isCompact?".Verbose":".Compact").show("fast")}else{announcement.find(isCompact?".Compact":".Verbose").hide();announcement.find(isCompact?".Verbose":".Compact").show()}}function permaHide(announcement,animate){announcement=$(announcement);if(animate){announcement.hide("slow")}else{announcement.hide()}var jax=new jaxreq("/db/main?a=QBI_HideAnnouncement");jax.AddValue("id",announcement.attr("id").split("_")[1]);jax.DoAsyncCmd(updateHiddenAnnouncementsVar)}function updateHiddenAnnouncementsVar(jax){if(jax.success){hiddenAnnouncements=jax.GetValue("flags")}}function permaHideUI(uiSelector,id,user,animate){var uiElement=$(uiSelector);if(animate){uiElement.hide("slow")}else{uiElement.hide()}$.ajax({url:"/db/"+gReqAppDBID+(user?"?a=JBI_HideUserUI":"?a=JBI_HideUI"),cache:false,data:{id:id},success:function(result){if(!_.isUndefined(result.errorCode)&&result.errorCode!=0){QB.Dialog.error(result.errorText)}}});EvCancelAll(event)}function ArrayMoveItem(arr,oldIndex,newIndex){if(newIndex==oldIndex){return false}if(oldIndex<0||oldIndex>=arr.length){return false}if(newIndex<0||newIndex>=arr.length){return false}var elt=arr[oldIndex];if(newIndex<oldIndex){for(var i=oldIndex;i>newIndex;i--){arr[i]=arr[i-1]}}else{for(var i=oldIndex;i<newIndex;i++){arr[i]=arr[i+1]}}arr[newIndex]=elt;return true}ArrayFlatten=function(arr){var rtn=[];for(var i=0;i<arr.length;i++){if(arr[i] instanceof Array){rtn=rtn.concat(ArrayFlatten(arr[i]))}else{rtn=rtn.concat(arr[i])}}return rtn};function StringBefore(string,delim){var pos=string.indexOf(delim);if(pos<0){return null}return string.substring(0,pos)}function StringAfter(string,delim){var pos=string.indexOf(delim);if(pos<0){return null}return string.substring(pos+delim.length)}function CSVToArray(strData,strDelimiter){strDelimiter=(strDelimiter||",");var objPattern=new RegExp(("(\\"+strDelimiter+'|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^"\\'+strDelimiter+"\\r\\n]*))"),"gi");var arrData=[[]];var arrMatches=null;while(arrMatches=objPattern.exec(strData)){var strMatchedDelimiter=arrMatches[1];if(strMatchedDelimiter.length&&(strMatchedDelimiter!=strDelimiter)){arrData.push([])}if(arrMatches[2]){var strMatchedValue=arrMatches[2].replace(new RegExp('""',"g"),'"')}else{var strMatchedValue=arrMatches[3]}arrData[arrData.length-1].push(strMatchedValue)}return(arrData)}function hasValue(elemName,value){var elem=toElem(elemName);if(elem){return elem.value==value}return false}function AddHostParam(url){if(!url||url==""||url.length==0){return url}if(StringStartsWith(url,"https://www"+gReqHostName.substring(gReqHostName.indexOf(".")))){var param="_HTTP_REFERER_="+encodeURIComponent(gReqHostName),transformedURL="";if(url.indexOf("?")==-1){transformedURL=url+"?"+param}else{transformedURL=url+"&"+param}return transformedURL}else{return url}}var getUrlLocation=function(href){var l=document.createElement("a");l.href=href;return l};function getSessionValue(key){if(!window.sessionStorage){return null}try{return sessionStorage.getItem(key)}catch(e){return null}}function setSessionValue(key,value){if(!window.sessionStorage){return}try{sessionStorage.setItem(key,value)}catch(e){return}}var QB=QB||{};QB.Storage=QB.Storage||{};QB.Storage.PrefixedAdapter=function(cachePrefix){this.cachePrefix=cachePrefix;if(this.initialize){this.initialize.apply(this)}};if(typeof Backbone!=="undefined"){QB.Storage.PrefixedAdapter.extend=Backbone.Model.extend;QB.Storage.PrefixedAdapter.prototype={localStorageTTL:60*24*60,_getCacheKey:function(keyName){var prefix=null;if(this.cachePrefix){if(_.isFunction(this.cachePrefix)){prefix=this.cachePrefix.call(this)}else{prefix=this.cachePrefix}}prefix=(prefix?"qb/"+prefix:"qb");return prefix+"/"+keyName},set:function(key,value,isSessionOnly){isSessionOnly=typeof isSessionOnly!=="undefined"?isSessionOnly:true;if((typeof window.localStorage==="undefined"||typeof window.localStorage==="unknown"||!window.localStorage)&&!isSessionOnly){return false}if(!key){return false}if(typeof value=="undefined"||value===null){return this.remove(key,isSessionOnly)}try{var cacheKey=this._getCacheKey(key);var valueJSON=JSON.stringify(value);if(!isSessionOnly){lscache.set(cacheKey,valueJSON,this.localStorageTTL)}else{window.sessionStorage.setItem(cacheKey,valueJSON)}return true}catch(ex){return false}},get:function(key,defaultValue,isSessionOnly){isSessionOnly=typeof isSessionOnly!=="undefined"?isSessionOnly:true;if((typeof window.localStorage==="undefined"||typeof window.localStorage==="unknown"||!window.localStorage)&&!isSessionOnly){return}if(!key){return}var cacheKey=this._getCacheKey(key);try{var json;if(!isSessionOnly){json=lscache.get(cacheKey)}else{json=window.sessionStorage.getItem(cacheKey)}if(!json){return defaultValue}return JSON.parse(json)}catch(ex){return defaultValue}},containsKey:function(key){if((typeof window.localStorage==="undefined"||typeof window.localStorage==="unknown"||!window.localStorage)){return}if(!key){return}var cacheKey=this._getCacheKey(key);var cacheVal=lscache.get(cacheKey);return(cacheVal!="undefined")},remove:function(key,isSessionOnly){isSessionOnly=typeof isSessionOnly!=="undefined"?isSessionOnly:true;if((typeof window.localStorage==="undefined"||typeof window.localStorage==="unknown"||!window.localStorage)&&!isSessionOnly){return false}if(!key){return false}var cacheKey=this._getCacheKey(key);try{if(!isSessionOnly){lscache.remove(cacheKey)}else{window.sessionStorage.removeItem(cacheKey)}return true}catch(ex){return false}}}}QB.Storage.Global=new QB.Storage.PrefixedAdapter();QB.Storage.User=new QB.Storage.PrefixedAdapter(function(){return"uid="+(window.gReqUID||0)});QB.Storage.UserApp=new QB.Storage.PrefixedAdapter(function(){return"uid="+(window.gReqUID||0)+"/app="+(window.gReqAppDBID||"main")});QB.Storage.UserDB=new QB.Storage.PrefixedAdapter(function(){return"uid="+(window.gReqUID||0)+"/db="+(window.gReqDBID||"?")});
/*
Autosize 1.11 - jQuery plugin for textareas
(c) 2012 Jack Moore - jacklmoore.com
license: www.opensource.org/licenses/mit-license.php
*/
(function($){var hidden="hidden",borderBox="border-box",lineHeight="lineHeight",copy='<textarea tabindex="-1" style="position:absolute; top:-9999px; left:-9999px; right:auto; bottom:auto; -moz-box-sizing:content-box; -webkit-box-sizing:content-box; box-sizing:content-box; word-wrap:break-word; height:0 !important; min-height:0 !important; overflow:hidden;">',copyStyle=["fontFamily","fontSize","fontWeight","fontStyle","letterSpacing","textTransform","wordSpacing","textIndent","paddingTop","paddingBottom","paddingLeft","paddingRight"],oninput="oninput",onpropertychange="onpropertychange",test=$(copy)[0];test.setAttribute(oninput,"return");if($.isFunction(test[oninput])||onpropertychange in test){$(test).css(lineHeight,"99px");if($(test).css(lineHeight)==="99px"){copyStyle.push(lineHeight)}$.fn.autosize=function(className){return this.each(function(){var ta=this,$ta=$(ta),mirror,minHeight=$ta.height(),maxHeight=parseInt($ta.css("maxHeight"),10),active,i=copyStyle.length,resize,boxOffset=0;if($ta.css("box-sizing")===borderBox||$ta.css("-moz-box-sizing")===borderBox||$ta.css("-webkit-box-sizing")===borderBox){boxOffset=$ta.outerHeight()-$ta.height()}if($ta.data("mirror")||$ta.data("ismirror")){return}else{mirror=$(copy).data("ismirror",true).addClass(className||"autosizejs")[0];resize=$ta.css("resize")==="none"?"none":"horizontal";$ta.data("mirror",$(mirror)).css({overflow:hidden,overflowY:hidden,wordWrap:"break-word",resize:resize})}maxHeight=maxHeight&&maxHeight>0?maxHeight:90000;function adjust(){var height,overflow;if(!active){active=true;mirror.value=ta.value;mirror.style.overflowY=ta.style.overflowY;mirror.style.width=$ta.css("width");mirror.scrollTop=0;mirror.scrollTop=90000;height=mirror.scrollTop;overflow=hidden;if(height>maxHeight){height=maxHeight;overflow="scroll"}else{if(height<minHeight){height=minHeight}}ta.style.overflowY=overflow;ta.style.height=height+boxOffset+"px";setTimeout(function(){active=false},1)}}while(i--){mirror.style[copyStyle[i]]=$ta.css(copyStyle[i])}$("body").append(mirror);if(onpropertychange in ta){if(oninput in ta){ta[oninput]=ta.onkeyup=adjust}else{ta[onpropertychange]=adjust}}else{ta[oninput]=adjust}$(window).resize(adjust);$ta.bind("autosize",adjust);$ta.text($ta.text());adjust()})}}else{$.fn.autosize=function(){return this}}}(jQuery));; 
 
//@ sourceURL=/js/widgets.js 
var QB=QB||{};QB.Utils=QB.Utils||{};QB.Dialog=(function(){var defaultCoreOptions={type:null,size:"medium",title:"",headline:null,contents:null,contentType:"text",id:"qbDialog",cancel:{text:"Cancel","class":"Cancel",type:"Plain",focused:true,click:function(){$(this).dialog("close")}},confirm:{text:"OK","class":"Confirm",type:"Success",focused:false,click:function(){$(this).dialog("close")}},extraButtons:[],focusedButton:null,hideCloseButton:false,darkOverlay:false,hideTitleBar:false,hideButtonBar:false,jqDialogOptions:{modal:true,resizable:false,minHeight:false,maxHeight:500}};function _coreDialog(options){var options=$.extend(true,{},defaultCoreOptions,options);var userContents=null;if(options.contentType==="text"){userContents=$("<div id='qbDialogMessage'></div>").text(options.contents)}else{if(options.contentType==="html"){userContents=$("<div id='qbDialogMessage'></div>").html(options.contents)}else{userContents=$(options.contents).show()}}var contents=$('<div class="Contents"></div>');if(options.headline){var headline=$('<div class="Headline"><span class="Icon"></span></div>');headline.append($('<span class="Text"></span>').html(options.headline));contents.append(headline)}contents.append(userContents);var size={};if(options.size=="small"){size.width=300;size.maxWidth=400}else{if(options.size=="medium"){size.width=500;size.maxWidth=600}else{if(options.size=="large"){size.width=700;size.maxWidth=800}else{if(options.size=="huge"){size.width=900;size.maxWidth=900}else{if(options.size=="auto"){size.width="auto"}else{if(typeof options.size=="number"){size.width=options.size;size.maxWidth=options.size}}}}}}if(!options.title&&options.contentType=="selector"){options.title=userContents.attr("title")}var opts=$.extend({},options.jqDialogOptions||{},{title:options.title||"",buttons:{decoy:function(){}}},size);if(opts.maxHeight){contents.css({"max-height":opts.maxHeight+"px","overflow-y":"auto"})}if(options.darkOverlay){contents.bind("dialogopen.qbdialog",function(evt){contents.dialog("widget").prev(".ui-widget-overlay").addClass("darkOverlay");contents.dialog("widget").next(".ui-widget-overlay").addClass("darkOverlay")});contents.bind("dialogbeforeclose.qbdialog",function(evt){contents.dialog("widget").prev(".ui-widget-overlay").removeClass("darkOverlay");contents.dialog("widget").next(".ui-widget-overlay").removeClass("darkOverlay");contents.unbind(".qbdialog")})}contents.dialog(opts);var widget=contents.dialog("widget").addClass("QB Dialog");widget.addClass(options.type||"Untyped");if(options.hideTitleBar){contents.siblings("div.ui-dialog-titlebar").remove();widget.addClass("no-titlebar")}if(options.hideButtonBar){contents.siblings("div.ui-dialog-buttonpane").css({display:"none"})}if(options.id){widget.attr("id",options.id);contents.bind("dialogbeforeclose",function(evt){widget.attr("id","")})}var buttons=[];if("extraButtons" in options&&$.isArray(options.extraButtons)){for(var i=0;i<options.extraButtons.length;i++){buttons.push(options.extraButtons[i])}}if(options.confirm!=null){buttons.push(options.confirm)}if(options.cancel!=null){buttons.push(options.cancel)}var buttonPane=widget.children(".ui-dialog-buttonpane").last();buttonPane.empty();for(var i=0;i<buttons.length;i++){var button=$('<button class="Vibrant"></button>').text(buttons[i].text);if(buttons[i]["class"]){button.addClass(buttons[i]["class"])}if(buttons[i]["type"]){button.addClass(buttons[i]["type"])}button.button();if($.isFunction(buttons[i].click)){button.click($.proxy(buttons[i].click,contents))}buttonPane.append(button)}if(options.focusedButton){buttonPane.find(options.focusedButton).focus()}if(options.hideCloseButton){widget.children(".ui-dialog-titlebar").find(".ui-dialog-titlebar-close").hide()}return contents}function getDialogPolymorphOptions(arguments){var options=arguments[0];var callback=arguments[1];var opts2=arguments[2];if($.isPlainObject(options)){return options}if(typeof options==="string"){options={contents:options,contentType:"text"}}else{options={contents:options,contentType:"selector"}}if($.isFunction(callback)){options.confirm=$.extend(true,{},options.confirm||{},{click:callback})}if(opts2){options=$.extend(true,{},options,opts2)}return options}return{alert:function(contents,callback,options){var options=getDialogPolymorphOptions(arguments);var defaults={size:"small",cancel:null,confirm:{focused:true}};var opts=$.extend(true,defaults,options);return _coreDialog(opts)},error:function(contents,callback,options){var options=getDialogPolymorphOptions(arguments);var defaults={type:"Error",headline:"Something went wrong!"};var opts=$.extend(true,defaults,options);return this.alert(opts)},confirm:function(contents,callback,options){var options=getDialogPolymorphOptions(arguments);var defaults={size:"small",confirm:{text:"Continue"}};var opts=$.extend(true,defaults,options);return _coreDialog(opts)},dialog:function(text,title){var options=getDialogPolymorphOptions(arguments);var defaults={size:"medium"};var opts=$.extend(true,defaults,options);return _coreDialog(opts)}}})();(function($){if(typeof $.ui.dialog==="undefined"){return}$.extend($.ui.dialog.prototype,{toggleButtonsEnabled:function(isEnabled,buttonSelector){var buttonPane=this.element.dialog("widget").children(".ui-dialog-buttonpane");var buttons=buttonPane.children("button");if(buttonSelector){buttons=buttons.filter(buttonSelector)}buttons.button(isEnabled?"enable":"disable")},enableButtons:function(buttonSelector){this.toggleButtonsEnabled(true,buttonSelector)},disableButtons:function(buttonSelector){this.toggleButtonsEnabled(false,buttonSelector)}})})(jQuery);var QBNagBox=(function(){var DefaultQBNagBoxOptions={nagBoxType:"Info",nagBoxExtraClasses:"",headerClass:"NagBoxHeader",contentClass:"NagBoxContent",closeIconClass:"Icon Close NagBoxClose",nagTypeIconClass:"Icon",closable:true,onClose:"",beforeElem:"",afterElem:"",content:"",header:""};function _qbNagBox(options){var nagBox=$('<div class="QBNagBox ui-corner-all"></div>').addClass("QB"+options.nagBoxType+"Box");if(options.nagBoxExtraClasses){nagBox.addClass(options.nagBoxExtraClasses)}var nagContentHolder=$("<div></div>").addClass(options.nagTypeIconClass);var nagBoxHeader=$("<div></div>").addClass(options.headerClass).html(options.header);var nagBoxContent=$("<div></div>").addClass(options.contentClass).html(options.content);nagContentHolder.append(nagBoxHeader);if(options.closable){var nagBoxCloseIcon=$("<div></div>").addClass(options.closeIconClass).click(function(){options.onClose;nagBox.remove()});nagContentHolder.append(nagBoxCloseIcon)}nagContentHolder.append(nagBoxContent);nagBox.append(nagContentHolder);if(options.beforeElem!=""){$(options.beforeElem).before(nagBox)}else{if(options.afterElem!=""){$(options.afterElem).after(nagBox)}else{if(options.content instanceof $){nagBox.insertAfter(options.content);nagBoxContent.html("").append(options.content.detach())}else{nagBox.appendTo($("body"))}}}return nagBox}return{info:function(optionalParams){DefaultQBNagBoxOptions.nagBoxType="Info";DefaultQBNagBoxOptions.nagTypeIconClass+=" "+DefaultQBNagBoxOptions.nagBoxType;return _qbNagBox($.extend({},DefaultQBNagBoxOptions,optionalParams))},warning:function(optionalParams){DefaultQBNagBoxOptions.nagBoxType="Warning";DefaultQBNagBoxOptions.nagTypeIconClass+=" "+DefaultQBNagBoxOptions.nagBoxType;return _qbNagBox($.extend({},DefaultQBNagBoxOptions,optionalParams))},error:function(optionalParams){DefaultQBNagBoxOptions.nagBoxType="Error";DefaultQBNagBoxOptions.nagTypeIconClass+=" "+DefaultQBNagBoxOptions.nagBoxType;return _qbNagBox($.extend({},DefaultQBNagBoxOptions,optionalParams))}}})();var Response={redirectUrl:function(url){document.location=url},redirectAct:function(action,dbid,extraOpts){var url=this.getActionUrl(action,dbid,extraOpts);this.redirectUrl(url)},getActionUrl:function(action,dbid,extraOpts){if(typeof(dbid)=="undefined"||dbid==null){dbid=gReqDBID}if(typeof(extraOpts)=="object"){extraOpts="&"+$.param(extraOpts)}var url="/db/"+dbid+"?a="+action;if(typeof(extraOpts)!="undefined"){url+=extraOpts}return url}};var Log=(function(){var logger=null;if(typeof(window.console)!="undefined"){logger=window.console}var _Levels={Silent:0,Error:1,Warn:2,Info:3,Debug:4};function _log(cond,args,primary){if(!cond){return}if(primary){primary.apply(logger,args)}else{if(logger.log){logger.log.apply(logger,args)}}}return{Levels:_Levels,level:_Levels.Error,setLevel:function(level){this.level=level},debug:function(){if(logger==null){return}_log(this.level>=this.Levels.Debug,arguments,logger.debug)},info:function(){if(logger==null){return}_log(this.level>=this.Levels.Info,arguments,logger.info)},warn:function(){if(logger==null){return}_log(this.level>=this.Levels.Warn,arguments,logger.warn)},error:function(){if(logger==null){return}_log(this.level>=this.Levels.Error,arguments,logger.error)}}})();QBCollapser=function(targetElem,iconElem){this.targetElem=targetElem;this.iconElem=iconElem;this.init()};QBCollapser.prototype={targetElem:null,iconElem:null,iconClass:"Icon",expandClass:"Plus",collapseClass:"Minus",_toggleQbCollapser:function(){$(this.targetElem).slideToggle("fast");$(this.iconElem).toggleClass(this.expandClass);$(this.iconElem).toggleClass(this.collapseClass)},_toggleQbCollapserIcon:function(){if($(this.targetElem).is(":visible")){$(this.iconElem).removeClass(this.expandClass).addClass(this.collapseClass)}else{$(this.iconElem).removeClass(this.collapseClass).addClass(this.expandClass)}},init:function(){var self=this;if(!this.targetElem||!this.iconElem){return false}$(this.iconElem).addClass(this.iconClass);this._toggleQbCollapserIcon();$(this.iconElem).click(function(){self._toggleQbCollapser()})}};QB.Utils.stickAtTopWhileScrolling=function(elements,scroller){var scroller=$(scroller);var stickers=[];for(var i=0;i<elements.length;i++){elements[i]=$(elements[i]).css("z-index",50+i);stickers[i]=$('<div class="Sticker"></div>');elements[i].before(stickers[i])}scroller.bind("scroll",_.throttle(adjustStuckElement,50));scroller.data("headerSize",0);adjustStuckElement();function adjustStuckElement(){var scrollerTop=scroller.offset().top;var scrollerScroll=scroller.scrollTop();var headerSize=0;var lastStuckElementBottomEdge=0;for(var i=0;i<elements.length;i++){var element=elements[i];var sticker=stickers[i];var isStuck=element.hasClass("ScrollSticky");var offset=(isStuck?sticker:element).offset().top-(scrollerTop);var shouldStick=(offset<=headerSize);var elementHeight=(isStuck?sticker:element).outerHeight();if(shouldStick){sticker.css("height",elementHeight+"px").show();element.addClass("ScrollSticky");var top=headerSize+sticker.position().top-offset;element.css({top:top+"px"});lastStuckElementBottomEdge=element.offset().top-scrollerTop+elementHeight}else{if(isStuck&&!shouldStick){sticker.css("height","1px").hide();element.removeClass("ScrollSticky").css("top","")}}headerSize+=elementHeight}scroller.data("headerSize",lastStuckElementBottomEdge>0?lastStuckElementBottomEdge:0)}};QB.Utils.pinBeneathPageBar=function(elt){var element=$(elt).css("z-index",999);if(element.length!==1){return false}var sticker=$('<div class="Sticker"></div>').insertBefore(element).hide();var isStuck=false;var pageBar=$("#pageNavBar");function adjustStuckElement(){var shouldStick=pageBar.hasClass("Fixed");if(shouldStick&&!isStuck){var barTop=pageBar.offset().top-$(window).scrollTop();var barHeight=pageBar.outerHeight();var elementHeight=element.outerHeight();sticker.css("height",elementHeight+"px").show();element.addClass("ScrollSticky Fixed");element.css({top:(barTop+barHeight)+"px"})}else{if(!shouldStick&&isStuck){sticker.css("height","").hide();element.removeClass("ScrollSticky Fixed").css({top:""})}}isStuck=shouldStick}$(window).on("scroll resizeidle.qb",_.throttle(adjustStuckElement,50));adjustStuckElement()};(function(){$.widget("qb.splitbutton",{options:{saveSelection:true,saveSelectionKey:"",alternateActionsMenu:null,menuButtonClass:"Tall Vibrant",updateAction:true,title:"Change Button Action"},_create:function(){if(!this.options.alternateActionsMenu){return}if(this.options.saveSelection&&!this.options.saveSelectionKey){return}this._createMenuButton();this._createMenu();this._bindMenuActions();this._initState()},_createMenuButton:function(){this.element.addClass("qb-splitbutton-btn");this.menuButton=$("<a></a>",{href:"#","class":this.options.menuButtonClass+" IconOnly Tipsy qb-splitbutton-menubtn","data-original-title":this.options.title});this.menuButton=this.menuButton.html('<span class="Icon DownArrowWhite"></span>&nbsp;').insertAfter(this.element)},_createMenu:function(){this.menu=$(this.options.alternateActionsMenu);this.menu.addClass("qb-splitbutton-menu");this.menu.qbMenu({trigger:{selector:this.menuButton,position:{my:"right top",at:"right bottom",of:this.menuButton}},zindex:9999});this.menuButton.click(function(){return false})},_bindMenuActions:function(){var self=this;this.menu.delegate("a","click",function(){var actionText=$(this).text();if(self.options.updateAction){self._updateAction(actionText)}})},_initState:function(){if(this.options.saveSelection){var text=getSessionValue(this.options.saveSelectionKey)||this.element.text();setSessionValue(this.options.saveSelectionKey,text);this.element.text(text)}},_updateAction:function(action){if(this.options.saveSelection){setSessionValue(this.options.saveSelectionKey,action)}this.element.text(action).click()}})})();(function(){$.widget("qb.columnChooser",{options:{defColArray:[],defOrderArray:[],srcListOrder:[],preventSelectionFor:[],minDestItems:0,maxDestItems:-1},_create:function(){this.srcList=$(this.options.srcList);this.destList=$(this.options.destList);this.srcList.addClass("SrcList");this.destList.addClass("DestList");this.sourceListOrder(this.options.srcListOrder);this._initSelection()},_initSelection:function(){var self=this;this.srcList.on("mousedown","li",function(){self._selectItem(this)});this.destList.on("mousedown","li",function(){self._selectItem(this)});if(this.options.allowDnD){this.srcList.sortable({connectWith:this.destList,start:function(e,ui){var maxItems=self.options.maxDestItems;if((maxItems!=-1)&&(self.destList.children().length==maxItems)){$(ui.helper).css("cursor","not-allowed")}},stop:function(e,ui){$(ui.item).css("cursor","default");if(ui.item.parent().hasClass("SrcList")){$(this).sortable("cancel")}else{var maxItems=self.options.maxDestItems;if((maxItems!=-1)&&(self.destList.children().length-1==maxItems)){$(this).sortable("cancel")}}},receive:function(e,ui){self._trigger("destItemMoved",{},{})}});this.destList.sortable({connectWith:this.srcList,receive:function(e,ui){self.destList.find("li").removeClass("selected");ui.item.addClass("selected");self._trigger("srcItemMoved",{},{})},remove:function(e,ui){$(this).sortable("cancel");self.destToSrc(ui.item)},stop:function(e,ui){if(ui.item.parent().attr("id")==self.destList.attr("id")){self._trigger("destItemMoved",{},{})}}})}this.srcList.on("dblclick","li",function(){self.srcToDest(this)});this.destList.on("dblclick","li",function(){self.destToSrc(this)})},sourceListOrder:function(value){this.srcListOrder=value},_selectItem:function(item){item=$(item);item.siblings().removeClass("selected");if(item.data("value")){item.addClass("selected");this._trigger("selectionChanged",null,null)}},selectedSrcItem:function(){return this.srcList.find("li.selected").first()},srcToDest:function(item){var maxItems=this.options.maxDestItems;if((maxItems!=-1)&&(this.destList.children().length>=maxItems)){return}var moved=this._moveItem(item,this.srcList,this.destList,false);this._trigger("destItemAdded",{},moved)},destToSrc:function(item){var minItems=this.options.minDestItems;if(minItems&&(minItems>=this.destList.children().length)){return}var moved=this._moveItem(item,this.destList,this.srcList,true);this._trigger("srcItemAdded",{},moved)},_findInsertionAt:function(val){var pos=0;var ret=null;var available=this.srcListOrder;this.srcList.find("li").each(function(){var nextVal=""+$(this).data("value");var i;for(i=0;i<available.length;i++){if(available[i]==nextVal){break}else{if(available[i]==val){ret=$(this);return false}}}});return ret},restoreDestToSrc:function(item){var val=item.data("value");var at=this._findInsertionAt(""+val);this.srcList.find("li").removeClass("selected");if(at==null){this.srcList.append(item)}else{at.before(item)}},restoreAllDestItemsToSrc:function(){var self=this;this.destList.find("li").each(function(){self.restoreDestToSrc($(this))})},_moveItem:function(item,fromList,toList,originalOrder){var src=item?$(item):fromList.find("li.selected:visible");var index=src.index();var fromItems;var newSelection;if(src.length>0){toList.find("li").removeClass("selected");if(originalOrder){this.restoreDestToSrc(src.first())}else{src.appendTo(toList)}if(index==fromList.children().length){index--}fromItems=fromList.children("li");newSelection=fromItems.eq(index);while(index>=0&&(newSelection.is(":hidden")||_.contains(this.options.preventSelectionFor,newSelection.data("value")))){newSelection=fromItems.eq(--index)}if(index>=0){newSelection.addClass("selected")}}return src},selectDefaultColumns:function(){var self=this;this.restoreAllDestItemsToSrc();this.srcList.find("li").each(function(){if(_.contains(self.options.defColArray,parseInt($(this).data("value")))){self.srcToDest(this)}})},sortDestColumns:function(){var self=this;_.each(self.options.defOrderArray,function(val){var item=self.destList.find("li[data-value='"+val+"']");item.appendTo(self.destList)})},repositionItem:function(incr){var selected=this.destList.find("li.selected").first();var numItems=this.destList.children("li").length;var index=selected.index();if(index!=-1){index+=incr;if(index<0){index=0}if(index<numItems-1){selected.insertBefore(selected.siblings(":eq("+index+")"))}else{selected.appendTo(this.destList)}this._trigger("destItemMoved",{},{})}},destroy:function(){}})})();$(function(){$(document.body).on("mouseenter",".AlertBanner .AlertAction",function(evt){$(this).closest(".AlertBanner").addClass("Active")});$(document.body).on("mouseleave",".AlertBanner .AlertAction",function(evt){$(this).closest(".AlertBanner").removeClass("Active")})});var userToolTipDefaultOptions={position:{corner:{target:"rightMiddle",tooltip:"leftMiddle"},adjust:{screen:true}},show:{delay:300},hide:{fixed:true,delay:250},style:{padding:"8px",color:"#000",border:{width:1,radius:2,color:"#999"},width:350,tip:true,background:"white"}};QB.Utils.SetupUserToolTipFromID=function(trigger,luid,fullName){var contents="<div class='AutoTip'><div class='Headline'><span class='User Icon'></span>"+fullName+"</div><div class='Contents LoadUserDetails' data-luid='"+luid+"'><div class='Icon AJAXLoading'></div></div></div>";QB.Utils.SetupUserToolTip(trigger,contents,{show:{ready:true}})};QB.Utils.TransformGenUserWinLink=function(elem){$(elem).one("click mouseover",function(event){var trigger=$(event.currentTarget);QB.Utils.SetupUserToolTipFromID(trigger,trigger.data("luid"),trigger.data("fullname"));trigger.removeClass("userWinLink");event.preventDefault()})};QB.Utils.SetupUserToolTip=function(trigger,contents,extraOptions){var trigger=$(trigger);var contents=$(contents);trigger.attr("onclick",null).off("click");var isVisible=false;trigger.qtip($.extend(true,{content:{text:contents},api:{onRender:function(){var detailContainer=$(this.elements.content).find(".Contents.LoadUserDetails");var luid=detailContainer.attr("data-luid");if(!luid){detailContainer.text("Could not load user details");return}var url="/db/main?a=GenUserTooltipDetailsFragment&uid="+luid;detailContainer.removeClass(".LoadUserDetails").load(url+" .AllIndented.Description",function(){trigger.qtip("api").updatePosition()})},onHide:function(){isVisible=false},onShow:function(){isVisible=true}}},userToolTipDefaultOptions,extraOptions));trigger.click(function(evt){trigger.qtip(isVisible?"hide":"show");return false})};; 
 
//@ sourceURL=/js/jquery.watermark.js 
/*!
 * jQuery Watermark Plugin v1.0
 *
 * Copyright 2010, George Courtsunis
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * Date: Sun Feb 21 22:33:48 2010
 */
(function() {
jQuery.fn.watermark = function(options) {

    return this.each(function() {

        //setup settings
        var settings = {
            color : {
                prev : $(this).css('color'),
                next : 'rgb(200, 200, 200)'
            },
            text : 'watermark...',
            reset : true 
        };

        if (options) {

            if (options.color) {
                var color = options.color;
                options.color = {};
                options.color.next = color;
                options.color.prev = settings.color.prev; //necessary
            }

            //extend w/ passed in options
            settings = jQuery.extend(settings, options);

        }  

        //bind event listeners to input
        var input = $(this).bind('focus', onFocus).bind('blur', onBlur).bind('watermarkreset', onFocus);

        //don't clobber pre-seeded values
        if (input.val().replace(/^\s+|\s+$/g, '') == '') {
            onBlur(input);
        }

        //event for the 'onfocus' DOM event
        function onFocus() {

            if (settings.reset) {

                //clear input
                $(this)
                    .val('')
                    .css('color', settings.color.prev);

                settings.reset = false;

            }

        };

        //event for the 'onblur' DOM event
        function onBlur() {

            //select input type
            var input = (arguments[0][0] && arguments[0][0].nodeType == 1) ? arguments[0] : $(this); //check for an html element

            //if there is nothing in the input, reset
            if (input.val().replace(/^\s+|\s+$/g, '').length < 1) {

                //reset watermark
                input 
                    .val(settings.text)
                    .css('color', settings.color.next);

                settings.reset = true;

            }

        };


    });
}
})()
; 
 
//@ sourceURL=/js/dataTables-1.8/media/js/jquery.dataTables.min.js 
/*
 * File:        jquery.dataTables.min.js
 * Version:     1.8.1
 * Author:      Allan Jardine (www.sprymedia.co.uk)
 * Info:        www.datatables.net
 * 
 * Copyright 2008-2011 Allan Jardine, all rights reserved.
 *
 * This source file is free software, under either the GPL v2 license or a
 * BSD style license, as supplied with this software.
 * 
 * This source file is distributed in the hope that it will be useful, but 
 * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY 
 * or FITNESS FOR A PARTICULAR PURPOSE. See the license files for details.
 */
(function(i,wa,p){i.fn.dataTableSettings=[];var D=i.fn.dataTableSettings;i.fn.dataTableExt={};var o=i.fn.dataTableExt;o.sVersion="1.8.1";o.sErrMode="alert";o.iApiIndex=0;o.oApi={};o.afnFiltering=[];o.aoFeatures=[];o.ofnSearch={};o.afnSortData=[];o.oStdClasses={sPagePrevEnabled:"paginate_enabled_previous",sPagePrevDisabled:"paginate_disabled_previous",sPageNextEnabled:"paginate_enabled_next",sPageNextDisabled:"paginate_disabled_next",sPageJUINext:"",sPageJUIPrev:"",sPageButton:"paginate_button",sPageButtonActive:"paginate_active",
sPageButtonStaticDisabled:"paginate_button paginate_button_disabled",sPageFirst:"first",sPagePrevious:"previous",sPageNext:"next",sPageLast:"last",sStripOdd:"odd",sStripEven:"even",sRowEmpty:"dataTables_empty",sWrapper:"dataTables_wrapper",sFilter:"dataTables_filter",sInfo:"dataTables_info",sPaging:"dataTables_paginate paging_",sLength:"dataTables_length",sProcessing:"dataTables_processing",sSortAsc:"sorting_asc",sSortDesc:"sorting_desc",sSortable:"sorting",sSortableAsc:"sorting_asc_disabled",sSortableDesc:"sorting_desc_disabled",
sSortableNone:"sorting_disabled",sSortColumn:"sorting_",sSortJUIAsc:"",sSortJUIDesc:"",sSortJUI:"",sSortJUIAscAllowed:"",sSortJUIDescAllowed:"",sSortJUIWrapper:"",sSortIcon:"",sScrollWrapper:"dataTables_scroll",sScrollHead:"dataTables_scrollHead",sScrollHeadInner:"dataTables_scrollHeadInner",sScrollBody:"dataTables_scrollBody",sScrollFoot:"dataTables_scrollFoot",sScrollFootInner:"dataTables_scrollFootInner",sFooterTH:""};o.oJUIClasses={sPagePrevEnabled:"fg-button ui-button ui-state-default ui-corner-left",
sPagePrevDisabled:"fg-button ui-button ui-state-default ui-corner-left ui-state-disabled",sPageNextEnabled:"fg-button ui-button ui-state-default ui-corner-right",sPageNextDisabled:"fg-button ui-button ui-state-default ui-corner-right ui-state-disabled",sPageJUINext:"ui-icon ui-icon-circle-arrow-e",sPageJUIPrev:"ui-icon ui-icon-circle-arrow-w",sPageButton:"fg-button ui-button ui-state-default",sPageButtonActive:"fg-button ui-button ui-state-default ui-state-disabled",sPageButtonStaticDisabled:"fg-button ui-button ui-state-default ui-state-disabled",
sPageFirst:"first ui-corner-tl ui-corner-bl",sPagePrevious:"previous",sPageNext:"next",sPageLast:"last ui-corner-tr ui-corner-br",sStripOdd:"odd",sStripEven:"even",sRowEmpty:"dataTables_empty",sWrapper:"dataTables_wrapper",sFilter:"dataTables_filter",sInfo:"dataTables_info",sPaging:"dataTables_paginate fg-buttonset ui-buttonset fg-buttonset-multi ui-buttonset-multi paging_",sLength:"dataTables_length",sProcessing:"dataTables_processing",sSortAsc:"ui-state-default",sSortDesc:"ui-state-default",sSortable:"ui-state-default",
sSortableAsc:"ui-state-default",sSortableDesc:"ui-state-default",sSortableNone:"ui-state-default",sSortColumn:"sorting_",sSortJUIAsc:"css_right ui-icon ui-icon-triangle-1-n",sSortJUIDesc:"css_right ui-icon ui-icon-triangle-1-s",sSortJUI:"css_right ui-icon ui-icon-carat-2-n-s",sSortJUIAscAllowed:"css_right ui-icon ui-icon-carat-1-n",sSortJUIDescAllowed:"css_right ui-icon ui-icon-carat-1-s",sSortJUIWrapper:"DataTables_sort_wrapper",sSortIcon:"DataTables_sort_icon",sScrollWrapper:"dataTables_scroll",
sScrollHead:"dataTables_scrollHead ui-state-default",sScrollHeadInner:"dataTables_scrollHeadInner",sScrollBody:"dataTables_scrollBody",sScrollFoot:"dataTables_scrollFoot ui-state-default",sScrollFootInner:"dataTables_scrollFootInner",sFooterTH:"ui-state-default"};o.oPagination={two_button:{fnInit:function(g,l,r){var s,w,y;if(g.bJUI){s=p.createElement("a");w=p.createElement("a");y=p.createElement("span");y.className=g.oClasses.sPageJUINext;w.appendChild(y);y=p.createElement("span");y.className=g.oClasses.sPageJUIPrev;
s.appendChild(y)}else{s=p.createElement("div");w=p.createElement("div")}s.className=g.oClasses.sPagePrevDisabled;w.className=g.oClasses.sPageNextDisabled;s.title=g.oLanguage.oPaginate.sPrevious;w.title=g.oLanguage.oPaginate.sNext;l.appendChild(s);l.appendChild(w);i(s).bind("click.DT",function(){g.oApi._fnPageChange(g,"previous")&&r(g)});i(w).bind("click.DT",function(){g.oApi._fnPageChange(g,"next")&&r(g)});i(s).bind("selectstart.DT",function(){return false});i(w).bind("selectstart.DT",function(){return false});
if(g.sTableId!==""&&typeof g.aanFeatures.p=="undefined"){l.setAttribute("id",g.sTableId+"_paginate");s.setAttribute("id",g.sTableId+"_previous");w.setAttribute("id",g.sTableId+"_next")}},fnUpdate:function(g){if(g.aanFeatures.p)for(var l=g.aanFeatures.p,r=0,s=l.length;r<s;r++)if(l[r].childNodes.length!==0){l[r].childNodes[0].className=g._iDisplayStart===0?g.oClasses.sPagePrevDisabled:g.oClasses.sPagePrevEnabled;l[r].childNodes[1].className=g.fnDisplayEnd()==g.fnRecordsDisplay()?g.oClasses.sPageNextDisabled:
g.oClasses.sPageNextEnabled}}},iFullNumbersShowPages:5,full_numbers:{fnInit:function(g,l,r){var s=p.createElement("span"),w=p.createElement("span"),y=p.createElement("span"),G=p.createElement("span"),x=p.createElement("span");s.innerHTML=g.oLanguage.oPaginate.sFirst;w.innerHTML=g.oLanguage.oPaginate.sPrevious;G.innerHTML=g.oLanguage.oPaginate.sNext;x.innerHTML=g.oLanguage.oPaginate.sLast;var v=g.oClasses;s.className=v.sPageButton+" "+v.sPageFirst;w.className=v.sPageButton+" "+v.sPagePrevious;G.className=
v.sPageButton+" "+v.sPageNext;x.className=v.sPageButton+" "+v.sPageLast;l.appendChild(s);l.appendChild(w);l.appendChild(y);l.appendChild(G);l.appendChild(x);i(s).bind("click.DT",function(){g.oApi._fnPageChange(g,"first")&&r(g)});i(w).bind("click.DT",function(){g.oApi._fnPageChange(g,"previous")&&r(g)});i(G).bind("click.DT",function(){g.oApi._fnPageChange(g,"next")&&r(g)});i(x).bind("click.DT",function(){g.oApi._fnPageChange(g,"last")&&r(g)});i("span",l).bind("mousedown.DT",function(){return false}).bind("selectstart.DT",
function(){return false});if(g.sTableId!==""&&typeof g.aanFeatures.p=="undefined"){l.setAttribute("id",g.sTableId+"_paginate");s.setAttribute("id",g.sTableId+"_first");w.setAttribute("id",g.sTableId+"_previous");G.setAttribute("id",g.sTableId+"_next");x.setAttribute("id",g.sTableId+"_last")}},fnUpdate:function(g,l){if(g.aanFeatures.p){var r=o.oPagination.iFullNumbersShowPages,s=Math.floor(r/2),w=Math.ceil(g.fnRecordsDisplay()/g._iDisplayLength),y=Math.ceil(g._iDisplayStart/g._iDisplayLength)+1,G=
"",x,v=g.oClasses;if(w<r){s=1;x=w}else if(y<=s){s=1;x=r}else if(y>=w-s){s=w-r+1;x=w}else{s=y-Math.ceil(r/2)+1;x=s+r-1}for(r=s;r<=x;r++)G+=y!=r?'<span class="'+v.sPageButton+'">'+r+"</span>":'<span class="'+v.sPageButtonActive+'">'+r+"</span>";x=g.aanFeatures.p;var z,Y=function(L){g._iDisplayStart=(this.innerHTML*1-1)*g._iDisplayLength;l(g);L.preventDefault()},V=function(){return false};r=0;for(s=x.length;r<s;r++)if(x[r].childNodes.length!==0){z=i("span:eq(2)",x[r]);z.html(G);i("span",z).bind("click.DT",
Y).bind("mousedown.DT",V).bind("selectstart.DT",V);z=x[r].getElementsByTagName("span");z=[z[0],z[1],z[z.length-2],z[z.length-1]];i(z).removeClass(v.sPageButton+" "+v.sPageButtonActive+" "+v.sPageButtonStaticDisabled);if(y==1){z[0].className+=" "+v.sPageButtonStaticDisabled;z[1].className+=" "+v.sPageButtonStaticDisabled}else{z[0].className+=" "+v.sPageButton;z[1].className+=" "+v.sPageButton}if(w===0||y==w||g._iDisplayLength==-1){z[2].className+=" "+v.sPageButtonStaticDisabled;z[3].className+=" "+
v.sPageButtonStaticDisabled}else{z[2].className+=" "+v.sPageButton;z[3].className+=" "+v.sPageButton}}}}}};o.oSort={"string-asc":function(g,l){if(typeof g!="string")g="";if(typeof l!="string")l="";g=g.toLowerCase();l=l.toLowerCase();return g<l?-1:g>l?1:0},"string-desc":function(g,l){if(typeof g!="string")g="";if(typeof l!="string")l="";g=g.toLowerCase();l=l.toLowerCase();return g<l?1:g>l?-1:0},"html-asc":function(g,l){g=g.replace(/<.*?>/g,"").toLowerCase();l=l.replace(/<.*?>/g,"").toLowerCase();return g<
l?-1:g>l?1:0},"html-desc":function(g,l){g=g.replace(/<.*?>/g,"").toLowerCase();l=l.replace(/<.*?>/g,"").toLowerCase();return g<l?1:g>l?-1:0},"date-asc":function(g,l){g=Date.parse(g);l=Date.parse(l);if(isNaN(g)||g==="")g=Date.parse("01/01/1970 00:00:00");if(isNaN(l)||l==="")l=Date.parse("01/01/1970 00:00:00");return g-l},"date-desc":function(g,l){g=Date.parse(g);l=Date.parse(l);if(isNaN(g)||g==="")g=Date.parse("01/01/1970 00:00:00");if(isNaN(l)||l==="")l=Date.parse("01/01/1970 00:00:00");return l-
g},"numeric-asc":function(g,l){return(g=="-"||g===""?0:g*1)-(l=="-"||l===""?0:l*1)},"numeric-desc":function(g,l){return(l=="-"||l===""?0:l*1)-(g=="-"||g===""?0:g*1)}};o.aTypes=[function(g){if(typeof g=="number")return"numeric";else if(typeof g!="string")return null;var l,r=false;l=g.charAt(0);if("0123456789-".indexOf(l)==-1)return null;for(var s=1;s<g.length;s++){l=g.charAt(s);if("0123456789.".indexOf(l)==-1)return null;if(l=="."){if(r)return null;r=true}}return"numeric"},function(g){var l=Date.parse(g);
if(l!==null&&!isNaN(l)||typeof g=="string"&&g.length===0)return"date";return null},function(g){if(typeof g=="string"&&g.indexOf("<")!=-1&&g.indexOf(">")!=-1)return"html";return null}];o.fnVersionCheck=function(g){var l=function(x,v){for(;x.length<v;)x+="0";return x},r=o.sVersion.split(".");g=g.split(".");for(var s="",w="",y=0,G=g.length;y<G;y++){s+=l(r[y],3);w+=l(g[y],3)}return parseInt(s,10)>=parseInt(w,10)};o._oExternConfig={iNextUnique:0};i.fn.dataTable=function(g){function l(){this.fnRecordsTotal=
function(){return this.oFeatures.bServerSide?parseInt(this._iRecordsTotal,10):this.aiDisplayMaster.length};this.fnRecordsDisplay=function(){return this.oFeatures.bServerSide?parseInt(this._iRecordsDisplay,10):this.aiDisplay.length};this.fnDisplayEnd=function(){return this.oFeatures.bServerSide?this.oFeatures.bPaginate===false||this._iDisplayLength==-1?this._iDisplayStart+this.aiDisplay.length:Math.min(this._iDisplayStart+this._iDisplayLength,this._iRecordsDisplay):this._iDisplayEnd};this.sInstance=
this.oInstance=null;this.oFeatures={bPaginate:true,bLengthChange:true,bFilter:true,bSort:true,bInfo:true,bAutoWidth:true,bProcessing:false,bSortClasses:true,bStateSave:false,bServerSide:false,bDeferRender:false};this.oScroll={sX:"",sXInner:"",sY:"",bCollapse:false,bInfinite:false,iLoadGap:100,iBarWidth:0,bAutoCss:true};this.aanFeatures=[];this.oLanguage={sProcessing:"Processing...",sLengthMenu:"Show _MENU_ entries",sZeroRecords:"No matching records found",sEmptyTable:"No data available in table",
sLoadingRecords:"Loading...",sInfo:"Showing _START_ to _END_ of _TOTAL_ entries",sInfoEmpty:"Showing 0 to 0 of 0 entries",sInfoFiltered:"(filtered from _MAX_ total entries)",sInfoPostFix:"",sSearch:"Search:",sUrl:"",oPaginate:{sFirst:"First",sPrevious:"Previous",sNext:"Next",sLast:"Last"},fnInfoCallback:null};this.aoData=[];this.aiDisplay=[];this.aiDisplayMaster=[];this.aoColumns=[];this.aoHeader=[];this.aoFooter=[];this.iNextId=0;this.asDataSearch=[];this.oPreviousSearch={sSearch:"",bRegex:false,
bSmart:true};this.aoPreSearchCols=[];this.aaSorting=[[0,"asc",0]];this.aaSortingFixed=null;this.asStripClasses=[];this.asDestoryStrips=[];this.sDestroyWidth=0;this.fnFooterCallback=this.fnHeaderCallback=this.fnRowCallback=null;this.aoDrawCallback=[];this.fnInitComplete=this.fnPreDrawCallback=null;this.sTableId="";this.nTableWrapper=this.nTBody=this.nTFoot=this.nTHead=this.nTable=null;this.bInitialised=this.bDeferLoading=false;this.aoOpenRows=[];this.sDom="lfrtip";this.sPaginationType="two_button";
this.iCookieDuration=7200;this.sCookiePrefix="SpryMedia_DataTables_";this.fnCookieCallback=null;this.aoStateSave=[];this.aoStateLoad=[];this.sAjaxSource=this.oLoadedState=null;this.sAjaxDataProp="aaData";this.bAjaxDataGet=true;this.jqXHR=null;this.fnServerData=function(a,b,c,d){d.jqXHR=i.ajax({url:a,data:b,success:c,dataType:"json",cache:false,error:function(f,e){e=="parsererror"&&alert("DataTables warning: JSON data from server could not be parsed. This is caused by a JSON formatting error.")}})};
this.fnFormatNumber=function(a){if(a<1E3)return a;else{var b=a+"";a=b.split("");var c="";b=b.length;for(var d=0;d<b;d++){if(d%3===0&&d!==0)c=","+c;c=a[b-d-1]+c}}return c};this.aLengthMenu=[10,25,50,100];this.bDrawing=this.iDraw=0;this.iDrawError=-1;this._iDisplayLength=10;this._iDisplayStart=0;this._iDisplayEnd=10;this._iRecordsDisplay=this._iRecordsTotal=0;this.bJUI=false;this.oClasses=o.oStdClasses;this.bSortCellsTop=this.bSorted=this.bFiltered=false;this.oInit=null}function r(a){return function(){var b=
[A(this[o.iApiIndex])].concat(Array.prototype.slice.call(arguments));return o.oApi[a].apply(this,b)}}function s(a){var b,c,d=a.iInitDisplayStart;if(a.bInitialised===false)setTimeout(function(){s(a)},200);else{xa(a);V(a);L(a,a.aoHeader);a.nTFoot&&L(a,a.aoFooter);K(a,true);a.oFeatures.bAutoWidth&&ea(a);b=0;for(c=a.aoColumns.length;b<c;b++)if(a.aoColumns[b].sWidth!==null)a.aoColumns[b].nTh.style.width=u(a.aoColumns[b].sWidth);if(a.oFeatures.bSort)R(a);else if(a.oFeatures.bFilter)M(a,a.oPreviousSearch);
else{a.aiDisplay=a.aiDisplayMaster.slice();E(a);C(a)}if(a.sAjaxSource!==null&&!a.oFeatures.bServerSide)a.fnServerData.call(a.oInstance,a.sAjaxSource,[],function(f){var e=f;if(a.sAjaxDataProp!=="")e=Z(a.sAjaxDataProp)(f);for(b=0;b<e.length;b++)v(a,e[b]);a.iInitDisplayStart=d;if(a.oFeatures.bSort)R(a);else{a.aiDisplay=a.aiDisplayMaster.slice();E(a);C(a)}K(a,false);w(a,f)},a);else if(!a.oFeatures.bServerSide){K(a,false);w(a)}}}function w(a,b){a._bInitComplete=true;if(typeof a.fnInitComplete=="function")typeof b!=
"undefined"?a.fnInitComplete.call(a.oInstance,a,b):a.fnInitComplete.call(a.oInstance,a)}function y(a,b,c){n(a.oLanguage,b,"sProcessing");n(a.oLanguage,b,"sLengthMenu");n(a.oLanguage,b,"sEmptyTable");n(a.oLanguage,b,"sLoadingRecords");n(a.oLanguage,b,"sZeroRecords");n(a.oLanguage,b,"sInfo");n(a.oLanguage,b,"sInfoEmpty");n(a.oLanguage,b,"sInfoFiltered");n(a.oLanguage,b,"sInfoPostFix");n(a.oLanguage,b,"sSearch");if(typeof b.oPaginate!="undefined"){n(a.oLanguage.oPaginate,b.oPaginate,"sFirst");n(a.oLanguage.oPaginate,
b.oPaginate,"sPrevious");n(a.oLanguage.oPaginate,b.oPaginate,"sNext");n(a.oLanguage.oPaginate,b.oPaginate,"sLast")}typeof b.sEmptyTable=="undefined"&&typeof b.sZeroRecords!="undefined"&&n(a.oLanguage,b,"sZeroRecords","sEmptyTable");typeof b.sLoadingRecords=="undefined"&&typeof b.sZeroRecords!="undefined"&&n(a.oLanguage,b,"sZeroRecords","sLoadingRecords");c&&s(a)}function G(a,b){var c=a.aoColumns.length;b={sType:null,_bAutoType:true,bVisible:true,bSearchable:true,bSortable:true,asSorting:["asc","desc"],
sSortingClass:a.oClasses.sSortable,sSortingClassJUI:a.oClasses.sSortJUI,sTitle:b?b.innerHTML:"",sName:"",sWidth:null,sWidthOrig:null,sClass:null,fnRender:null,bUseRendered:true,iDataSort:c,mDataProp:c,fnGetData:null,fnSetData:null,sSortDataType:"std",sDefaultContent:null,sContentPadding:"",nTh:b?b:p.createElement("th"),nTf:null};a.aoColumns.push(b);if(typeof a.aoPreSearchCols[c]=="undefined"||a.aoPreSearchCols[c]===null)a.aoPreSearchCols[c]={sSearch:"",bRegex:false,bSmart:true};else{if(typeof a.aoPreSearchCols[c].bRegex==
"undefined")a.aoPreSearchCols[c].bRegex=true;if(typeof a.aoPreSearchCols[c].bSmart=="undefined")a.aoPreSearchCols[c].bSmart=true}x(a,c,null)}function x(a,b,c){b=a.aoColumns[b];if(typeof c!="undefined"&&c!==null){if(typeof c.sType!="undefined"){b.sType=c.sType;b._bAutoType=false}n(b,c,"bVisible");n(b,c,"bSearchable");n(b,c,"bSortable");n(b,c,"sTitle");n(b,c,"sName");n(b,c,"sWidth");n(b,c,"sWidth","sWidthOrig");n(b,c,"sClass");n(b,c,"fnRender");n(b,c,"bUseRendered");n(b,c,"iDataSort");n(b,c,"mDataProp");
n(b,c,"asSorting");n(b,c,"sSortDataType");n(b,c,"sDefaultContent");n(b,c,"sContentPadding")}b.fnGetData=Z(b.mDataProp);b.fnSetData=ya(b.mDataProp);if(!a.oFeatures.bSort)b.bSortable=false;if(!b.bSortable||i.inArray("asc",b.asSorting)==-1&&i.inArray("desc",b.asSorting)==-1){b.sSortingClass=a.oClasses.sSortableNone;b.sSortingClassJUI=""}else if(b.bSortable||i.inArray("asc",b.asSorting)==-1&&i.inArray("desc",b.asSorting)==-1){b.sSortingClass=a.oClasses.sSortable;b.sSortingClassJUI=a.oClasses.sSortJUI}else if(i.inArray("asc",
b.asSorting)!=-1&&i.inArray("desc",b.asSorting)==-1){b.sSortingClass=a.oClasses.sSortableAsc;b.sSortingClassJUI=a.oClasses.sSortJUIAscAllowed}else if(i.inArray("asc",b.asSorting)==-1&&i.inArray("desc",b.asSorting)!=-1){b.sSortingClass=a.oClasses.sSortableDesc;b.sSortingClassJUI=a.oClasses.sSortJUIDescAllowed}}function v(a,b){var c;c=typeof b.length=="number"?b.slice():i.extend(true,{},b);b=a.aoData.length;var d={nTr:null,_iId:a.iNextId++,_aData:c,_anHidden:[],_sRowStripe:""};a.aoData.push(d);for(var f,
e=0,h=a.aoColumns.length;e<h;e++){c=a.aoColumns[e];typeof c.fnRender=="function"&&c.bUseRendered&&c.mDataProp!==null&&N(a,b,e,c.fnRender({iDataRow:b,iDataColumn:e,aData:d._aData,oSettings:a}));if(c._bAutoType&&c.sType!="string"){f=H(a,b,e,"type");if(f!==null&&f!==""){f=fa(f);if(c.sType===null)c.sType=f;else if(c.sType!=f)c.sType="string"}}}a.aiDisplayMaster.push(b);a.oFeatures.bDeferRender||z(a,b);return b}function z(a,b){var c=a.aoData[b],d;if(c.nTr===null){c.nTr=p.createElement("tr");typeof c._aData.DT_RowId!=
"undefined"&&c.nTr.setAttribute("id",c._aData.DT_RowId);typeof c._aData.DT_RowClass!="undefined"&&i(c.nTr).addClass(c._aData.DT_RowClass);for(var f=0,e=a.aoColumns.length;f<e;f++){var h=a.aoColumns[f];d=p.createElement("td");d.innerHTML=typeof h.fnRender=="function"&&(!h.bUseRendered||h.mDataProp===null)?h.fnRender({iDataRow:b,iDataColumn:f,aData:c._aData,oSettings:a}):H(a,b,f,"display");if(h.sClass!==null)d.className=h.sClass;if(h.bVisible){c.nTr.appendChild(d);c._anHidden[f]=null}else c._anHidden[f]=
d}}}function Y(a){var b,c,d,f,e,h,j,k,m;if(a.bDeferLoading||a.sAjaxSource===null){j=a.nTBody.childNodes;b=0;for(c=j.length;b<c;b++)if(j[b].nodeName.toUpperCase()=="TR"){k=a.aoData.length;a.aoData.push({nTr:j[b],_iId:a.iNextId++,_aData:[],_anHidden:[],_sRowStripe:""});a.aiDisplayMaster.push(k);h=j[b].childNodes;d=e=0;for(f=h.length;d<f;d++){m=h[d].nodeName.toUpperCase();if(m=="TD"||m=="TH"){N(a,k,e,i.trim(h[d].innerHTML));e++}}}}j=$(a);h=[];b=0;for(c=j.length;b<c;b++){d=0;for(f=j[b].childNodes.length;d<
f;d++){e=j[b].childNodes[d];m=e.nodeName.toUpperCase();if(m=="TD"||m=="TH")h.push(e)}}h.length!=j.length*a.aoColumns.length&&J(a,1,"Unexpected number of TD elements. Expected "+j.length*a.aoColumns.length+" and got "+h.length+". DataTables does not support rowspan / colspan in the table body, and there must be one cell for each row/column combination.");d=0;for(f=a.aoColumns.length;d<f;d++){if(a.aoColumns[d].sTitle===null)a.aoColumns[d].sTitle=a.aoColumns[d].nTh.innerHTML;j=a.aoColumns[d]._bAutoType;
m=typeof a.aoColumns[d].fnRender=="function";e=a.aoColumns[d].sClass!==null;k=a.aoColumns[d].bVisible;var t,q;if(j||m||e||!k){b=0;for(c=a.aoData.length;b<c;b++){t=h[b*f+d];if(j&&a.aoColumns[d].sType!="string"){q=H(a,b,d,"type");if(q!==""){q=fa(q);if(a.aoColumns[d].sType===null)a.aoColumns[d].sType=q;else if(a.aoColumns[d].sType!=q)a.aoColumns[d].sType="string"}}if(m){q=a.aoColumns[d].fnRender({iDataRow:b,iDataColumn:d,aData:a.aoData[b]._aData,oSettings:a});t.innerHTML=q;a.aoColumns[d].bUseRendered&&
N(a,b,d,q)}if(e)t.className+=" "+a.aoColumns[d].sClass;if(k)a.aoData[b]._anHidden[d]=null;else{a.aoData[b]._anHidden[d]=t;t.parentNode.removeChild(t)}}}}}function V(a){var b,c,d;a.nTHead.getElementsByTagName("tr");if(a.nTHead.getElementsByTagName("th").length!==0){b=0;for(d=a.aoColumns.length;b<d;b++){c=a.aoColumns[b].nTh;a.aoColumns[b].sClass!==null&&i(c).addClass(a.aoColumns[b].sClass);if(a.aoColumns[b].sTitle!=c.innerHTML)c.innerHTML=a.aoColumns[b].sTitle}}else{var f=p.createElement("tr");b=0;
for(d=a.aoColumns.length;b<d;b++){c=a.aoColumns[b].nTh;c.innerHTML=a.aoColumns[b].sTitle;a.aoColumns[b].sClass!==null&&i(c).addClass(a.aoColumns[b].sClass);f.appendChild(c)}i(a.nTHead).html("")[0].appendChild(f);W(a.aoHeader,a.nTHead)}if(a.bJUI){b=0;for(d=a.aoColumns.length;b<d;b++){c=a.aoColumns[b].nTh;f=p.createElement("div");f.className=a.oClasses.sSortJUIWrapper;i(c).contents().appendTo(f);var e=p.createElement("span");e.className=a.oClasses.sSortIcon;f.appendChild(e);c.appendChild(f)}}d=function(){this.onselectstart=
function(){return false};return false};if(a.oFeatures.bSort)for(b=0;b<a.aoColumns.length;b++)if(a.aoColumns[b].bSortable!==false){ga(a,a.aoColumns[b].nTh,b);i(a.aoColumns[b].nTh).bind("mousedown.DT",d)}else i(a.aoColumns[b].nTh).addClass(a.oClasses.sSortableNone);a.oClasses.sFooterTH!==""&&i(">tr>th",a.nTFoot).addClass(a.oClasses.sFooterTH);if(a.nTFoot!==null){c=S(a,null,a.aoFooter);b=0;for(d=a.aoColumns.length;b<d;b++)if(typeof c[b]!="undefined")a.aoColumns[b].nTf=c[b]}}function L(a,b,c){var d,f,
e,h=[],j=[],k=a.aoColumns.length;if(typeof c=="undefined")c=false;d=0;for(f=b.length;d<f;d++){h[d]=b[d].slice();h[d].nTr=b[d].nTr;for(e=k-1;e>=0;e--)!a.aoColumns[e].bVisible&&!c&&h[d].splice(e,1);j.push([])}d=0;for(f=h.length;d<f;d++){if(h[d].nTr){a=0;for(e=h[d].nTr.childNodes.length;a<e;a++)h[d].nTr.removeChild(h[d].nTr.childNodes[0])}e=0;for(b=h[d].length;e<b;e++){k=c=1;if(typeof j[d][e]=="undefined"){h[d].nTr.appendChild(h[d][e].cell);for(j[d][e]=1;typeof h[d+c]!="undefined"&&h[d][e].cell==h[d+
c][e].cell;){j[d+c][e]=1;c++}for(;typeof h[d][e+k]!="undefined"&&h[d][e].cell==h[d][e+k].cell;){for(a=0;a<c;a++)j[d+a][e+k]=1;k++}h[d][e].cell.setAttribute("rowspan",c);h[d][e].cell.setAttribute("colspan",k)}}}}function C(a){var b,c,d=[],f=0,e=false;b=a.asStripClasses.length;c=a.aoOpenRows.length;if(!(a.fnPreDrawCallback!==null&&a.fnPreDrawCallback.call(a.oInstance,a)===false)){a.bDrawing=true;if(typeof a.iInitDisplayStart!="undefined"&&a.iInitDisplayStart!=-1){a._iDisplayStart=a.oFeatures.bServerSide?
a.iInitDisplayStart:a.iInitDisplayStart>=a.fnRecordsDisplay()?0:a.iInitDisplayStart;a.iInitDisplayStart=-1;E(a)}if(a.bDeferLoading){a.bDeferLoading=false;a.iDraw++}else if(a.oFeatures.bServerSide){if(!a.bDestroying&&!za(a))return}else a.iDraw++;if(a.aiDisplay.length!==0){var h=a._iDisplayStart,j=a._iDisplayEnd;if(a.oFeatures.bServerSide){h=0;j=a.aoData.length}for(h=h;h<j;h++){var k=a.aoData[a.aiDisplay[h]];k.nTr===null&&z(a,a.aiDisplay[h]);var m=k.nTr;if(b!==0){var t=a.asStripClasses[f%b];if(k._sRowStripe!=
t){i(m).removeClass(k._sRowStripe).addClass(t);k._sRowStripe=t}}if(typeof a.fnRowCallback=="function"){m=a.fnRowCallback.call(a.oInstance,m,a.aoData[a.aiDisplay[h]]._aData,f,h);if(!m&&!e){J(a,0,"A node was not returned by fnRowCallback");e=true}}d.push(m);f++;if(c!==0)for(k=0;k<c;k++)m==a.aoOpenRows[k].nParent&&d.push(a.aoOpenRows[k].nTr)}}else{d[0]=p.createElement("tr");if(typeof a.asStripClasses[0]!="undefined")d[0].className=a.asStripClasses[0];e=a.oLanguage.sZeroRecords.replace("_MAX_",a.fnFormatNumber(a.fnRecordsTotal()));
if(a.iDraw==1&&a.sAjaxSource!==null&&!a.oFeatures.bServerSide)e=a.oLanguage.sLoadingRecords;else if(typeof a.oLanguage.sEmptyTable!="undefined"&&a.fnRecordsTotal()===0)e=a.oLanguage.sEmptyTable;b=p.createElement("td");b.setAttribute("valign","top");b.colSpan=X(a);b.className=a.oClasses.sRowEmpty;b.innerHTML=e;d[f].appendChild(b)}typeof a.fnHeaderCallback=="function"&&a.fnHeaderCallback.call(a.oInstance,i(">tr",a.nTHead)[0],aa(a),a._iDisplayStart,a.fnDisplayEnd(),a.aiDisplay);typeof a.fnFooterCallback==
"function"&&a.fnFooterCallback.call(a.oInstance,i(">tr",a.nTFoot)[0],aa(a),a._iDisplayStart,a.fnDisplayEnd(),a.aiDisplay);f=p.createDocumentFragment();b=p.createDocumentFragment();if(a.nTBody){e=a.nTBody.parentNode;b.appendChild(a.nTBody);if(!a.oScroll.bInfinite||!a._bInitComplete||a.bSorted||a.bFiltered){c=a.nTBody.childNodes;for(b=c.length-1;b>=0;b--)c[b].parentNode.removeChild(c[b])}b=0;for(c=d.length;b<c;b++)f.appendChild(d[b]);a.nTBody.appendChild(f);e!==null&&e.appendChild(a.nTBody)}for(b=a.aoDrawCallback.length-
1;b>=0;b--)a.aoDrawCallback[b].fn.call(a.oInstance,a);a.bSorted=false;a.bFiltered=false;a.bDrawing=false;if(a.oFeatures.bServerSide){K(a,false);typeof a._bInitComplete=="undefined"&&w(a)}}}function ba(a){if(a.oFeatures.bSort)R(a,a.oPreviousSearch);else if(a.oFeatures.bFilter)M(a,a.oPreviousSearch);else{E(a);C(a)}}function za(a){if(a.bAjaxDataGet){K(a,true);var b=a.aoColumns.length,c=[],d,f;a.iDraw++;c.push({name:"sEcho",value:a.iDraw});c.push({name:"iColumns",value:b});c.push({name:"sColumns",value:ha(a)});
c.push({name:"iDisplayStart",value:a._iDisplayStart});c.push({name:"iDisplayLength",value:a.oFeatures.bPaginate!==false?a._iDisplayLength:-1});for(f=0;f<b;f++){d=a.aoColumns[f].mDataProp;c.push({name:"mDataProp_"+f,value:typeof d=="function"?"function":d})}if(a.oFeatures.bFilter!==false){c.push({name:"sSearch",value:a.oPreviousSearch.sSearch});c.push({name:"bRegex",value:a.oPreviousSearch.bRegex});for(f=0;f<b;f++){c.push({name:"sSearch_"+f,value:a.aoPreSearchCols[f].sSearch});c.push({name:"bRegex_"+
f,value:a.aoPreSearchCols[f].bRegex});c.push({name:"bSearchable_"+f,value:a.aoColumns[f].bSearchable})}}if(a.oFeatures.bSort!==false){d=a.aaSortingFixed!==null?a.aaSortingFixed.length:0;var e=a.aaSorting.length;c.push({name:"iSortingCols",value:d+e});for(f=0;f<d;f++){c.push({name:"iSortCol_"+f,value:a.aaSortingFixed[f][0]});c.push({name:"sSortDir_"+f,value:a.aaSortingFixed[f][1]})}for(f=0;f<e;f++){c.push({name:"iSortCol_"+(f+d),value:a.aaSorting[f][0]});c.push({name:"sSortDir_"+(f+d),value:a.aaSorting[f][1]})}for(f=
0;f<b;f++)c.push({name:"bSortable_"+f,value:a.aoColumns[f].bSortable})}a.fnServerData.call(a.oInstance,a.sAjaxSource,c,function(h){Aa(a,h)},a);return false}else return true}function Aa(a,b){if(typeof b.sEcho!="undefined")if(b.sEcho*1<a.iDraw)return;else a.iDraw=b.sEcho*1;if(!a.oScroll.bInfinite||a.oScroll.bInfinite&&(a.bSorted||a.bFiltered))ia(a);a._iRecordsTotal=b.iTotalRecords;a._iRecordsDisplay=b.iTotalDisplayRecords;var c=ha(a);if(c=typeof b.sColumns!="undefined"&&c!==""&&b.sColumns!=c)var d=
Ba(a,b.sColumns);b=Z(a.sAjaxDataProp)(b);for(var f=0,e=b.length;f<e;f++)if(c){for(var h=[],j=0,k=a.aoColumns.length;j<k;j++)h.push(b[f][d[j]]);v(a,h)}else v(a,b[f]);a.aiDisplay=a.aiDisplayMaster.slice();a.bAjaxDataGet=false;C(a);a.bAjaxDataGet=true;K(a,false)}function xa(a){var b=p.createElement("div");a.nTable.parentNode.insertBefore(b,a.nTable);a.nTableWrapper=p.createElement("div");a.nTableWrapper.className=a.oClasses.sWrapper;a.sTableId!==""&&a.nTableWrapper.setAttribute("id",a.sTableId+"_wrapper");
a.nTableReinsertBefore=a.nTable.nextSibling;for(var c=a.nTableWrapper,d=a.sDom.split(""),f,e,h,j,k,m,t,q=0;q<d.length;q++){e=0;h=d[q];if(h=="<"){j=p.createElement("div");k=d[q+1];if(k=="'"||k=='"'){m="";for(t=2;d[q+t]!=k;){m+=d[q+t];t++}if(m=="H")m="fg-toolbar ui-toolbar ui-widget-header ui-corner-tl ui-corner-tr ui-helper-clearfix";else if(m=="F")m="fg-toolbar ui-toolbar ui-widget-header ui-corner-bl ui-corner-br ui-helper-clearfix";if(m.indexOf(".")!=-1){k=m.split(".");j.setAttribute("id",k[0].substr(1,
k[0].length-1));j.className=k[1]}else if(m.charAt(0)=="#")j.setAttribute("id",m.substr(1,m.length-1));else j.className=m;q+=t}c.appendChild(j);c=j}else if(h==">")c=c.parentNode;else if(h=="l"&&a.oFeatures.bPaginate&&a.oFeatures.bLengthChange){f=Ca(a);e=1}else if(h=="f"&&a.oFeatures.bFilter){f=Da(a);e=1}else if(h=="r"&&a.oFeatures.bProcessing){f=Ea(a);e=1}else if(h=="t"){f=Fa(a);e=1}else if(h=="i"&&a.oFeatures.bInfo){f=Ga(a);e=1}else if(h=="p"&&a.oFeatures.bPaginate){f=Ha(a);e=1}else if(o.aoFeatures.length!==
0){j=o.aoFeatures;t=0;for(k=j.length;t<k;t++)if(h==j[t].cFeature){if(f=j[t].fnInit(a))e=1;break}}if(e==1&&f!==null){if(typeof a.aanFeatures[h]!="object")a.aanFeatures[h]=[];a.aanFeatures[h].push(f);c.appendChild(f)}}b.parentNode.replaceChild(a.nTableWrapper,b)}function Fa(a){if(a.oScroll.sX===""&&a.oScroll.sY==="")return a.nTable;var b=p.createElement("div"),c=p.createElement("div"),d=p.createElement("div"),f=p.createElement("div"),e=p.createElement("div"),h=p.createElement("div"),j=a.nTable.cloneNode(false),
k=a.nTable.cloneNode(false),m=a.nTable.getElementsByTagName("thead")[0],t=a.nTable.getElementsByTagName("tfoot").length===0?null:a.nTable.getElementsByTagName("tfoot")[0],q=typeof g.bJQueryUI!="undefined"&&g.bJQueryUI?o.oJUIClasses:o.oStdClasses;c.appendChild(d);e.appendChild(h);f.appendChild(a.nTable);b.appendChild(c);b.appendChild(f);d.appendChild(j);j.appendChild(m);if(t!==null){b.appendChild(e);h.appendChild(k);k.appendChild(t)}b.className=q.sScrollWrapper;c.className=q.sScrollHead;d.className=
q.sScrollHeadInner;f.className=q.sScrollBody;e.className=q.sScrollFoot;h.className=q.sScrollFootInner;if(a.oScroll.bAutoCss){c.style.overflow="hidden";c.style.position="relative";e.style.overflow="hidden";f.style.overflow="auto"}c.style.border="0";c.style.width="100%";e.style.border="0";d.style.width="150%";j.removeAttribute("id");j.style.marginLeft="0";a.nTable.style.marginLeft="0";if(t!==null){k.removeAttribute("id");k.style.marginLeft="0"}d=i(">caption",a.nTable);h=0;for(k=d.length;h<k;h++)j.appendChild(d[h]);
if(a.oScroll.sX!==""){c.style.width=u(a.oScroll.sX);f.style.width=u(a.oScroll.sX);if(t!==null)e.style.width=u(a.oScroll.sX);i(f).scroll(function(){c.scrollLeft=this.scrollLeft;if(t!==null)e.scrollLeft=this.scrollLeft})}if(a.oScroll.sY!=="")f.style.height=u(a.oScroll.sY);a.aoDrawCallback.push({fn:Ia,sName:"scrolling"});a.oScroll.bInfinite&&i(f).scroll(function(){if(!a.bDrawing)if(i(this).scrollTop()+i(this).height()>i(a.nTable).height()-a.oScroll.iLoadGap)if(a.fnDisplayEnd()<a.fnRecordsDisplay()){ja(a,
"next");E(a);C(a)}});a.nScrollHead=c;a.nScrollFoot=e;return b}function Ia(a){var b=a.nScrollHead.getElementsByTagName("div")[0],c=b.getElementsByTagName("table")[0],d=a.nTable.parentNode,f,e,h,j,k,m,t,q,I=[];h=a.nTable.getElementsByTagName("thead");h.length>0&&a.nTable.removeChild(h[0]);if(a.nTFoot!==null){k=a.nTable.getElementsByTagName("tfoot");k.length>0&&a.nTable.removeChild(k[0])}h=a.nTHead.cloneNode(true);a.nTable.insertBefore(h,a.nTable.childNodes[0]);if(a.nTFoot!==null){k=a.nTFoot.cloneNode(true);
a.nTable.insertBefore(k,a.nTable.childNodes[1])}if(a.oScroll.sX===""){d.style.width="100%";b.parentNode.style.width="100%"}var O=S(a,h);f=0;for(e=O.length;f<e;f++){t=Ja(a,f);O[f].style.width=a.aoColumns[t].sWidth}a.nTFoot!==null&&P(function(B){B.style.width=""},k.getElementsByTagName("tr"));f=i(a.nTable).outerWidth();if(a.oScroll.sX===""){a.nTable.style.width="100%";if(i.browser.msie&&i.browser.version<=7)a.nTable.style.width=u(i(a.nTable).outerWidth()-a.oScroll.iBarWidth)}else if(a.oScroll.sXInner!==
"")a.nTable.style.width=u(a.oScroll.sXInner);else if(f==i(d).width()&&i(d).height()<i(a.nTable).height()){a.nTable.style.width=u(f-a.oScroll.iBarWidth);if(i(a.nTable).outerWidth()>f-a.oScroll.iBarWidth)a.nTable.style.width=u(f)}else a.nTable.style.width=u(f);f=i(a.nTable).outerWidth();if(a.oScroll.sX===""){d.style.width=u(f+a.oScroll.iBarWidth);b.parentNode.style.width=u(f+a.oScroll.iBarWidth)}e=a.nTHead.getElementsByTagName("tr");h=h.getElementsByTagName("tr");P(function(B,F){m=B.style;m.paddingTop=
"0";m.paddingBottom="0";m.borderTopWidth="0";m.borderBottomWidth="0";m.height=0;q=i(B).width();F.style.width=u(q);I.push(q)},h,e);i(h).height(0);if(a.nTFoot!==null){j=k.getElementsByTagName("tr");k=a.nTFoot.getElementsByTagName("tr");P(function(B,F){m=B.style;m.paddingTop="0";m.paddingBottom="0";m.borderTopWidth="0";m.borderBottomWidth="0";m.height=0;q=i(B).width();F.style.width=u(q);I.push(q)},j,k);i(j).height(0)}P(function(B){B.innerHTML="";B.style.width=u(I.shift())},h);a.nTFoot!==null&&P(function(B){B.innerHTML=
"";B.style.width=u(I.shift())},j);if(i(a.nTable).outerWidth()<f)if(a.oScroll.sX==="")J(a,1,"The table cannot fit into the current element which will cause column misalignment. It is suggested that you enable x-scrolling or increase the width the table has in which to be drawn");else a.oScroll.sXInner!==""&&J(a,1,"The table cannot fit into the current element which will cause column misalignment. It is suggested that you increase the sScrollXInner property to allow it to draw in a larger area, or simply remove that parameter to allow automatic calculation");
if(a.oScroll.sY==="")if(i.browser.msie&&i.browser.version<=7)d.style.height=u(a.nTable.offsetHeight+a.oScroll.iBarWidth);if(a.oScroll.sY!==""&&a.oScroll.bCollapse){d.style.height=u(a.oScroll.sY);j=a.oScroll.sX!==""&&a.nTable.offsetWidth>d.offsetWidth?a.oScroll.iBarWidth:0;if(a.nTable.offsetHeight<d.offsetHeight)d.style.height=u(i(a.nTable).height()+j)}j=i(a.nTable).outerWidth();c.style.width=u(j);b.style.width=u(j+a.oScroll.iBarWidth);if(a.nTFoot!==null){b=a.nScrollFoot.getElementsByTagName("div")[0];
c=b.getElementsByTagName("table")[0];b.style.width=u(a.nTable.offsetWidth+a.oScroll.iBarWidth);c.style.width=u(a.nTable.offsetWidth)}if(a.bSorted||a.bFiltered)d.scrollTop=0}function ca(a){if(a.oFeatures.bAutoWidth===false)return false;ea(a);for(var b=0,c=a.aoColumns.length;b<c;b++)a.aoColumns[b].nTh.style.width=a.aoColumns[b].sWidth}function Da(a){var b=a.oLanguage.sSearch;b=b.indexOf("_INPUT_")!==-1?b.replace("_INPUT_",'<input type="text" />'):b===""?'<input type="text" />':b+' <input type="text" />';
var c=p.createElement("div");c.className=a.oClasses.sFilter;c.innerHTML="<label>"+b+"</label>";a.sTableId!==""&&typeof a.aanFeatures.f=="undefined"&&c.setAttribute("id",a.sTableId+"_filter");b=i("input",c);b.val(a.oPreviousSearch.sSearch.replace('"',"&quot;"));b.bind("keyup.DT",function(){for(var d=a.aanFeatures.f,f=0,e=d.length;f<e;f++)d[f]!=this.parentNode&&i("input",d[f]).val(this.value);this.value!=a.oPreviousSearch.sSearch&&M(a,{sSearch:this.value,bRegex:a.oPreviousSearch.bRegex,bSmart:a.oPreviousSearch.bSmart})});
b.bind("keypress.DT",function(d){if(d.keyCode==13)return false});return c}function M(a,b,c){Ka(a,b.sSearch,c,b.bRegex,b.bSmart);for(b=0;b<a.aoPreSearchCols.length;b++)La(a,a.aoPreSearchCols[b].sSearch,b,a.aoPreSearchCols[b].bRegex,a.aoPreSearchCols[b].bSmart);o.afnFiltering.length!==0&&Ma(a);a.bFiltered=true;a._iDisplayStart=0;E(a);C(a);ka(a,0)}function Ma(a){for(var b=o.afnFiltering,c=0,d=b.length;c<d;c++)for(var f=0,e=0,h=a.aiDisplay.length;e<h;e++){var j=a.aiDisplay[e-f];if(!b[c](a,da(a,j,"filter"),
j)){a.aiDisplay.splice(e-f,1);f++}}}function La(a,b,c,d,f){if(b!==""){var e=0;b=la(b,d,f);for(d=a.aiDisplay.length-1;d>=0;d--){f=ma(H(a,a.aiDisplay[d],c,"filter"),a.aoColumns[c].sType);if(!b.test(f)){a.aiDisplay.splice(d,1);e++}}}}function Ka(a,b,c,d,f){var e=la(b,d,f);if(typeof c=="undefined"||c===null)c=0;if(o.afnFiltering.length!==0)c=1;if(b.length<=0){a.aiDisplay.splice(0,a.aiDisplay.length);a.aiDisplay=a.aiDisplayMaster.slice()}else if(a.aiDisplay.length==a.aiDisplayMaster.length||a.oPreviousSearch.sSearch.length>
b.length||c==1||b.indexOf(a.oPreviousSearch.sSearch)!==0){a.aiDisplay.splice(0,a.aiDisplay.length);ka(a,1);for(c=0;c<a.aiDisplayMaster.length;c++)e.test(a.asDataSearch[c])&&a.aiDisplay.push(a.aiDisplayMaster[c])}else{var h=0;for(c=0;c<a.asDataSearch.length;c++)if(!e.test(a.asDataSearch[c])){a.aiDisplay.splice(c-h,1);h++}}a.oPreviousSearch.sSearch=b;a.oPreviousSearch.bRegex=d;a.oPreviousSearch.bSmart=f}function ka(a,b){a.asDataSearch.splice(0,a.asDataSearch.length);b=typeof b!="undefined"&&b==1?a.aiDisplayMaster:
a.aiDisplay;for(var c=0,d=b.length;c<d;c++)a.asDataSearch[c]=na(a,da(a,b[c],"filter"))}function na(a,b){var c="";if(typeof a.__nTmpFilter=="undefined")a.__nTmpFilter=p.createElement("div");for(var d=a.__nTmpFilter,f=0,e=a.aoColumns.length;f<e;f++)if(a.aoColumns[f].bSearchable)c+=ma(b[f],a.aoColumns[f].sType)+"  ";if(c.indexOf("&")!==-1){d.innerHTML=c;c=d.textContent?d.textContent:d.innerText;c=c.replace(/\n/g," ").replace(/\r/g,"")}return c}function la(a,b,c){if(c){a=b?a.split(" "):oa(a).split(" ");
a="^(?=.*?"+a.join(")(?=.*?")+").*$";return new RegExp(a,"i")}else{a=b?a:oa(a);return new RegExp(a,"i")}}function ma(a,b){if(typeof o.ofnSearch[b]=="function")return o.ofnSearch[b](a);else if(b=="html")return a.replace(/\n/g," ").replace(/<.*?>/g,"");else if(typeof a=="string")return a.replace(/\n/g," ");else if(a===null)return"";return a}function R(a,b){var c,d,f,e,h=[],j=[],k=o.oSort;d=a.aoData;var m=a.aoColumns;if(!a.oFeatures.bServerSide&&(a.aaSorting.length!==0||a.aaSortingFixed!==null)){h=a.aaSortingFixed!==
null?a.aaSortingFixed.concat(a.aaSorting):a.aaSorting.slice();for(c=0;c<h.length;c++){var t=h[c][0];f=pa(a,t);e=a.aoColumns[t].sSortDataType;if(typeof o.afnSortData[e]!="undefined"){var q=o.afnSortData[e](a,t,f);f=0;for(e=d.length;f<e;f++)N(a,f,t,q[f])}}c=0;for(d=a.aiDisplayMaster.length;c<d;c++)j[a.aiDisplayMaster[c]]=c;var I=h.length;a.aiDisplayMaster.sort(function(O,B){var F,qa;for(c=0;c<I;c++){F=m[h[c][0]].iDataSort;qa=m[F].sType;F=k[(qa?qa:"string")+"-"+h[c][1]](H(a,O,F,"sort"),H(a,B,F,"sort"));
if(F!==0)return F}return k["numeric-asc"](j[O],j[B])})}if((typeof b=="undefined"||b)&&!a.oFeatures.bDeferRender)T(a);a.bSorted=true;if(a.oFeatures.bFilter)M(a,a.oPreviousSearch,1);else{a.aiDisplay=a.aiDisplayMaster.slice();a._iDisplayStart=0;E(a);C(a)}}function ga(a,b,c,d){i(b).bind("click.DT",function(f){if(a.aoColumns[c].bSortable!==false){var e=function(){var h,j;if(f.shiftKey){for(var k=false,m=0;m<a.aaSorting.length;m++)if(a.aaSorting[m][0]==c){k=true;h=a.aaSorting[m][0];j=a.aaSorting[m][2]+
1;if(typeof a.aoColumns[h].asSorting[j]=="undefined")a.aaSorting.splice(m,1);else{a.aaSorting[m][1]=a.aoColumns[h].asSorting[j];a.aaSorting[m][2]=j}break}k===false&&a.aaSorting.push([c,a.aoColumns[c].asSorting[0],0])}else if(a.aaSorting.length==1&&a.aaSorting[0][0]==c){h=a.aaSorting[0][0];j=a.aaSorting[0][2]+1;if(typeof a.aoColumns[h].asSorting[j]=="undefined")j=0;a.aaSorting[0][1]=a.aoColumns[h].asSorting[j];a.aaSorting[0][2]=j}else{a.aaSorting.splice(0,a.aaSorting.length);a.aaSorting.push([c,a.aoColumns[c].asSorting[0],
0])}R(a)};if(a.oFeatures.bProcessing){K(a,true);setTimeout(function(){e();a.oFeatures.bServerSide||K(a,false)},0)}else e();typeof d=="function"&&d(a)}})}function T(a){var b,c,d,f,e,h=a.aoColumns.length,j=a.oClasses;for(b=0;b<h;b++)a.aoColumns[b].bSortable&&i(a.aoColumns[b].nTh).removeClass(j.sSortAsc+" "+j.sSortDesc+" "+a.aoColumns[b].sSortingClass);f=a.aaSortingFixed!==null?a.aaSortingFixed.concat(a.aaSorting):a.aaSorting.slice();for(b=0;b<a.aoColumns.length;b++)if(a.aoColumns[b].bSortable){e=a.aoColumns[b].sSortingClass;
d=-1;for(c=0;c<f.length;c++)if(f[c][0]==b){e=f[c][1]=="asc"?j.sSortAsc:j.sSortDesc;d=c;break}i(a.aoColumns[b].nTh).addClass(e);if(a.bJUI){c=i("span",a.aoColumns[b].nTh);c.removeClass(j.sSortJUIAsc+" "+j.sSortJUIDesc+" "+j.sSortJUI+" "+j.sSortJUIAscAllowed+" "+j.sSortJUIDescAllowed);c.addClass(d==-1?a.aoColumns[b].sSortingClassJUI:f[d][1]=="asc"?j.sSortJUIAsc:j.sSortJUIDesc)}}else i(a.aoColumns[b].nTh).addClass(a.aoColumns[b].sSortingClass);e=j.sSortColumn;if(a.oFeatures.bSort&&a.oFeatures.bSortClasses){d=
Q(a);if(a.oFeatures.bDeferRender)i(d).removeClass(e+"1 "+e+"2 "+e+"3");else if(d.length>=h)for(b=0;b<h;b++)if(d[b].className.indexOf(e+"1")!=-1){c=0;for(a=d.length/h;c<a;c++)d[h*c+b].className=i.trim(d[h*c+b].className.replace(e+"1",""))}else if(d[b].className.indexOf(e+"2")!=-1){c=0;for(a=d.length/h;c<a;c++)d[h*c+b].className=i.trim(d[h*c+b].className.replace(e+"2",""))}else if(d[b].className.indexOf(e+"3")!=-1){c=0;for(a=d.length/h;c<a;c++)d[h*c+b].className=i.trim(d[h*c+b].className.replace(" "+
e+"3",""))}j=1;var k;for(b=0;b<f.length;b++){k=parseInt(f[b][0],10);c=0;for(a=d.length/h;c<a;c++)d[h*c+k].className+=" "+e+j;j<3&&j++}}}function Ha(a){if(a.oScroll.bInfinite)return null;var b=p.createElement("div");b.className=a.oClasses.sPaging+a.sPaginationType;o.oPagination[a.sPaginationType].fnInit(a,b,function(c){E(c);C(c)});typeof a.aanFeatures.p=="undefined"&&a.aoDrawCallback.push({fn:function(c){o.oPagination[c.sPaginationType].fnUpdate(c,function(d){E(d);C(d)})},sName:"pagination"});return b}
function ja(a,b){var c=a._iDisplayStart;if(b=="first")a._iDisplayStart=0;else if(b=="previous"){a._iDisplayStart=a._iDisplayLength>=0?a._iDisplayStart-a._iDisplayLength:0;if(a._iDisplayStart<0)a._iDisplayStart=0}else if(b=="next")if(a._iDisplayLength>=0){if(a._iDisplayStart+a._iDisplayLength<a.fnRecordsDisplay())a._iDisplayStart+=a._iDisplayLength}else a._iDisplayStart=0;else if(b=="last")if(a._iDisplayLength>=0){b=parseInt((a.fnRecordsDisplay()-1)/a._iDisplayLength,10)+1;a._iDisplayStart=(b-1)*a._iDisplayLength}else a._iDisplayStart=
0;else J(a,0,"Unknown paging action: "+b);return c!=a._iDisplayStart}function Ga(a){var b=p.createElement("div");b.className=a.oClasses.sInfo;if(typeof a.aanFeatures.i=="undefined"){a.aoDrawCallback.push({fn:Na,sName:"information"});a.sTableId!==""&&b.setAttribute("id",a.sTableId+"_info")}return b}function Na(a){if(!(!a.oFeatures.bInfo||a.aanFeatures.i.length===0)){var b=a._iDisplayStart+1,c=a.fnDisplayEnd(),d=a.fnRecordsTotal(),f=a.fnRecordsDisplay(),e=a.fnFormatNumber(b),h=a.fnFormatNumber(c),j=
a.fnFormatNumber(d),k=a.fnFormatNumber(f);if(a.oScroll.bInfinite)e=a.fnFormatNumber(1);e=a.fnRecordsDisplay()===0&&a.fnRecordsDisplay()==a.fnRecordsTotal()?a.oLanguage.sInfoEmpty+a.oLanguage.sInfoPostFix:a.fnRecordsDisplay()===0?a.oLanguage.sInfoEmpty+" "+a.oLanguage.sInfoFiltered.replace("_MAX_",j)+a.oLanguage.sInfoPostFix:a.fnRecordsDisplay()==a.fnRecordsTotal()?a.oLanguage.sInfo.replace("_START_",e).replace("_END_",h).replace("_TOTAL_",k)+a.oLanguage.sInfoPostFix:a.oLanguage.sInfo.replace("_START_",
e).replace("_END_",h).replace("_TOTAL_",k)+" "+a.oLanguage.sInfoFiltered.replace("_MAX_",a.fnFormatNumber(a.fnRecordsTotal()))+a.oLanguage.sInfoPostFix;if(a.oLanguage.fnInfoCallback!==null)e=a.oLanguage.fnInfoCallback(a,b,c,d,f,e);a=a.aanFeatures.i;b=0;for(c=a.length;b<c;b++)i(a[b]).html(e)}}function Ca(a){if(a.oScroll.bInfinite)return null;var b='<select size="1" '+(a.sTableId===""?"":'name="'+a.sTableId+'_length"')+">",c,d;if(a.aLengthMenu.length==2&&typeof a.aLengthMenu[0]=="object"&&typeof a.aLengthMenu[1]==
"object"){c=0;for(d=a.aLengthMenu[0].length;c<d;c++)b+='<option value="'+a.aLengthMenu[0][c]+'">'+a.aLengthMenu[1][c]+"</option>"}else{c=0;for(d=a.aLengthMenu.length;c<d;c++)b+='<option value="'+a.aLengthMenu[c]+'">'+a.aLengthMenu[c]+"</option>"}b+="</select>";var f=p.createElement("div");a.sTableId!==""&&typeof a.aanFeatures.l=="undefined"&&f.setAttribute("id",a.sTableId+"_length");f.className=a.oClasses.sLength;f.innerHTML="<label>"+a.oLanguage.sLengthMenu.replace("_MENU_",b)+"</label>";i('select option[value="'+
a._iDisplayLength+'"]',f).attr("selected",true);i("select",f).bind("change.DT",function(){var e=i(this).val(),h=a.aanFeatures.l;c=0;for(d=h.length;c<d;c++)h[c]!=this.parentNode&&i("select",h[c]).val(e);a._iDisplayLength=parseInt(e,10);E(a);if(a.fnDisplayEnd()==a.fnRecordsDisplay()){a._iDisplayStart=a.fnDisplayEnd()-a._iDisplayLength;if(a._iDisplayStart<0)a._iDisplayStart=0}if(a._iDisplayLength==-1)a._iDisplayStart=0;C(a)});return f}function Ea(a){var b=p.createElement("div");a.sTableId!==""&&typeof a.aanFeatures.r==
"undefined"&&b.setAttribute("id",a.sTableId+"_processing");b.innerHTML=a.oLanguage.sProcessing;b.className=a.oClasses.sProcessing;a.nTable.parentNode.insertBefore(b,a.nTable);return b}function K(a,b){if(a.oFeatures.bProcessing){a=a.aanFeatures.r;for(var c=0,d=a.length;c<d;c++)a[c].style.visibility=b?"visible":"hidden"}}function Ja(a,b){for(var c=-1,d=0;d<a.aoColumns.length;d++){a.aoColumns[d].bVisible===true&&c++;if(c==b)return d}return null}function pa(a,b){for(var c=-1,d=0;d<a.aoColumns.length;d++){a.aoColumns[d].bVisible===
true&&c++;if(d==b)return a.aoColumns[d].bVisible===true?c:null}return null}function U(a,b){var c,d;c=a._iDisplayStart;for(d=a._iDisplayEnd;c<d;c++)if(a.aoData[a.aiDisplay[c]].nTr==b)return a.aiDisplay[c];c=0;for(d=a.aoData.length;c<d;c++)if(a.aoData[c].nTr==b)return c;return null}function X(a){for(var b=0,c=0;c<a.aoColumns.length;c++)a.aoColumns[c].bVisible===true&&b++;return b}function E(a){a._iDisplayEnd=a.oFeatures.bPaginate===false?a.aiDisplay.length:a._iDisplayStart+a._iDisplayLength>a.aiDisplay.length||
a._iDisplayLength==-1?a.aiDisplay.length:a._iDisplayStart+a._iDisplayLength}function Oa(a,b){if(!a||a===null||a==="")return 0;if(typeof b=="undefined")b=p.getElementsByTagName("body")[0];var c=p.createElement("div");c.style.width=u(a);b.appendChild(c);a=c.offsetWidth;b.removeChild(c);return a}function ea(a){var b=0,c,d=0,f=a.aoColumns.length,e,h=i("th",a.nTHead);for(e=0;e<f;e++)if(a.aoColumns[e].bVisible){d++;if(a.aoColumns[e].sWidth!==null){c=Oa(a.aoColumns[e].sWidthOrig,a.nTable.parentNode);if(c!==
null)a.aoColumns[e].sWidth=u(c);b++}}if(f==h.length&&b===0&&d==f&&a.oScroll.sX===""&&a.oScroll.sY==="")for(e=0;e<a.aoColumns.length;e++){c=i(h[e]).width();if(c!==null)a.aoColumns[e].sWidth=u(c)}else{b=a.nTable.cloneNode(false);e=a.nTHead.cloneNode(true);d=p.createElement("tbody");c=p.createElement("tr");b.removeAttribute("id");b.appendChild(e);if(a.nTFoot!==null){b.appendChild(a.nTFoot.cloneNode(true));P(function(k){k.style.width=""},b.getElementsByTagName("tr"))}b.appendChild(d);d.appendChild(c);
d=i("thead th",b);if(d.length===0)d=i("tbody tr:eq(0)>td",b);h=S(a,e);for(e=d=0;e<f;e++){var j=a.aoColumns[e];if(j.bVisible&&j.sWidthOrig!==null&&j.sWidthOrig!=="")h[e-d].style.width=u(j.sWidthOrig);else if(j.bVisible)h[e-d].style.width="";else d++}for(e=0;e<f;e++)if(a.aoColumns[e].bVisible){d=Pa(a,e);if(d!==null){d=d.cloneNode(true);if(a.aoColumns[e].sContentPadding!=="")d.innerHTML+=a.aoColumns[e].sContentPadding;c.appendChild(d)}}f=a.nTable.parentNode;f.appendChild(b);if(a.oScroll.sX!==""&&a.oScroll.sXInner!==
"")b.style.width=u(a.oScroll.sXInner);else if(a.oScroll.sX!==""){b.style.width="";if(i(b).width()<f.offsetWidth)b.style.width=u(f.offsetWidth)}else if(a.oScroll.sY!=="")b.style.width=u(f.offsetWidth);b.style.visibility="hidden";Qa(a,b);f=i("tbody tr:eq(0)",b).children();if(f.length===0)f=S(a,i("thead",b)[0]);if(a.oScroll.sX!==""){for(e=d=c=0;e<a.aoColumns.length;e++)if(a.aoColumns[e].bVisible){c+=a.aoColumns[e].sWidthOrig===null?i(f[d]).outerWidth():parseInt(a.aoColumns[e].sWidth.replace("px",""),
10)+(i(f[d]).outerWidth()-i(f[d]).width());d++}b.style.width=u(c);a.nTable.style.width=u(c)}for(e=d=0;e<a.aoColumns.length;e++)if(a.aoColumns[e].bVisible){c=i(f[d]).width();if(c!==null&&c>0)a.aoColumns[e].sWidth=u(c);d++}a.nTable.style.width=u(i(b).outerWidth());b.parentNode.removeChild(b)}}function Qa(a,b){if(a.oScroll.sX===""&&a.oScroll.sY!==""){i(b).width();b.style.width=u(i(b).outerWidth()-a.oScroll.iBarWidth)}else if(a.oScroll.sX!=="")b.style.width=u(i(b).outerWidth())}function Pa(a,b){var c=
Ra(a,b);if(c<0)return null;if(a.aoData[c].nTr===null){var d=p.createElement("td");d.innerHTML=H(a,c,b,"");return d}return Q(a,c)[b]}function Ra(a,b){for(var c=-1,d=-1,f=0;f<a.aoData.length;f++){var e=H(a,f,b,"display")+"";e=e.replace(/<.*?>/g,"");if(e.length>c){c=e.length;d=f}}return d}function u(a){if(a===null)return"0px";if(typeof a=="number"){if(a<0)return"0px";return a+"px"}var b=a.charCodeAt(a.length-1);if(b<48||b>57)return a;return a+"px"}function Va(a,b){if(a.length!=b.length)return 1;for(var c=
0;c<a.length;c++)if(a[c]!=b[c])return 2;return 0}function fa(a){for(var b=o.aTypes,c=b.length,d=0;d<c;d++){var f=b[d](a);if(f!==null)return f}return"string"}function A(a){for(var b=0;b<D.length;b++)if(D[b].nTable==a)return D[b];return null}function aa(a){for(var b=[],c=a.aoData.length,d=0;d<c;d++)b.push(a.aoData[d]._aData);return b}function $(a){for(var b=[],c=0,d=a.aoData.length;c<d;c++)a.aoData[c].nTr!==null&&b.push(a.aoData[c].nTr);return b}function Q(a,b){var c=[],d,f,e,h,j;f=0;var k=a.aoData.length;
if(typeof b!="undefined"){f=b;k=b+1}for(f=f;f<k;f++){j=a.aoData[f];if(j.nTr!==null){b=[];e=0;for(h=j.nTr.childNodes.length;e<h;e++){d=j.nTr.childNodes[e].nodeName.toLowerCase();if(d=="td"||d=="th")b.push(j.nTr.childNodes[e])}e=d=0;for(h=a.aoColumns.length;e<h;e++)if(a.aoColumns[e].bVisible)c.push(b[e-d]);else{c.push(j._anHidden[e]);d++}}}return c}function oa(a){return a.replace(new RegExp("(\\/|\\.|\\*|\\+|\\?|\\||\\(|\\)|\\[|\\]|\\{|\\}|\\\\|\\$|\\^)","g"),"\\$1")}function ra(a,b){for(var c=-1,d=
0,f=a.length;d<f;d++)if(a[d]==b)c=d;else a[d]>b&&a[d]--;c!=-1&&a.splice(c,1)}function Ba(a,b){b=b.split(",");for(var c=[],d=0,f=a.aoColumns.length;d<f;d++)for(var e=0;e<f;e++)if(a.aoColumns[d].sName==b[e]){c.push(e);break}return c}function ha(a){for(var b="",c=0,d=a.aoColumns.length;c<d;c++)b+=a.aoColumns[c].sName+",";if(b.length==d)return"";return b.slice(0,-1)}function J(a,b,c){a=a.sTableId===""?"DataTables warning: "+c:"DataTables warning (table id = '"+a.sTableId+"'): "+c;if(b===0)if(o.sErrMode==
"alert")alert(a);else throw a;else typeof console!="undefined"&&typeof console.log!="undefined"&&console.log(a)}function ia(a){a.aoData.splice(0,a.aoData.length);a.aiDisplayMaster.splice(0,a.aiDisplayMaster.length);a.aiDisplay.splice(0,a.aiDisplay.length);E(a)}function sa(a){if(!(!a.oFeatures.bStateSave||typeof a.bDestroying!="undefined")){var b,c,d,f="{";f+='"iCreate":'+(new Date).getTime()+",";f+='"iStart":'+(a.oScroll.bInfinite?0:a._iDisplayStart)+",";f+='"iEnd":'+(a.oScroll.bInfinite?a._iDisplayLength:
a._iDisplayEnd)+",";f+='"iLength":'+a._iDisplayLength+",";f+='"sFilter":"'+encodeURIComponent(a.oPreviousSearch.sSearch)+'",';f+='"sFilterEsc":'+!a.oPreviousSearch.bRegex+",";f+='"aaSorting":[ ';for(b=0;b<a.aaSorting.length;b++)f+="["+a.aaSorting[b][0]+',"'+a.aaSorting[b][1]+'"],';f=f.substring(0,f.length-1);f+="],";f+='"aaSearchCols":[ ';for(b=0;b<a.aoPreSearchCols.length;b++)f+='["'+encodeURIComponent(a.aoPreSearchCols[b].sSearch)+'",'+!a.aoPreSearchCols[b].bRegex+"],";f=f.substring(0,f.length-
1);f+="],";f+='"abVisCols":[ ';for(b=0;b<a.aoColumns.length;b++)f+=a.aoColumns[b].bVisible+",";f=f.substring(0,f.length-1);f+="]";b=0;for(c=a.aoStateSave.length;b<c;b++){d=a.aoStateSave[b].fn(a,f);if(d!=="")f=d}f+="}";Sa(a.sCookiePrefix+a.sInstance,f,a.iCookieDuration,a.sCookiePrefix,a.fnCookieCallback)}}function Ta(a,b){if(a.oFeatures.bStateSave){var c,d,f;d=ta(a.sCookiePrefix+a.sInstance);if(d!==null&&d!==""){try{c=typeof i.parseJSON=="function"?i.parseJSON(d.replace(/'/g,'"')):eval("("+d+")")}catch(e){return}d=
0;for(f=a.aoStateLoad.length;d<f;d++)if(!a.aoStateLoad[d].fn(a,c))return;a.oLoadedState=i.extend(true,{},c);a._iDisplayStart=c.iStart;a.iInitDisplayStart=c.iStart;a._iDisplayEnd=c.iEnd;a._iDisplayLength=c.iLength;a.oPreviousSearch.sSearch=decodeURIComponent(c.sFilter);a.aaSorting=c.aaSorting.slice();a.saved_aaSorting=c.aaSorting.slice();if(typeof c.sFilterEsc!="undefined")a.oPreviousSearch.bRegex=!c.sFilterEsc;if(typeof c.aaSearchCols!="undefined")for(d=0;d<c.aaSearchCols.length;d++)a.aoPreSearchCols[d]=
{sSearch:decodeURIComponent(c.aaSearchCols[d][0]),bRegex:!c.aaSearchCols[d][1]};if(typeof c.abVisCols!="undefined"){b.saved_aoColumns=[];for(d=0;d<c.abVisCols.length;d++){b.saved_aoColumns[d]={};b.saved_aoColumns[d].bVisible=c.abVisCols[d]}}}}}function Sa(a,b,c,d,f){var e=new Date;e.setTime(e.getTime()+c*1E3);c=wa.location.pathname.split("/");a=a+"_"+c.pop().replace(/[\/:]/g,"").toLowerCase();var h;if(f!==null){h=typeof i.parseJSON=="function"?i.parseJSON(b):eval("("+b+")");b=f(a,h,e.toGMTString(),
c.join("/")+"/")}else b=a+"="+encodeURIComponent(b)+"; expires="+e.toGMTString()+"; path="+c.join("/")+"/";f="";e=9999999999999;if((ta(a)!==null?p.cookie.length:b.length+p.cookie.length)+10>4096){a=p.cookie.split(";");for(var j=0,k=a.length;j<k;j++)if(a[j].indexOf(d)!=-1){var m=a[j].split("=");try{h=eval("("+decodeURIComponent(m[1])+")")}catch(t){continue}if(typeof h.iCreate!="undefined"&&h.iCreate<e){f=m[0];e=h.iCreate}}if(f!=="")p.cookie=f+"=; expires=Thu, 01-Jan-1970 00:00:01 GMT; path="+c.join("/")+
"/"}p.cookie=b}function ta(a){var b=wa.location.pathname.split("/");a=a+"_"+b[b.length-1].replace(/[\/:]/g,"").toLowerCase()+"=";b=p.cookie.split(";");for(var c=0;c<b.length;c++){for(var d=b[c];d.charAt(0)==" ";)d=d.substring(1,d.length);if(d.indexOf(a)===0)return decodeURIComponent(d.substring(a.length,d.length))}return null}function W(a,b){b=b.getElementsByTagName("tr");var c,d,f,e,h,j,k,m,t=function(O,B,F){for(;typeof O[B][F]!="undefined";)F++;return F};a.splice(0,a.length);d=0;for(j=b.length;d<
j;d++)a.push([]);d=0;for(j=b.length;d<j;d++){f=0;for(k=b[d].childNodes.length;f<k;f++){c=b[d].childNodes[f];if(c.nodeName.toUpperCase()=="TD"||c.nodeName.toUpperCase()=="TH"){var q=c.getAttribute("colspan")*1,I=c.getAttribute("rowspan")*1;q=!q||q===0||q===1?1:q;I=!I||I===0||I===1?1:I;m=t(a,d,0);for(h=0;h<q;h++)for(e=0;e<I;e++){a[d+e][m+h]={cell:c,unique:q==1?true:false};a[d+e].nTr=b[d]}}}}}function S(a,b,c){var d=[];if(typeof c=="undefined"){c=a.aoHeader;if(typeof b!="undefined"){c=[];W(c,b)}}b=0;
for(var f=c.length;b<f;b++)for(var e=0,h=c[b].length;e<h;e++)if(c[b][e].unique&&(typeof d[e]=="undefined"||!a.bSortCellsTop))d[e]=c[b][e].cell;return d}function Ua(){var a=p.createElement("p"),b=a.style;b.width="100%";b.height="200px";var c=p.createElement("div");b=c.style;b.position="absolute";b.top="0px";b.left="0px";b.visibility="hidden";b.width="200px";b.height="150px";b.overflow="hidden";c.appendChild(a);p.body.appendChild(c);b=a.offsetWidth;c.style.overflow="scroll";a=a.offsetWidth;if(b==a)a=
c.clientWidth;p.body.removeChild(c);return b-a}function P(a,b,c){for(var d=0,f=b.length;d<f;d++)for(var e=0,h=b[d].childNodes.length;e<h;e++)if(b[d].childNodes[e].nodeType==1)typeof c!="undefined"?a(b[d].childNodes[e],c[d].childNodes[e]):a(b[d].childNodes[e])}function n(a,b,c,d){if(typeof d=="undefined")d=c;if(typeof b[c]!="undefined")a[d]=b[c]}function da(a,b,c){for(var d=[],f=0,e=a.aoColumns.length;f<e;f++)d.push(H(a,b,f,c));return d}function H(a,b,c,d){var f=a.aoColumns[c];if((c=f.fnGetData(a.aoData[b]._aData))===
undefined){if(a.iDrawError!=a.iDraw&&f.sDefaultContent===null){J(a,0,"Requested unknown parameter '"+f.mDataProp+"' from the data source for row "+b);a.iDrawError=a.iDraw}return f.sDefaultContent}if(c===null&&f.sDefaultContent!==null)c=f.sDefaultContent;if(d=="display"&&c===null)return"";return c}function N(a,b,c,d){a.aoColumns[c].fnSetData(a.aoData[b]._aData,d)}function Z(a){if(a===null)return function(){return null};else if(typeof a=="function")return function(c){return a(c)};else if(typeof a==
"string"&&a.indexOf(".")!=-1){var b=a.split(".");return b.length==2?function(c){return c[b[0]][b[1]]}:b.length==3?function(c){return c[b[0]][b[1]][b[2]]}:function(c){for(var d=0,f=b.length;d<f;d++)c=c[b[d]];return c}}else return function(c){return c[a]}}function ya(a){if(a===null)return function(){};else if(typeof a=="function")return function(c,d){return a(c,d)};else if(typeof a=="string"&&a.indexOf(".")!=-1){var b=a.split(".");return b.length==2?function(c,d){c[b[0]][b[1]]=d}:b.length==3?function(c,
d){c[b[0]][b[1]][b[2]]=d}:function(c,d){for(var f=0,e=b.length-1;f<e;f++)c=c[b[f]];c[b[b.length-1]]=d}}else return function(c,d){c[a]=d}}this.oApi={};this.fnDraw=function(a){var b=A(this[o.iApiIndex]);if(typeof a!="undefined"&&a===false){E(b);C(b)}else ba(b)};this.fnFilter=function(a,b,c,d,f){var e=A(this[o.iApiIndex]);if(e.oFeatures.bFilter){if(typeof c=="undefined")c=false;if(typeof d=="undefined")d=true;if(typeof f=="undefined")f=true;if(typeof b=="undefined"||b===null){M(e,{sSearch:a,bRegex:c,
bSmart:d},1);if(f&&typeof e.aanFeatures.f!="undefined"){b=e.aanFeatures.f;c=0;for(d=b.length;c<d;c++)i("input",b[c]).val(a)}}else{e.aoPreSearchCols[b].sSearch=a;e.aoPreSearchCols[b].bRegex=c;e.aoPreSearchCols[b].bSmart=d;M(e,e.oPreviousSearch,1)}}};this.fnSettings=function(){return A(this[o.iApiIndex])};this.fnVersionCheck=o.fnVersionCheck;this.fnSort=function(a){var b=A(this[o.iApiIndex]);b.aaSorting=a;R(b)};this.fnSortListener=function(a,b,c){ga(A(this[o.iApiIndex]),a,b,c)};this.fnAddData=function(a,
b){if(a.length===0)return[];var c=[],d,f=A(this[o.iApiIndex]);if(typeof a[0]=="object")for(var e=0;e<a.length;e++){d=v(f,a[e]);if(d==-1)return c;c.push(d)}else{d=v(f,a);if(d==-1)return c;c.push(d)}f.aiDisplay=f.aiDisplayMaster.slice();if(typeof b=="undefined"||b)ba(f);return c};this.fnDeleteRow=function(a,b,c){var d=A(this[o.iApiIndex]);a=typeof a=="object"?U(d,a):a;var f=d.aoData.splice(a,1),e=i.inArray(a,d.aiDisplay);d.asDataSearch.splice(e,1);ra(d.aiDisplayMaster,a);ra(d.aiDisplay,a);typeof b==
"function"&&b.call(this,d,f);if(d._iDisplayStart>=d.aiDisplay.length){d._iDisplayStart-=d._iDisplayLength;if(d._iDisplayStart<0)d._iDisplayStart=0}if(typeof c=="undefined"||c){E(d);C(d)}return f};this.fnClearTable=function(a){var b=A(this[o.iApiIndex]);ia(b);if(typeof a=="undefined"||a)C(b)};this.fnOpen=function(a,b,c){var d=A(this[o.iApiIndex]);this.fnClose(a);var f=p.createElement("tr"),e=p.createElement("td");f.appendChild(e);e.className=c;e.colSpan=X(d);if(typeof b.jquery!="undefined"||typeof b==
"object")e.appendChild(b);else e.innerHTML=b;b=i("tr",d.nTBody);i.inArray(a,b)!=-1&&i(f).insertAfter(a);d.aoOpenRows.push({nTr:f,nParent:a});return f};this.fnClose=function(a){for(var b=A(this[o.iApiIndex]),c=0;c<b.aoOpenRows.length;c++)if(b.aoOpenRows[c].nParent==a){(a=b.aoOpenRows[c].nTr.parentNode)&&a.removeChild(b.aoOpenRows[c].nTr);b.aoOpenRows.splice(c,1);return 0}return 1};this.fnGetData=function(a,b){var c=A(this[o.iApiIndex]);if(typeof a!="undefined"){a=typeof a=="object"?U(c,a):a;if(typeof b!=
"undefined")return H(c,a,b,"");return typeof c.aoData[a]!="undefined"?c.aoData[a]._aData:null}return aa(c)};this.fnGetNodes=function(a){var b=A(this[o.iApiIndex]);if(typeof a!="undefined")return typeof b.aoData[a]!="undefined"?b.aoData[a].nTr:null;return $(b)};this.fnGetPosition=function(a){var b=A(this[o.iApiIndex]),c=a.nodeName.toUpperCase();if(c=="TR")return U(b,a);else if(c=="TD"||c=="TH"){c=U(b,a.parentNode);for(var d=Q(b,c),f=0;f<b.aoColumns.length;f++)if(d[f]==a)return[c,pa(b,f),f]}return null};
this.fnUpdate=function(a,b,c,d,f){var e=A(this[o.iApiIndex]);b=typeof b=="object"?U(e,b):b;if(i.isArray(a)&&typeof a=="object"){e.aoData[b]._aData=a.slice();for(c=0;c<e.aoColumns.length;c++)this.fnUpdate(H(e,b,c),b,c,false,false)}else if(typeof a=="object"){e.aoData[b]._aData=i.extend(true,{},a);for(c=0;c<e.aoColumns.length;c++)this.fnUpdate(H(e,b,c),b,c,false,false)}else{a=a;N(e,b,c,a);if(e.aoColumns[c].fnRender!==null){a=e.aoColumns[c].fnRender({iDataRow:b,iDataColumn:c,aData:e.aoData[b]._aData,
oSettings:e});e.aoColumns[c].bUseRendered&&N(e,b,c,a)}if(e.aoData[b].nTr!==null)Q(e,b)[c].innerHTML=a}c=i.inArray(b,e.aiDisplay);e.asDataSearch[c]=na(e,da(e,b,"filter"));if(typeof f=="undefined"||f)ca(e);if(typeof d=="undefined"||d)ba(e);return 0};this.fnSetColumnVis=function(a,b,c){var d=A(this[o.iApiIndex]),f,e;e=d.aoColumns.length;var h,j;if(d.aoColumns[a].bVisible!=b){if(b){for(f=j=0;f<a;f++)d.aoColumns[f].bVisible&&j++;j=j>=X(d);if(!j)for(f=a;f<e;f++)if(d.aoColumns[f].bVisible){h=f;break}f=0;
for(e=d.aoData.length;f<e;f++)if(d.aoData[f].nTr!==null)j?d.aoData[f].nTr.appendChild(d.aoData[f]._anHidden[a]):d.aoData[f].nTr.insertBefore(d.aoData[f]._anHidden[a],Q(d,f)[h])}else{f=0;for(e=d.aoData.length;f<e;f++)if(d.aoData[f].nTr!==null){h=Q(d,f)[a];d.aoData[f]._anHidden[a]=h;h.parentNode.removeChild(h)}}d.aoColumns[a].bVisible=b;L(d,d.aoHeader);d.nTFoot&&L(d,d.aoFooter);f=0;for(e=d.aoOpenRows.length;f<e;f++)d.aoOpenRows[f].nTr.colSpan=X(d);if(typeof c=="undefined"||c){ca(d);C(d)}sa(d)}};this.fnPageChange=
function(a,b){var c=A(this[o.iApiIndex]);ja(c,a);E(c);if(typeof b=="undefined"||b)C(c)};this.fnDestroy=function(){var a=A(this[o.iApiIndex]),b=a.nTableWrapper.parentNode,c=a.nTBody,d,f;a.bDestroying=true;d=0;for(f=a.aoColumns.length;d<f;d++)a.aoColumns[d].bVisible===false&&this.fnSetColumnVis(d,true);i(a.nTableWrapper).find("*").andSelf().unbind(".DT");i("tbody>tr>td."+a.oClasses.sRowEmpty,a.nTable).parent().remove();if(a.nTable!=a.nTHead.parentNode){i(">thead",a.nTable).remove();a.nTable.appendChild(a.nTHead)}if(a.nTFoot&&
a.nTable!=a.nTFoot.parentNode){i(">tfoot",a.nTable).remove();a.nTable.appendChild(a.nTFoot)}a.nTable.parentNode.removeChild(a.nTable);i(a.nTableWrapper).remove();a.aaSorting=[];a.aaSortingFixed=[];T(a);i($(a)).removeClass(a.asStripClasses.join(" "));if(a.bJUI){i("th",a.nTHead).removeClass([o.oStdClasses.sSortable,o.oJUIClasses.sSortableAsc,o.oJUIClasses.sSortableDesc,o.oJUIClasses.sSortableNone].join(" "));i("th span."+o.oJUIClasses.sSortIcon,a.nTHead).remove();i("th",a.nTHead).each(function(){var e=
i("div."+o.oJUIClasses.sSortJUIWrapper,this),h=e.contents();i(this).append(h);e.remove()})}else i("th",a.nTHead).removeClass([o.oStdClasses.sSortable,o.oStdClasses.sSortableAsc,o.oStdClasses.sSortableDesc,o.oStdClasses.sSortableNone].join(" "));a.nTableReinsertBefore?b.insertBefore(a.nTable,a.nTableReinsertBefore):b.appendChild(a.nTable);d=0;for(f=a.aoData.length;d<f;d++)a.aoData[d].nTr!==null&&c.appendChild(a.aoData[d].nTr);if(a.oFeatures.bAutoWidth===true)a.nTable.style.width=u(a.sDestroyWidth);
i(">tr:even",c).addClass(a.asDestoryStrips[0]);i(">tr:odd",c).addClass(a.asDestoryStrips[1]);d=0;for(f=D.length;d<f;d++)D[d]==a&&D.splice(d,1);a=null};this.fnAdjustColumnSizing=function(a){var b=A(this[o.iApiIndex]);ca(b);if(typeof a=="undefined"||a)this.fnDraw(false);else if(b.oScroll.sX!==""||b.oScroll.sY!=="")this.oApi._fnScrollDraw(b)};for(var ua in o.oApi)if(ua)this[ua]=r(ua);this.oApi._fnExternApiFunc=r;this.oApi._fnInitalise=s;this.oApi._fnInitComplete=w;this.oApi._fnLanguageProcess=y;this.oApi._fnAddColumn=
G;this.oApi._fnColumnOptions=x;this.oApi._fnAddData=v;this.oApi._fnCreateTr=z;this.oApi._fnGatherData=Y;this.oApi._fnBuildHead=V;this.oApi._fnDrawHead=L;this.oApi._fnDraw=C;this.oApi._fnReDraw=ba;this.oApi._fnAjaxUpdate=za;this.oApi._fnAjaxUpdateDraw=Aa;this.oApi._fnAddOptionsHtml=xa;this.oApi._fnFeatureHtmlTable=Fa;this.oApi._fnScrollDraw=Ia;this.oApi._fnAjustColumnSizing=ca;this.oApi._fnFeatureHtmlFilter=Da;this.oApi._fnFilterComplete=M;this.oApi._fnFilterCustom=Ma;this.oApi._fnFilterColumn=La;
this.oApi._fnFilter=Ka;this.oApi._fnBuildSearchArray=ka;this.oApi._fnBuildSearchRow=na;this.oApi._fnFilterCreateSearch=la;this.oApi._fnDataToSearch=ma;this.oApi._fnSort=R;this.oApi._fnSortAttachListener=ga;this.oApi._fnSortingClasses=T;this.oApi._fnFeatureHtmlPaginate=Ha;this.oApi._fnPageChange=ja;this.oApi._fnFeatureHtmlInfo=Ga;this.oApi._fnUpdateInfo=Na;this.oApi._fnFeatureHtmlLength=Ca;this.oApi._fnFeatureHtmlProcessing=Ea;this.oApi._fnProcessingDisplay=K;this.oApi._fnVisibleToColumnIndex=Ja;this.oApi._fnColumnIndexToVisible=
pa;this.oApi._fnNodeToDataIndex=U;this.oApi._fnVisbleColumns=X;this.oApi._fnCalculateEnd=E;this.oApi._fnConvertToWidth=Oa;this.oApi._fnCalculateColumnWidths=ea;this.oApi._fnScrollingWidthAdjust=Qa;this.oApi._fnGetWidestNode=Pa;this.oApi._fnGetMaxLenString=Ra;this.oApi._fnStringToCss=u;this.oApi._fnArrayCmp=Va;this.oApi._fnDetectType=fa;this.oApi._fnSettingsFromNode=A;this.oApi._fnGetDataMaster=aa;this.oApi._fnGetTrNodes=$;this.oApi._fnGetTdNodes=Q;this.oApi._fnEscapeRegex=oa;this.oApi._fnDeleteIndex=
ra;this.oApi._fnReOrderIndex=Ba;this.oApi._fnColumnOrdering=ha;this.oApi._fnLog=J;this.oApi._fnClearTable=ia;this.oApi._fnSaveState=sa;this.oApi._fnLoadState=Ta;this.oApi._fnCreateCookie=Sa;this.oApi._fnReadCookie=ta;this.oApi._fnDetectHeader=W;this.oApi._fnGetUniqueThs=S;this.oApi._fnScrollBarWidth=Ua;this.oApi._fnApplyToChildren=P;this.oApi._fnMap=n;this.oApi._fnGetRowData=da;this.oApi._fnGetCellData=H;this.oApi._fnSetCellData=N;this.oApi._fnGetObjectDataFn=Z;this.oApi._fnSetObjectDataFn=ya;var va=
this;return this.each(function(){var a=0,b,c,d,f;a=0;for(b=D.length;a<b;a++){if(D[a].nTable==this)if(typeof g=="undefined"||typeof g.bRetrieve!="undefined"&&g.bRetrieve===true)return D[a].oInstance;else if(typeof g.bDestroy!="undefined"&&g.bDestroy===true){D[a].oInstance.fnDestroy();break}else{J(D[a],0,"Cannot reinitialise DataTable.\n\nTo retrieve the DataTables object for this table, please pass either no arguments to the dataTable() function, or set bRetrieve to true. Alternatively, to destory the old table and create a new one, set bDestroy to true (note that a lot of changes to the configuration can be made through the API which is usually much faster).");
return}if(D[a].sTableId!==""&&D[a].sTableId==this.getAttribute("id")){D.splice(a,1);break}}var e=new l;D.push(e);var h=false,j=false;a=this.getAttribute("id");if(a!==null){e.sTableId=a;e.sInstance=a}else e.sInstance=o._oExternConfig.iNextUnique++;if(this.nodeName.toLowerCase()!="table")J(e,0,"Attempted to initialise DataTables on a node which is not a table: "+this.nodeName);else{e.nTable=this;e.oInstance=va.length==1?va:i(this).dataTable();e.oApi=va.oApi;e.sDestroyWidth=i(this).width();if(typeof g!=
"undefined"&&g!==null){e.oInit=g;n(e.oFeatures,g,"bPaginate");n(e.oFeatures,g,"bLengthChange");n(e.oFeatures,g,"bFilter");n(e.oFeatures,g,"bSort");n(e.oFeatures,g,"bInfo");n(e.oFeatures,g,"bProcessing");n(e.oFeatures,g,"bAutoWidth");n(e.oFeatures,g,"bSortClasses");n(e.oFeatures,g,"bServerSide");n(e.oFeatures,g,"bDeferRender");n(e.oScroll,g,"sScrollX","sX");n(e.oScroll,g,"sScrollXInner","sXInner");n(e.oScroll,g,"sScrollY","sY");n(e.oScroll,g,"bScrollCollapse","bCollapse");n(e.oScroll,g,"bScrollInfinite",
"bInfinite");n(e.oScroll,g,"iScrollLoadGap","iLoadGap");n(e.oScroll,g,"bScrollAutoCss","bAutoCss");n(e,g,"asStripClasses");n(e,g,"fnPreDrawCallback");n(e,g,"fnRowCallback");n(e,g,"fnHeaderCallback");n(e,g,"fnFooterCallback");n(e,g,"fnCookieCallback");n(e,g,"fnInitComplete");n(e,g,"fnServerData");n(e,g,"fnFormatNumber");n(e,g,"aaSorting");n(e,g,"aaSortingFixed");n(e,g,"aLengthMenu");n(e,g,"sPaginationType");n(e,g,"sAjaxSource");n(e,g,"sAjaxDataProp");n(e,g,"iCookieDuration");n(e,g,"sCookiePrefix");
n(e,g,"sDom");n(e,g,"bSortCellsTop");n(e,g,"oSearch","oPreviousSearch");n(e,g,"aoSearchCols","aoPreSearchCols");n(e,g,"iDisplayLength","_iDisplayLength");n(e,g,"bJQueryUI","bJUI");n(e.oLanguage,g,"fnInfoCallback");typeof g.fnDrawCallback=="function"&&e.aoDrawCallback.push({fn:g.fnDrawCallback,sName:"user"});typeof g.fnStateSaveCallback=="function"&&e.aoStateSave.push({fn:g.fnStateSaveCallback,sName:"user"});typeof g.fnStateLoadCallback=="function"&&e.aoStateLoad.push({fn:g.fnStateLoadCallback,sName:"user"});
if(e.oFeatures.bServerSide&&e.oFeatures.bSort&&e.oFeatures.bSortClasses)e.aoDrawCallback.push({fn:T,sName:"server_side_sort_classes"});else e.oFeatures.bDeferRender&&e.aoDrawCallback.push({fn:T,sName:"defer_sort_classes"});if(typeof g.bJQueryUI!="undefined"&&g.bJQueryUI){e.oClasses=o.oJUIClasses;if(typeof g.sDom=="undefined")e.sDom='<"H"lfr>t<"F"ip>'}if(e.oScroll.sX!==""||e.oScroll.sY!=="")e.oScroll.iBarWidth=Ua();if(typeof g.iDisplayStart!="undefined"&&typeof e.iInitDisplayStart=="undefined"){e.iInitDisplayStart=
g.iDisplayStart;e._iDisplayStart=g.iDisplayStart}if(typeof g.bStateSave!="undefined"){e.oFeatures.bStateSave=g.bStateSave;Ta(e,g);e.aoDrawCallback.push({fn:sa,sName:"state_save"})}if(typeof g.iDeferLoading!="undefined"){e.bDeferLoading=true;e._iRecordsTotal=g.iDeferLoading;e._iRecordsDisplay=g.iDeferLoading}if(typeof g.aaData!="undefined")j=true;if(typeof g!="undefined"&&typeof g.aoData!="undefined")g.aoColumns=g.aoData;if(typeof g.oLanguage!="undefined")if(typeof g.oLanguage.sUrl!="undefined"&&g.oLanguage.sUrl!==
""){e.oLanguage.sUrl=g.oLanguage.sUrl;i.getJSON(e.oLanguage.sUrl,null,function(t){y(e,t,true)});h=true}else y(e,g.oLanguage,false)}else g={};if(typeof g.asStripClasses=="undefined"){e.asStripClasses.push(e.oClasses.sStripOdd);e.asStripClasses.push(e.oClasses.sStripEven)}c=false;d=i(">tbody>tr",this);a=0;for(b=e.asStripClasses.length;a<b;a++)if(d.filter(":lt(2)").hasClass(e.asStripClasses[a])){c=true;break}if(c){e.asDestoryStrips=["",""];if(i(d[0]).hasClass(e.oClasses.sStripOdd))e.asDestoryStrips[0]+=
e.oClasses.sStripOdd+" ";if(i(d[0]).hasClass(e.oClasses.sStripEven))e.asDestoryStrips[0]+=e.oClasses.sStripEven;if(i(d[1]).hasClass(e.oClasses.sStripOdd))e.asDestoryStrips[1]+=e.oClasses.sStripOdd+" ";if(i(d[1]).hasClass(e.oClasses.sStripEven))e.asDestoryStrips[1]+=e.oClasses.sStripEven;d.removeClass(e.asStripClasses.join(" "))}c=[];var k;a=this.getElementsByTagName("thead");if(a.length!==0){W(e.aoHeader,a[0]);c=S(e)}if(typeof g.aoColumns=="undefined"){k=[];a=0;for(b=c.length;a<b;a++)k.push(null)}else k=
g.aoColumns;a=0;for(b=k.length;a<b;a++){if(typeof g.saved_aoColumns!="undefined"&&g.saved_aoColumns.length==b){if(k[a]===null)k[a]={};k[a].bVisible=g.saved_aoColumns[a].bVisible}G(e,c?c[a]:null)}if(typeof g.aoColumnDefs!="undefined")for(a=g.aoColumnDefs.length-1;a>=0;a--){var m=g.aoColumnDefs[a].aTargets;i.isArray(m)||J(e,1,"aTargets must be an array of targets, not a "+typeof m);c=0;for(d=m.length;c<d;c++)if(typeof m[c]=="number"&&m[c]>=0){for(;e.aoColumns.length<=m[c];)G(e);x(e,m[c],g.aoColumnDefs[a])}else if(typeof m[c]==
"number"&&m[c]<0)x(e,e.aoColumns.length+m[c],g.aoColumnDefs[a]);else if(typeof m[c]=="string"){b=0;for(f=e.aoColumns.length;b<f;b++)if(m[c]=="_all"||i(e.aoColumns[b].nTh).hasClass(m[c]))x(e,b,g.aoColumnDefs[a])}}if(typeof k!="undefined"){a=0;for(b=k.length;a<b;a++)x(e,a,k[a])}a=0;for(b=e.aaSorting.length;a<b;a++){if(e.aaSorting[a][0]>=e.aoColumns.length)e.aaSorting[a][0]=0;k=e.aoColumns[e.aaSorting[a][0]];if(typeof e.aaSorting[a][2]=="undefined")e.aaSorting[a][2]=0;if(typeof g.aaSorting=="undefined"&&
typeof e.saved_aaSorting=="undefined")e.aaSorting[a][1]=k.asSorting[0];c=0;for(d=k.asSorting.length;c<d;c++)if(e.aaSorting[a][1]==k.asSorting[c]){e.aaSorting[a][2]=c;break}}T(e);a=i(">thead",this);if(a.length===0){a=[p.createElement("thead")];this.appendChild(a[0])}e.nTHead=a[0];a=i(">tbody",this);if(a.length===0){a=[p.createElement("tbody")];this.appendChild(a[0])}e.nTBody=a[0];a=i(">tfoot",this);if(a.length>0){e.nTFoot=a[0];W(e.aoFooter,e.nTFoot)}if(j)for(a=0;a<g.aaData.length;a++)v(e,g.aaData[a]);
else Y(e);e.aiDisplay=e.aiDisplayMaster.slice();e.bInitialised=true;h===false&&s(e)}})}})(jQuery,window,document);
; 
 
//@ sourceURL=/js/jqutils.js 
function getOptions(defaults,opts){return($.extend({},defaults,opts))}function logMessage(msg){if(typeof console!="undefined"&&typeof console.log!="undefined"){console.log(msg)}}function errorMessage(msg){if(typeof console!="undefined"&&typeof console.error!="undefined"){console.error(msg)}}function exceptionMessage(msg,e){if(typeof console!==undefined&&typeof console.error!==undefined){console.dir(e);console.error(msg)}}function showBetaMessage(){$("<div><p class='confirmMessage'>This feature is not available in this alpha version.</p></div>").dialog({modal:true,resizable:false,title:"Feature not available",buttons:{OK:function(){$(this).dialog("close")}},close:function(){$(this).dialog("destroy").remove()}})}function notifyGreen(msg){$.jGrowl(msg,{theme:"jGrowl-green"})}function doErrorDialog(errorMsg){$("<div><p class='errorMessage'>"+errorMsg+"</p></div>").dialog({title:"Error",modal:true,resizable:false,buttons:{OK:function(){$(this).dialog("destroy").remove()}}})}function doConfirmationDialog(msg,success,failure){$('<div><p class="confirmMessage">'+msg+"</p></div>").dialog({title:"Confirm",modal:true,resizable:false,buttons:{Cancel:function(){if(failure&&failure.constructor==Function){failure()}$(this).dialog("close").remove()},OK:function(){if(success&&success.constructor==Function){success()}$(this).dialog("close").remove()}}})}function getXMLresp(data){var xml;if($.browser.msie&&typeof data=="string"){xml=new ActiveXObject("Microsoft.XMLDOM");xml.async=false;xml.loadXML(data)}else{xml=data}return xml}function updateSelectForInvalidOption(menu){var menu$=$(menu);if(menu$.children("option:selected").hasClass("redCritOpt")){menu$.css("color","red").children("option").css("color","black")}else{menu$.css("color","black")}}function setupResizeTrigger(){$(function(){var winWidth=$(window).width();var winHeight=$(window).height();$(window).resize(_.debounce(function(){var winNewWidth=$(window).width();var winNewHeight=$(window).height();if(winWidth!=winNewWidth||winHeight!=winNewHeight){$(window).trigger("resizeidle.qb")}winWidth=winNewWidth;winHeight=winNewHeight},200))})}(function($,window,document,undefined){var pluginName="setupClearables";function updateClearButton(x){var isEmpty=(x.value==""||x.value==$(x).attr("placeholder"));$(x).siblings("a").toggleClass("DisplayNone",isEmpty);$(x).toggleClass("Empty",isEmpty)}var defaults={clearSelector:".clearsearch",updateFunction:updateClearButton,inputSelector:".clearableInput",defaultClearButton:true};function Plugin(element,options){this.element=element;this.options=$.extend({},defaults,options);if(options&&options.clearSelector&&!options.defaultClearButton){this.options.defaultClearButton=false}this._defaults=defaults;this._name=pluginName;this.init(element)}Plugin.prototype.init=function(){var settings=this.options;var funcElem=$(this.element);var funcInputElem=funcElem.find(settings.inputSelector);if(settings.defaultClearButton){funcInputElem.wrap('<span class="ClearContainer  "></span>').after('<a href="javascript:void(0)" class="clearsearch DisplayNone Clear Icon" title="Clear input"  src="'+(window.gResDir||"")+'/css/themes/classic/images/icons/clearsearch.png"  alt="clear the input" />');funcInputElem.addClass("UserInput WithPadding")}$(function(){if(settings.defaultClearButton){setTimeout(function(){funcInputElem.each(function(x,e){updateClearButton(e)})},10)}});var clearbutton=funcElem.find(settings.clearSelector);clearbutton.click(function(event){var inp=$(event.target).prev(settings.inputSelector);if(inp.length){inp.val("");settings.updateFunction(inp[0],funcElem);inp.focus();inp.trigger("cleared")}return false});funcElem.find(settings.inputSelector).bind("keyup input paste",function(x){setTimeout(function(){settings.updateFunction(x.target)},10)})};$.fn[pluginName]=function(options){return this.each(function(){if(!$.data(this,"plugin_"+pluginName)){$.data(this,"plugin_"+pluginName,new Plugin(this,options))}})}})(jQuery,window,document);var MicroCache=function(){var _values={};return{get:function(key){return _values[key]},contains:function(key){return key in _values},clear:function(key){delete _values[key]},set:function(key,value){_values[key]=value},values:function(){return _values},getSet:function(key,value){if(!this.contains(key)){this.set(key,typeof value=="function"?value():value)}return this.get(key)}}};window.pm={getUrlVars:function(){var vars=[],hash;var hashes=window.location.href.slice(window.location.href.indexOf("?")+1).split("&");for(var i=0;i<hashes.length;i++){hash=hashes[i].split("=");vars.push(hash[0]);vars[hash[0]]=hash[1]||"";var lowr=hash[0].toLowerCase();if(lowr!=hash[0]){vars.push(lowr);vars[lowr]=hash[1]||""}}return vars},getUrlVar:function(name){return(this.getUrlVars()[name?name.toLowerCase():""])}};function timedChunk(items,process,context,callback){var todo=items.concat();setTimeout(function(){var start=+new Date();do{process.call(context,todo.shift())}while(todo.length>0&&(+new Date()-start<50));if(todo.length>0){setTimeout(arguments.callee,25)}else{if(_.isFunction(callback)){callback(items)}}},25)}function timedChunkHash(items,process,context,callback){var todo=_.keys(items);var todoval=_.values(items);setTimeout(function(){var start=+new Date();do{process.call(context,todoval.shift(),todo.shift())}while(todo.length>0&&(+new Date()-start<50));if(todo.length>0){setTimeout(arguments.callee,25)}else{if(_.isFunction(callback)){callback(items)}}},25)}function defer(delay,callback){var timer;return function(){var thiis=this,args=arguments;window.clearTimeout(timer);timer=window.setTimeout(function(){callback.apply(thiis,args)},delay)}}function setInitialState(control,isOn){if(control==null){if(window.console){console.error("setInitialState() error: control is null")}return}if(isOn){control.prop("checked",true)}else{control.removeAttr("checked")}}function parseDataAs2D(input){var lines=input.split(kDelimRow).slice(1);var rows=[];for(var i=0,j=0;i<lines.length;++i){var listitem=lines[i].split(kDelimData).slice(1);rows[j++]=listitem}return rows}function parseDataAs1D(input){return input.split(kDelimRow).slice(1)}function changeTableViewLength(table,length){var oSettings=table.fnSettings()._iDisplayLength=length;table.fnDraw()}function changeTableFilter(table,filterSelVal){if(filterSelVal=="clear"){clearTableFilters(table)}else{filterValue=filterSelVal.split(",");if(filterValue.length==2){clearTableFilters(table);table.fnFilter("^"+filterValue[1]+"$",filterValue[0],true,false,false)}}}function clearTableFilters(table){var oSettings=table.fnSettings();for(iCol=0;iCol<oSettings.aoPreSearchCols.length;iCol++){oSettings.aoPreSearchCols[iCol].sSearch=""}table.fnDraw()}var selectionErrorDialogSettings={buttons:{OK:function(){$(this).dialog("close")}},modal:true,title:"No items selected",resizable:false,width:360};function checkForSelected(numSelectedItems){if(numSelectedItems.length==0||numSelectedItems==0){$("<div><p class='errorMessage'>Please select one or more items before trying to perform this action.</p></div>").dialog(selectionErrorDialogSettings);return false}else{return true}}function buildDTRetval(table,oneRowFunction,delim){if(typeof oneRowFunction!="function"){return""}var retval="";var nodes=table.fnGetDisplayNodes();for(i=0;i<nodes.length;i++){if($("input",nodes[i]).prop("checked")==true){var aPos=table.fnGetPosition(nodes[i]);var aData=table.fnGetData(aPos);retval+=oneRowFunction(aData)+delim}}return retval}function clearAllSelected(tableid){$("#"+tableid+" :checkbox").prop("checked",false)}function renderDate(oObj){var dateInt=parseInt(oObj.aData[oObj.iDataColumn]);if(isNaN(dateInt)){return""}var date=new Date(dateInt);var datestring=date.toDateString();var datestringarray=date.toDateString().split(" ");var time=date.toTimeString().split(" ")[0];return datestringarray[1]+" "+datestringarray[2]+", "+datestringarray[3]+" "+time}function renderBoolAsCheck(oObj){return(oObj.aData[oObj.iDataColumn]==1)?"<img src='/i/icons/16/check_green.png'>":""}if(typeof($.ui.dialog)!="undefined"){$.extend($.ui.dialog.prototype,{addbutton:function(buttonName,func){var buttons=this.element.dialog("option","buttons");var newset={};newset[buttonName]=func;for(var ord in buttons){newset[ord]=buttons[ord]}this.element.dialog("option","buttons",newset)}});$.extend($.ui.dialog.prototype,{removebutton:function(buttonName){var buttons=this.element.dialog("option","buttons");delete buttons[buttonName];this.element.dialog("option","buttons",buttons)}})}if(typeof($.fn.dataTableExt)!="undefined"){$.fn.dataTableExt.oApi.fnGetDisplayNodes=function(oSettings,iRow){var anRows=[];if(oSettings.aiDisplay.length!==0){if(typeof iRow!="undefined"){return oSettings.aoData[oSettings.aiDisplay[iRow]].nTr}else{for(var j=oSettings._iDisplayStart;j<oSettings._iDisplayEnd;j++){var nRow=oSettings.aoData[oSettings.aiDisplay[j]].nTr;anRows.push(nRow)}}}return anRows};$.fn.dataTableExt.oApi.fnGetColumnData=function(oSettings,iColumn,bUnique,bFiltered,bIgnoreEmpty){if(typeof iColumn=="undefined"){return new Array()}if(typeof bUnique=="undefined"){bUnique=true}if(typeof bFiltered=="undefined"){bFiltered=true}if(typeof bIgnoreEmpty=="undefined"){bIgnoreEmpty=true}var aiRows;if(bFiltered==true){aiRows=oSettings.aiDisplay}else{aiRows=oSettings.aiDisplayMaster}var asResultData=new Array();for(var i=0,c=aiRows.length;i<c;i++){iRow=aiRows[i];var aData=this.fnGetData(iRow);var sValue=aData[iColumn];if(bIgnoreEmpty==true&&sValue.length==0){continue}else{if(bUnique==true&&jQuery.inArray(sValue,asResultData)>-1){continue}else{asResultData.push(sValue)}}}return asResultData};jQuery.fn.dataTableExt.oSort["num-html-asc"]=function(a,b){var x=a.replace(/<.*?>/g,"");var y=b.replace(/<.*?>/g,"");x=parseFloat(x);y=parseFloat(y);return((x<y)?-1:((x>y)?1:0))};jQuery.fn.dataTableExt.oSort["num-html-desc"]=function(a,b){var x=a.replace(/<.*?>/g,"");var y=b.replace(/<.*?>/g,"");x=parseFloat(x);y=parseFloat(y);return((x<y)?1:((x>y)?-1:0))};$.fn.dataTableExt.oApi.fnUpdateNoBuild=function(oSettings,mData,mRow,iColumn){var iVisibleColumn;var sDisplay;var iRow=(typeof mRow=="object")?this.oApi._fnNodeToDataIndex(oSettings,mRow):mRow;if(typeof mData!="object"){sDisplay=mData;oSettings.aoData[iRow]._aData[iColumn]=sDisplay;if(oSettings.aoColumns[iColumn].fnRender!==null){sDisplay=oSettings.aoColumns[iColumn].fnRender({iDataRow:iRow,iDataColumn:iColumn,aData:oSettings.aoData[iRow]._aData,oSettings:oSettings});if(oSettings.aoColumns[iColumn].bUseRendered){oSettings.aoData[iRow]._aData[iColumn]=sDisplay}}iVisibleColumn=this.oApi._fnColumnIndexToVisible(oSettings,iColumn);if(iVisibleColumn!==null){oSettings.aoData[iRow].nTr.getElementsByTagName("td")[iVisibleColumn].innerHTML=sDisplay}}else{if(mData.length!=oSettings.aoColumns.length){alert("DataTables warning: An array passed to fnUpdate must have the same number of columns as the table in question - in this case "+oSettings.aoColumns.length);return 1}for(var i=0;i<mData.length;i++){sDisplay=mData[i];oSettings.aoData[iRow]._aData[i]=sDisplay;if(oSettings.aoColumns[i].fnRender!==null){sDisplay=oSettings.aoColumns[i].fnRender({iDataRow:iRow,iDataColumn:i,aData:oSettings.aoData[iRow]._aData,oSettings:oSettings});if(oSettings.aoColumns[i].bUseRendered){oSettings.aoData[iRow]._aData[i]=sDisplay}}iVisibleColumn=this.oApi._fnColumnIndexToVisible(oSettings,i);if(iVisibleColumn!==null){oSettings.aoData[iRow].nTr.getElementsByTagName("td")[iVisibleColumn].innerHTML=sDisplay}}}return 0};$.fn.dataTableExt.oApi.fnBuildAndRedraw=function(oSettings){this.oApi._fnBuildSearchArray(oSettings,1);this.oApi._fnReDraw(oSettings)};
/*
* jQuery scrollintoview() plugin and :scrollable selector filter
*
* based on Version 1.8 (14 Jul 2011)
* Requires jQuery 1.4 or newer
*
* Copyright (c) 2011 Robert Koritnik
* Licensed under the terms of the MIT license
* http://www.opensource.org/licenses/mit-license.php
*/
}(function($){var converter={vertical:{x:false,y:true},horizontal:{x:true,y:false},both:{x:true,y:true},x:{x:true,y:false},y:{x:false,y:true}};var settings={duration:"fast",direction:"both",topIndent:0};var rootrx=/^(?:html)$/i;var borders=function(domElement,styles){styles=styles||(document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(domElement,null):domElement.currentStyle);var px=document.defaultView&&document.defaultView.getComputedStyle?true:false;var b={top:(parseFloat(px?styles.borderTopWidth:$.css(domElement,"borderTopWidth"))||0),left:(parseFloat(px?styles.borderLeftWidth:$.css(domElement,"borderLeftWidth"))||0),bottom:(parseFloat(px?styles.borderBottomWidth:$.css(domElement,"borderBottomWidth"))||0),right:(parseFloat(px?styles.borderRightWidth:$.css(domElement,"borderRightWidth"))||0)};return{top:b.top,left:b.left,bottom:b.bottom,right:b.right,vertical:b.top+b.bottom,horizontal:b.left+b.right}};var dimensions=function($element){var win=$(window);var isRoot=rootrx.test($element[0].nodeName);return{border:isRoot?{top:0,left:0,bottom:0,right:0}:borders($element[0]),scroll:{top:(isRoot?win:$element).scrollTop(),left:(isRoot?win:$element).scrollLeft()},scrollbar:{right:isRoot?0:$element.innerWidth()-$element[0].clientWidth,bottom:isRoot?0:$element.innerHeight()-$element[0].clientHeight},rect:(function(){var r=$element[0].getBoundingClientRect();return{top:isRoot?0:r.top,left:isRoot?0:r.left,bottom:isRoot?$element[0].clientHeight:r.bottom,right:isRoot?$element[0].clientWidth:r.right}})()}};$.fn.extend({scrollintoview:function(options){options=$.extend({},settings,options);options.direction=converter[typeof(options.direction)==="string"&&options.direction.toLowerCase()]||converter.both;var dirStr="";if(options.direction.x===true){dirStr="horizontal"}if(options.direction.y===true){dirStr=dirStr?"both":"vertical"}var el=this.eq(0);var scroller=el.closest(":scrollable("+dirStr+")");var completeCalled=false;if(scroller.length>0){scroller=scroller.eq(0);var dim={e:dimensions(el),s:dimensions(scroller)};var rel={top:dim.e.rect.top-(dim.s.rect.top+dim.s.border.top),bottom:dim.s.rect.bottom-dim.s.border.bottom-dim.s.scrollbar.bottom-dim.e.rect.bottom,left:dim.e.rect.left-(dim.s.rect.left+dim.s.border.left),right:dim.s.rect.right-dim.s.border.right-dim.s.scrollbar.right-dim.e.rect.right};var animOptions={};if(options.direction.y===true){if(rel.top<0){animOptions.scrollTop=dim.s.scroll.top+rel.top+options.topIndent}else{if(rel.top>0&&rel.bottom<0){if(rel.top<-rel.bottom){animOptions.scrollTop=dim.s.scroll.top+rel.top+options.topIndent}else{animOptions.scrollTop=dim.s.scroll.top-rel.bottom+options.topIndent}}}}if(options.direction.x===true){if(rel.left<0){animOptions.scrollLeft=dim.s.scroll.left+rel.left}else{if(rel.left>0&&rel.right<0){animOptions.scrollLeft=dim.s.scroll.left+Math.min(rel.left,-rel.right)}}}if(!$.isEmptyObject(animOptions)){if(rootrx.test(scroller[0].nodeName)){scroller=$("html,body")}scroller.animate(animOptions,options.duration).eq(0).queue(function(next){completeCalled=true;$.isFunction(options.complete)&&options.complete.call(scroller[0]);next()})}}if(!completeCalled){$.isFunction(options.complete)&&options.complete.call(scroller?scroller[0]:undefined)}return this}});var scrollValue={auto:true,scroll:true,visible:false,hidden:false};$.extend($.expr[":"],{scrollable:function(element,index,meta,stack){var direction=converter[typeof(meta[3])==="string"&&meta[3].toLowerCase()]||converter.both;var styles=(document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(element,null):element.currentStyle);var overflow={x:scrollValue[styles.overflowX.toLowerCase()]||false,y:scrollValue[styles.overflowY.toLowerCase()]||false,isRoot:rootrx.test(element.nodeName)};if(!overflow.x&&!overflow.y&&!overflow.isRoot){return false}var size={height:{scroll:element.scrollHeight,client:element.clientHeight},width:{scroll:element.scrollWidth,client:element.clientWidth},scrollableX:function(){return(overflow.x||overflow.isRoot)&&this.width.scroll>this.width.client},scrollableY:function(){return(overflow.y||overflow.isRoot)&&this.height.scroll>this.height.client}};return direction.y&&size.scrollableY()||direction.x&&size.scrollableX()}})})(jQuery);
/*
* jQuery resize event - v1.1 - 3/14/2010
* http://benalman.com/projects/jquery-resize-plugin/
* 
* Copyright (c) 2010 "Cowboy" Ben Alman
* Dual licensed under the MIT and GPL licenses.
* http://benalman.com/about/license/
*/
(function($,window,undefined){var elems=$([]),jq_resize=$.resize=$.extend($.resize,{}),timeout_id,str_setTimeout="setTimeout",str_resize="resize",str_data=str_resize+"-special-event",str_delay="delay",str_throttle="throttleWindow";jq_resize[str_delay]=250;jq_resize[str_throttle]=false;$.event.special[str_resize]={setup:function(){if(!jq_resize[str_throttle]&&this[str_setTimeout]){return false}if(this.container&&this.container.className=="highcharts-container"){return false}var elem=$(this);elems=elems.add(elem);$.data(this,str_data,{w:elem.width(),h:elem.height()});if(elems.length===1){loopy()}},teardown:function(){if(!jq_resize[str_throttle]&&this[str_setTimeout]){return false}if(this.container&&this.container.className=="highcharts-container"){return false}var elem=$(this);elems=elems.not(elem);elem.removeData(str_data);if(!elems.length){clearTimeout(timeout_id)}},add:function(handleObj){if(!jq_resize[str_throttle]&&this[str_setTimeout]){return false}if(this.container&&this.container.className=="highcharts-container"){return false}var old_handler;function new_handler(e,w,h){var elem=$(this),data=$.data(this,str_data);data.w=w!==undefined?w:elem.width();data.h=h!==undefined?h:elem.height();old_handler.apply(this,arguments)}if($.isFunction(handleObj)){old_handler=handleObj;return new_handler}else{old_handler=handleObj.handler;handleObj.handler=new_handler}}};function loopy(){timeout_id=window[str_setTimeout](function(){elems.each(function(){var elem=$(this),width=elem.width(),height=elem.height(),data=$.data(this,str_data);if(width!==data.w||height!==data.h){elem.trigger(str_resize,[data.w=width,data.h=height])}});loopy()},jq_resize[str_delay])}})(jQuery,this);function chromeFramePrompt(){$("#gcfLoading").hide();$("#gcfReload").hide();$("#gcfOverlay").show();$("#gcfPrompt").show().position({of:$(window)});_.defer(function(){$("#gcfPrompt").focus()},2000)}function checkIEVersionSupported(){$("#gcfLoading").hide();$("#gcfReload").hide();$("#gcfPrompt").hide();$("#gcfOverlay").hide();var ua=navigator.userAgent.toLowerCase();var haschrome=ua.indexOf("chrome/")>=0;var userMSIEVersion=GetBrowserVersion();var oldIEVersion=(parseInt(userMSIEVersion,10)<8);if(gReqTemplName.toLowerCase()=="login"){return}if(oldIEVersion&&!haschrome){chromeFramePrompt()}}
/*
* jQuery UI Touch Punch 0.2.2
*
* Copyright 2011, Dave Furfero
* Dual licensed under the MIT or GPL Version 2 licenses.
*
* Changes by sharo
* Depends:
*  jquery.ui.widget.js
*  jquery.ui.mouse.js
*/
(function($){$.support.touch="ontouchend" in document;if(!$.support.touch){return}var mouseProto=$.ui.mouse.prototype,_mouseInit=mouseProto._mouseInit,touchHandled;function simulateMouseEvent(event,simulatedType){if(event.originalEvent.touches.length>1){return}var touch=event.originalEvent.changedTouches[0],simulatedEvent=document.createEvent("MouseEvents");simulatedEvent.initMouseEvent(simulatedType,true,true,window,1,touch.screenX,touch.screenY,touch.clientX,touch.clientY,false,false,false,false,0,null);if(!event.target.dispatchEvent(simulatedEvent)){event.preventDefault()}}mouseProto._touchStart=function(event){var self=this;if(touchHandled||!self._mouseCapture(event.originalEvent.changedTouches[0])){return}touchHandled=true;self._touchMoved=false;simulateMouseEvent(event,"mouseover");simulateMouseEvent(event,"mousemove");simulateMouseEvent(event,"mousedown")};mouseProto._touchMove=function(event){if(!touchHandled){return}this._touchMoved=true;simulateMouseEvent(event,"mousemove")};mouseProto._touchEnd=function(event){if(!touchHandled){return}simulateMouseEvent(event,"mouseup");simulateMouseEvent(event,"mouseout");if(!this._touchMoved){simulateMouseEvent(event,"click")}touchHandled=false};mouseProto._mouseInit=function(){var self=this;self.element.bind("touchstart",$.proxy(self,"_touchStart")).bind("touchmove",$.proxy(self,"_touchMove")).bind("touchend",$.proxy(self,"_touchEnd"));_mouseInit.call(self)}})(jQuery);
/*
* jQuery Special Events for Touch Devices
*
*/
(function($){$.support.touch="ontouchend" in document;if(!$.support.touch){return}$.each(("doubletap taphold").split(" "),function(i,name){$.fn[name]=function(fn){return fn?this.bind(name,fn):this.trigger(name)};if($.attrFn){$.attrFn[name]=true}});function triggerCustomEvent(obj,eventType,event){var e=jQuery.extend(new jQuery.Event(),event,{type:eventType,isSimulated:true,originalEvent:{}});var result=jQuery.event.dispatch.call(obj,e);return result}$.event.special.doubletap={doubleTapThreshold:500,setup:function(data,namespaces){$(this).bind("touchend",$.event.special.doubletap.handler)},teardown:function(namespaces){$(this).unbind("touchend",$.event.special.doubletap.handler)},handler:function(event){var elem=this;var $elem=$(this);var now=new Date().getTime();var lastTouch=$elem.data("lastTouch")||now+1;var delta=now-lastTouch;var numTouches=event.originalEvent.touches.length;if(numTouches==0){if(delta<$.event.special.doubletap.doubleTapThreshold&&delta>0){$elem.data("lastTouch",null);triggerCustomEvent(elem,"doubletap",event)}else{$elem.data("lastTouch",now)}}else{$elem.data("lastTouch",null)}}};$.event.special.taphold={tapHoldThreshold:750,setup:function(){var thisObject=this,$this=$(thisObject),origTarget=null,timer;var reset=(function(){window.clearTimeout(timer);timer=null;$(document).unbind("touchmove touchend touchcancel",reset)});$this.bind("touchstart",function(event){var end_target=event.target;origTarget=end_target;var onHold=(function(){if(end_target==origTarget){triggerCustomEvent(thisObject,"taphold",event)}timer=null});timer=window.setTimeout(onHold,$.event.special.taphold.tapHoldThreshold);$(document).bind("touchmove touchend touchcancel",reset)})}}})(jQuery);; 
 
//@ sourceURL=/js/jgrowl/jquery.jgrowl_minimized.js 
(function($){$.jGrowl=function(m,o){if($('#jGrowl').size()==0)
$('<div id="jGrowl"></div>').addClass($.jGrowl.defaults.position).appendTo('body');$('#jGrowl').jGrowl(m,o);};$.fn.jGrowl=function(m,o){if($.isFunction(this.each)){var args=arguments;return this.each(function(){var self=this;if($(this).data('jGrowl.instance')==undefined){$(this).data('jGrowl.instance',$.extend(new $.fn.jGrowl(),{notifications:[],element:null,interval:null}));$(this).data('jGrowl.instance').startup(this);}
if($.isFunction($(this).data('jGrowl.instance')[m])){$(this).data('jGrowl.instance')[m].apply($(this).data('jGrowl.instance'),$.makeArray(args).slice(1));}else{$(this).data('jGrowl.instance').create(m,o);}});};};$.extend($.fn.jGrowl.prototype,{defaults:{pool:0,header:'',group:'',sticky:false,position:'top-right',glue:'after',theme:'default',corners:'10px',check:250,life:3000,speed:'normal',easing:'swing',closer:true,closeTemplate:'&times;',closerTemplate:'<div>[ close all ]</div>',log:function(e,m,o){},beforeOpen:function(e,m,o){},open:function(e,m,o){},beforeClose:function(e,m,o){},close:function(e,m,o){},animateOpen:{opacity:'show'},animateClose:{opacity:'hide'}},notifications:[],element:null,interval:null,create:function(message,o){var o=$.extend({},this.defaults,o);this.notifications.push({message:message,options:o});o.log.apply(this.element,[this.element,message,o]);},render:function(notification){var self=this;var message=notification.message;var o=notification.options;var notification=$('<div class="jGrowl-notification ui-state-highlight ui-corner-all'+
((o.group!=undefined&&o.group!='')?' '+o.group:'')+'">'+'<div class="close">'+o.closeTemplate+'</div>'+'<div class="header">'+o.header+'</div>'+'<div class="message">'+message+'</div></div>').data("jGrowl",o).addClass(o.theme).children('div.close').bind("click.jGrowl",function(){$(this).parent().trigger('jGrowl.close');}).parent();$(notification).bind("mouseover.jGrowl",function(){$('div.jGrowl-notification',self.element).data("jGrowl.pause",true);}).bind("mouseout.jGrowl",function(){$('div.jGrowl-notification',self.element).data("jGrowl.pause",false);}).bind('jGrowl.beforeOpen',function(){if(o.beforeOpen.apply(notification,[notification,message,o,self.element])!=false){$(this).trigger('jGrowl.open');}}).bind('jGrowl.open',function(){if(o.open.apply(notification,[notification,message,o,self.element])!=false){if(o.glue=='after'){$('div.jGrowl-notification:last',self.element).after(notification);}else{$('div.jGrowl-notification:first',self.element).before(notification);}
$(this).animate(o.animateOpen,o.speed,o.easing,function(){if($.browser.msie&&(parseInt($(this).css('opacity'),10)===1||parseInt($(this).css('opacity'),10)===0))
this.style.removeAttribute('filter');$(this).data("jGrowl").created=new Date();});}}).bind('jGrowl.beforeClose',function(){if(o.beforeClose.apply(notification,[notification,message,o,self.element])!=false)
$(this).trigger('jGrowl.close');}).bind('jGrowl.close',function(){$(this).data('jGrowl.pause',true);$(this).animate(o.animateClose,o.speed,o.easing,function(){$(this).remove();var close=o.close.apply(notification,[notification,message,o,self.element]);if($.isFunction(close))
close.apply(notification,[notification,message,o,self.element]);});}).trigger('jGrowl.beforeOpen');if($.fn.corner!=undefined)$(notification).corner(o.corners);if($('div.jGrowl-notification:parent',self.element).size()>1&&$('div.jGrowl-closer',self.element).size()==0&&this.defaults.closer!=false){$(this.defaults.closerTemplate).addClass('jGrowl-closer ui-state-highlight ui-corner-all').addClass(this.defaults.theme).appendTo(self.element).animate(this.defaults.animateOpen,this.defaults.speed,this.defaults.easing).bind("click.jGrowl",function(){$(this).siblings().children('div.close').trigger("click.jGrowl");if($.isFunction(self.defaults.closer)){self.defaults.closer.apply($(this).parent()[0],[$(this).parent()[0]]);}});};},update:function(){$(this.element).find('div.jGrowl-notification:parent').each(function(){if($(this).data("jGrowl")!=undefined&&$(this).data("jGrowl").created!=undefined&&($(this).data("jGrowl").created.getTime()+$(this).data("jGrowl").life)<(new Date()).getTime()&&$(this).data("jGrowl").sticky!=true&&($(this).data("jGrowl.pause")==undefined||$(this).data("jGrowl.pause")!=true)){$(this).trigger('jGrowl.beforeClose');}});if(this.notifications.length>0&&(this.defaults.pool==0||$(this.element).find('div.jGrowl-notification:parent').size()<this.defaults.pool))
this.render(this.notifications.shift());if($(this.element).find('div.jGrowl-notification:parent').size()<2){$(this.element).find('div.jGrowl-closer').animate(this.defaults.animateClose,this.defaults.speed,this.defaults.easing,function(){$(this).remove();});}},startup:function(e){this.element=$(e).addClass('jGrowl').append('<div class="jGrowl-notification"></div>');this.interval=setInterval(function(){$(e).data('jGrowl.instance').update();},this.defaults.check);if($.browser.msie&&parseInt($.browser.version)<7&&!window["XMLHttpRequest"]){$(this.element).addClass('ie6');}},shutdown:function(){$(this.element).removeClass('jGrowl').find('div.jGrowl-notification').remove();clearInterval(this.interval);},close:function(){$(this.element).find('div.jGrowl-notification').each(function(){$(this).trigger('jGrowl.beforeClose');});}});$.jGrowl.defaults=$.fn.jGrowl.prototype.defaults;})(jQuery);; 
 
//@ sourceURL=/js/jquery.validate-1.9.0.min.js 
/**
 * jQuery Validation Plugin 1.9.0
 *
 * http://bassistance.de/jquery-plugins/jquery-plugin-validation/
 * http://docs.jquery.com/Plugins/Validation
 *
 * Copyright (c) 2006 - 2011 Jörn Zaefferer
 *
 * Dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
 */
(function(c){c.extend(c.fn,{validate:function(a){if(this.length){var b=c.data(this[0],"validator");if(b)return b;this.attr("novalidate","novalidate");b=new c.validator(a,this[0]);c.data(this[0],"validator",b);if(b.settings.onsubmit){a=this.find("input, button");a.filter(".cancel").click(function(){b.cancelSubmit=true});b.settings.submitHandler&&a.filter(":submit").click(function(){b.submitButton=this});this.submit(function(d){function e(){if(b.settings.submitHandler){if(b.submitButton)var f=c("<input type='hidden'/>").attr("name",
b.submitButton.name).val(b.submitButton.value).appendTo(b.currentForm);b.settings.submitHandler.call(b,b.currentForm);b.submitButton&&f.remove();return false}return true}b.settings.debug&&d.preventDefault();if(b.cancelSubmit){b.cancelSubmit=false;return e()}if(b.form()){if(b.pendingRequest){b.formSubmitted=true;return false}return e()}else{b.focusInvalid();return false}})}return b}else a&&a.debug&&window.console&&console.warn("nothing selected, can't validate, returning nothing")},valid:function(){if(c(this[0]).is("form"))return this.validate().form();
else{var a=true,b=c(this[0].form).validate();this.each(function(){a&=b.element(this)});return a}},removeAttrs:function(a){var b={},d=this;c.each(a.split(/\s/),function(e,f){b[f]=d.attr(f);d.removeAttr(f)});return b},rules:function(a,b){var d=this[0];if(a){var e=c.data(d.form,"validator").settings,f=e.rules,g=c.validator.staticRules(d);switch(a){case "add":c.extend(g,c.validator.normalizeRule(b));f[d.name]=g;if(b.messages)e.messages[d.name]=c.extend(e.messages[d.name],b.messages);break;case "remove":if(!b){delete f[d.name];
return g}var h={};c.each(b.split(/\s/),function(j,i){h[i]=g[i];delete g[i]});return h}}d=c.validator.normalizeRules(c.extend({},c.validator.metadataRules(d),c.validator.classRules(d),c.validator.attributeRules(d),c.validator.staticRules(d)),d);if(d.required){e=d.required;delete d.required;d=c.extend({required:e},d)}return d}});c.extend(c.expr[":"],{blank:function(a){return!c.trim(""+a.value)},filled:function(a){return!!c.trim(""+a.value)},unchecked:function(a){return!a.checked}});c.validator=function(a,
b){this.settings=c.extend(true,{},c.validator.defaults,a);this.currentForm=b;this.init()};c.validator.format=function(a,b){if(arguments.length==1)return function(){var d=c.makeArray(arguments);d.unshift(a);return c.validator.format.apply(this,d)};if(arguments.length>2&&b.constructor!=Array)b=c.makeArray(arguments).slice(1);if(b.constructor!=Array)b=[b];c.each(b,function(d,e){a=a.replace(RegExp("\\{"+d+"\\}","g"),e)});return a};c.extend(c.validator,{defaults:{messages:{},groups:{},rules:{},errorClass:"error",
validClass:"valid",errorElement:"label",focusInvalid:true,errorContainer:c([]),errorLabelContainer:c([]),onsubmit:true,ignore:":hidden",ignoreTitle:false,onfocusin:function(a){this.lastActive=a;if(this.settings.focusCleanup&&!this.blockFocusCleanup){this.settings.unhighlight&&this.settings.unhighlight.call(this,a,this.settings.errorClass,this.settings.validClass);this.addWrapper(this.errorsFor(a)).hide()}},onfocusout:function(a){if(!this.checkable(a)&&(a.name in this.submitted||!this.optional(a)))this.element(a)},
onkeyup:function(a){if(a.name in this.submitted||a==this.lastElement)this.element(a)},onclick:function(a){if(a.name in this.submitted)this.element(a);else a.parentNode.name in this.submitted&&this.element(a.parentNode)},highlight:function(a,b,d){a.type==="radio"?this.findByName(a.name).addClass(b).removeClass(d):c(a).addClass(b).removeClass(d)},unhighlight:function(a,b,d){a.type==="radio"?this.findByName(a.name).removeClass(b).addClass(d):c(a).removeClass(b).addClass(d)}},setDefaults:function(a){c.extend(c.validator.defaults,
a)},messages:{required:"This field is required.",remote:"Please fix this field.",email:"Please enter a valid email address.",url:"Please enter a valid URL.",date:"Please enter a valid date.",dateISO:"Please enter a valid date (ISO).",number:"Please enter a valid number.",digits:"Please enter only digits.",creditcard:"Please enter a valid credit card number.",equalTo:"Please enter the same value again.",accept:"Please enter a value with a valid extension.",maxlength:c.validator.format("Please enter no more than {0} characters."),
minlength:c.validator.format("Please enter at least {0} characters."),rangelength:c.validator.format("Please enter a value between {0} and {1} characters long."),range:c.validator.format("Please enter a value between {0} and {1}."),max:c.validator.format("Please enter a value less than or equal to {0}."),min:c.validator.format("Please enter a value greater than or equal to {0}.")},autoCreateRanges:false,prototype:{init:function(){function a(e){var f=c.data(this[0].form,"validator"),g="on"+e.type.replace(/^validate/,
"");f.settings[g]&&f.settings[g].call(f,this[0],e)}this.labelContainer=c(this.settings.errorLabelContainer);this.errorContext=this.labelContainer.length&&this.labelContainer||c(this.currentForm);this.containers=c(this.settings.errorContainer).add(this.settings.errorLabelContainer);this.submitted={};this.valueCache={};this.pendingRequest=0;this.pending={};this.invalid={};this.reset();var b=this.groups={};c.each(this.settings.groups,function(e,f){c.each(f.split(/\s/),function(g,h){b[h]=e})});var d=
this.settings.rules;c.each(d,function(e,f){d[e]=c.validator.normalizeRule(f)});c(this.currentForm).validateDelegate("[type='text'], [type='password'], [type='file'], select, textarea, [type='number'], [type='search'] ,[type='tel'], [type='url'], [type='email'], [type='datetime'], [type='date'], [type='month'], [type='week'], [type='time'], [type='datetime-local'], [type='range'], [type='color'] ","focusin focusout keyup",a).validateDelegate("[type='radio'], [type='checkbox'], select, option","click",
a);this.settings.invalidHandler&&c(this.currentForm).bind("invalid-form.validate",this.settings.invalidHandler)},form:function(){this.checkForm();c.extend(this.submitted,this.errorMap);this.invalid=c.extend({},this.errorMap);this.valid()||c(this.currentForm).triggerHandler("invalid-form",[this]);this.showErrors();return this.valid()},checkForm:function(){this.prepareForm();for(var a=0,b=this.currentElements=this.elements();b[a];a++)this.check(b[a]);return this.valid()},element:function(a){this.lastElement=
a=this.validationTargetFor(this.clean(a));this.prepareElement(a);this.currentElements=c(a);var b=this.check(a);if(b)delete this.invalid[a.name];else this.invalid[a.name]=true;if(!this.numberOfInvalids())this.toHide=this.toHide.add(this.containers);this.showErrors();return b},showErrors:function(a){if(a){c.extend(this.errorMap,a);this.errorList=[];for(var b in a)this.errorList.push({message:a[b],element:this.findByName(b)[0]});this.successList=c.grep(this.successList,function(d){return!(d.name in a)})}this.settings.showErrors?
this.settings.showErrors.call(this,this.errorMap,this.errorList):this.defaultShowErrors()},resetForm:function(){c.fn.resetForm&&c(this.currentForm).resetForm();this.submitted={};this.lastElement=null;this.prepareForm();this.hideErrors();this.elements().removeClass(this.settings.errorClass)},numberOfInvalids:function(){return this.objectLength(this.invalid)},objectLength:function(a){var b=0,d;for(d in a)b++;return b},hideErrors:function(){this.addWrapper(this.toHide).hide()},valid:function(){return this.size()==
0},size:function(){return this.errorList.length},focusInvalid:function(){if(this.settings.focusInvalid)try{c(this.findLastActive()||this.errorList.length&&this.errorList[0].element||[]).filter(":visible").focus().trigger("focusin")}catch(a){}},findLastActive:function(){var a=this.lastActive;return a&&c.grep(this.errorList,function(b){return b.element.name==a.name}).length==1&&a},elements:function(){var a=this,b={};return c(this.currentForm).find("input, select, textarea").not(":submit, :reset, :image, [disabled]").not(this.settings.ignore).filter(function(){!this.name&&
a.settings.debug&&window.console&&console.error("%o has no name assigned",this);if(this.name in b||!a.objectLength(c(this).rules()))return false;return b[this.name]=true})},clean:function(a){return c(a)[0]},errors:function(){return c(this.settings.errorElement+"."+this.settings.errorClass,this.errorContext)},reset:function(){this.successList=[];this.errorList=[];this.errorMap={};this.toShow=c([]);this.toHide=c([]);this.currentElements=c([])},prepareForm:function(){this.reset();this.toHide=this.errors().add(this.containers)},
prepareElement:function(a){this.reset();this.toHide=this.errorsFor(a)},check:function(a){a=this.validationTargetFor(this.clean(a));var b=c(a).rules(),d=false,e;for(e in b){var f={method:e,parameters:b[e]};try{var g=c.validator.methods[e].call(this,a.value.replace(/\r/g,""),a,f.parameters);if(g=="dependency-mismatch")d=true;else{d=false;if(g=="pending"){this.toHide=this.toHide.not(this.errorsFor(a));return}if(!g){this.formatAndAdd(a,f);return false}}}catch(h){this.settings.debug&&window.console&&console.log("exception occured when checking element "+
a.id+", check the '"+f.method+"' method",h);throw h;}}if(!d){this.objectLength(b)&&this.successList.push(a);return true}},customMetaMessage:function(a,b){if(c.metadata){var d=this.settings.meta?c(a).metadata()[this.settings.meta]:c(a).metadata();return d&&d.messages&&d.messages[b]}},customMessage:function(a,b){var d=this.settings.messages[a];return d&&(d.constructor==String?d:d[b])},findDefined:function(){for(var a=0;a<arguments.length;a++)if(arguments[a]!==undefined)return arguments[a]},defaultMessage:function(a,
b){return this.findDefined(this.customMessage(a.name,b),this.customMetaMessage(a,b),!this.settings.ignoreTitle&&a.title||undefined,c.validator.messages[b],"<strong>Warning: No message defined for "+a.name+"</strong>")},formatAndAdd:function(a,b){var d=this.defaultMessage(a,b.method),e=/\$?\{(\d+)\}/g;if(typeof d=="function")d=d.call(this,b.parameters,a);else if(e.test(d))d=jQuery.format(d.replace(e,"{$1}"),b.parameters);this.errorList.push({message:d,element:a});this.errorMap[a.name]=d;this.submitted[a.name]=
d},addWrapper:function(a){if(this.settings.wrapper)a=a.add(a.parent(this.settings.wrapper));return a},defaultShowErrors:function(){for(var a=0;this.errorList[a];a++){var b=this.errorList[a];this.settings.highlight&&this.settings.highlight.call(this,b.element,this.settings.errorClass,this.settings.validClass);this.showLabel(b.element,b.message)}if(this.errorList.length)this.toShow=this.toShow.add(this.containers);if(this.settings.success)for(a=0;this.successList[a];a++)this.showLabel(this.successList[a]);
if(this.settings.unhighlight){a=0;for(b=this.validElements();b[a];a++)this.settings.unhighlight.call(this,b[a],this.settings.errorClass,this.settings.validClass)}this.toHide=this.toHide.not(this.toShow);this.hideErrors();this.addWrapper(this.toShow).show()},validElements:function(){return this.currentElements.not(this.invalidElements())},invalidElements:function(){return c(this.errorList).map(function(){return this.element})},showLabel:function(a,b){var d=this.errorsFor(a);if(d.length){d.removeClass(this.settings.validClass).addClass(this.settings.errorClass);
d.attr("generated")&&d.html(b)}else{d=c("<"+this.settings.errorElement+"/>").attr({"for":this.idOrName(a),generated:true}).addClass(this.settings.errorClass).html(b||"");if(this.settings.wrapper)d=d.hide().show().wrap("<"+this.settings.wrapper+"/>").parent();this.labelContainer.append(d).length||(this.settings.errorPlacement?this.settings.errorPlacement(d,c(a)):d.insertAfter(a))}if(!b&&this.settings.success){d.text("");typeof this.settings.success=="string"?d.addClass(this.settings.success):this.settings.success(d)}this.toShow=
this.toShow.add(d)},errorsFor:function(a){var b=this.idOrName(a);return this.errors().filter(function(){return c(this).attr("for")==b})},idOrName:function(a){return this.groups[a.name]||(this.checkable(a)?a.name:a.id||a.name)},validationTargetFor:function(a){if(this.checkable(a))a=this.findByName(a.name).not(this.settings.ignore)[0];return a},checkable:function(a){return/radio|checkbox/i.test(a.type)},findByName:function(a){var b=this.currentForm;return c(document.getElementsByName(a)).map(function(d,
e){return e.form==b&&e.name==a&&e||null})},getLength:function(a,b){switch(b.nodeName.toLowerCase()){case "select":return c("option:selected",b).length;case "input":if(this.checkable(b))return this.findByName(b.name).filter(":checked").length}return a.length},depend:function(a,b){return this.dependTypes[typeof a]?this.dependTypes[typeof a](a,b):true},dependTypes:{"boolean":function(a){return a},string:function(a,b){return!!c(a,b.form).length},"function":function(a,b){return a(b)}},optional:function(a){return!c.validator.methods.required.call(this,
c.trim(a.value),a)&&"dependency-mismatch"},startRequest:function(a){if(!this.pending[a.name]){this.pendingRequest++;this.pending[a.name]=true}},stopRequest:function(a,b){this.pendingRequest--;if(this.pendingRequest<0)this.pendingRequest=0;delete this.pending[a.name];if(b&&this.pendingRequest==0&&this.formSubmitted&&this.form()){c(this.currentForm).submit();this.formSubmitted=false}else if(!b&&this.pendingRequest==0&&this.formSubmitted){c(this.currentForm).triggerHandler("invalid-form",[this]);this.formSubmitted=
false}},previousValue:function(a){return c.data(a,"previousValue")||c.data(a,"previousValue",{old:null,valid:true,message:this.defaultMessage(a,"remote")})}},classRuleSettings:{required:{required:true},email:{email:true},url:{url:true},date:{date:true},dateISO:{dateISO:true},dateDE:{dateDE:true},number:{number:true},numberDE:{numberDE:true},digits:{digits:true},creditcard:{creditcard:true}},addClassRules:function(a,b){a.constructor==String?this.classRuleSettings[a]=b:c.extend(this.classRuleSettings,
a)},classRules:function(a){var b={};(a=c(a).attr("class"))&&c.each(a.split(" "),function(){this in c.validator.classRuleSettings&&c.extend(b,c.validator.classRuleSettings[this])});return b},attributeRules:function(a){var b={};a=c(a);for(var d in c.validator.methods){var e;if(e=d==="required"&&typeof c.fn.prop==="function"?a.prop(d):a.attr(d))b[d]=e;else if(a[0].getAttribute("type")===d)b[d]=true}b.maxlength&&/-1|2147483647|524288/.test(b.maxlength)&&delete b.maxlength;return b},metadataRules:function(a){if(!c.metadata)return{};
var b=c.data(a.form,"validator").settings.meta;return b?c(a).metadata()[b]:c(a).metadata()},staticRules:function(a){var b={},d=c.data(a.form,"validator");if(d.settings.rules)b=c.validator.normalizeRule(d.settings.rules[a.name])||{};return b},normalizeRules:function(a,b){c.each(a,function(d,e){if(e===false)delete a[d];else if(e.param||e.depends){var f=true;switch(typeof e.depends){case "string":f=!!c(e.depends,b.form).length;break;case "function":f=e.depends.call(b,b)}if(f)a[d]=e.param!==undefined?
e.param:true;else delete a[d]}});c.each(a,function(d,e){a[d]=c.isFunction(e)?e(b):e});c.each(["minlength","maxlength","min","max"],function(){if(a[this])a[this]=Number(a[this])});c.each(["rangelength","range"],function(){if(a[this])a[this]=[Number(a[this][0]),Number(a[this][1])]});if(c.validator.autoCreateRanges){if(a.min&&a.max){a.range=[a.min,a.max];delete a.min;delete a.max}if(a.minlength&&a.maxlength){a.rangelength=[a.minlength,a.maxlength];delete a.minlength;delete a.maxlength}}a.messages&&delete a.messages;
return a},normalizeRule:function(a){if(typeof a=="string"){var b={};c.each(a.split(/\s/),function(){b[this]=true});a=b}return a},addMethod:function(a,b,d){c.validator.methods[a]=b;c.validator.messages[a]=d!=undefined?d:c.validator.messages[a];b.length<3&&c.validator.addClassRules(a,c.validator.normalizeRule(a))},methods:{required:function(a,b,d){if(!this.depend(d,b))return"dependency-mismatch";switch(b.nodeName.toLowerCase()){case "select":return(a=c(b).val())&&a.length>0;case "input":if(this.checkable(b))return this.getLength(a,
b)>0;default:return c.trim(a).length>0}},remote:function(a,b,d){if(this.optional(b))return"dependency-mismatch";var e=this.previousValue(b);this.settings.messages[b.name]||(this.settings.messages[b.name]={});e.originalMessage=this.settings.messages[b.name].remote;this.settings.messages[b.name].remote=e.message;d=typeof d=="string"&&{url:d}||d;if(this.pending[b.name])return"pending";if(e.old===a)return e.valid;e.old=a;var f=this;this.startRequest(b);var g={};g[b.name]=a;c.ajax(c.extend(true,{url:d,
mode:"abort",port:"validate"+b.name,dataType:"json",data:g,success:function(h){f.settings.messages[b.name].remote=e.originalMessage;var j=h===true;if(j){var i=f.formSubmitted;f.prepareElement(b);f.formSubmitted=i;f.successList.push(b);f.showErrors()}else{i={};h=h||f.defaultMessage(b,"remote");i[b.name]=e.message=c.isFunction(h)?h(a):h;f.showErrors(i)}e.valid=j;f.stopRequest(b,j)}},d));return"pending"},minlength:function(a,b,d){return this.optional(b)||this.getLength(c.trim(a),b)>=d},maxlength:function(a,
b,d){return this.optional(b)||this.getLength(c.trim(a),b)<=d},rangelength:function(a,b,d){a=this.getLength(c.trim(a),b);return this.optional(b)||a>=d[0]&&a<=d[1]},min:function(a,b,d){return this.optional(b)||a>=d},max:function(a,b,d){return this.optional(b)||a<=d},range:function(a,b,d){return this.optional(b)||a>=d[0]&&a<=d[1]},email:function(a,b){return this.optional(b)||/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i.test(a)},
url:function(a,b){return this.optional(b)||/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(a)},
date:function(a,b){return this.optional(b)||!/Invalid|NaN/.test(new Date(a))},dateISO:function(a,b){return this.optional(b)||/^\d{4}[\/-]\d{1,2}[\/-]\d{1,2}$/.test(a)},number:function(a,b){return this.optional(b)||/^-?(?:\d+|\d{1,3}(?:,\d{3})+)(?:\.\d+)?$/.test(a)},digits:function(a,b){return this.optional(b)||/^\d+$/.test(a)},creditcard:function(a,b){if(this.optional(b))return"dependency-mismatch";if(/[^0-9 -]+/.test(a))return false;var d=0,e=0,f=false;a=a.replace(/\D/g,"");for(var g=a.length-1;g>=
0;g--){e=a.charAt(g);e=parseInt(e,10);if(f)if((e*=2)>9)e-=9;d+=e;f=!f}return d%10==0},accept:function(a,b,d){d=typeof d=="string"?d.replace(/,/g,"|"):"png|jpe?g|gif";return this.optional(b)||a.match(RegExp(".("+d+")$","i"))},equalTo:function(a,b,d){d=c(d).unbind(".validate-equalTo").bind("blur.validate-equalTo",function(){c(b).valid()});return a==d.val()}}});c.format=c.validator.format})(jQuery);
(function(c){var a={};if(c.ajaxPrefilter)c.ajaxPrefilter(function(d,e,f){e=d.port;if(d.mode=="abort"){a[e]&&a[e].abort();a[e]=f}});else{var b=c.ajax;c.ajax=function(d){var e=("port"in d?d:c.ajaxSettings).port;if(("mode"in d?d:c.ajaxSettings).mode=="abort"){a[e]&&a[e].abort();return a[e]=b.apply(this,arguments)}return b.apply(this,arguments)}}})(jQuery);
(function(c){!jQuery.event.special.focusin&&!jQuery.event.special.focusout&&document.addEventListener&&c.each({focus:"focusin",blur:"focusout"},function(a,b){function d(e){e=c.event.fix(e);e.type=b;return c.event.handle.call(this,e)}c.event.special[b]={setup:function(){this.addEventListener(a,d,true)},teardown:function(){this.removeEventListener(a,d,true)},handler:function(e){arguments[0]=c.event.fix(e);arguments[0].type=b;return c.event.handle.apply(this,arguments)}}});c.extend(c.fn,{validateDelegate:function(a,
b,d){return this.bind(b,function(e){var f=c(e.target);if(f.is(a))return d.apply(f,arguments)})}})})(jQuery);
; 
 
//@ sourceURL=/js/addUserAutocomplete.js 
var kPageToken="";var kUnselected="x5NULL";function getPageToken(){kPageToken=GetValue("PageToken");if(kPageToken==""){var jax=new jaxreq(gReqAppDBID+"?a=QBI_GetPageToken");jax.DoAsyncCmd(function(){getPageTokenCallback(jax)})}}function getPageTokenCallback(jax){if(jax.success){kPageToken=jax.GetValue("pageToken")}else{if(window.console){console.error("Security problem attempting to add user")}}}function addRoleValidator(){$.validator.addMethod("userHasRole",function(rolevalue,roleelement,unselected){var valid=true;var addrfield=$(".emailAddressInput",$(roleelement).closest("tr").get(0));if(addrfield.length!=0&&addrfield.get(0).value.length!=0){valid=(rolevalue!=unselected)}return valid})}var tokenInputSettings={minChars:1,searchDelay:500,hintText:"Enter email, user name, name, or group name",noResultsText:"No users found.",searchingText:"Searching...",allowNewValues:true,allowDomains:false,classes:{tokenList:"token-input-list-facebook",token:"token-input-token-facebook",tokenName:"token-input-name-facebook",tokenDelete:"token-input-delete-facebook",selectedToken:"token-input-selected-token-facebook",highlightedToken:"token-input-highlighted-token-facebook",dropdown:"token-input-dropdown-facebook",dropdownItem:"token-input-dropdown-item-facebook",dropdownItem2:"token-input-dropdown-item2-facebook",selectedDropdownItem:"token-input-selected-dropdown-item-facebook",inputToken:"token-input-input-token-facebook"}};var addressBookClicked;var usersInCompanyResponse="";this.contacts="";this.groups="";var knowThatContactsIsEmpty=false;var inputLabelHasContacts="Enter emails, names, user names, or groups";var addressBook;var abWaitInterval;var abWaitCounter=0;var abWaitLimit=12;function addressBookClick(event){addressBookClicked=event.currentTarget;if(addressBook===undefined){setABDefaultOpts();var abOpts={selectedUsersEventHandler:addFromAddressBook,cancelledEventHandler:focusOnInput};addressBook=new AddressBook(abOpts)}addressBook.open(addressBookClicked)}var gDialogShareWithNewUser;function initAddUserDialog(){gDialogShareWithNewUser=QB.Dialog.dialog({id:"dialogShareWithNewUser",contents:"#addUserDialog",contentType:"selector",size:"auto",title:"Share With a New User",confirm:{text:"Send",click:function(){userDialogDone(false)}},jqDialogOptions:{autoOpen:false,close:function(event,ui){gDialogShareWithNewUser.find("#addUserHelpLink").remove();addUserCriteriaWidget.reInit()},open:function(event,ui){gDialogShareWithNewUser.siblings(":last").prepend($("#addUserHelpLink"))},maxHeight:false}});$("#addUserSendInvite").click(function(){var checked=$("#addUserSendInvite").prop("checked");$("#sendInviteDetails").toggle(checked);if(checked){gDialogShareWithNewUser.siblings(".ui-dialog-buttonpane").find(".ui-button.Confirm .ui-button-text").text("Send")}else{gDialogShareWithNewUser.siblings(".ui-dialog-buttonpane").find(".ui-button.Confirm .ui-button-text").text("Add")}});$(".addressBookButton").click(function(event){if(!gIsAddressBookAvailable){logMessage("Address book not loaded yet")}else{addressBookClick(event)}});var addUserCriteriaWidgetSettings=[{tableId:"#addUserAutocompleteTable",rowPrefix:"rowa_",reinits:true,maxCriteria:8,insertedEventHandler:function(e,info,index){$(info).find(".emailAddressInput").tokenInput("",tokenInputSettings);$(info).find(".addDialogRoleSelector").rules("add",{userHasRole:kUnselected})},deletedEventHandler:function(e,info,index){$(info).find(".addDialogRoleSelector").rules("remove")},endobj:""}];var addUserCriteriaWidget=new CriteriaWidget(addUserCriteriaWidgetSettings[0],{insertImage:(window.gResDir||"")+"/i/icons/16/add.gif",removeImage:(window.gResDir||"")+"/i/icons/16/cross.png",showOnHover:false,hideDisabled:true,displayInsertButtonsPerLine:false,numberToInsertOnInit:0,highlightInsert:false,highlightDelete:false,endobj:""});$("#addUserNewSectionButton").bind("click",{widget:addUserCriteriaWidget},function(e){e.data.widget.addToEnd();if(defaultAppRoleId!="9"){$(e.data.widget.criteriaSetDom).find("select.addDialogRoleSelector:last").val(defaultAppRoleId)}return false});addRoleValidator();addUserRoleValidator=$("#addUserForm").validate({errorClass:"validationErrorNoMargin",onkeyup:false,onfocusout:false,onkeyup:false,onclick:false,highlight:function(element,errorClass){$(element).addClass(errorClass)},unhighlight:function(element,errorClass){$(element).removeClass(errorClass)},errorPlacement:function(error,element){return}});var errorDialogSettings={autoOpen:false,buttons:{OK:function(){$(this).dialog("close")}},modal:true,resizable:false};$("#addUserEmptyDialog").dialog(errorDialogSettings);$("#invalidUsersDialog").dialog(errorDialogSettings);$("#tooManyItemsToAddDialog").dialog(errorDialogSettings)}function addFromAddressBook(selectedUsers,target){var field=$(".emailAddressInput",$(target).closest("tr").get(0));if(field.length==1){var tl=$(field[0]).data("tokenlist");for(i=0;i<selectedUsers.length;i++){tl.append(selectedUsers[i].id,selectedUsers[i].name,selectedUsers[i].display)}}addRoleValidator()}function focusOnInput(target){$(target).parent().next().find("ul > li > input").focus()}var contactsTimer=0;var contactsInterval;var gOverrideEmail=false;function openAddUserAutocomplete(){if(defaultAppRoleId!="9"){$("select.addDialogRoleSelector").val(defaultAppRoleId)}if(gOverrideEmail){$("#addUserSendInvite").off()}if(gReqUserDelayVerify){showVerificationRequiredDialog("Share");return}if(!gIsAddressBookAvailable){GetAddressBookBody()}getPageToken();$("#addUserValidRoles").hide();gDialogShareWithNewUser.dialog("open");$("#addUserSendInvite").attr("defaultChecked","true");$("#addUserSendInvite").prop("checked",true);gDialogShareWithNewUser.siblings(".ui-dialog-buttonpane").find(".ui-button.Confirm .ui-button-text").text(gOverrideEmail?"Add":"Send");$("#sendInviteDetails").toggle(!gOverrideEmail);$("#addUserDialog .emailAddressInput").tokenInput("",tokenInputSettings);addRoleValidator();$(".addDialogRoleSelector").rules("add",{userHasRole:kUnselected});if(contacts.length>0){$("#addUserInputLabel").text(inputLabelHasContacts)}else{if(!knowThatContactsIsEmpty){contactsInterval=setInterval(checkContactsAndSetLabel,500)}}$.TokenList.tokenCounter("reset")}function checkContactsAndSetLabel(){if(contacts.length>0){$(".contactsInputLabel").text(inputLabelHasContacts);clearInterval(contactsInterval)}else{if(contactsTimer==12){knowThatContactsIsEmpty=true;clearInterval(contactsInterval)}else{contactsTimer++}}}function userDialogDone(eoiConfirmed){if($.TokenList.tokenCounter()==0){$("#addUserEmptyDialog").dialog("open");return}if($.TokenList.tokenCounter()>kMaxTokenCount){$("#tooManyItemsToAddDialog").dialog("open");return}if(!$("#addUserForm .addDialogRoleSelector").valid()){$("#addUserValidRoles").show();return}else{$("#addUserValidRoles").hide()}if(checkForInvalid()){return}if(isAddingEOI()&&!eoiConfirmed){doEOIConfirm();return}addUserDoneAutocomplete();gDialogShareWithNewUser.dialog("close")}function checkForInvalid(){if($("#addUserDialog .invalid-token").size()>0){$("#invalidUsersDialog").dialog("open");return true}else{return false}}function isAddingEOI(){var found=false;var eoi=kGIDEveryone+kDelimA+kACGroup;$("#addUserDialog .emailAddressInput").each(function(indexInArray,valueOfElement){if($.inArray(eoi,$(valueOfElement).val().split(","))!=-1){found=true}});return found}function doEOIConfirm(){var roles="";var eoi=kGIDEveryone+kDelimA+kACGroup;var confirmText="";if(gEveryoneMsg==""){confirmText=kEveryoneDefault}else{$("#addUserDialog .emailAddressInput").each(function(indexInArray,valueOfElement){if($.inArray(eoi,$(valueOfElement).val().split(","))!=-1){if(roles!=""){roles+=", "+roleinfo[$(valueOfElement).parents(":eq(0)").siblings(":eq(1)").children("select").val()]}else{roles+=roleinfo[$(valueOfElement).parents(":eq(0)").siblings(":eq(1)").children("select").val()]}}});var msg=gEveryoneMsg.replace(/%role%/,"'"+roles+"'");confirmText=msg}QB.Dialog.confirm({title:"Confirm",contents:"<div><p>"+confirmText+"</p></div>",contentType:"html",size:"medium",id:"confirmInviteDialog",cancel:{click:function(){$.TokenList.tokenCounter("reset");$(this).dialog("close")}},confirm:{text:"OK",click:function(){$(this).dialog("close");userDialogDone(true)}}})}function addUserDoneAutocomplete(){var existingUserInfo="";$("#addUserDialog .emailAddressInput").each(function(indexInArray,valueOfElement){var currentRole=$(valueOfElement).parents(":eq(0)").siblings(":eq(1)").children("select").val();var emailInput=$(valueOfElement).val();emailInput=emailInput.split(",");for(i=0;i<emailInput.length;i++){var tokenInfo=emailInput[i].split(kDelimA);if(tokenInfo.length==2){if(existingUserInfo==""){existingUserInfo+=emailInput[i]+kDelimA+currentRole}else{existingUserInfo+=kDelimA+emailInput[i]+kDelimA+currentRole}}else{if(tokenInfo.length==1&&tokenInfo[0]!=""){var type;if(LooksLikeEmailDomain(tokenInfo[0])){type=kACDomgroup}else{type=kACUser}if(existingUserInfo==""){existingUserInfo+=tokenInfo[0]+kDelimA+type+kDelimA+currentRole}else{existingUserInfo+=kDelimA+tokenInfo[0]+kDelimA+type+kDelimA+currentRole}}else{}}}});addToApp(existingUserInfo,$("#addUserSendInvite").prop("checked"),$("#sendInviteMessage").val())}function addToApp(exisitingUserInfo,doInvite,inviteMsg,callback){if(exisitingUserInfo==""){return}addTrusteesToApp(exisitingUserInfo,doInvite,inviteMsg,callback)}function addTrusteesToApp(newTrusteeInfo,doInvite,inviteMsg,callback){var jax=new jaxreq(gReqAppDBID+"?a=QBI_ShareFullAdd");jax.AddValue("PageToken",kPageToken);jax.AddValue("newTrustees",newTrusteeInfo);jax.AddValue("doInvite",doInvite&&!gOverrideEmail);jax.AddValue("usertext",inviteMsg);jax.DoSyncCmd();if(jax.success){if(typeof doAddInDisplay=="function"){doAddInDisplay(jax.GetValue("newInfo"))}$.jGrowl(jax.GetValue("confmsg"),{theme:"jGrowl-green"});QBTrackPageView("/Prod/AddUserToApp");if($.isFunction(callback)){callback.call()}}else{doErrorDialog(jax.errdetails)}};; 
 
//@ sourceURL=/js/criteriaWidget.js 
(function(){var _context=this;_context.dumpElt=function(ind,elt){var indent="    ";var newline="\n";var html=elt.innerHTML.substring(0,20);var outids=function(ind,elt){return ind+". id="+elt.id+" name="+elt.name+" - "+html+newline};var msg="";msg+=outids(ind,elt);return msg};_context.dumpElts=function(list){var indent="    ";var newline="\n";var msglist="";list.each(function(ind,elt){msglist+=_context.dumpElt(ind,elt)});return msglist+newline};var empty="";var defaultCriteria={tableId:undefined,rowPrefix:"criteriaRow_",maxCriteria:100,newCriterionLine:function(def,idnum){return($("<input> item "+idnum))},clsCriteriaSet:"criteria",reinits:false,clsCriterion:"criterion",endobj:empty};$.expr[":"].rowHidden=function(obj){return($(obj).css("display")=="none")};var defaultCriteriaOptions={positionButtonsAtEnd:true,preWrapped:false,displayInsertButtonsPerLine:true,displayDeleteButtonsPerLine:true,advancedModeEnabled:false,advancedModeMaxDepth:3,showOnHover:true,hideDisabled:false,insertNewAfter:true,fadeOpacity:0.05,greyOpacity:0.45,fadeSpeed:600,numberToInsertOnInit:0,clsCriteriaSet:"criteria",clsCriterion:"criterion",newColor:"#D1EFD1",removeColor:"#FBBBB9",insertImage:(window.gResDir||"")+"/i/icons/16/add.gif",removeImage:(window.gResDir||"")+"/i/icons/16/delete.gif",critGroupAddImage:(window.gResDir||"")+"/i/icons/16/critgroup_add.png",critGroupRemoveImage:(window.gResDir||"")+"/i/icons/16/critgroup_remove.png",highlightInsert:true,highlightDelete:true,endobj:empty,showParens:false};var evtListChanged="criteriaListChanged";var evtInserted="criteriaInserted";var evtPreDeleted="criteriaPreDeleted";var evtReadyToDelete="criteriaReadyToDelete";var evtDeleted="criteriaDeleted";var evtMoved="criteriaMoved";var clsDeleteBtn="deleteCriterion";var clsInsertBtn="insertCriterion";var clsGroupAddBtn="addCritGroup";var clsGroupRemoveBtn="removeFromCritGroup";var clsCritBtn="criteriaButton";var clsCritBtnCell="buttonCell";var clsCritData="critData";function jcls(classname){return("."+classname)}var cnumstart='<td class="criterionnum';var cnumend='">s!!!criterionnum!!!e</td>';var criterionnumvis=cnumstart+cnumend;var criterionnumnonvis=cnumstart+" nodisplay"+cnumend;var criterionnumcell=criterionnumnonvis;var insButton=' <img class="insertCriterion criteriaButton" alt="ins"  title="Insert after this" src="s!!!insertImage!!!e" />';var deleteButton='  <img class="deleteCriterion criteriaButton" alt="del"  title="Delete this" src="s!!!removeImage!!!e" />';var txtCritGroupAddEnabled="Add this to a new set of criteria";var txtCritGroupAddDisabledPre="Can't add a new set here; a maximum of ";var txtCritGroupAddDisabledPost=" levels is allowed.";var txtCritGroupAddDisabled=function(nLevels){return txtCritGroupAddDisabledPre+nLevels+txtCritGroupAddDisabledPost};var txtConfirmDeleteCritGroupMessage="Are you sure you want to delete this entire set of filters?";var critGroupAddButton='  <img class="addCritGroup advancedModeOnly criteriaButton" alt="group"  title="Add this to a new set of criteria" src="s!!!critGroupAddImage!!!e" />';var critGroupRemoveButton='  <img class="removeFromCritGroup advancedModeOnly criteriaButton" alt="ungroup"  title="Move this up to its parent set" src="s!!!critGroupRemoveImage!!!e" />';_context.CriteriaWidget=function(criteriaDesc,options){try{this.def=getOptions(defaultCriteria,criteriaDesc);this.opts=getOptions(defaultCriteriaOptions,options);var allvars=(window.pm.getUrlVars());var maxc=allvars.maxcriteria;if(typeof maxc!="undefined"){try{var maxi=parseInt(maxc,10);if(maxi>=1){this.def.maxCriteria=maxi}}catch(e){errorMessage("CriteriaWidget maxvars parameter error"+e)}}if(typeof allvars.shownums!="undefined"){criterionnumcell=criterionnumvis}if(typeof window[this.def.maxCriteriaVar]!="undefined"){this.origMax=window[this.def.maxCriteriaVar];window[this.def.maxCriteriaVar]=this.def.maxCriteria;if(typeof window[this.def.visvar]!="undefined"){window[this.def.visvar]=Math.min(parseInt(window[this.def.maxCriteriaVar],10),parseInt(window[this.def.visvar],10))}}this.list=[];this.blank=null;this.backupCriteriaSet=null;this.init();if(this.opts.showParens){$(".advGroups").removeClass("nodisplay")}if(this.opts.advancedModeEnabled){this.initCritGroupsFromMInfo()}}catch(e){errorMessage("CriteriaWidget constructor error"+e)}};_context.CriteriaWidget.defaultCriteriaOptions=defaultCriteriaOptions;_context.CriteriaWidget.defaultCriteria=defaultCriteria;_context.CriteriaWidget.prototype={setNumber:function(obj,member,number){var omat=obj[member].match(/(.*_)([0-9]+)/);var oldidnum="";if(omat&&omat.length==3){oldidnum=omat[2];obj[member]=omat[1]+number}return oldidnum},setOnclick:function(obj,member,number){var oldmethod=obj.getAttribute("onclick").toString();if(oldmethod.indexOf("function")==0){oldmethod=oldmethod.replace(new RegExp("\n","g"),"");oldmethod=oldmethod.slice(oldmethod.indexOf("{")+1,oldmethod.lastIndexOf("}"))}var omat=oldmethod.match(/(.*_)([0-9]+)(.*$)/);if(omat.length==4){var js=(omat[1]+number+omat[3]);var newclick=new Function("event",js);$(obj).get(0).onclick=newclick}return oldidnum},numberRows:function(){var rows=$("[id*="+this.def.rowPrefix+"]",this.$criteriaSet.get());var self=this;var len=rows.length;if(len){for(i=0;i<len;i++){this.numberARow(i,rows[i])}}},numberARow:function(indx,obj){var self=this;oldidnum=self.setNumber(obj,"id",indx);if(typeof obj.name!="undefined"){oldidnum=self.setNumber(obj,"name",indx)}$(jcls("criterionnum"),obj).text(indx+1+".");var subitems=$("[id*=_]",obj);subitems.each((function(newnum){var newrownum=newnum;return function(bdx,subobj){self.setNumber(subobj,"id",newrownum)}})(indx));try{subitems=$("[name*=_]",obj);subitems.each((function(newnum){var newrownum=newnum;return function(bdx,subobj){self.setNumber(subobj,"name",newrownum)}})(indx))}catch(e){}try{subitems=$("[onclick*=_]",obj);subitems.each((function(newnum){var newrownum=newnum;return function(bdx,subobj){self.setOnclick(subobj,"onclick",newrownum)}})(indx))}catch(e){}},dumpRows:function(){var indent="    ";var newline="\n";var outchild=function(elt){return indent+$(elt).find(".RelDatePreview")[0].innerHTML+newline};var outids=function(ind,elt){return ind+". "+elt.id+newline+outchild(elt)};var msg="";var rows=$("[id*="+this.def.rowPrefix+"]",this.$criteriaSet.get());rows.each(function(ind,elt){msg+=outids(ind,elt)});return msg+newline+newline},getIndex:function(elt){return($.inArray(elt[0],this.list))},numVis:function(){return this.list.not(":rowHidden").length},canInsertToList:function(elt){var indx=this.getIndex(elt);if(this.list.not(":rowHidden").length<this.def.maxCriteria){return indx}return null},canRemoveFromList:function(elt){var indx=this.getIndex(elt);var vis=this.list.not(":rowHidden");if(indx!=-1&&vis.length>=1&&indx<vis.length){return indx}return null},disableWidget:function(elt,opts){var opts=opts||this.opts;elt.prop("disabled",true);elt.addClass("disabled");elt.css("opacity",this.opts.greyOpacity);if(opts.hideDisabled){elt.addClass("novisibility")}},enableWidget:function(elt,opts){var opts=opts||this.opts;elt.removeAttr("disabled");elt.removeClass("disabled");elt.css("opacity",1);if(opts.hideDisabled){elt.removeClass("novisibility")}},setWidgetEnabled:function(elt,isEnabled,opts){var opts=opts||this.opts;if(isEnabled){this.enableWidget(elt,opts)}else{this.disableWidget(elt,opts)}},isWidgetEnabled:function(elt){return !(elt.prop("disabled")||false)},highlightElement:function(elt,chgto){if(this.opts.highlightInsert){var originalBG=elt.css("background-color");elt.effect("highlight",{color:chgto,opacity:1,endobj:empty},this.opts.fadeSpeed);elt.css("backgroundColor",originalBG)}},highlightToDeleteElement:function(e){var toDelete=e.delinfo.toDelete;var originalBG=toDelete.css("background-color");var widget=this;if(!this.opts.advancedModeEnabled&&this.opts.highlightDelete){var fadeColor=this.opts.removeColor;toDelete.effect("highlight",{color:fadeColor,opacity:this.opts.fadeOpacity,mode:"hide",endobj:empty},this.opts.fadeSpeed,(function(widget,delinfo){var self=widget;return function(){self.$criteriaSet.trigger({type:evtReadyToDelete,delinfo:delinfo,endobj:null})}})(this,e.delinfo))}else{this.$criteriaSet.trigger({type:evtReadyToDelete,delinfo:e.delinfo,endobj:null})}},enableDisable:function(initial){var critElt=this.criteriaSet;if(!critElt.length){return}var firsttime=initial||false;var items=firsttime?$(jcls(this.def.clsCriterion),$(critElt.get(0))):$(jcls(this.def.clsCriterion),$(critElt.get(0))).not(":rowHidden");var itemslen=items.length;var toshow=firsttime?window[this.def.visvar]||itemslen:itemslen;var atMax=(toshow>=this.def.maxCriteria);if(items.length==0){return}if(items&&toshow==1){if(!this.opts.advancedModeEnabled){this.disableWidget($(jcls(clsDeleteBtn),items[0]),this.opts)}}else{for(var i=0;i<itemslen;i++){this.enableWidget($(jcls(clsDeleteBtn),items[i]),this.opts);if(atMax){this.disableWidget($(jcls(clsInsertBtn),items[i]),this.opts)}else{this.enableWidget($(jcls(clsInsertBtn),items[i]),this.opts)}}}},getDataElement:function(rowElt){return($(jcls(clsCritData),rowElt))},setupListeners:function(){var bindcontext={widget:this,endobj:empty};this.$criteriaSet.bind(evtListChanged,bindcontext,function(e){var me=e.data.widget;me.enableDisable(e.initialize);me.numberRows()});if(this.def.listChangedEventHandler){this.$criteriaSet.bind(evtListChanged,bindcontext,this.def.listChangedEventHandler)}this.$criteriaSet.bind(evtMoved,bindcontext,function(e){var me=e.data.widget;me.numberRows()});if(this.def.movedEventHandler){this.$criteriaSet.bind(evtMoved,bindcontext,this.def.movedEventHandler)}this.$criteriaSet.bind(evtInserted,bindcontext,function(e){if(e.animate){e.data.widget.highlightElement(e.newInfo,e.insertColor)}});if(this.def.insertedEventHandler){this.$criteriaSet.bind(evtInserted,bindcontext,function(e){e.data.widget.def.insertedEventHandler(e,e.newInfo,e.newindex)})}this.$criteriaSet.bind(evtPreDeleted,bindcontext,function(e){e.data.widget.highlightToDeleteElement(e)});this.$criteriaSet.bind(evtReadyToDelete,bindcontext,function(e){e.data.widget.readyToDeleteCriterion(e)});if(this.def.deletedEventHandler){this.$criteriaSet.bind(evtDeleted,bindcontext,function(e){e.data.widget.def.deletedEventHandler(e)})}this.$criteriaSet.delegate(jcls(clsCritBtn),"click",bindcontext,function(e){var self=e.data.widget;var targ=$(this);var continuebubble=true;if(targ.hasClass(clsDeleteBtn)){$(jcls(self.def.clsCriterion),self.criteriaSetDom).stop(false,true);if(self.isWidgetEnabled(targ)){self.deleteCriterion(targ)}return false}else{if(targ.hasClass(clsInsertBtn)){$(jcls(self.def.clsCriterion),self.criteriaSetDom).stop(false,true);if(self.isWidgetEnabled(targ)){self.insertCriterion(targ,true)}return false}else{if(targ.hasClass(clsGroupAddBtn)){$(jcls(self.def.clsCriterion),self.criteriaSetDom).stop(false,true);if(self.isWidgetEnabled(targ)){self.insertCritGroup(targ)}return false}else{if(targ.hasClass(clsGroupRemoveBtn)){$(jcls(self.def.clsCriterion),self.criteriaSetDom).stop(false,true);if(self.isWidgetEnabled(targ)){self.moveCritOutOfParent(targ)}return false}}}}return continuebubble})},bindGroupAndOrEvents:function(groupHeader){var anyAllBox=groupHeader.find(".anyAllBox");var self=this;anyAllBox.change(function(e){self.anyAllChanged(anyAllBox);if(typeof viewType!="undefined"&&viewType=="chart"){var isPie=document.editform.cformat.selectedIndex==charttype.pie;LegendTableChange(isPie?"categories":"series")}})},bindGroupIconEvents:function(groupIconsCell){var bindcontext={widget:this,endobj:empty};groupIconsCell.bind("click",bindcontext,function(e){var self=e.data.widget;var targ=$(e.target);var continuebubble=true;if(targ.hasClass(clsDeleteBtn)){$(jcls(self.def.clsCriterion),self.criteriaSetDom).stop(false,true);var group=self.getParentGroupHeader(targ);var outer=group.next(".critGroupOuter");var parent=self.getParentGroupHeader(group);var wasFirstInGroup=group.hasClass("firstInGroup");doDeleteGroup=function(){self.deleteCritGroup(group);if(wasFirstInGroup){self.updateFirstInGroup(parent)}};group.addClass("confirmDeleteHighlight");outer.addClass("confirmDeleteHighlight");clearHighlight=function(){group.removeClass("confirmDeleteHighlight");outer.removeClass("confirmDeleteHighlight")};$("<div><p class='confirmMessage'>"+txtConfirmDeleteCritGroupMessage+"</p></div>").dialog({modal:true,resizable:false,title:"Delete entire set?",buttons:{Cancel:function(){$(this).dialog("close")},Delete:function(){$(this).dialog("close");doDeleteGroup()}},beforeclose:function(){clearHighlight()}});return false}else{if(targ.hasClass(clsInsertBtn)){$(jcls(self.def.clsCriterion),self.criteriaSetDom).stop(false,true);if(self.isWidgetEnabled(targ)){self.insertCritAfterGroup(self.getParentGroupHeader(targ))}return false}else{if(targ.hasClass(clsGroupAddBtn)){$(jcls(self.def.clsCriterion),self.criteriaSetDom).stop(false,true);return false}}}return continuebubble})},initAllInvis:function(widget){$($(jcls(clsCritBtn),widget.criteriaSetDom),widget.$criteriaSet).addClass("novisibility")},initOneHover:function(item,widget){$(item).data(clsCritBtnCell,$(item).find(jcls(clsCritBtnCell)+" "+jcls(clsCritBtn)));$($(item).data(clsCritBtnCell)).addClass("novisibility");$(item).mouseover(function(){$(this).data(clsCritBtnCell).removeClass("novisibility");$(this).addClass("critRowHover");if($(this).hasClass("critGroupHeader")){$(this).next(".critGroupOuter").addClass("critRowHover")}}).mouseout(function(){$(this).data(clsCritBtnCell).addClass("novisibility");$(this).removeClass("critRowHover");if($(this).hasClass("critGroupHeader")){$(this).next(".critGroupOuter").removeClass("critRowHover")}})},initAllHover:function(){var context=this;$("tr"+jcls(this.def.clsCriterion),context.criteriaSetDom).each(function(inx,item){context.initOneHover(item,context)});this.initAllInvis(this)},addToEnd:function(){var critElt=this.criteriaSet;if(!critElt.length){return}var items=$(this.list).not(":rowHidden");this.insertCriterion($(items[items.length-1]))},insertCriterion:function(targ,animate){if(typeof animate=="undefined"){animate=(IsIE()?false:true)}var insertAfterNode=targ.closest(jcls(this.def.clsCriterion));var listindx=this.canInsertToList(insertAfterNode);if(listindx==null){return null}var isFirstInGroup=this.isCritFirstInGroup(listindx);var isLastInGroup=this.isCritLastInGroup(listindx);var defaultnew=$($(this.blank).clone(true));var origbk=defaultnew.css("background-color");var newInfo;if(this.opts.insertNewAfter){newInfo=defaultnew.insertAfter(insertAfterNode)}else{newInfo=defaultnew.insertBefore(insertAfterNode);if(insertAfterNode.hasClass("firstInGroup")){insertAfterNode.removeClass("firstInGroup");newInfo.addClass("firstInGroup")}}newInfo.hide();var arr=jQuery.makeArray(this.list);var oldindx=(this.opts.insertNewAfter)?listindx:listindx-1;var newindx=(this.opts.insertNewAfter)?listindx+1:listindx;arr.splice(newindx,0,newInfo.get(0));this.list=$(arr);if(this.opts.showOnHover){this.initOneHover(newInfo,this)}this.updateAndOrText(newInfo);this.updateIndentingAllowed(newInfo);this.$criteriaSet.trigger({type:evtListChanged,criteriaSet:this.$criteriaSet,endobj:empty});if(this.opts.advancedModeEnabled&&!this.opts.insertNewAfter&&isFirstInGroup){var oldGb=$("#groupsBefore_"+oldindx);var newGb=$("#groupsBefore_"+newindx);newGb.val(oldGb.val());oldGb.val("")}if(this.opts.advancedModeEnabled&&this.opts.insertNewAfter&&isLastInGroup){var oldGa=$("#groupsAfter_"+oldindx);var newGa=$("#groupsAfter_"+newindx);newGa.val(oldGa.val());oldGa.val("")}newInfo.show();this.$criteriaSet.trigger({type:evtInserted,criteriaSet:this.$criteriaSet,newindex:newindx,insertColor:this.opts.newColor,newInfo:newInfo,endobj:empty,animate:animate});return newInfo},isCritFirstInGroup:function(rnum){return($("#groupsBefore_"+rnum).val()||"").length>0},isFirstItemInGroup:function(critOrGroup){if(critOrGroup.hasClass("critGroupOuter")){critOrGroup=critOrGroup.prev(".critGroupHeader")}return critOrGroup.prevAll(".criterion,.critGroupHeader").length==0},isCritLastInGroup:function(rnum){return($("#groupsAfter_"+rnum).val()||"").length>0},getParentGroup:function(critOrGroup){return critOrGroup.parent().closest(".critGroup,.criteriaSet")},getParentGroups:function(critOrGroup,filter){var filter=filter||".critGroup,.criteriaSet";return critOrGroup.parents(filter)},getParentGroupHeader:function(critOrGroup){var group=critOrGroup.parent().closest(".critGroupHeader,.critGroupOuter");if(group.hasClass("critGroupOuter")){group=group.prev(".critGroupHeader")}return group},getGroupChildren:function(group,filter){var filter=filter||".critGroupHeader,.criterion";if(group.hasClass("critGroupHeader")){group=group.next(".critGroupOuter")}var ctrElt=group.find("table.critGroup").first().children("tbody");return ctrElt.children(filter)},isIndentButtonEnabled:function(critOrGroup){if(critOrGroup.length>1){var anyItemDisabled=false;for(var i=0;i<critOrGroup.length;i++){if(!this.isIndentButtonEnabled($(critOrGroup.get(i)))){continue}anyItemDisabled=true;break}return anyItemDisabled}if(critOrGroup.hasClass("critGroupOuter")){critOrGroup=critOrGroup.prev(".critGroupHeader")}return this.isWidgetEnabled(critOrGroup.find(".addCritGroup"))},updateIndentingAllowed:function(elt,recursive){var self=this;var recursive=recursive||"none";var somethingChanged=false;if(elt.hasClass("criterion")){var indentable=this.getParentGroups(elt,".critGroup").length<this.opts.advancedModeMaxDepth;var btnAddGroup=elt.find(".addCritGroup");var isEnabled=this.isWidgetEnabled(btnAddGroup);if(indentable!=isEnabled){this.setWidgetEnabled(btnAddGroup,indentable);somethingChanged=true;if(indentable){btnAddGroup.attr("title",txtCritGroupAddEnabled)}else{btnAddGroup.attr("title",txtCritGroupAddDisabled(this.opts.advancedModeMaxDepth))}}}else{var groupHeader=[];var groupOuter=[];if(elt.hasClass("critGroupOuter")){groupOuter=elt;groupHeader=group.prev(".critGroupHeader")}else{groupHeader=elt;groupOuter=elt.next(".critGroupOuter")}if(groupHeader.length==0||groupOuter.length==0){return}if(recursive=="down"||recursive=="down-then-up"){this.getGroupChildren(groupOuter).each(function(i,e){self.updateIndentingAllowed($(e),"down")})}var indentable=groupOuter.find(".addCritGroup[disabled]").length==0;var btnAddGroup=groupHeader.find(".addCritGroup");var isEnabled=this.isWidgetEnabled(btnAddGroup);if(indentable!=isEnabled){this.setWidgetEnabled(btnAddGroup,indentable);somethingChanged=true;if(indentable){btnAddGroup.attr("title",txtCritGroupAddEnabled)}else{btnAddGroup.attr("title",txtCritGroupAddDisabled(this.opts.advancedModeMaxDepth))}}}if(somethingChanged&&(recursive=="up"||recursive=="down-then-up")&&!elt.hasClass("topLevel")){var parent=this.getParentGroupHeader(elt);this.updateIndentingAllowed(parent,"up")}},anyAllChanged:function(anyAllBox){var andOr=anyAllBox.val()=="all"?"and":"or";var anyAll=anyAllBox.val()=="all"?"ALL(":"ANY(";var group=this.getParentGroupHeader(anyAllBox);var groupOuter=group.next(".critGroupOuter");var children=this.getGroupChildren(group);children.find(".andOrText").text(andOr);var firstCrit=groupOuter.find("tr.criterion").first();if(firstCrit.length==0){return null}var rowNum=this.getIndex(firstCrit);if(rowNum==null){return null}var gB=$("#groupsBefore_"+rowNum);var values=gB.val().split(",");var numLevelsDown=this.getParentGroups(firstCrit).index(this.getParentGroup(group));if(numLevelsDown<0||numLevelsDown>values.length){return null}values[values.length-numLevelsDown]=anyAll;gB.val(values.join(","))},deleteCritGroup:function(group,isSubCall){var isSubCall=isSubCall||false;var groupHeader=null;var groupOuter=null;if(group.hasClass("critGroupHeader")){groupHeader=group;groupOuter=group.next(".critGroupOuter")}else{return null}var groupIsOnlyChild=groupHeader.siblings(".critGroupHeader,.criterion").not(":rowHidden").length==0;if(groupIsOnlyChild&&!isSubCall){var parent=this.getParentGroupHeader(groupHeader);if(!parent.hasClass("topLevel")){return this.deleteCritGroup(parent,false)}}var subgroups=this.getGroupChildren(groupOuter,".critGroupHeader");for(var i=0;i<subgroups.length;i++){this.deleteCritGroup($(subgroups[i]),true)}if(groupIsOnlyChild){this.insertCritAfterGroup(groupHeader)}var crits=this.getGroupChildren(groupOuter,".criterion");var firstIndex=this.getIndex(crits.first());if(firstIndex!=null){var gB=$("#groupsBefore_"+firstIndex);var oldV=gB.val();if(oldV==null){oldV=""}var lastComma=oldV.lastIndexOf(",");if(lastComma<0){lastComma=0}gB.val(oldV.substring(0,lastComma))}var lastIndex=this.getIndex(crits.last());if(lastIndex!=null){var gA=$("#groupsAfter_"+lastIndex);var oldV=gA.val();if(oldV.length>0){gA.val(oldV.substring(1))}}for(var i=0;i<crits.length;i++){this.deleteCriterion($(crits[i]),true)}var parent=this.getParentGroupHeader(groupOuter);groupOuter.remove();groupHeader.remove();if(!isSubCall){this.updateFirstInGroup(parent);this.updateIndentingAllowed(parent,"up")}},insertCritAfterGroup:function(group){if(group.hasClass("critGroupHeader")){group=group.next(".critGroupOuter")}var lastCrit=group.find(".criterion").last();if(lastCrit.length==0){return null}var oldIndex=this.canInsertToList(lastCrit);if(oldIndex==null){return null}var newCrit=this.insertCriterion(lastCrit,false);var newIndex=this.getIndex(newCrit);var isLast=newCrit.next(".critGroupHeader,.critGroupOuter,.criterion").length==0;var oldGa=$("#groupsAfter_"+oldIndex);var newGa=$("#groupsAfter_"+newIndex);var numParensToLeaveBehind=newGa.val().length;if(isLast){var numParensToLeaveBehind=this.getParentGroups(newCrit).index(this.getParentGroup(group))}if(numParensToLeaveBehind>newGa.val().length){numParensToLeaveBehind=newGa.val().length}newCrit.detach().insertAfter(group);oldGa.val(newGa.val().substring(0,numParensToLeaveBehind));newGa.val(newGa.val().substring(numParensToLeaveBehind));this.updateAndOrText(newCrit);this.updateIndentingAllowed(newCrit)},updateAndOrText:function(critOrGroup){if(critOrGroup.hasClass("critGroupOuter")){critOrGroup=critOrGroup.prev(".critGroupHeader")}var parent=this.getParentGroupHeader(critOrGroup);var anyAll=parent.find(".anyAllBox").val()=="all"?"and":"or";critOrGroup.find(".andOrText").text(anyAll)},updateFirstInGroup:function(group){var children=this.getGroupChildren(group);children.removeClass("firstInGroup").removeClass("firstInGroupHeader");var first=children.not(":rowHidden").first().addClass("firstInGroup");if(first.hasClass("critGroupHeader")){first.addClass("firstInGroupHeader")}},insertCritGroup:function(targ,includeSecondCrit,forceAnyAll){if(!targ||targ.length==0){return}var forceAnyAll=forceAnyAll||null;if(typeof includeSecondCrit=="undefined"){includeSecondCrit=(targ.length==1)}var nodesToConsume=[];if(targ.length==1){nodesToConsume=targ.closest(jcls(this.def.clsCriterion))}else{nodesToConsume=targ}var parent=this.getParentGroupHeader(nodesToConsume.first());var oppositeAnyAll=parent.find(".anyAllBox").val()=="all"?"any":"all";var visibleNodesToConsume=nodesToConsume.not(":rowHidden");var firstCrit=visibleNodesToConsume.first();var listindx=this.getIndex(visibleNodesToConsume.first());var lastindx=this.getIndex(visibleNodesToConsume.last());if(listindx==null||lastindx==null){return null}var buttons=this.getButtons(this.opts);var groupHeader=$('<tr class="critGroupHeader"><td><span class="andOrText">and</span> <select class="anyAllBox"><option value="all">all</option><option value="any">any</option></select> of these conditions are true</td>'+buttons+"</tr>");var group=$('<tr class="critGroupOuter"><td class="subGroup" colspan="2"><table class="indenter" width="100%" cellpadding="0" cellspacing="0"><tbody><tr><td class="spLeft"><img src="/i/clear2x2.gif"/></td><td class="spCenter"><table cellpadding="0" cellspacing="0" class="critGroup"><tbody></tbody></table></td><td class="spRight"><img src="/i/clear2x2.gif"/></td></tr></tbody></table></td></tr>');var table=group.find(".critGroup");groupHeader.insertAfter(nodesToConsume.first());group.insertAfter(groupHeader);this.initOneHover(groupHeader,this);this.bindGroupIconEvents(groupHeader.find(".buttonCell"));this.bindGroupAndOrEvents(groupHeader);var gb=nodesToConsume.find("#groupsBefore_"+listindx).first();var txt=gb.val()||"";gb.val(txt.length>0?txt+",ANY(":"ANY(");var ga=nodesToConsume.find("#groupsAfter_"+lastindx).first();ga.val(")"+(ga.val()||""));table.children("tbody").first().append(nodesToConsume.detach());if(this.isFirstItemInGroup(groupHeader)){groupHeader.addClass("firstInGroup").addClass("firstInGroupHeader")}nodesToConsume.removeClass("firstInGroup");visibleNodesToConsume.first().addClass("firstInGroup");this.updateAndOrText(groupHeader);groupHeader.find(".anyAllBox").val(forceAnyAll||oppositeAnyAll).change();if(includeSecondCrit){this.insertCriterion(visibleNodesToConsume.last(),false)}this.updateIndentingAllowed(groupHeader,"down-then-up");return groupHeader},moveCritOutOfParent:function(targ){if(!targ||targ.length!=1){return null}var critToMove=targ.closest(jcls(this.def.clsCriterion));var oldIndex=this.getIndex(critToMove);if(oldIndex==null){return null}var groupToMoveOutOf=this.getParentGroupHeader(critToMove);var kids=this.getGroupChildren(groupToMoveOutOf);var isFirstInGroup=this.isCritFirstInGroup(oldIndex);var isLastInGroup=this.isCritLastInGroup(oldIndex);var isOnlyOneInGroup=isFirstInGroup&&isLastInGroup;var movedLastInGroup=isOnlyOneInGroup;if(isOnlyOneInGroup){var newCrit=this.insertCriterion(critToMove,false);if(newCrit==null){return null}this.updateIndentingAllowed(newCrit);newCrit.addClass("firstInGroup");var isFirstInGroup=this.isCritFirstInGroup(oldIndex);var isLastInGroup=this.isCritLastInGroup(oldIndex);var isOnlyOneInGroup=isFirstInGroup&&isLastInGroup}var movedGB=$("#groupsBefore_"+oldIndex);var movedGA=$("#groupsAfter_"+oldIndex);var prevIndex=oldIndex-1;var nextIndex=oldIndex+1;if(isLastInGroup&&!isFirstInGroup){var prevGA=$("#groupsAfter_"+prevIndex);prevGA.val(prevGA.val()+movedGA.val())}else{if(!isLastInGroup&&isFirstInGroup){var nextRow=$("#critRow_"+nextIndex);nextRow.addClass("firstInGroup");var nextGB=$("#groupsBefore_"+nextIndex);var insertComma=nextGB.val().length>0&&movedGB.val().length>0;nextGB.val(movedGB.val()+(insertComma?",":"")+nextGB.val())}}movedGB.val("");movedGA.val("");critToMove.detach().insertBefore(groupToMoveOutOf);critToMove.removeClass("firstInGroup").removeClass("critRowHover");critToMove.find(".criteriaButton").addClass("novisibility");this.updateIndentingAllowed(critToMove);if(groupToMoveOutOf.hasClass("firstInGroup")||groupToMoveOutOf.hasClass("firstInGroupHeader")){groupToMoveOutOf.removeClass("firstInGroup").removeClass("firstInGroupHeader");critToMove.addClass("firstInGroup")}this.updateAndOrText(critToMove);this.updateAndOrText(groupToMoveOutOf);var firstCrit=groupToMoveOutOf.next(".critGroupOuter").find(".criterion").first();var newIndex=this.getIndex(firstCrit);if(newIndex!=null){var gB=$("#groupsBefore_"+newIndex);var nLeftBehind=this.getParentGroups(firstCrit).index(this.getParentGroup(critToMove));var oldV=gB.val().split(",");if(nLeftBehind>oldV.length){nLeftBehind=oldV.length}if(nLeftBehind<0){nLeftBehind=0}var leaveBehind;if(nLeftBehind==oldV.length){leaveBehind=oldV;oldV=[]}else{if(nLeftBehind==0){leaveBehind=[]}else{leaveBehind=oldV.splice(oldV.length-nLeftBehind,nLeftBehind)}}gB.val(leaveBehind.join(","));movedGB.val(oldV.join(","))}if(isFirstInGroup){newIndex=oldIndex}if(newIndex!=oldIndex){var arr=jQuery.makeArray(this.list);ArrayMoveItem(arr,oldIndex,newIndex);this.list=$(arr);this.$criteriaSet.trigger({type:evtMoved,criteriaSet:this.$criteriaSet,oldIndex:oldIndex,newIndex:newIndex,endobj:empty})}if(this.isCritFirstInGroup(critToMove)){critToMove.addClass("firstInGroup")}if(movedLastInGroup){this.deleteCritGroup(groupToMoveOutOf)}},deleteCriterion:function(toDelete,allowDeleteOnlyInGroup){var allowDeleteOnlyInGroup=allowDeleteOnlyInGroup||false;toDelete=toDelete.closest(jcls(this.def.clsCriterion));var listindx=this.canRemoveFromList(toDelete);var deletedOnlyOneInGroup=false;if(this.opts.advancedModeEnabled){var isFirstInGroup=this.isCritFirstInGroup(listindx);var isLastInGroup=this.isCritLastInGroup(listindx);var isOnlyOneInGroup=isFirstInGroup&&isLastInGroup;if(isOnlyOneInGroup){deletedOnlyOneInGroup=true}if(isOnlyOneInGroup&&!allowDeleteOnlyInGroup){var newCrit=this.insertCriterion(toDelete,false);this.updateIndentingAllowed(newCrit);newCrit.addClass("firstInGroup");isFirstInGroup=this.isCritFirstInGroup(listindx);isLastInGroup=this.isCritLastInGroup(listindx);isOnlyOneInGroup=isFirstInGroup&&isLastInGroup;if(isOnlyOneInGroup){listindx=null}}}if(listindx==null){return false}if(this.opts.advancedModeEnabled){var delGB=$("#groupsBefore_"+listindx).val()||"";var delGA=$("#groupsAfter_"+listindx).val()||"";var prevIndex=listindx-1;var nextIndex=listindx+1;if(isLastInGroup&&!isFirstInGroup){var prevGA=$("#groupsAfter_"+prevIndex);prevGA.val(prevGA.val()+delGA)}else{if(!isLastInGroup&&isFirstInGroup){var nextGB=$("#groupsBefore_"+nextIndex);if(nextGB!=null){var insertComma=nextGB.val().length>0&&delGB.length>0;nextGB.val(delGB+(insertComma?",":"")+nextGB.val())}}}}this.$criteriaSet.trigger({type:evtPreDeleted,delinfo:{toDelete:toDelete,listindx:listindx,isFirstInGroup:isFirstInGroup,isLastInGroup:isLastInGroup,isOnlyOneInGroup:isOnlyOneInGroup,deletedOnlyOneInGroup:deletedOnlyOneInGroup},criteriaSet:this.$criteriaSet,endobj:empty});this.$criteriaSet.trigger({type:evtListChanged,criteriaSet:this.$criteriaSet,endobj:empty});return false},readyToDeleteCriterion:function(e){var arr=jQuery.makeArray(this.list);var removed=arr.splice(e.delinfo.listindx,1);this.list=$(arr);var deletedOnlyOneInGroup=e.delinfo.deletedOnlyOneInGroup||false;var toDelete$=$(e.delinfo.toDelete);var parent=this.getParentGroupHeader(toDelete$);toDelete$.remove();if(this.opts.advancedModeEnabled){this.updateFirstInGroup(parent)}this.$criteriaSet.trigger({type:evtListChanged,criteriaSet:this.$criteriaSet,endobj:empty});this.$criteriaSet.trigger({type:evtDeleted,criteriaSet:this.$criteriaSet,delindex:e.delinfo.listindx,endobj:empty});if(this.opts.advancedModeEnabled&&deletedOnlyOneInGroup){this.deleteCritGroup(parent,false)}},createNewCriterion:function(){var idnum=this.nextId++;var thtml='<tr><td id="'+this.def.rowPrefix+idnum+'" class='+this.def.clsCriterion+">"+this.def.newCriterionLine(this.def,idnum)+"</td></tr>";return($(thtml))},createNewSet:function(){var xhtml="<table class="+this.def.clsCriteriaSet+' border="0" cellspacing="0"></table>';$(xhtml).append(this.createNewCriterion());return($(xhtml))},getButtons:function(opt){var opt=opt||null;if(opt==null){opt=this.opts}var buttons=(opt.displayInsertButtonsPerLine?insButton:"")+(opt.displayDeleteButtonsPerLine?deleteButton:"")+(opt.advancedModeEnabled?(critGroupRemoveButton+critGroupAddButton):"");buttons=buttons.replace(/s!!!insertImage!!!e/g,opt.insertImage).replace(/s!!!removeImage!!!e/g,opt.removeImage).replace(/s!!!critGroupAddImage!!!e/g,opt.critGroupAddImage).replace(/s!!!critGroupRemoveImage!!!e/g,opt.critGroupRemoveImage);var wrapcls=opt.advancedModeEnabled?" nowrap":"";return'<td class="buttonCell'+wrapcls+'">'+buttons+" </td>"},makeWidget:function(criteriaRowElement,idxparam,opt){var newhtml=this.getButtons(opt);var card=1;var re=$(criteriaRowElement);re.each(function(){var criterionnum=criterionnumcell;criterionnum=criterionnum.replace(/s!!!criterionnum!!!e/g,(card++)+".");var _$this=$(this);if(!opt.preWrapped){_$this.children().wrapAll('<td><table cellspacing="2" cellpadding="0"><tr class="origwrapper"></tr></table></td>')}_$this.prepend(criterionnum);if(opt.positionButtonsAtEnd){_$this.append(newhtml)}else{_$this.prepend(newhtml)}});re.addClass(opt.clsCriterion)},initCriteriaSet:function(def){if(!this.def.criteriaSet){if(this.def.tableId){this.def.criteriaSet=$(this.def.tableId)}else{this.def.criteriaSet=[]}}if(this.def.criteriaSet.length==0){this.criteriaSet=this.createNewSet()}else{this.criteriaSet=this.def.criteriaSet}this.$criteriaSet=$(this.criteriaSet);this.criteriaSetDom=this.$criteriaSet.get(0);if(this.opts.advancedModeEnabled){this.$criteriaSet.removeClass("SimpleMode").addClass("AdvancedMode")}},initList:function(){this.$criteriaSet.addClass("criteriaSet");this.$criteriaSet.attr("cellspacing","0");this.$criteriaSet.data("context",this);return($("[id^="+this.def.rowPrefix+"]",this.criteriaSet))},initNewItem:function(){if(this.list.length&&this.blank==null){var itemForBlank=null;var hid=($("[id^="+this.def.rowPrefix+"]:rowHidden",this.criteriaSet));if(hid.length){itemForBlank=hid[hid.length-1]}else{itemForBlank=this.list[0]}this.blank=$(itemForBlank).clone(true);this.numberARow(999999,this.blank[0]);this.blank.show();this.makeWidget(this.blank,"",this.opts)}},reInit:function(){this.list=null;$(this.criteriaSet[0]).replaceWith($(this.backupCriteriaSet.clone(true)));this.def.criteriaSet=null;this.init()},extractMInfoStructure:function(){if(!Array.tag){Array.prototype.tag=null}var structure=[];var stack=[structure];for(var i=0;i<mi.length;i++){if(mi[i]==null||mi[i].isEmpty()){continue}var opens=mi[i].groupsBefore.split(",");if(mi[i].groupsBefore.length==0){opens=[]}for(var j=0;j<opens.length;j++){var group=[];group.tag=opens[j];stack[stack.length-1].push(group);stack.push(group)}stack[stack.length-1].push(i);var nCloses=mi[i].groupsAfter.length;for(var j=0;j<nCloses;j++){var popped=stack.pop()}}return structure},initCritGroupsFromMInfo:function(){if(!this.opts.advancedModeEnabled){return}$("input.advGroups",this.criteriaSetDom).each(function(i,e){$(e).val("")});var structure=this.extractMInfoStructure();if(structure.length==1&&structure[0] instanceof Array){structure=structure[0]}if(structure.tag==null){structure.tag="ALL("}var groupHeader=null;if(structure.length==0){groupHeader=this.insertCritGroup(this.list,false,"all")}else{groupHeader=this.recursivelyPushIntoGroups(structure)}var groupOuter=groupHeader.next(".critGroupOuter");var table=groupOuter.find(".critGroup").first();groupHeader.addClass("topLevelHeader").addClass("topLevel");groupOuter.addClass("topLevelOuter").addClass("topLevel");table.addClass("topLevelGroup").addClass("topLevel")},getCriteriaFromList:function(criteriaNumbers){if(criteriaNumbers instanceof Array){var rtn=[];for(var i=0;i<criteriaNumbers.length;i++){rtn.push(this.list[criteriaNumbers[i]])}return rtn}else{return this.list[criteriaNumbers]}},recursivelyPushIntoGroups:function(group){var elemIndices=ArrayFlatten(group);var critRows=$(this.getCriteriaFromList(elemIndices));var groupType=group.tag=="ANY("?"any":"all";var groupElem=this.insertCritGroup(critRows,false,groupType);for(var i=0;i<group.length;i++){if(!(group[i] instanceof Array)){continue}this.recursivelyPushIntoGroups(group[i])}return groupElem},backupInitialState:function(){if(this.backupCriteriaSet==null&&this.def.reinits){this.backupCriteriaSet=$(this.criteriaSet).clone(true)}},init:function(){this.initCriteriaSet(this.def);this.backupInitialState();this.list=this.initList();this.initNewItem();this.list.each((function(widget){return function(index,item){widget.makeWidget(item,index,widget.opts)}})(this));if(this.opts.showOnHover){this.initAllHover()}this.setupListeners();this.nextId=this.list.length;if(this.list.length){this.$criteriaSet.trigger({type:evtListChanged,initialize:true,criteriaSet:this.$criteriaSet,endobj:empty})}var initCount;if((initCount=parseInt(this.opts.numberToInsertOnInit,10))!=NaN&&initCount>0){var oldopt=this.opts.highlightInsert;this.opts.highlightInsert=false;for(var i=0;i<initCount;i++){this.addToEnd()}this.opts.highlightInsert=oldopt}},endobj:empty}}());; 
 
//@ sourceURL=/js/jquery.tokeninput.js 
/*
 * jQuery Plugin: Tokenizing Autocomplete Text Entry
 * Version 1.2
 *
 * Copyright (c) 2010 Intuit
 * Copyright (c) 2009 James Smith (http://loopj.com)
 * Licensed jointly under the GPL and MIT licenses,
 * choose which one suits your project best!
 *
 */

var token_list;

(function($) {

var defaultTokenInputSettings = {
    url: "",
    hintText: "Type in a search term",
    noResultsText: "No results",
    searchingText: "Searching...",
    searchDelay: 100,
    allowNewValues: false,
    prePopulateFromInput: false,
    minChars: 1,
    tokenLimit: null,
    jsonContainer: null,
    method: "GET",
    contentType: "json",
    queryParam: "q",
    onResult: null,
    backspaceTimeout : 0,
    searchTimeout : 0,
    allowDomains : false,
    maxHeight : 100,
    maxNumSuggestions: 16, //max number of suggestions in list
    autoFocus: true
};

$.fn.tokenInput = function (url, options) {
    options = options || {};
    options.url = url;
    var settings = $.extend({}, defaultTokenInputSettings, options);

    settings.classes = $.extend({
        tokenList: "token-input-list",
        token: "token-input-token",
        tokenName: "token-input-name",
        tokenDelete: "token-input-delete",
        selectedToken: "token-input-selected-token",
        highlightedToken: "token-input-highlighted-token",
        dropdown: "token-input-dropdown",
        dropdownItem: "token-input-dropdown-item",
        dropdownItem2: "token-input-dropdown-item2",
        selectedDropdownItem: "token-input-selected-dropdown-item",
        inputToken: "token-input-input-token"
    }, options.classes);

    return this.each(function () {
        var list = new $.TokenList(this, settings);
        $(this).data("tokenlist", list);
    });
   
};

$.fn.tokenInput.defaults = defaultTokenInputSettings;

$.TokenList = function (input, settings) {
    
    //get searchable trustees
    loadTrustees();

    //
    // Variables
    //

    // Input box position "enum"
    var POSITION = {
        BEFORE: 0,
        AFTER: 1,
        END: 2
    };

    // Keys "enum"
    var KEY = {
        z: 86,
        BACKSPACE: 8,
        TAB: 9,
        RETURN: 13,
        ESC: 27,
        LEFT: 37,
        UP: 38,
        RIGHT: 39,
        DOWN: 40,
        COMMA: 188, 
        SEMICOLONFF: 59,
        SEMICOLONIE: 186
    };

    // Save the tokens
    var saved_tokens = [];

    // Keep track of the number of tokens in the list
    var token_count = 0;

    // Basic cache to save on db hits
    var cache = new $.TokenList.Cache();

    // Keep track of the timeout
    var timeout;

    // Create a new text input an attach keyup events
    var input_box = $("<input type=\"text\">")
        .click(function (event) {
            //set focus when the input is clicked
            $(this).focus();
        })
        .css({
            outline: "none"
        })
        /*.focus(function () {
            if (settings.tokenLimit == null || settings.tokenLimit != token_count) {
                show_dropdown_hint();
            }
        })*/
        .blur(function () {

            //KLUDGE[gjcourt : 2010_2_24]
            /* until browsers support the "onpaste" event
               crap like this will be necessary. */
            handlePaste();
           
            //eventually, this if statement will be removed because
            //of the addition of a tooltip, removing the idea of an
            //invalid token ~gjcourt 2010_2_16
            if(IsRFC822ValidEmail($(this).val()) || (settings.allowDomains && LooksLikeEmailDomain($(this).val()))) {
                create_new_token(); 
            }
            
            hide_dropdown();
        })
        .keyup(function (event) {
            $(this).css('width', $(this).val().length + 'em');
        })
        .keydown(function (event) {



            var previous_token;
            var next_token;

            switch(event.keyCode) {
                case KEY.LEFT:
                case KEY.RIGHT:
                    hide_dropdown();
                case KEY.UP:
                case KEY.DOWN:
                    if(!$(this).val()) {

                        previous_token = input_token.prev();
                        next_token = input_token.next();

                        if((previous_token.length && previous_token.get(0) === selected_token) || (next_token.length && next_token.get(0) === selected_token)) {
                            // Check if there is a previous/next token and it is selected
                            if(event.keyCode == KEY.LEFT || event.keyCode == KEY.UP) {
                                deselect_token($(selected_token), POSITION.BEFORE);
                            } else {
                                deselect_token($(selected_token), POSITION.AFTER);
                            }
                        } else if((event.keyCode == KEY.LEFT || event.keyCode == KEY.UP) && previous_token.length) {
                            // We are moving left, select the previous token if it exists
                            select_token($(previous_token.get(0)));
                        } else if((event.keyCode == KEY.RIGHT || event.keyCode == KEY.DOWN) && next_token.length) {
                            // We are moving right, select the next token if it exists
                            select_token($(next_token.get(0)));
                        }

                    } else {

                        /*
                        //need a reliable way to test caret position in order to get this to work properly
                        //Using another jQuery plugin, we can reliably get the selection start position
                        //and therefore figure out if we can move the toekn over or not
                        console.log($(this).getSelection().start + ' : ' + $(this).getSelection().end);
                        if(event.keyCode == KEY.LEFT && $(this).getSelection().start == 0 && $(this).getSelection().length == 0 && input_token.prev().length) {
                            select_token(input_token.prev());
                        } 
                        if(event.keyCode == KEY.RIGHT && $(this).getSelection().start == $(this).val().length && input_token.next().length) {
                            select_token(input_token.next());
                        }
                        */

                        if (event.keyCode == KEY.UP) {
                            select_dropdown_item($(selected_dropdown_item).prev());
                            break;
                        } 
                        
                        //handle down
                        if (event.keyCode == KEY.DOWN) {
                            if (selected_dropdown_item) {
                                select_dropdown_item($(selected_dropdown_item).next());
                            } else {
                                clearTimeout(settings.searchTimeout);
                                settings.searchTimeout = setTimeout(function(){do_search(false);}, 5);
                            }
                        }

                    }
                    break;

                case KEY.BACKSPACE:
                    previous_token = input_token.prev();

                    if(!$(this).val().length) {
                        clearTimeout(settings.backspaceTimeout);
                        hide_dropdown(); //hide any search results currently being shown
                        if(selected_token) {
                            delete_token($(selected_token));
                        } else if(previous_token.length) {
                            select_token($(previous_token.get(0)));
                        }
                        return false;
                    } else if($(this).val().length <= settings.minChars) {
                        clearTimeout(settings.backspaceTimeout);
                        hide_dropdown();
                    } else {
                        // set a timeout just long enough to let this function finish.
                        clearTimeout(settings.backspaceTimeout);
                        settings.backspaceTimeout = setTimeout(function(){do_search(false);}, settings.searchDelay);
                    }
                    break;

                case KEY.TAB:
                case KEY.RETURN:
                case KEY.COMMA:
                case KEY.SEMICOLONFF:
                case KEY.SEMICOLONIE:
                    // make sure shift key isn't depressed
                    if (!event.shiftKey) {

                        //add the user from selected dropdown item
                        if(selected_dropdown_item) {
                            var li_data = $.data($(selected_dropdown_item).get(0), "tokeninput");
                            add_token(li_data.id, li_data.name, li_data.display);
                            return false;
                        }
                        //try copy/paste   
                        else if (handlePaste()) {
                            return false;
                        //add a new user from their email
                        } else if(settings.allowNewValues) {
                            create_new_token();
                            return false;
                        }


                    }
                    break;

                case KEY.ESC:
                  hide_dropdown();
                  return true;
                
                //handle ctrl + z
                case KEY.z: 
                    if (event.ctrlKey) {
                        handlePaste();
                    }
                    break;

                default:
                    if(is_printable_character(event.keyCode)) {
                      // set a timeout just long enough to let this function finish.
                      //do_search(false);
                      clearTimeout(settings.searchTimeout);
                      settings.searchTimeout = setTimeout(function(){do_search(false);}, 5);
                    }
                    break;
            }
        });


    // Keep a reference to the original input box
    var hidden_input = $(input)
                           .hide()
                           .focus(function () {
                               input_box.focus();
                           })
                           .blur(function () {
                               input_box.blur();
                           });

    // Keep a reference to the selected token and dropdown item
    var selected_token = null;
    var selected_dropdown_item = null;

    // The list to store the token items in
    token_list = $("<ul />")
        .css('width', hidden_input.width())
        .addClass(settings.classes.tokenList)
        .insertAfter(hidden_input)
        .click(function (event) {
            $(this).find('input').focus();
        })
        .mouseover(function (event) {
            var li = get_element_from_event(event, "li");
            if(li && selected_token !== this) {
                li.addClass(settings.classes.highlightedToken);
            }
        })
        .mouseout(function (event) {
            var li = get_element_from_event(event, "li");
            if(li && selected_token !== this) {
                li.removeClass(settings.classes.highlightedToken);
            }
        });


    // The list to store the dropdown items in
    var dropdown = $("<div>")
        .addClass(settings.classes.dropdown)
        .insertAfter(token_list)
        .hide();

    // The token holding the input box
    var input_token = $("<li />")
        .addClass(settings.classes.inputToken)
        .appendTo(token_list)
        .append(input_box);

    init_list();

    if (settings.autoFocus)
    {
        //put focus into input box
        $(input_box).focus();
    }

    //
    // Functions
    //


    // Pre-populate list if items exist
    function init_list () {
        li_data = settings.prePopulate;
        if(li_data && li_data.length) {
            for(var i in li_data) {
                var this_token = $("<li><p>"+li_data[i].name+"</p> </li>")
                    .addClass(settings.classes.token)
                    .insertBefore(input_token);

                $("<span>x</span>")
                    .addClass(settings.classes.tokenDelete)
                    .appendTo(this_token)
                    .click(function () {
                        delete_token($(this).parent());
                        return false;
                    });

                $.data(this_token.get(0), "tokeninput", {"id": li_data[i].id, "name": li_data[i].name});

                // Clear input box and make sure it keeps focus
                input_box
                    .val("")
                    .focus();

                // Don't show the help dropdown, they've got the idea
                hide_dropdown();

                // Save this token id
                var id_string = li_data[i].id + ",";
                hidden_input.val(hidden_input.val() + id_string);
            }
        } else if(settings.prePopulateFromInput) {
          var values = hidden_input.val().split(',');
          hidden_input.val('');

          $.each(values, function() {
            var value = $.trim(this);
            if(value.length > 0) add_token(value, value, value);
          });
        } else {
          hidden_input.val('');
        }
    }

    function is_printable_character(keycode) {
        if((keycode >= 48 && keycode <= 90) ||      // 0-1a-z
           (keycode >= 96 && keycode <= 111) ||     // numpad 0-9 + - / * .
           (keycode >= 186 && keycode <= 192) ||    // ; = , - . / ^
           (keycode >= 219 && keycode <= 222)       // ( \ ) '
          ) {
              return true;
          } else {
              return false;
          }
    }

    // Get an element of a particular type from an event (click/mouseover etc)
    function get_element_from_event (event, element_type) {
        var target = $(event.target);
        var element = null;

        if(target.is(element_type)) {
            element = target;
        } else if(target.parent(element_type).length) {
            element = target.parent(element_type+":first");
        }

        return element;
    }

    // Inner function to a token to the list
    function insert_token(id, value, display, isBadToken) {

        var this_token = $("<li />")
            .addClass(settings.classes.token)
            .insertBefore(input_token)
            .mousedown(function () {
                //prevent user from selecting token text
                return false;
            });

        var wrapper = $('<div class="wrapper"><span class="' + settings.classes.tokenName + '">' + display + '</span></div>')
            .appendTo(this_token);
      
        if (isBadToken) {
            $(this_token).children('div').addClass('invalid-token')
                .dblclick(function(){edit_token(this_token);})
                .attr("title", "You did not enter a valid email address.  Double-click to edit.");
        }

        // The 'delete token' button
        //$("<span>&nbsp;x&nbsp;</span>")
        $("<span>x</span>")
            .addClass(settings.classes.tokenDelete)
            .appendTo(wrapper)
            .click(function () {
                    delete_token($(this).parent().parent());
                    return false;
            });

        /*%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%*/
        /*
            HACK[gjcourt : 2010_2_3] The following positioning code is a hack
            to get IE to wrap our tokens correctly. It is not very
            expensive, and should be unobtrusive to all other browsers
            (considering that they render the correct <li> width from
            the start). 

           */
        //get the padding from the token
        var paddingWidth = 2 * parseInt(wrapper.css('padding'));
        //get padding form the close span
        if (paddingWidth) {
            paddingWidth += 1 * parseInt(wrapper.children('span:nth-child(2)').css('padding-left')); 
        }
        //get the li margin
        var marginWidth = parseInt(2 * parseInt(wrapper.css('margin')));
        //set the token-width
        var token_width = (paddingWidth ? paddingWidth : 0) + (marginWidth ? marginWidth : 0) + wrapper.width();
        this_token.css('width', token_width);
        
        //another hack for IE6 max height
        if (IsIE() && _IEversion == 6)
            {
            if ($(token_list).height() > settings.maxHeight)
                $(token_list).css("height", settings.maxHeight);
            }
        /*%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%*/

        $.data(this_token.get(0), "tokeninput", {"id": id, "name": value});

        return this_token;
    }

    // Add a token to the token list based on user input
    function add_token (id, name, display, isBadToken) {

        //sanity check against total token amount
        $.TokenList.tokenCounter(true); //increment the token counter
        if ($.TokenList.checkTokenCount()) {

            //build the error message
            tooManyUsers();

            //halt adding aditional tokens
            return;

        }

        var this_token = insert_token(id, name, display, isBadToken);

        // Clear input box and make sure it keeps focus
        input_box
            .val("")
            .focus();

        // Don't show the help dropdown, they've got the idea
        hide_dropdown();

        // Save this token id
        var id_string = id + ",";
        hidden_input.val(hidden_input.val() + id_string);
        
        token_count++;
        
        if(settings.tokenLimit != null && settings.tokenLimit >= token_count) {
            input_box.hide();
            hide_dropdown();
        }
    }
    
    function create_new_token() {
        var s = (arguments[0] && arguments[0].constructor == String) ? arguments[0] : input_box.val().toLowerCase();
        s = s.replace(/^\s+|\s+$/g,''); //trim whitespace
        sHTML = HTMLEncode(s); //guard against XSS attacks
        //want to use the HTMLEncoded version for the token but NOT for the validation (will invalidate email addresses with & and ')
        //QBE005135 - also use the unecoded version for the id so that user is not created in SQL with an encoded email address
        if(s.length > 0) {
            add_token(s, sHTML, sHTML, !(IsRFC822ValidEmail(s) || (settings.allowDomains && LooksLikeEmailDomain(s))));
        }
    }

    function create_new_token_bulk(lst) {

        //check token limit
        if ($.TokenList.checkTokenCount(lst.length)) {

            //build the error message
            tooManyUsers();
            //reset input

            $(input_box).val('');

            //halt adding aditional tokens
            return;

        }

        //bulk add
        for (var i = 0; i < lst.length; ++i) {
            //QBE005465 - Fixing due to duplicate tokens created when empty string wasn't handled
            if(lst[i].length > 0) {
                create_new_token(lst[i]);
            }
        }

    }

    // Select a token in the token list
    function select_token (token) {

        var div = token.children(':first-child');

        div.addClass(settings.classes.selectedToken);

        selected_token = token.get(0);

        // Hide input box
        input_box.val("");

        // Hide dropdown if it is visible (eg if we clicked to select token)
        hide_dropdown();
    }
    
    function edit_token (token)
        {
        var text = token.children('div').children(':first-child').text();
        input_box.val(text);
        input_box.css('width', text.length + 'em');
        input_box.focus();
        //delete the token and data
        // Remove the id from the saved list
        var token_data = $.data(token.get(0), "tokeninput");

        // Delete the token
        token.remove();
        selected_token = null;

        // Delete this token's id from hidden input
        var str = hidden_input.val();
        var start = str.indexOf(token_data.id+",");
        var end = str.indexOf(",", start) + 1;

        if(end >= str.length) {
            hidden_input.val(str.slice(0, start));
        } else {
            hidden_input.val(str.slice(0, start) + str.slice(end, str.length));
        }

        token_count--;
        }
        
    // Deselect a token in the token list
    function deselect_token (token, position) {
        token.children(':first-child').removeClass(settings.classes.selectedToken);
        selected_token = null;

        if(position == POSITION.BEFORE) {
            input_token.insertBefore(token);
        } else if(position == POSITION.AFTER) {
            input_token.insertAfter(token);
        } else {
            input_token.appendTo(token_list);
        }

        // Show the input box and give it focus again
        input_box.focus();
    }

    // Toggle selection of a token in the token list
    function toggle_select_token (token) {
        if(selected_token == token.get(0)) {
            deselect_token(token, POSITION.END);
        } else {
            if(selected_token) {
                deselect_token($(selected_token), POSITION.END);
            }
            select_token(token);
        }
    }

    // Delete a token from the token list
    function delete_token (token) {
        // Remove the id from the saved list
        var token_data = $.data(token.get(0), "tokeninput");

        // Delete the token
        token.remove();
        $.TokenList.tokenCounter(false); //increment the token counter
        selected_token = null;

        // Show the input box and give it focus again
        input_box.focus();

        // Delete this token's id from hidden input
        var str = hidden_input.val();
        var start = str.indexOf(token_data.id+",");
        var end = str.indexOf(",", start) + 1;

        if(end >= str.length) {
            hidden_input.val(str.slice(0, start));
        } else {
            hidden_input.val(str.slice(0, start) + str.slice(end, str.length));
        }

        token_count--;

        if (settings.tokenLimit != null) {
            input_box
                .show()
                .val("")
                .focus();
        }
    }

    // Hide and clear the results dropdown
    function hide_dropdown () {
        dropdown.hide().empty();
        selected_dropdown_item = null;
    }

    function show_dropdown_searching () {
      if(settings.searchingText.length > 0) {
          dropdown
              .html("<p>"+settings.searchingText+"</p>")
              .show();
      }
    }

    function show_dropdown_hint () {
        dropdown
            .html("<p>"+settings.hintText+"</p>")
            .show();
    }

    // Highlight the query part of the search term
  function highlight_term(value, term) {
    return value.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)(" + term + ")(?![^<>]*>)(?![^&;]+;)", "gi"), "<b>$1</b>");
  }

  this.append = function(id, name, display){
      add_token(id,name,display);
  };
    
    // Populate the results dropdown with some results
    function populate_dropdown(query, results) {
        if(results.length) {
            dropdown.empty();
            var dropdown_ul = $("<ul>")
                .mouseover(function (event) {
                    select_dropdown_item(get_element_from_event(event, "li"));
                })
                .mousedown(function (event) {
                    // Stop user selecting text on query results
                    return false;
                })
                .appendTo(dropdown)
                .hide();

            for(var i in results) {
                if (results.hasOwnProperty(i)) {
                    var this_li = $("<li>"+highlight_term(results[i].name, query)+"</li>")
                        .bind('mousedown', function(event) {
                                li_data = $.data(event.currentTarget, "tokeninput");
                                add_token(li_data.id, li_data.name, li_data.display);
                        })
                        .appendTo(dropdown_ul);
                                        
                    if(i%2) {
                        this_li.addClass(settings.classes.dropdownItem);
                    } else {
                        this_li.addClass(settings.classes.dropdownItem2);
                    }

                    if(i == 0) {
                        select_dropdown_item(this_li);
                    }

                    $.data(this_li.get(0), "tokeninput", {"id": results[i].id, "name": results[i].name, "display":results[i].display});
                }
            }

            dropdown.show();
            dropdown_ul.show();

        } else {
          
          //no results w/ text
          if(settings.noResultsText.length > 0) {

              //reset the selected dropdown item
              selected_dropdown_item = null;

              //show "no results" text
              dropdown
                  .html("<p>"+settings.noResultsText+"</p>")
                  .show();

          //no results w/out text
          } else {
            hide_dropdown();
          }

        }
    }

    // Highlight an item in the results dropdown
    function select_dropdown_item (item) {
        if(item) {
            if(selected_dropdown_item) {
                deselect_dropdown_item($(selected_dropdown_item));
            }

            item.addClass(settings.classes.selectedDropdownItem);
            selected_dropdown_item = item.get(0);
        }
    }

    // Remove highlighting from an item in the results dropdown
    function deselect_dropdown_item (item) {
        item.removeClass(settings.classes.selectedDropdownItem);
        selected_dropdown_item = null;
    }

    // Do a search and show the "searching" dropdown if the input is longer
    // than settings.minChars
    function do_search(immediate) {

        var query = input_box.val().toLowerCase();

        if (query && query.length) {
            
            //if token selected deselect
            if(selected_token) {
                deselect_token($(selected_token), POSITION.AFTER);
            }
            
            //if query is above minimum query length, run search
            if (query.length >= settings.minChars) {
                show_dropdown_searching();
                if (immediate) {
                    run_search(query);
                } else {
                    clearTimeout(timeout);
                    timeout = setTimeout(function(){run_search(query);}, settings.searchDelay);
                }
            
            // no query, hide dropdown
            } else {
                hide_dropdown();
            }
        }
    }

    // Do the actual search
    function run_search(query) {
        var cached_results = cache.get(query);
        if(cached_results) {
            populate_dropdown(query, cached_results);
        } else {
            results = suggest(query);
            cache.add(query, results);
            populate_dropdown(query, results);
        }
    }


    /******************************************************************
      suggest 

      Function to search through the "this.contacts" array and match 
      users based on the specified search priority. In the case of this
      suggest function, priority is hardcoded as:

      full-name/last/first/email/screenname

      Changes to how the search priority also affect the "search" function
      and the ordering of the statements should be closely coupled with
      the array concatenation that is happening at the end of this function.
    /******************************************************************/
    function suggest(query) {

        //TESTING
        var start = (new Date()).getTime();

        // array to store resulting users
        var suggestions = [];

        // preflight test for harmful characters
        var badChars = (/([\\\/\?\[\]\(\)\*\$\^\{\}])/g).test(query);
        if (badChars) {
            return suggestions;
        }

        //build the pattern and create global vars for search
        var params = {}; //loop params
        params.query = query.replace(/^\s+|\s+$/g,''); //trim whitespace
        params.pattern = new RegExp('^' + query, 'i'); // starts-with test
        params.patternGroup = new RegExp('^' + query + '|\\.' + query + '|\\_' + query, 'i');
        params.patternFull = /^(\s*\w+\s+\w+)/i; // does the query look like a full name?
        params.looksLikeFull = params.patternFull.test(params.query);
        
        // figure out if we are trying to match on full name or not
        if (params.looksLikeFull) {
            //create a new regex to match full-name
            params.patternFull = new RegExp('^' + params.query.replace(/\s+/g, '\\s+'), 'i');
        }

        //storage buckets for search results
        params.buckets = { grp : [], f : [], l : [], e : [], sn : [], fn : [] };

        //loop over all groups and contacts (faster than a 'for' loop for whatever reason)
        if (this.groups && this.groups.length) {
            $(this.groups).each(function() { compareGroup(this, params); });
        }
        var end = (new Date()).getTime();
        gSearchGroups = end - start;

        if (this.contacts && this.contacts.length) {
            $(this.contacts).each(function() { compareContact(this, params); });
        }
        start = (new Date()).getTime();
        gSearchContacts = start - end;

        //build the suggestion list from the smaller buckets
        suggestions = suggestions.concat(params.buckets.grp.slice(0));
        suggestions = suggestions.concat(params.buckets.fn.slice(0));
        suggestions = suggestions.concat(params.buckets.l.slice(0));
        suggestions = suggestions.concat(params.buckets.f.slice(0));
        suggestions = suggestions.concat(params.buckets.e.slice(0));
        suggestions = suggestions.concat(params.buckets.sn.slice(0));
            
        //return the suggestion list
        return suggestions.slice(0, settings.maxNumSuggestions); // for now, hard-limit to 16
    }


    /******************************************************************
        compareGroup

      This function is the search "comparator", which means that it 
      needs to be as cheap as possible, in other words, be very careful
      about changing this function.
    /******************************************************************/
    function compareGroup(group, params) {
        // group check 
        if (params.patternGroup.test(group.n)) {
            params.buckets.grp.push($.TokenList.makeGroup(group));
            return true;
        }
    }

    /******************************************************************
        compareContact 

      This function is the search "comparator", which means that it 
      needs to be as cheap as possible, in other words, be very careful
      about changing this function.
    /******************************************************************/
    function compareContact(contact, params) {
        
        // full-name iff query looks like full name
        if (params.looksLikeFull && params.patternFull.test(contact.fn)) {
            params.buckets.fn.push($.TokenList.makeUser(contact));
            return true;
            }

        // last name
        if (params.pattern.test(contact.l)) {
            params.buckets.l.push($.TokenList.makeUser(contact));
            return true;
            }

        // first name
        if (params.pattern.test(contact.f)) {
            params.buckets.f.push($.TokenList.makeUser(contact));
            return true;
            }

        // email
        if (params.pattern.test(contact.e)) {
            params.buckets.e.push($.TokenList.makeUser(contact));
            return true;
            }

        // screen name
        if (params.pattern.test(contact.sn)) {
            params.buckets.sn.push($.TokenList.makeUser(contact));
            return true;
        }

    }
    
    //return true if copy/paste was handled
    //check for text immediately instead of waiting
    function handlePaste() {
        
        //start a new interval
        if (!this.interval) {
            this.interval = setInterval(function() { handlePaste() }, 10);
            this.iter = 0;
        }

        this.iter++;
        var text = $(input_box).val();

        //stop after finding text or 500ms
        if (this.iter > 50 || text.length) {

            //reset
            clearInterval(this.interval);
            this.iter = this.interval = undefined;

            var bulk = looksLikeBulkEmail(text);
            if (bulk.length) {
                create_new_token_bulk(bulk);
                return true;
            }

        }
        return false;

    }

    function looksLikeBulkEmail(text) {

        var splitNewline = text.split(/\n/);
        if (splitNewline.length > 1) {
            return splitNewline;
        }

        var splitComma = text.split(/,/);
        if (splitComma.length > 1) {
            return splitComma;
        }

        var splitSemiColon = text.split(/;/);
        if (splitSemiColon.length > 1) {
            return splitSemiColon;
        }
        
        var splitTab = text.split(/\t/);
        if (splitTab.length > 1) {
            return splitTab;
        }

        //handle copy/paste from excel column
        var splitSpace = text.split(/ /);
        if (splitSpace.length > 1) {
            return splitSpace;
        }
                      
        return false;
    }

    function tooManyUsers() {

        //build the error message
        var heading = 'oops';
        var msg = 'Sorry, we don\'t currently support adding more than 400 users at a time. Please add users in groups of 400.';

        //open up a new modal jQuery popup w/ the error message
        $('<div><p class="errorMessage">' + msg + '</p></div>').dialog({title: heading, modal: true});

    }

};

$.TokenList.makeUser = function(contact) {
        var user = {};
        user.id = contact.i + kDelimA + contact.t; //uid plus type
        user.name = HTMLEncode(contact.f) + ' ' + HTMLEncode(contact.l) + ' &lt;' + (contact.e ? HTMLEncode(contact.e) : 'private') + '&gt;' + (contact.sn ? (' ' + HTMLEncode(contact.sn)) : ''); // first/last/email/sn
        user.display = (contact.fn ? HTMLEncode(contact.fn) : (contact.e ? ('&lt;' + HTMLEncode(contact.e) + '&gt;') : HTMLEncode(contact.sn)));
        return user;
};


$.TokenList.makeGroup = function(grp) {
        var group = {};
        group.id = grp.i + kDelimA + grp.t; //uid plus type
        group.name = HTMLEncode(grp.n + ' (' + grp.m + ')');
        group.display = group.name;
        return group;
};

/**************************************
  checkTokenCount

  Check if the tokenCount is over the 
  maximum number of tokens allowed

  @returns Boolean
****************************************/
$.TokenList.checkTokenCount = function() {
    //check if we are over the token limit
    return ((this.tokenCount + ((arguments[0] && arguments[0].constructor == Number) ? arguments[0] : 0)) >= kMaxTokenCount);
} 

/***************************************



****************************************/
$.TokenList.tokenCounter = function()  {

    //setup
    if (!this.tokenCount) {
        this.tokenCount = 0;
    }
    
    //process input
    if (arguments && arguments.length == 1) {

        //choose which type of input to process
        switch (arguments[0].constructor) {

            //if argument type is boolean
            case Boolean:
                if (arguments[0]) {
                    this.tokenCount++;
                } else {
                    if (this.tokenCount > 0) {
                        this.tokenCount--;
                    }
                }
                break;

            //if argument type is string
            case String:
                if (arguments[0].toLowerCase() == 'reset') {
                    this.tokenCount = 0;
                }
                break;

        }

    }
    return this.tokenCount;
}

// Really basic cache for the results
$.TokenList.Cache = function (options) {
    var settings = $.extend({
        max_size: 50
        }, options);

    var data = {};
    var size = 0;

    var flush = function () {
        data = {};
        size = 0;
    };

    this.add = function (query, results) {
        if(size > settings.max_size) {
            flush();
        }

        if(!data[query]) {
            size++;
        }

        data[query] = results;
    };

    this.get = function (query) {
        return data[query];
    };
};

/***************************************************
  getGroups

  pulls the current list of all company users and parses
  them into an array of user objects

  @args void
  @returns void

 ***************************************************/
function getGroups() {

    //sanity check
    if (this.groups && this.groups.constructor == Array && this.groups.length) {
        //prevents resetting of this.groups if it's already been set
        return;
    }

    //grab the company users
    var req = new jaxreq('/db/main?a=qbi_getgroupsbyuid&format=string');
    req.DoAsyncCmd(function() { getGroupsCallback(req) });

};

/***************************************************
  getGroupsCallback

  callback for getCompanyUsers, pulls the current user
  string and then parses it into the user array

  shows an error message if the request does not complete

  @args req
  @returns void

 ***************************************************/
function getGroupsCallback(req) {

    //on failure
    if (!req.success) {
        //don't do anything after the error
        return;
    }

    //on success, parse contacts
    this.groups = req.GetValue('userlist');
    parseGroups();

};


/***************************************************
  parseGroups

  parses the this.groups string into an array of group 
  objects. each group has id/type/blank/blank/blank/name/members/status
  as their attributes. w/ large data-sets ~O(10K-100K) this should execute
  on the order of seconds

  @args void
  @returns void

 ***************************************************/
function parseGroups() {

    //TESTING
    var start = (new Date()).getTime();

    //split the contacts string into the contacts array
    this.groups = this.groups.split('\\c').slice(1);

    //create user objects and build this.contacts array
    for (var i = this.groups.length - 1, attrs; i >= 0; --i) {

        //split the current contact into an array of attributes
        attrs = this.groups[i].split('\\a').slice(1);

        // don't include EOI if not supported by account/app/plan
        if (!gEOIAllowed && attrs[1] == "2" && attrs[0] == 3)
	        continue;

        //build the new group 
        this.groups[i] = {};
        this.groups[i].i = attrs[0]; //id
        this.groups[i].t = attrs[1]; //type 
        this.groups[i].n = attrs[5]; //name
        this.groups[i].m = attrs[6]; //members
        this.groups[i].s = attrs[7]; //status

    }


    //TESTING
    var end = (new Date()).getTime();
    gParseGroups = end - start;

};

/***************************************************
  getCompanyUsers

  pulls the current list of all company users and parses
  them into an array of user objects

  @args void
  @returns void

 ***************************************************/
function getCompanyUsers() {

    //sanity check
    if (this.contacts && this.contacts.constructor == Array && this.contacts.length) {
        //prevents resetting of this.contacts if it's already been set
        return;
    }

    //grab the company users
    var req = new jaxreq('/db/main?a=qbi_getcompanyusers&format=string&filterDenied=1&acctID=' + gReqAccountID);
    req.DoAsyncCmd(function() { getCompanyUsersCallback(req) });

};

/***************************************************
  getCompanyUsersCallback

  callback for getCompanyUsers, pulls the current user
  string and then parses it into the user array

  shows an error message if the request does not complete

  @args req
  @returns void

 ***************************************************/
function getCompanyUsersCallback(req) {

    //on failure
    if (!req.success) {
        //don't do anything after the error
        return;

    }

    //on success, parse contacts
    this.contacts = usersInCompanyResponse = req.GetValue('userlist');
    parseContacts();

};

/***************************************************
  parseContacts

  parses the this.contacts string into an array of user
  objects. each user has id/type/first/last/email/sn/status
  as their attributes. w/ large data-sets ~O(10K-100K) this should execute
  on the order of seconds

  @args void
  @returns void

 ***************************************************/
function parseContacts() {

    //TESTING
    var start = (new Date()).getTime();

    //split the contacts string into the contacts array
    this.contacts = this.contacts.split('\\c').slice(1);

    //create user objects and build this.contacts array
    for (var i = this.contacts.length - 1, attrs; i >= 0; --i) {

        //split the current contact into an array of attributes
        attrs = this.contacts[i].split('\\a').slice(1);

        //build the new contact
        this.contacts[i] = {};
        this.contacts[i].i = attrs[0]; //id
        this.contacts[i].t = attrs[1]; //type 
        this.contacts[i].f = attrs[2]; //first name
        this.contacts[i].l = attrs[3]; //last name
        this.contacts[i].fn = (attrs[2] + ' ' + attrs[3]).replace(/^\s+|\s+$/g, ''); // first + space + last
        this.contacts[i].e = attrs[4]; //email
        this.contacts[i].sn = attrs[5]; //screen name
        this.contacts[i].s = attrs[6]; //status

    }


    //TESTING
    var end = (new Date()).getTime();
    gParseContacts = end - start;

};

function loadTrustees() {
    getGroups();
    getCompanyUsers();
};

})(jQuery);
; 
 
//@ sourceURL=/js/addressBook.js 
var gABGroupsOnly=false;var abDefaultOpts;function GetAddressBookBody(){if($("#addressBookDialog").length==0){var url="";if(gParentDBID!=""){url=gParentDBID+"?a=QBI_AddressBook"}else{url="main?a=QBI_AddressBookMain"}var jax=new jaxreq(url);if($("#groupPropsDialog").length!=0){jax.AddValue("dontIncludeGroupDialog",true)}jax.DoAsyncCmd(AddressBookBodyCallback)}}function AddressBookBodyCallback(jax){if(jax.success){var contents=jax.GetValue("divContents");$("#addressBook").html(HTMLDecode(contents))}else{if(window.console){console.error("Could not get Address Book")}}}(function(){var empty="";var kUsersUnknown=0;var kUsersInApp=-1;var kUsersInCompany=-2;var kUsersSearch=-3;var kGroups=-4;var kCreateNewUser=-5;var kAllUsers=-100;var TABLEMAX=2000;var waitForUsersInCompany=true;var waitForUsersInCompanyTimer=0;var waitForUsersInCompanyInterval;var ww=$(window).width()-20;var wh=$(window).height()-20;var minwidth=670;var minheight=600;var defaultOptions={multiSelect:true,minSearchChars:3,dialogTitle:"Address Book",selectionSectionTitle:"Selections:",height:Math.min(wh,minheight),width:Math.min(ww,minwidth),dialogID:"#addressBookDialog",endobj:empty};var resultsTables={currentTable:null,grpTable:{obj:null,id:"#browseGResultsTable"},userTable:{obj:null,id:"#browseUResultsTable"},allTable:{obj:null,id:"#searchResultsTable"}};var evtUsersSelected="abUsersSelected";var evtDialogCancelled="abCancelled";var noneFoundMessage="No matches found for the term entered.";var noneFoundInCompanyMsg="No matches found in your company.";var noneGroupsFound="No groups found.";var tooManyUsersInCompany="Too many users to display. Use the Search box above to search for all or part of a name.";var tooManyUsers="Too many users to display.";var tooManyGroups="Too many groups to display.";var noneToBrowseMessage="No matches found for the term entered.";var noneToFilteredBrowseMessage="No matches found for the term entered.";var searchExactMessage="Use the Search box above to search for an email address, user name, or QuickBase group name.";var emptyMessge="&nbsp;";var handlerSetup=false;this.AddressBook=function(optionsParam){try{this.opts=$.extend({},defaultOptions,abDefaultOpts,optionsParam);this.dialogID=this.opts.dialogID;this.$dialogID=$(this.dialogID);this.doneBrowseCallback=[];this.selectedUsersList=new Array;this.closeTrigger="cancel";if(!handlerSetup){$(document).bind("evtGroupAdded",{self:this},function(e){e.data.self.insertNewGroupSelector(e.groupInfo)});this.$dialogID.bind(evtUsersSelected,{self:this},function(e){if(e.data.self.opts.selectedUsersEventHandler){e.data.self.opts.selectedUsersEventHandler(e.users,e.ab.targetElem)}});this.$dialogID.bind(evtDialogCancelled,{self:this},function(e){if(e.data.self.opts.cancelledEventHandler){e.data.self.opts.cancelledEventHandler(e.ab.targetElem)}});handlerSetup=true}this.init(this.opts)}catch(e){exceptionMessage("AddressBook constructor error",e)}};this.AddressBook.prototype.cancelDialog=function(){this.$dialogID.trigger({type:evtDialogCancelled,ab:this,endobj:empty})};this.AddressBook.prototype.okDialog=function(e){var self=$(this).data("ab");if(self.selectedUsersList.length){self.closeTrigger="ok";$(this).trigger({type:evtUsersSelected,users:self.selectedUsersList,ab:self,dialogID:$(this)[0].id,endobj:empty})}$(this).dialog("close")};this.AddressBook.prototype.init=function(){var self=this;abDataIndxes={idIdx:0,typeIdx:1,firstIdx:2,lastIdx:3,emailIdx:4,screenIdx:5,statusIdx:6,dummyIdx:7};this.addressBook=this.$dialogID.dialog({autoOpen:false,width:this.opts.width,height:this.opts.height,title:this.opts.dialogTitle,modal:true,close:function(event,ui){$("#addressBookHelpLink").unbind("click");$("#addressBookDialog.ui-dialog-content #addressBookHelpLink").remove();if($(this).data("ab").closeTrigger!="ok"){$(this).data("ab").cancelDialog(event)}},open:function(event,ui){$(this).data("ab").closeTrigger="cancel";$("#addressBookDialog.ui-dialog-content").siblings(":last").prepend($("#addressBookHelpLink"));$("#addressBookHelpLink").click(function(){return OpenHelp("quickbase_address_book")})},buttons:{Cancel:function(){$(this).dialog("close")},OK:this.okDialog},endobj:empty});this.$dialogID.data("ab",this);$("#createAGroup").bind("click",{self:this},this.createAGroupHandler);this.parsedUsersInCompany=null;if(!this.opts.gABAllowNonUsers){$("#addressBookGroupSelect [value="+kGroups+"]").prop("disabled",true)}$("#abSearchForm").submit(function(e){if(!$("#exactUserSearchButton").hasClass("novisibility")){$("#exactUserSearchButton").click()}return false});$("#exactUserSearchButton").bind("click",{self:this},this.exactSearchHandler);$("#addressBookGroupSelect").bind("change",{self:this},this.groupSelectHandler);if(resultsTables.grpTable.obj==null){this.userColumns=[{bVisible:false,bSearchable:false,bSortable:false,sType:"string"},{bVisible:false,bSearchable:false,bSortable:false,sType:"string"},{bVisible:true,bSortable:true,sTitle:"First Name",sType:"string",fnRender:this.htmlEncodeInfo,bUseRendered:false},{bVisible:true,bSortable:true,sTitle:"Last Name",sType:"string",fnRender:this.htmlEncodeInfo,bUseRendered:false},{bVisible:true,bSortable:true,sTitle:"Email",sType:"string",fnRender:this.htmlEncodeInfo,bUseRendered:false},{bVisible:true,bSortable:true,sTitle:"User Name",sType:"string",fnRender:this.htmlEncodeInfo,bUseRendered:false},{bVisible:true,bSearchable:false,sTitle:"Status",bSortable:true,sType:"string"},{bVisible:false,bSearchable:false,bSortable:false,sType:"string"}];this.groupColumns=[{bVisible:false,bSearchable:false,bSortable:false,sType:"string"},{bVisible:false,bSearchable:false,bSortable:false,sType:"string"},{bVisible:false,bSearchable:false,bSortable:false,sType:"string"},{bVisible:false,bSearchable:false,bSortable:false,sType:"string"},{bVisible:false,bSearchable:false,bSortable:false,sType:"string"},{bVisible:true,bUseRendered:false,bSortable:true,sTitle:"Name",sType:"string"},{bVisible:true,bSearchable:false,bUseRendered:false,bSortable:true,fnRender:this.showGroupInfo,sType:"string",sTitle:"Members",sType:"numeric"},{bVisible:false,bSearchable:false,bSortable:false,sType:"string"}];var tableOptions={bJQueryUI:true,bSort:true,bFilter:true,iDisplayLength:10,bProcessing:false,bPaginate:true,bSortClasses:false,bAutoWidth:false,sPaginationType:"full_numbers",asStripClasses:["odd","even"],sDom:'<"tableToolbar fg-toolbar data-table-header ui-widget-header ui-corner-tl ui-corner-tr ui-helper-clearfix"i>t<"fg-toolbar ui-widget-header ui-corner-bl ui-corner-br ui-helper-clearfix"p>',oLanguage:{sZeroRecords:searchExactMessage}};this.groupTableOptions={};$.extend(true,this.groupTableOptions,tableOptions);var gto=this.groupTableOptions;gto.aaData=this.resultsArray;gto.aaSorting=[];gto.sDom='<"bscope">'+gto.sDom;gto.aoColumns=this.groupColumns;gto.oLanguage.sZeroRecords=noneGroupsFound;this.userTableOptions={};$.extend(true,this.userTableOptions,tableOptions);var uto=this.userTableOptions;uto.aaData=this.resultsArray;uto.aaSorting=[];uto.sDom='<"bscope">'+uto.sDom;uto.aoColumns=this.userColumns;uto.oLanguage.sZeroRecords=noneFoundMessage;this.srchTableOptions={};$.extend(true,this.srchTableOptions,tableOptions);var sto=this.srchTableOptions;sto.aaSorting=[];sto.aaData=this.resultsArray;sto.aoColumns=this.userColumns;sto.bFilter=false;var btab=resultsTables;btab.grpTable.obj=$(btab.grpTable.id).dataTable(gto);btab.userTable.obj=$(btab.userTable.id).dataTable(uto);btab.allTable.obj=$(btab.allTable.id).dataTable(sto)}else{this.clearTable();resultsTables.currentTable=resultsTables.allTable.obj}$("#absearchInput").bind("keyup",{self:this},this.searchInputHandler);this.opts.maxRows=TABLEMAX;var allvars=(window.pm.getUrlVars());var maxr=allvars.maxrows;if(typeof maxr!="undefined"){try{var maxi=parseInt(maxr,10);if(maxi>=1){this.opts.maxRows=maxi}if(max==-1){this.opts.maxRows=undefined}}catch(e){errorMessage(" maxRows parameter error"+e)}}$("#browseGResultsTable_wrapper .tableToolbar").prepend($("#abTableToolbarItems"));var initialBrowse=kAllUsers;this.initForAllColumns();this.clearSearch();$("#addressBookGroupSelect").val(initialBrowse);$("#addressBookGroupSelect").change()};this.AddressBook.prototype.open=function(target,startingSearch){this.hideShowChoices();this.targetElem=target;this.addressBook.dialog("open");this.clearChoices();if(startingSearch){$("#absearchInput").get(0).value=startingSearch;$("#addressBookGroupSelect").val(kAllUsers);$("#addressBookGroupSelect").change();$("#exactUserSearchButton").click()}$("#absearchInput").get(0).focus()};this.AddressBook.prototype.searchInputHandler=function(e){if(!e.data.self.inFullSearchState){e.data.self.filterTable(e)}return true};this.AddressBook.prototype.filterTable=function(e){e.data.self.filterCurrentTable();return true};this.AddressBook.prototype.filterCurrentTable=function(){if(this.inFullSearchState){this.currentTable().fnFilter("")}else{this.setNoneMessage();this.currentTable().fnFilter($("#absearchInput").get(0).value)}};this.AddressBook.prototype.clearSearch=function(){var elt=$("#abSearchField");if(elt){elt.val("")}};this.AddressBook.prototype.clearChoices=function(){document.getElementById("abChoices").value="";this.selectedUsersList=[];this.selectedUsersList.length=0};this.AddressBook.prototype.hideShowChoices=function(){var section=$("#abChoicesSection");if(this.opts.multiSelect){section.removeClass("nodisplay")}else{section.addClass("nodisplay")}};this.AddressBook.prototype.getRowData=function(e){var aPos=e.table.fnGetPosition(e.currentTarget);var aData=e.table.fnGetData(aPos[0]);var ind=abDataIndxes;var row=aData[aPos];var contact={};if(row[ind.idIdx]==0){contact.i=row[ind.emailIdx]}else{contact.i=row[ind.idIdx]}if(row[ind.typeIdx]==0){contact.t=kACUser}else{contact.t=row[ind.typeIdx]}contact.f=row[ind.firstIdx];contact.l=row[ind.lastIdx];contact.fn=(row[ind.firstIdx]+" "+row[ind.lastIdx]).replace(/^\s+|\s+$/g,"");contact.e=row[ind.emailIdx];contact.sn=row[ind.screenIdx];var user=$.TokenList.makeUser(contact);return user};this.AddressBook.prototype.tableInit=function(tableToInit){var self=this;$(tableToInit.fnGetNodes()).mouseover(function(){$(this).addClass("abSelected")});$(tableToInit.fnGetNodes()).mouseout(function(){$(this).removeClass("abSelected")});$(tableToInit.fnGetNodes()).dblclick(function(event){event.table=tableToInit;self.userAdded(self.getRowData(event))});$(tableToInit.fnGetNodes()).click(function(event){event.table=tableToInit;self.userAdded(self.getRowData(event))})};this.AddressBook.prototype.userAdded=function(userInfo){var out=HTMLDecode(userInfo.display);if(out.charAt(0)=="<"&&out.charAt(out.length-1)==">"){out=out.substring(1,out.length-1)}out=out.replace(/&nbsp;]*/g," ");out=$.trim(out);if(this.opts.multiSelect){var comma=(!this.selectedUsersList.length)?"":", ";var userAlreadyAdded=false;for(var i=0,len=this.selectedUsersList.length;i<len;i++){userAlreadyAdded=this.selectedUsersList[i].display==userInfo.display;if(userAlreadyAdded){break}}if(!userAlreadyAdded){document.getElementById("abChoices").value+=comma+out;this.selectedUsersList[this.selectedUsersList.length++]=userInfo}}else{document.getElementById("abChoices").value=out;this.selectedUsersList[0]=userInfo}};this.AddressBook.prototype.includeInList=function(type,id){var answer=true;if(!this.opts.gABAllowEveryoneGID&&type==kACGroup&&id==3){answer=false}else{if(type==kACPlaceholder&&!this.opts.gABAllowPlaceholders){answer=false}else{if(!this.opts.gABAllowNonUsers&&(type==kACGroup||type==kACDomgroup||type==kACAccount)){answer=false}else{if(this.opts.gABNoDomGroups&&type==kACDomgroup){answer=false}}}}return answer};this.AddressBook.prototype.parseUserAs2D=function(input){var ind=abDataIndxes;var lines=input.split("\\c").slice(1);var rows=[];for(var i=0,j=0;i<lines.length;++i){var listitem=lines[i].split("\\a").slice(1);if(this.includeInList(parseInt(listitem[ind.typeIdx],10),parseInt(listitem[ind.idIdx],10))){rows[j++]=listitem}}var mx=this.opts.maxRows||rows.length+1;if(rows.length>mx){rows=null;this.tooMany()}return rows};this.AddressBook.prototype.currentTable=function(){var currTableobj=resultsTables.currentTable;return currTableobj};this.AddressBook.prototype.clearTable=function(){resultsTables.grpTable.obj.fnClearTable();resultsTables.userTable.obj.fnClearTable();resultsTables.allTable.obj.fnClearTable()};this.AddressBook.prototype.tableMessage=function(msg){this.clearTable();$(".dataTables_empty",this.currentTable().get(0)).get(0).innerHTML=msg};this.AddressBook.prototype.startSearch=function(){this.currentTable().parents(".resultsSection").scrollTop(0);this.tableMessage('<span class="processing">Loading user list. This may take up to a minute if you have many users.</span>')};this.AddressBook.prototype.doneSearch=function(){this.tableMessage("")};this.AddressBook.prototype.tooMany=function(){if(this.opts.gABCurrentState==kUsersInCompany||this.opts.gABCurrentState==kAllUsers){this.tableMessage(tooManyUsersInCompany)}else{if(this.opts.gABCurrentState==kGroups){this.tableMessage(tooManyGroups)}else{this.tableMessage(tooManyUsers)}}};this.AddressBook.prototype.openMessageDialog=function(htmlMsg){if(typeof this.messageDialog=="undefined"){this.messageDialog=$("#abMessageDialog").dialog({autoOpen:false,modal:true,buttons:{OK:function(){$(this).dialog("close")}}})}$("#abMessageDialog").get(0).innerHTML=htmlMsg;this.messageDialog.dialog("open")};this.AddressBook.prototype.tooShort=function(){this.openMessageDialog("You cannot search for such a short text string.<br/>Please enter a string at least "+this.opts.minSearchChars+" characters in length.")};this.AddressBook.prototype.reportError=function(request,textStatus,errorThrown){var reported=false;var rData=$(request.responseXML);if(rData){var ecodeElt=rData.find("errcode");if(ecodeElt.length>0){var ecode=ecodeElt.text();if(ecode=="2"){this.tooShort();reported=true}else{if(ecode=="80"){this.tooMany();reported=true}}}if(!reported){var etxtElt=rData.find("errtext");if(etxtElt.length>0){var etxt=ecodeElt.text();this.openMessageDialog(etxt);reported=true}}}if(!reported){this.openMessageDialog("Sorry, our request didn't complete<br/>Code: "+request.errcode+"<br/>Details: "+request.errtext)}};this.AddressBook.prototype.exactSearchHandler=function(e){var self=e.data.self;var matchtext=GetValue("absearchInput");self.resultsArray=null;self.doneSearchCallback=self.updateSearchResults;var errorOccured=false;if(matchtext==""){errorOccured=true}else{if(matchtext.length<self.opts.minSearchChars){self.tooShort();errorOccured=true}}if(!errorOccured){self.ajaxFindUsers(matchtext)}else{self.clearTable()}return false};this.AddressBook.prototype.updateSearchResults=function(){this.initForAllColumns();if(this.resultsArray){this.currentTable().fnSettings().oLanguage.sZeroRecords=noneFoundMessage;if(this.resultsArray.length){this.currentTable().fnAddData(this.resultsArray)}else{this.clearTable();if(this.opts.gABCurrentState==kUsersInCompany){this.tableMessage(noneFoundInCompanyMsg)}else{this.tableMessage(noneFoundMessage)}}}this.tableInit(this.currentTable())};this.AddressBook.prototype.searchResponse=function(request,textStatus){this.ab.doneSearch();if(textStatus=="success"){var rData=$(request.responseXML);var ulist=rData.find("userlist");if(ulist.length>0){this.ab.resultsArray=this.ab.parseUserAs2D(ulist.text())}else{this.ab.reportError(request,textStatus)}}else{this.ab.reportError(request,textStatus)}if(this.ab.doneSearchCallback){this.ab.doneSearchCallback()}};this.AddressBook.prototype.ajaxFindUsers=function(matchtext){this.initForAllColumns();this.startSearch();var data="a=QBI_MatchUsers&format=string&matchtext="+urlencode(matchtext)+"&filterDenied=1&acctID="+gReqAccountID;if(this.opts.gABCurrentState==kUsersInCompany){data+="&restrictToCompany=true"}var url="main";$.ajax({type:"POST",url:url,ab:this,async:true,dataType:"xml",data:data,complete:this.searchResponse,error:this.reportError})};this.AddressBook.prototype.createAGroupHandler=function(e){ClickCreateGroup(gReqAccountID,gReqAccountName,true,OnCreateGroupSuccessAB);return false};this.AddressBook.prototype.showGroupInfo=function(oObj){var ind=abDataIndxes;var response="";if(oObj.aData[ind.idIdx]!=(""+kGIDEveryone)&&oObj.aData[ind.typeIdx]==(""+kACGroup)){response='<a class="nm" href="/db/main?a=GroupMain&gid='+oObj.aData[ind.idIdx]+'" target="ucGroupManage">'+oObj.aData[ind.statusIdx]+"</a>"}return response};this.AddressBook.prototype.htmlEncodeInfo=function(oObj){return HTMLEncode(oObj.aData[oObj.iDataColumn])};this.AddressBook.prototype.insertNewGroupSelector=function(newGroup){$("#addressBookGroupSelect [value="+kGroups+"]").after('<option value="'+newGroup.gid+'">&nbsp;&nbsp;&nbsp;'+newGroup.gname+"</option>")};this.AddressBook.prototype.groupSelectHandler=function(e){var self=e.data.self;var dbid=gParentDBID;self.resultsArray=null;self.doneBrowseCallback=self.updateBrowseResults;var val=GetValue("addressBookGroupSelect");if(val=="_sf"){SetValue("addressBookGroupSelect",self.opts.gABCurrentState);return false}var _self=self;var _dbid=dbid;var _val=val;self.opts.gABCurrentState=val;setTimeout(function(){if(_val==kUsersInApp){_self.ajaxGetAppUsers(_dbid)}else{if(_val==kUsersInCompany){_self.ajaxGetCompanyUsers()}else{if(_val==kGroups){_self.ajaxGetGroupsByUID()}else{if(_val==kAllUsers){_self.allUsers()}else{if(_val>0){_self.ajaxGetGroupUsers(_val)}}}}}},0);return false};this.AddressBook.prototype.setNoneMessage=function(){var nonemsg=(this.resultsArray&&$("#absearchInput").get(0).value.length==0)?noneToBrowseMessage:noneToFilteredBrowseMessage;resultsTables.grpTable.obj.fnSettings().oLanguage.sZeroRecords=nonemsg;resultsTables.userTable.obj.fnSettings().oLanguage.sZeroRecords=nonemsg};this.AddressBook.prototype.updateBrowseResults=function(type){(type=="groups")?this.initForGroupColumns():this.initForUserColumns();if(this.resultsArray){resultsTables.allTable.obj.fnSettings().oLanguage.sZeroRecords=noneFoundMessage;if(this.resultsArray.length){this.currentTable().fnAddData(this.resultsArray);this.filterCurrentTable()}else{this.clearTable()}}this.tableInit(this.currentTable())};this.AddressBook.prototype.groupResponse=function(request,textStatus){this.ab.doneSearch();if(textStatus=="success"){var rData=$(request.responseXML);var ulist=rData.find("userlist");if(ulist.length>0){this.ab.resultsArray=this.ab.parseUserAs2D(ulist.text())}else{this.ab.reportError(request,textStatus)}}else{this.ab.reportError(request,textStatus)}if(this.ab.doneBrowseCallback){this.ab.doneBrowseCallback(this.resultsType)}};this.AddressBook.prototype.ajaxGetBrowseData=function(url,data,resultsType){this.startSearch();var _url=url;var _data=data;var _resultsType=resultsType;var _this=this;setTimeout(function(){$.ajax({type:"POST",url:_url,ab:_this,resultsType:_resultsType,async:true,dataType:"xml",data:_data,complete:_this.groupResponse,error:_this.reportError})},0)};this.AddressBook.prototype.initForUserColumns=function(){resultsTables.currentTable=resultsTables.userTable.obj;this.inFullSearchState=false;$(".aball").hide();$(".abbrz").show();$(".aballbutton").addClass("novisibility");$("#exactUserSearchButton").prop("disabled",true);$(".abgroup").hide();$(".abuser").show()};this.AddressBook.prototype.initForGroupColumns=function(){resultsTables.currentTable=resultsTables.grpTable.obj;this.inFullSearchState=false;$(".aball").hide();$(".abbrz").show();$(".aballbutton").addClass("novisibility");$("#exactUserSearchButton").prop("disabled",true);$(".abuser").hide();$(".abgroup").show()};this.AddressBook.prototype.initForAllColumns=function(){resultsTables.currentTable=resultsTables.allTable.obj;this.inFullSearchState=true;$(".aball").show();$(".aballbutton").removeClass("novisibility");$("#exactUserSearchButton").removeAttr("disabled");$(".abbrz").hide();$(".abuser").hide();$(".abgroup").hide()};this.AddressBook.prototype.ajaxGetAppUsers=function(dbid){this.initForUserColumns();var data="a=QBI_GetAppUsers&format=string&filterDenied=1";var url=dbid;this.ajaxGetBrowseData(url,data,"users")};this.AddressBook.prototype.allUsers=function(){this.initForAllColumns();this.clearTable()};this.AddressBook.prototype.getUsersInCompanyHandler=function(){var tooManyUsers=false;if(this.parsedUsersInCompany!=null){this.resultsArray=this.parsedUsersInCompany;this.doneSearch()}else{if(this.opts.maxRows&&contacts.length>this.opts.maxRows){this.tooMany();tooManyUsers=true}else{this.resultsArray=this.parsedUsersInCompany=this.parseUserAs2D(usersInCompanyResponse);this.doneSearch()}}this.doneBrowseCallback("users");if(tooManyUsers){this.inFullSearchState=true;$("#exactUserSearchButton").removeClass("novisibility").removeAttr("disabled")}};this.AddressBook.prototype.checkUsersInCompany=function(){if(contacts.length>0){waitForUsersInCompany=false;this.ajaxGetCompanyUsers();clearInterval(waitForUsersInCompanyInterval)}else{if(waitForUsersInCompanyTimer==12){waitForUsersInCompany=false;this.tooMany();clearInterval(waitForUsersInCompanyInterval)}else{waitForUsersInCompanyTimer++}}};this.AddressBook.prototype.ajaxGetCompanyUsers=function(){this.initForUserColumns();var _this=this;this.startSearch();if(usersInCompanyResponse&&usersInCompanyResponse!=""){setTimeout(function(){_this.getUsersInCompanyHandler()},0)}else{if(waitForUsersInCompany){waitForUsersInCompanyInterval=setInterval(function(){_this.checkUsersInCompany()},500)}else{this.tooMany()}}};this.AddressBook.prototype.ajaxGetGroupsByUID=function(){this.initForGroupColumns();var data="a=QBI_GetGroupsByUID&format=string";var url="main";this.ajaxGetBrowseData(url,data,"groups")};this.AddressBook.prototype.ajaxGetGroupUsers=function(val){this.initForUserColumns();var data="a=QBI_GetGroupUsers&format=string&gid="+val+"&filterDenied=1&acctID="+gReqAccountID;var url="main";this.ajaxGetBrowseData(url,data,"users")}}());function OnCreateGroupSuccessAB(gid,gname,gnum){$(document).trigger({type:"evtGroupAdded",groupInfo:{gid:gid,gname:gname,gnum:gnum}});$("#addressBookGroupSelect").change();notifyGreen("Group "+gname+" created.")};; 
 
//@ sourceURL=/js/qtip/jquery.qtip-1.0.min.js 
/*!
* jquery.qtip. The jQuery tooltip plugin
*
* Copyright (c) 2009 Craig Thompson
* http://craigsworks.com
*
* Licensed under MIT
* http://www.opensource.org/licenses/mit-license.php
*
* Launch  : February 2009
* Version : 1.0.0-rc3
* Released: Tuesday 12th May, 2009 - 00:00
* Debug: jquery.qtip.debug.js
*/
(function(d){function w(b){if(!b)return false;this.x=String(b).replace(/middle/i,"center").match(/left|right|center/i)[0].toLowerCase();this.y=String(b).replace(/middle/i,"center").match(/top|bottom|center/i)[0].toLowerCase();this.offset={left:0,top:0};this.precedance=b.charAt(0).search(/^(t|b)/)>-1?"y":"x";this.string=function(){return this.precedance==="y"?this.y+this.x:this.x+this.y}}function y(b,c,f){c={bottomright:[[0,0],[c,f],[c,0]],bottomleft:[[0,0],[c,0],[0,f]],topright:[[0,f],[c,0],[c,f]], topleft:[[0,0],[0,f],[c,f]],topcenter:[[0,f],[c/2,0],[c,f]],bottomcenter:[[0,0],[c,0],[c/2,f]],rightcenter:[[0,0],[c,f/2],[0,f]],leftcenter:[[c,0],[c,f],[0,f/2]]};c.lefttop=c.bottomright;c.righttop=c.bottomleft;c.leftbottom=c.topright;c.rightbottom=c.topleft;return c[b]}function z(b){var c;if(d("<canvas />").get(0).getContext)c={topLeft:[b,b],topRight:[0,b],bottomLeft:[b,0],bottomRight:[0,0]};else if(d.browser.msie)c={topLeft:[-90,90,0],topRight:[-90,90,-b],bottomLeft:[90,270,0],bottomRight:[90,270, -b]};return c}function x(b,c){var f;b=d.extend(true,{},b);for(f in b)if(c===true&&/(tip|classes)/i.test(f))delete b[f];else!c&&/(width|border|tip|title|classes|user)/i.test(f)&&delete b[f];return b}function A(b){if(typeof b.tip!=="object")b.tip={corner:b.tip};if(typeof b.tip.size!=="object")b.tip.size={width:b.tip.size,height:b.tip.size};if(typeof b.border!=="object")b.border={width:b.border};if(typeof b.width!=="object")b.width={value:b.width};if(typeof b.width.max==="string")b.width.max=parseInt(b.width.max.replace(/([0-9]+)/i, "$1"),10);if(typeof b.width.min==="string")b.width.min=parseInt(b.width.min.replace(/([0-9]+)/i,"$1"),10);if(typeof b.tip.size.x==="number"){b.tip.size.width=b.tip.size.x;delete b.tip.size.x}if(typeof b.tip.size.y==="number"){b.tip.size.height=b.tip.size.y;delete b.tip.size.y}return b}function B(){var b,c,f;b=this;f=[true,{}];for(c=0;c<arguments.length;c++)f.push(arguments[c]);for(c=[d.extend.apply(d,f)];typeof c[0].name==="string";)c.unshift(A(d.fn.qtip.styles[c[0].name]));c.unshift(true,{classes:{tooltip:"qtip-"+ (arguments[0].name||"defaults")}},d.fn.qtip.styles.defaults);c=d.extend.apply(d,c);f=d.browser.msie?1:0;c.tip.size.width+=f;c.tip.size.height+=f;if(c.tip.size.width%2>0)c.tip.size.width+=1;if(c.tip.size.height%2>0)c.tip.size.height+=1;if(c.tip.corner===true)c.tip.corner=b.options.position.corner.tooltip==="center"&&b.options.position.corner.target==="center"?false:b.options.position.corner.tooltip;return c}function C(b,c,f,a){b=b.get(0).getContext("2d");b.fillStyle=a;b.beginPath();b.arc(c[0],c[1], f,0,Math.PI*2,false);b.fill()}function J(){var b,c,f,a,e,g,i,h,j;b=this;b.elements.wrapper.find(".qtip-borderBottom, .qtip-borderTop").remove();f=b.options.style.border.width;a=b.options.style.border.radius;e=b.options.style.border.color||b.options.style.tip.color;g=z(a);i={};for(c in g){i[c]='<div rel="'+c+'" style="'+(/Left/.test(c)?"left":"right")+":0; position:absolute; height:"+a+"px; width:"+a+'px; overflow:hidden; line-height:0.1px; font-size:1px">';if(d("<canvas />").get(0).getContext)i[c]+= '<canvas height="'+a+'" width="'+a+'" style="vertical-align: top"></canvas>';else if(d.browser.msie){h=a*2+3;i[c]+='<v:arc stroked="false" fillcolor="'+e+'" startangle="'+g[c][0]+'" endangle="'+g[c][1]+'" style="width:'+h+"px; height:"+h+"px; margin-top:"+(/bottom/.test(c)?-2:-1)+"px; margin-left:"+(/Right/.test(c)?g[c][2]-3.5:-1)+'px; vertical-align:top; display:inline-block; behavior:url(#default#VML)"></v:arc>'}i[c]+="</div>"}c=b.getDimensions().width-Math.max(f,a)*2;c='<div class="qtip-betweenCorners" style="height:'+ a+"px; width:"+c+"px; overflow:hidden; background-color:"+e+'; line-height:0.1px; font-size:1px;">';b.elements.wrapper.prepend('<div class="qtip-borderTop" dir="ltr" style="height:'+a+"px; margin-left:"+a+'px; line-height:0.1px; font-size:1px; padding:0;">'+i.topLeft+i.topRight+c);b.elements.wrapper.append('<div class="qtip-borderBottom" dir="ltr" style="height:'+a+"px; margin-left:"+a+'px; line-height:0.1px; font-size:1px; padding:0;">'+i.bottomLeft+i.bottomRight+c);if(d("<canvas />").get(0).getContext)b.elements.wrapper.find("canvas").each(function(){j= g[d(this).parent("[rel]:first").attr("rel")];C.call(b,d(this),j,a,e)});else d.browser.msie&&b.elements.tooltip.append('<v:image style="behavior:url(#default#VML);"></v:image>');i=Math.max(a,a+(f-a));f=Math.max(f-a,0);b.elements.contentWrapper.css({border:"0px solid "+e,borderWidth:f+"px "+i+"px"})}function D(b,c,f){b=b.get(0).getContext("2d");b.fillStyle=f;b.beginPath();b.moveTo(c[0][0],c[0][1]);b.lineTo(c[1][0],c[1][1]);b.lineTo(c[2][0],c[2][1]);b.fill()}function E(b){var c,f,a;c=this;if(!(c.options.style.tip.corner=== false||!c.elements.tip)){b||(b=new w(c.elements.tip.attr("rel")));f=a=d.browser.msie?1:0;c.elements.tip.css(b[b.precedance],0);if(b.precedance==="y"){if(d.browser.msie)a=parseInt(d.browser.version.charAt(0),10)===6?b.y==="top"?-3:1:b.y==="top"?1:2;if(b.x==="center")c.elements.tip.css({left:"50%",marginLeft:-(c.options.style.tip.size.width/2)});else b.x==="left"?c.elements.tip.css({left:c.options.style.border.radius-f}):c.elements.tip.css({right:c.options.style.border.radius+f});b.y==="top"?c.elements.tip.css({top:-a}): c.elements.tip.css({bottom:a})}else{if(d.browser.msie)a=parseInt(d.browser.version.charAt(0),10)===6?1:b.x==="left"?1:2;if(b.y==="center")c.elements.tip.css({top:"50%",marginTop:-(c.options.style.tip.size.height/2)});else b.y==="top"?c.elements.tip.css({top:c.options.style.border.radius-f}):c.elements.tip.css({bottom:c.options.style.border.radius+f});b.x==="left"?c.elements.tip.css({left:-a}):c.elements.tip.css({right:a})}f="padding-"+b[b.precedance];b=c.options.style.tip.size[b.precedance==="x"? "width":"height"];c.elements.tooltip.css("padding",0).css(f,b);if(d.browser.msie&&parseInt(d.browser.version.charAt(0),6)===6){b=parseInt(c.elements.tip.css("margin-top"),10)||0;b+=parseInt(c.elements.content.css("margin-top"),10)||0;c.elements.tip.css({marginTop:b})}}}function F(b){var c,f,a,e,g;c=this;c.elements.tip!==null&&c.elements.tip.remove();f=c.options.style.tip.color||c.options.style.border.color;if(c.options.style.tip.corner!==false){b||(b=new w(c.options.style.tip.corner));a=y(b.string(), c.options.style.tip.size.width,c.options.style.tip.size.height);c.elements.tip='<div class="'+c.options.style.classes.tip+'" dir="ltr" rel="'+b.string()+'" style="position:absolute; height:'+c.options.style.tip.size.height+"px; width:"+c.options.style.tip.size.width+'px; margin:0 auto; line-height:0.1px; font-size:1px;"></div>';c.elements.tooltip.prepend(c.elements.tip);if(d("<canvas />").get(0).getContext)e='<canvas height="'+c.options.style.tip.size.height+'" width="'+c.options.style.tip.size.width+ '"></canvas>';else if(d.browser.msie){e=c.options.style.tip.size.width+","+c.options.style.tip.size.height;g="m"+a[0][0]+","+a[0][1];g+=" l"+a[1][0]+","+a[1][1];g+=" "+a[2][0]+","+a[2][1];g+=" xe";e='<v:shape fillcolor="'+f+'" stroked="false" filled="true" path="'+g+'" coordsize="'+e+'" style="width:'+c.options.style.tip.size.width+"px; height:"+c.options.style.tip.size.height+"px; line-height:0.1px; display:inline-block; behavior:url(#default#VML); vertical-align:"+(b.y==="top"?"bottom":"top")+'"></v:shape>'; e+='<v:image style="behavior:url(#default#VML);"></v:image>';c.elements.contentWrapper.css("position","relative")}c.elements.tip=c.elements.tooltip.find("."+c.options.style.classes.tip).eq(0);c.elements.tip.html(e);d("<canvas  />").get(0).getContext&&D.call(c,c.elements.tip.find("canvas:first"),a,f);b.y==="top"&&d.browser.msie&&parseInt(d.browser.version.charAt(0),10)===6&&c.elements.tip.css({marginTop:-4});E.call(c,b)}}function K(){var b=this;b.elements.title!==null&&b.elements.title.remove();b.elements.tooltip.attr("aria-labelledby", "qtip-"+b.id+"-title");b.elements.title=d('<div id="qtip-'+b.id+'-title" class="'+b.options.style.classes.title+'"></div>').css(x(b.options.style.title,true)).css({zoom:d.browser.msie?1:0}).prependTo(b.elements.contentWrapper);b.options.content.title.text&&b.updateTitle.call(b,b.options.content.title.text);if(b.options.content.title.button!==false&&typeof b.options.content.title.button==="string")b.elements.button=d('<a class="'+b.options.style.classes.button+'" role="button" style="float:right; position: relative"></a>').css(x(b.options.style.button, true)).html(b.options.content.title.button).prependTo(b.elements.title).click(function(c){b.status.disabled||b.hide(c)})}function L(){function b(h){if(a.status.disabled!==true){clearTimeout(a.timers.inactive);a.timers.inactive=setTimeout(function(){d(i).each(function(){g.unbind(this+".qtip-inactive");a.elements.content.unbind(this+".qtip-inactive")});a.hide(h)},a.options.hide.delay)}}function c(h){if(a.status.disabled!==true){if(a.options.hide.when.event==="inactive"){d(i).each(function(){g.bind(this+ ".qtip-inactive",b);a.elements.content.bind(this+".qtip-inactive",b)});b()}clearTimeout(a.timers.show);clearTimeout(a.timers.hide);if(a.options.show.delay>0)a.timers.show=setTimeout(function(){a.show(h)},a.options.show.delay);else a.show(h)}}function f(h){if(a.status.disabled!==true){if(a.options.hide.fixed===true&&/mouse(out|leave)/i.test(a.options.hide.when.event)&&d(h.relatedTarget).parents('div.qtip[id^="qtip"]').length>0){h.stopPropagation();h.preventDefault();clearTimeout(a.timers.hide);return false}clearTimeout(a.timers.show); clearTimeout(a.timers.hide);a.elements.tooltip.stop(true,true);a.timers.hide=setTimeout(function(){a.hide(h)},a.options.hide.delay)}}var a,e,g,i;a=this;e=a.options.show.when.target;g=a.options.hide.when.target;if(a.options.hide.fixed)g=g.add(a.elements.tooltip);i=["click","dblclick","mousedown","mouseup","mousemove","mouseout","mouseenter","mouseleave","mouseover"];a.options.hide.fixed===true&&a.elements.tooltip.bind("mouseover.qtip",function(){a.status.disabled!==true&&clearTimeout(a.timers.hide)}); if(a.options.show.when.target.add(a.options.hide.when.target).length===1&&a.options.show.when.event===a.options.hide.when.event&&a.options.hide.when.event!=="inactive"||a.options.hide.when.event==="unfocus"){a.cache.toggle=0;e.bind(a.options.show.when.event+".qtip",function(h){a.cache.toggle===0?c(h):f(h)})}else{e.bind(a.options.show.when.event+".qtip",c);a.options.hide.when.event!=="inactive"&&g.bind(a.options.hide.when.event+".qtip",f)}/(fixed|absolute)/.test(a.options.position.type)&&a.elements.tooltip.bind("mouseover.qtip", a.focus);a.options.position.target==="mouse"&&a.options.position.type!=="static"&&e.bind("mousemove.qtip",function(h){a.cache.mouse={x:h.pageX,y:h.pageY};a.status.disabled===false&&a.options.position.adjust.mouse===true&&a.options.position.type!=="static"&&a.elements.tooltip.css("display")!=="none"&&a.updatePosition(h)})}function M(){var b,c;b=this;c=b.getDimensions();b.elements.bgiframe=b.elements.wrapper.prepend('<div class="embed-container"> <iframe class="qtip-bgiframe" frameborder="0" tabindex="-1" src="javascript:false" style="display:block; position:absolute; z-index:-1; filter:alpha(opacity=\'0\'); border: 1px solid red; height:'+ c.height+"px; width:"+c.width+'px" />').children(".qtip-bgiframe:first")}function G(){var b,c,f,a;b=this;b.beforeRender.call(b);b.status.rendered=2;b.elements.tooltip='<div qtip="'+b.id+'" id="qtip-'+b.id+'" role="tooltip" aria-describedby="qtip-'+b.id+'-content" class="qtip '+(b.options.style.classes.tooltip||b.options.style)+'" style="display:none; -moz-border-radius:0; -webkit-border-radius:0; border-radius:0; position:'+b.options.position.type+';">   <div class="qtip-wrapper" style="position:relative; overflow:hidden; text-align:left;">     <div class="qtip-contentWrapper" style="overflow:hidden;">        <div id="qtip-'+ b.id+'-content" class="qtip-content '+b.options.style.classes.content+'"></div> </div></div></div>';b.elements.tooltip=d(b.elements.tooltip);b.elements.tooltip.appendTo(b.options.position.container);b.elements.tooltip.data("qtip",{current:0,interfaces:[b]});b.elements.wrapper=b.elements.tooltip.children("div:first");b.elements.contentWrapper=b.elements.wrapper.children("div:first");b.elements.content=b.elements.contentWrapper.children("div:first").css(x(b.options.style));d.browser.msie&&b.elements.wrapper.add(b.elements.content).css({zoom:1}); b.options.hide.when.event==="unfocus"&&b.elements.tooltip.attr("unfocus",true);typeof b.options.style.width.value==="number"&&b.updateWidth();if(d("<canvas />").get(0).getContext||d.browser.msie){b.options.style.border.radius>0?J.call(b):b.elements.contentWrapper.css({border:b.options.style.border.width+"px solid "+b.options.style.border.color});b.options.style.tip.corner!==false&&F.call(b)}else{b.elements.contentWrapper.css({border:b.options.style.border.width+"px solid "+b.options.style.border.color}); b.options.style.border.radius=0;b.options.style.tip.corner=false}if(typeof b.options.content.text==="string"&&b.options.content.text.length>0||b.options.content.text.jquery&&b.options.content.text.length>0)c=b.options.content.text;else if(b.elements.target.attr("title").length>0){b.cache.attr=["title",b.elements.target.attr("title")];c=b.cache.attr[1].replace(/\n/gi,"<br />")}else if(b.elements.target.attr("alt").length>0){b.cache.attr=["alt",b.elements.target.attr("alt")];c=b.cache.attr[1].replace(/\n/gi, "<br />")}else c=" ";b.cache.attr&&b.elements.target.removeAttr(b.cache.attr[0]);b.options.content.title.text!==false&&K.call(b);b.updateContent(c,false);L.call(b);b.options.show.ready===true&&b.show();if(b.options.content.url!==false){c=b.options.content.url;f=b.options.content.data;a=b.options.content.method||"get";b.loadContent(c,f,a)}b.status.rendered=true;b.onRender.call(b)}function N(b,c,f){var a=this;a.id=f;a.options=c;a.status={animated:false,rendered:false,disabled:false,focused:false};a.elements= {target:b.addClass(a.options.style.classes.target),tooltip:null,wrapper:null,content:null,contentWrapper:null,title:null,button:null,tip:null,bgiframe:null};a.cache={attr:null,mouse:{},toggle:0,overflow:{left:false,top:false}};a.timers={};d.extend(a,a.options.api,{show:function(e){function g(){a.elements.tooltip.attr("aria-hidden",true);a.options.position.type!=="static"&&a.focus();a.onShow.call(a,e);d.browser.msie&&a.elements.tooltip.get(0).style.removeAttribute("filter");a.elements.tooltip.css({opacity:""})} var i;if(!a.status.rendered)return false;if(a.elements.tooltip.css("display")!=="none")return a;a.elements.tooltip.stop(true,false);if(a.beforeShow.call(a,e)===false)return a;a.cache.toggle=1;a.options.position.type!=="static"&&a.updatePosition(e,a.options.show.effect.length>0&&a.rendered!==2);if(typeof a.options.show.solo==="object")i=d(a.options.show.solo);else if(a.options.show.solo===true)i=d("div.qtip").not(a.elements.tooltip);i&&i.each(function(){d(this).qtip("api").status.rendered===true&& d(this).qtip("api").hide()});if(typeof a.options.show.effect.type==="function"){a.options.show.effect.type.call(a.elements.tooltip,a.options.show.effect.length);a.elements.tooltip.queue(function(){g();d(this).dequeue()})}else{switch(a.options.show.effect.type.toLowerCase()){case "fade":a.elements.tooltip.fadeIn(a.options.show.effect.length,g);break;case "slide":a.elements.tooltip.slideDown(a.options.show.effect.length,function(){g();a.options.position.type!=="static"&&a.updatePosition(e,true)});break; case "grow":a.elements.tooltip.show(a.options.show.effect.length,g);break;default:a.elements.tooltip.show(null,g);break}a.elements.tooltip.addClass(a.options.style.classes.active)}return a},hide:function(e){function g(){a.elements.tooltip.attr("aria-hidden",true);a.elements.tooltip.css({opacity:""});a.onHide.call(a,e)}if(a.status.rendered){if(a.elements.tooltip.css("display")==="none")return a}else return false;clearTimeout(a.timers.show);a.elements.tooltip.stop(true,false);if(a.beforeHide.call(a, e)===false)return a;a.cache.toggle=0;if(typeof a.options.hide.effect.type==="function"){a.options.hide.effect.type.call(a.elements.tooltip,a.options.hide.effect.length);a.elements.tooltip.queue(function(){g();d(this).dequeue()})}else{switch(a.options.hide.effect.type.toLowerCase()){case "fade":a.elements.tooltip.fadeOut(a.options.hide.effect.length,g);break;case "slide":a.elements.tooltip.slideUp(a.options.hide.effect.length,g);break;case "grow":a.elements.tooltip.hide(a.options.hide.effect.length, g);break;default:a.elements.tooltip.hide(null,g);break}a.elements.tooltip.removeClass(a.options.style.classes.active)}return a},toggle:function(e,g){g=/boolean|number/.test(typeof g)?g:!a.elements.tooltip.is(":visible");a[g?"show":"hide"](e);return a},updatePosition:function(e,g){if(!a.status.rendered)return false;var i=c.position,h=d(i.target),j=a.elements.tooltip.outerWidth(),o=a.elements.tooltip.outerHeight(),m,p,l,r=i.corner.tooltip,u=i.corner.target,k,n,v,I={left:function(){var s=l.left+j-d(window).width()- d(window).scrollLeft(),t=r.x==="left"?-j:r.x==="right"?j:0,q=-2*i.adjust.x;l.left+=l.left<0?t+m+q:s>0?t-m+q:0;return Math.round(s)},top:function(){var s=l.top+o-d(window).height()-d(window).scrollTop(),t=r.y==="top"?-o:r.y==="bottom"?o:0,q=u.y==="top"?p:u.y==="bottom"?-p:0,H=-2*i.adjust.y;l.top+=l.top<0?t+p+H:s>0?t+q+H:0;return Math.round(s)}};if(e&&c.position.target==="mouse"){u={x:"left",y:"top"};m=p=0;l={top:e.pageY,left:e.pageX}}else{if(h[0]===document){m=h.width();p=h.height();l={top:0,left:0}}else if(h[0]=== window){m=h.width();p=h.height();l={top:h.scrollTop(),left:h.scrollLeft()}}else if(h.is("area")){k=a.options.position.target.attr("coords").split(",");for(n=0;n<k.length;n++)k[n]=parseInt(k[n],10);n=a.options.position.target.parent("map").attr("name");v=d('img[usemap="#'+n+'"]:first').offset();h.position={left:Math.floor(v.left+k[0]),top:Math.floor(v.top+k[1])};switch(a.options.position.target.attr("shape").toLowerCase()){case "rect":m=Math.ceil(Math.abs(k[2]-k[0]));p=Math.ceil(Math.abs(k[3]-k[1])); break;case "circle":m=k[2]+1;p=k[2]+1;break;case "poly":m=k[0];p=k[1];for(n=0;n<k.length;n++)if(n%2===0){if(k[n]>m)m=k[n];if(k[n]<k[0])l.left=Math.floor(v.left+k[n])}else{if(k[n]>p)p=k[n];if(k[n]<k[1])l.top=Math.floor(v.top+k[n])}m-=l.left-v.left;p-=l.top-v.top;break}m-=2;p-=2}else{m=h.outerWidth();p=h.outerHeight();l=h.offset()}l.left+=u.x==="right"?m:u.x==="center"?m/2:0;l.top+=u.y==="bottom"?p:u.y==="center"?p/2:0}l.left+=i.adjust.x+(r.x==="right"?-j:r.x==="center"?-j/2:0);l.top+=i.adjust.y+(r.y=== "bottom"?-o:r.y==="center"?-o/2:0);if(a.options.style.border.radius>0){if(r.x==="left")l.left-=a.options.style.border.radius;else if(r.x==="right")l.left+=a.options.style.border.radius;if(r.y==="top")l.top-=a.options.style.border.radius;else if(r.y==="bottom")l.top+=a.options.style.border.radius}i.adjust.screen&&function(){var s={x:0,y:0},t={x:I.left(),y:I.top()},q=new w(c.style.tip.corner);if(a.elements.tip&&q){if(q.x!=="center"&&t.x>-1)q.x=s.x=q.x==="left"?"right":"left";if(q.y!=="center"&&t.y> -1)q.y=s.y=q.y==="top"?"bottom":"top";a.cache.overflow={left:s.x===false,top:s.y===false};a.elements.tip.attr("rel")!==q.string()&&F.call(a,q)}}();!a.elements.bgiframe&&d.browser.msie&&parseInt(d.browser.version.charAt(0),10)===6&&M.call(a);if(a.beforePositionUpdate.call(a,e)===false)return a;if(c.position.target!=="mouse"&&g===true){a.status.animated=true;a.elements.tooltip.stop().animate(l,200,"swing",function(){a.status.animated=false})}else a.elements.tooltip.css(l);a.onPositionUpdate.call(a, e);return a},updateWidth:function(e){if(!a.status.rendered||e&&typeof e!=="number")return false;var g=a.elements.contentWrapper.siblings().add(a.elements.tip).add(a.elements.button),i=a.elements.wrapper.add(a.elements.contentWrapper.children()),h=a.elements.tooltip,j=a.options.style.width.max,o=a.options.style.width.min;if(!e)if(typeof a.options.style.width.value==="number")e=a.options.style.width.value;else{a.elements.tooltip.css({width:"auto"});g.hide();h.width(e);d.browser.msie&&i.css({zoom:""}); e=a.getDimensions().width;a.options.style.width.value||(e=Math.min(Math.max(e,o),j))}if(e%2)e+=1;a.elements.tooltip.width(e);g.show();a.options.style.border.radius&&a.elements.tooltip.find(".qtip-betweenCorners").each(function(){d(this).width(e-a.options.style.border.radius*2)});if(d.browser.msie){i.css({zoom:1});a.elements.wrapper.width(e);a.elements.bgiframe&&a.elements.bgiframe.width(e).height(a.getDimensions.height)}return a},updateStyle:function(e){var g,i,h,j;if(!a.status.rendered||typeof e!== "string"||!d.fn.qtip.styles[e])return false;a.options.style=B.call(a,d.fn.qtip.styles[e],a.options.user.style);a.elements.content.css(x(a.options.style));a.options.content.title.text!==false&&a.elements.title.css(x(a.options.style.title,true));a.elements.contentWrapper.css({borderColor:a.options.style.border.color});if(a.options.style.tip.corner!==false)if(d("<canvas />").get(0).getContext){e=a.elements.tooltip.find(".qtip-tip canvas:first");i=e.get(0).getContext("2d");i.clearRect(0,0,300,300);h= e.parent("div[rel]:first").attr("rel");j=y(h,a.options.style.tip.size.width,a.options.style.tip.size.height);D.call(a,e,j,a.options.style.tip.color||a.options.style.border.color)}else if(d.browser.msie){e=a.elements.tooltip.find('.qtip-tip [nodeName="shape"]');e.attr("fillcolor",a.options.style.tip.color||a.options.style.border.color)}if(a.options.style.border.radius>0){a.elements.tooltip.find(".qtip-betweenCorners").css({backgroundColor:a.options.style.border.color});if(d("<canvas />").get(0).getContext){g= z(a.options.style.border.radius);a.elements.tooltip.find(".qtip-wrapper canvas").each(function(){i=d(this).get(0).getContext("2d");i.clearRect(0,0,300,300);h=d(this).parent("div[rel]:first").attr("rel");C.call(a,d(this),g[h],a.options.style.border.radius,a.options.style.border.color)})}else d.browser.msie&&a.elements.tooltip.find('.qtip-wrapper [nodeName="arc"]').each(function(){d(this).attr("fillcolor",a.options.style.border.color)})}return a},updateContent:function(e,g){function i(){a.updateWidth(); if(g!==false){a.options.position.type!=="static"&&a.updatePosition(a.elements.tooltip.is(":visible"),true);a.options.style.tip.corner!==false&&E.call(a)}}var h,j,o;if(!a.status.rendered||!e)return false;h=a.beforeContentUpdate.call(a,e);if(typeof h==="string")e=h;else if(h===false)return;d.browser.msie&&a.elements.contentWrapper.children().css({zoom:"normal"});e.jquery&&e.length>0?e.clone(true).appendTo(a.elements.content).show():a.elements.content.html(e);j=a.elements.content.find("img[complete=false]"); if(j.length>0){o=0;j.each(function(){d('<img src="'+d(this).attr("src")+'" />').load(function(){++o===j.length&&i()})})}else i();a.onContentUpdate.call(a);return a},loadContent:function(e,g,i){function h(j){a.onContentLoad.call(a);a.updateContent(j)}if(!a.status.rendered)return false;if(a.beforeContentLoad.call(a)===false)return a;i==="post"?d.post(e,g,h):d.get(e,g,h);return a},updateTitle:function(e){if(!a.status.rendered||!e)return false;if(a.beforeTitleUpdate.call(a)===false)return a;if(a.elements.button)a.elements.button= a.elements.button.clone(true);a.elements.title.html(e);a.elements.button&&a.elements.title.prepend(a.elements.button);a.onTitleUpdate.call(a);return a},focus:function(e){var g,i,h;if(!a.status.rendered||a.options.position.type==="static")return false;g=parseInt(a.elements.tooltip.css("z-index"),10);i=15E3+d('div.qtip[id^="qtip"]').length-1;if(!a.status.focused&&g!==i){g=a.beforeFocus.call(a,e);if(g===false)return a;d('div.qtip[id^="qtip"]').not(a.elements.tooltip).each(function(){if(d(this).qtip("api").status.rendered=== true){h=parseInt(d(this).css("z-index"),10);typeof h==="number"&&h>-1&&d(this).css({zIndex:parseInt(d(this).css("z-index"),10)-1});d(this).qtip("api").status.focused=false}});a.elements.tooltip.css({zIndex:i});a.status.focused=true;a.onFocus.call(a,e)}return a},disable:function(e){if(!a.status.rendered)return false;a.status.disabled=e?true:false;return a},destroy:function(){var e,g;if(a.beforeDestroy.call(a)===false)return a;if(a.status.rendered){a.options.show.when.target.unbind("mousemove.qtip", a.updatePosition);a.options.show.when.target.unbind("mouseout.qtip",a.hide);a.options.show.when.target.unbind(a.options.show.when.event+".qtip");a.options.hide.when.target.unbind(a.options.hide.when.event+".qtip");a.elements.tooltip.unbind(a.options.hide.when.event+".qtip");a.elements.tooltip.unbind("mouseover.qtip",a.focus);a.elements.tooltip.remove()}else a.options.show.when.target.unbind(a.options.show.when.event+".qtip-"+a.id+"-create");if(typeof a.elements.target.data("qtip")==="object"){g=a.elements.target.data("qtip").interfaces; if(typeof g==="object"&&g.length>0)for(e=0;e<g.length-1;e++)g[e].id===a.id&&g.splice(e,1)}d.fn.qtip.interfaces.splice(a.id,1);if(typeof g==="object"&&g.length>0)a.elements.target.data("qtip").current=g.length-1;else a.elements.target.removeData("qtip");a.onDestroy.call(a);return a.elements.target},getPosition:function(){var e,g;if(!a.status.rendered)return false;(e=a.elements.tooltip.css("display")!=="none"?false:true)&&a.elements.tooltip.css({visiblity:"hidden"}).show();g=a.elements.tooltip.offset(); e&&a.elements.tooltip.css({visiblity:"visible"}).hide();return g},getDimensions:function(){var e,g;if(!a.status.rendered)return false;(e=!a.elements.tooltip.is(":visible")?true:false)&&a.elements.tooltip.css({visiblity:"hidden"}).show();g={height:a.elements.tooltip.outerHeight(),width:a.elements.tooltip.outerWidth()};e&&a.elements.tooltip.css({visiblity:"visible"}).hide();return g}})}d(document).ready(function(){var b;d(window).bind("resize scroll",function(c){for(b=0;b<d.fn.qtip.interfaces.length;b++){var f= d.fn.qtip.interfaces[b];if(f&&f.status&&f.status.rendered&&f.options.position.type!=="static"&&(f.options.position.adjust.scroll&&c.type==="scroll"||f.options.position.adjust.resize&&c.type==="resize"))f.updatePosition(c,true)}});d(document).bind("mousedown.qtip",function(c){d(c.target).parents("div.qtip").length===0&&d(".qtip[unfocus]").each(function(){var f=d(this).qtip("api");d(this).is(":visible")&&f&&f.status&&!f.status.disabled&&d(c.target).add(f.elements.target).length>1&&f.hide(c)})})});d.fn.qtip= function(b,c){var f,a,e,g,i,h,j,o;if(typeof b==="string")if(d(this).data("qtip"))if(b==="api")return d(this).data("qtip").interfaces[d(this).data("qtip").current];else{if(b==="interfaces")return d(this).data("qtip").interfaces}else return d(this);else{b||(b={});if(typeof b.content!=="object"||b.content.jquery&&b.content.length>0)b.content={text:b.content};if(typeof b.content.title!=="object")b.content.title={text:b.content.title};if(typeof b.position!=="object")b.position={corner:b.position};if(typeof b.position.corner!== "object")b.position.corner={target:b.position.corner,tooltip:b.position.corner};if(typeof b.show!=="object")b.show={when:b.show};if(typeof b.show.when!=="object")b.show.when={event:b.show.when};if(typeof b.show.effect!=="object")b.show.effect={type:b.show.effect};if(typeof b.hide!=="object")b.hide={when:b.hide};if(typeof b.hide.when!=="object")b.hide.when={event:b.hide.when};if(typeof b.hide.effect!=="object")b.hide.effect={type:b.hide.effect};if(typeof b.style!=="object")b.style={name:b.style};b.style= A(b.style);g=d.extend(true,{},d.fn.qtip.defaults,b);g.style=B.call({options:g},g.style);g.user=d.extend(true,{},b)}return d(this).each(function(){if(typeof b==="string"){h=b.toLowerCase();e=d(this).qtip("interfaces");if(typeof e==="object")if(c===true&&h==="destroy")for(f=e.length-1;f>-1;f--)"object"===typeof e[f]&&e[f].destroy();else{if(c!==true)e=[d(this).qtip("api")];for(f=0;f<e.length;f++)if(h==="destroy")e[f].destroy();else if(e[f].status.rendered===true)if(h==="show")e[f].show();else if(h=== "hide")e[f].hide();else if(h==="focus")e[f].focus();else if(h==="disable")e[f].disable(true);else if(h==="enable")e[f].disable(false);else h==="update"&&e[f].updatePosition()}}else{j=d.extend(true,{},g);j.hide.effect.length=g.hide.effect.length;j.show.effect.length=g.show.effect.length;if(j.position.container===false)j.position.container=d(document.body);if(j.position.target===false)j.position.target=d(this);if(j.show.when.target===false)j.show.when.target=d(this);if(j.hide.when.target===false)j.hide.when.target= d(this);j.position.corner.tooltip=new w(j.position.corner.tooltip);j.position.corner.target=new w(j.position.corner.target);a=d.fn.qtip.interfaces.length;for(f=0;f<a;f++)if(typeof d.fn.qtip.interfaces[f]==="undefined"){a=f;break}i=new N(d(this),j,a);d.fn.qtip.interfaces[a]=i;if(typeof d(this).data("qtip")==="object"&&d(this).data("qtip")){if(typeof d(this).attr("qtip")==="undefined")d(this).data("qtip").current=d(this).data("qtip").interfaces.length;d(this).data("qtip").interfaces.push(i)}else d(this).data("qtip", {current:0,interfaces:[i]});if(j.content.prerender===false&&j.show.when.event!==false&&j.show.ready!==true)j.show.when.target.bind(j.show.when.event+".qtip-"+a+"-create",{qtip:a},function(m){o=d.fn.qtip.interfaces[m.data.qtip];o.options.show.when.target.unbind(o.options.show.when.event+".qtip-"+m.data.qtip+"-create");o.cache.mouse={x:m.pageX,y:m.pageY};G.call(o);o.options.show.when.target.trigger(o.options.show.when.event)});else{i.cache.mouse={x:j.show.when.target.offset().left,y:j.show.when.target.offset().top}; G.call(i)}}})};d.fn.qtip.interfaces=[];d.fn.qtip.log={error:function(){return this}};d.fn.qtip.constants={};d.fn.qtip.defaults={content:{prerender:false,text:false,url:false,data:null,title:{text:false,button:false}},position:{target:false,corner:{target:"bottomRight",tooltip:"topLeft"},adjust:{x:0,y:0,mouse:true,screen:false,scroll:true,resize:true},type:"absolute",container:false},show:{when:{target:false,event:"mouseover"},effect:{type:"fade",length:100},delay:140,solo:false,ready:false},hide:{when:{target:false, event:"mouseout"},effect:{type:"fade",length:100},delay:0,fixed:false},api:{beforeRender:function(){},onRender:function(){},beforePositionUpdate:function(){},onPositionUpdate:function(){},beforeShow:function(){},onShow:function(){},beforeHide:function(){},onHide:function(){},beforeContentUpdate:function(){},onContentUpdate:function(){},beforeContentLoad:function(){},onContentLoad:function(){},beforeTitleUpdate:function(){},onTitleUpdate:function(){},beforeDestroy:function(){},onDestroy:function(){}, beforeFocus:function(){},onFocus:function(){}}};d.fn.qtip.styles={defaults:{background:"white",color:"#111",overflow:"hidden",textAlign:"left",width:{min:0,max:250},padding:"5px 9px",border:{width:1,radius:0,color:"#d3d3d3"},tip:{corner:false,color:false,size:{width:13,height:13},opacity:1},title:{background:"#e1e1e1",fontWeight:"bold",padding:"7px 12px"},button:{cursor:"pointer"},classes:{target:"",tip:"qtip-tip",title:"qtip-title",button:"qtip-button",content:"qtip-content",active:"qtip-active"}}, cream:{border:{width:3,radius:0,color:"#F9E98E"},title:{background:"#F0DE7D",color:"#A27D35"},background:"#FBF7AA",color:"#A27D35",classes:{tooltip:"qtip-cream"}},light:{border:{width:3,radius:0,color:"#E2E2E2"},title:{background:"#f1f1f1",color:"#454545"},background:"white",color:"#454545",classes:{tooltip:"qtip-light"}},dark:{border:{width:3,radius:0,color:"#303030"},title:{background:"#404040",color:"#f3f3f3"},background:"#505050",color:"#f3f3f3",classes:{tooltip:"qtip-dark"}},red:{border:{width:3, radius:0,color:"#CE6F6F"},title:{background:"#f28279",color:"#9C2F2F"},background:"#F79992",color:"#9C2F2F",classes:{tooltip:"qtip-red"}},green:{border:{width:3,radius:0,color:"#A9DB66"},title:{background:"#b9db8c",color:"#58792E"},background:"#CDE6AC",color:"#58792E",classes:{tooltip:"qtip-green"}},blue:{border:{width:3,radius:0,color:"#ADD9ED"},title:{background:"#D0E9F5",color:"#5E99BD"},background:"#E5F6FE",color:"#4D9FBF",classes:{tooltip:"qtip-blue"}}}})(jQuery);; 
 
//@ sourceURL=/js/jquery.multiselect-1.12.min.js 
/*
 * jQuery MultiSelect UI Widget 1.12
 * Copyright (c) 2011 Eric Hynds
 *
 * http://www.erichynds.com/jquery/jquery-ui-multiselect-widget/
 *
 * Depends:
 *   - jQuery 1.4.2+
 *   - jQuery UI 1.8 widget factory
 *
 * Optional:
 *   - jQuery UI effects
 *   - jQuery UI position utility
 *
 * Dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
 *
 */
(function(d){var j=0;d.widget("ech.multiselect",{options:{header:!0,height:175,minWidth:225,classes:"",checkAllText:"Check all",uncheckAllText:"Uncheck all",noneSelectedText:"Select options",selectedText:"# selected",selectedList:0,show:"",hide:"",autoOpen:!1,multiple:!0,position:{}},_create:function(){var a=this.element.hide(),b=this.options;this.speed=d.fx.speeds._default;this._isOpen=!1;a=(this.button=d('<button type="button"><span class="ui-icon ui-icon-triangle-2-n-s"></span></button>')).addClass("ui-multiselect ui-widget ui-state-default ui-corner-all").addClass(b.classes).attr({title:a.attr("title"), "aria-haspopup":!0,tabIndex:a.attr("tabIndex")}).insertAfter(a);(this.buttonlabel=d("<span />")).html(b.noneSelectedText).appendTo(a);var a=(this.menu=d("<div />")).addClass("ui-multiselect-menu ui-widget ui-widget-content ui-corner-all").addClass(b.classes).appendTo(document.body),c=(this.header=d("<div />")).addClass("ui-widget-header ui-corner-all ui-multiselect-header ui-helper-clearfix").appendTo(a);(this.headerLinkContainer=d("<ul />")).addClass("ui-helper-reset").html(function(){return!0=== b.header?'<li><a class="ui-multiselect-all" href="#"><span class="ui-icon ui-icon-check"></span><span>'+b.checkAllText+'</span></a></li><li><a class="ui-multiselect-none" href="#"><span class="ui-icon ui-icon-closethick"></span><span>'+b.uncheckAllText+"</span></a></li>":"string"===typeof b.header?"<li>"+b.header+"</li>":""}).append('<li class="ui-multiselect-close"><a href="#" class="ui-multiselect-close"><span class="ui-icon ui-icon-circle-close"></span></a></li>').appendTo(c);(this.checkboxContainer= d("<ul />")).addClass("ui-multiselect-checkboxes ui-helper-reset").appendTo(a);this._bindEvents();this.refresh(!0);b.multiple||a.addClass("ui-multiselect-single")},_init:function(){!1===this.options.header&&this.header.hide();this.options.multiple||this.headerLinkContainer.find(".ui-multiselect-all, .ui-multiselect-none").hide();this.options.autoOpen&&this.open();this.element.is(":disabled")&&this.disable()},refresh:function(a){var b=this.element,c=this.options,e=this.menu,h=this.checkboxContainer, g=[],f=[],i=b.attr("id")||j++;b.find("option").each(function(b){d(this);var a=this.parentNode,e=this.innerHTML,h=this.title,j=this.value,b=this.id||"ui-multiselect-"+i+"-option-"+b,k=this.disabled,m=this.selected,l=["ui-corner-all"];"optgroup"===a.tagName.toLowerCase()&&(a=a.getAttribute("label"),-1===d.inArray(a,g)&&(f.push('<li class="ui-multiselect-optgroup-label"><a href="#">'+a+"</a></li>"),g.push(a)));k&&l.push("ui-state-disabled");m&&!c.multiple&&l.push("ui-state-active");f.push('<li class="'+ (k?"ui-multiselect-disabled":"")+'">');f.push('<label for="'+b+'" title="'+h+'" class="'+l.join(" ")+'">');f.push('<input id="'+b+'" name="multiselect_'+i+'" type="'+(c.multiple?"checkbox":"radio")+'" value="'+j+'" title="'+e+'"');m&&(f.push(' checked="checked"'),f.push(' aria-selected="true"'));k&&(f.push(' disabled="disabled"'),f.push(' aria-disabled="true"'));f.push(" /><span>"+e+"</span></label></li>")});h.html(f.join(""));this.labels=e.find("label");this._setButtonWidth();this._setMenuWidth(); this.button[0].defaultValue=this.update();a||this._trigger("refresh")},update:function(){var a=this.options,b=this.labels.find("input"),c=b.filter("[checked]"),e=c.length,a=0===e?a.noneSelectedText:d.isFunction(a.selectedText)?a.selectedText.call(this,e,b.length,c.get()):/\d/.test(a.selectedList)&&0<a.selectedList&&e<=a.selectedList?c.map(function(){return d(this).next().text()}).get().join(", "):a.selectedText.replace("#",e).replace("#",b.length);this.buttonlabel.html(a);return a},_bindEvents:function(){function a(){b[b._isOpen?  "close":"open"]();return!1}var b=this,c=this.button;c.find("span").bind("click.multiselect",a);c.bind({click:a,keypress:function(a){switch(a.which){case 27:case 38:case 37:b.close();break;case 39:case 40:b.open()}},mouseenter:function(){c.hasClass("ui-state-disabled")||d(this).addClass("ui-state-hover")},mouseleave:function(){d(this).removeClass("ui-state-hover")},focus:function(){c.hasClass("ui-state-disabled")||d(this).addClass("ui-state-focus")},blur:function(){d(this).removeClass("ui-state-focus")}}); this.header.delegate("a","click.multiselect",function(a){if(d(this).hasClass("ui-multiselect-close"))b.close();else b[d(this).hasClass("ui-multiselect-all")?"checkAll":"uncheckAll"]();a.preventDefault()});this.menu.delegate("li.ui-multiselect-optgroup-label a","click.multiselect",function(a){a.preventDefault();var c=d(this),g=c.parent().nextUntil("li.ui-multiselect-optgroup-label").find("input:visible:not(:disabled)"),f=g.get(),c=c.parent().text();!1!==b._trigger("beforeoptgrouptoggle",a,{inputs:f, label:c})&&(b._toggleChecked(g.filter("[checked]").length!==g.length,g),b._trigger("optgrouptoggle",a,{inputs:f,label:c,checked:f[0].checked}))}).delegate("label","mouseenter.multiselect",function(){d(this).hasClass("ui-state-disabled")||(b.labels.removeClass("ui-state-hover"),d(this).addClass("ui-state-hover").find("input").focus())}).delegate("label","keydown.multiselect",function(a){a.preventDefault();switch(a.which){case 9:case 27:b.close();break;case 38:case 40:case 37:case 39:b._traverse(a.which, this);break;case 13:d(this).find("input")[0].click()}}).delegate('input[type="checkbox"], input[type="radio"]',"click.multiselect",function(a){var c=d(this),g=this.value,f=this.checked,i=b.element.find("option");this.disabled||!1===b._trigger("click",a,{value:g,text:this.title,checked:f})?a.preventDefault():(c.focus(),c.attr("aria-selected",f),i.each(function(){if(this.value===g)this.selected=f;else if(!b.options.multiple)this.selected=!1}),b.options.multiple||(b.labels.removeClass("ui-state-active"), c.closest("label").toggleClass("ui-state-active",f),b.close()),b.element.trigger("change"),setTimeout(d.proxy(b.update,b),10))});d(document).bind("mousedown.multiselect",function(a){b._isOpen&&!d.contains(b.menu[0],a.target)&&!d.contains(b.button[0],a.target)&&a.target!==b.button[0]&&b.close()});d(this.element[0].form).bind("reset.multiselect",function(){setTimeout(d.proxy(b.refresh,b),10)})},_setButtonWidth:function(){var a=this.element.outerWidth(),b=this.options;if(/\d/.test(b.minWidth)&&a<b.minWidth)a= b.minWidth;this.button.width(a)},_setMenuWidth:function(){var a=this.menu,b=this.button.outerWidth()-parseInt(a.css("padding-left"),10)-parseInt(a.css("padding-right"),10)-parseInt(a.css("border-right-width"),10)-parseInt(a.css("border-left-width"),10);a.width(b||this.button.outerWidth())},_traverse:function(a,b){var c=d(b),e=38===a||37===a,c=c.parent()[e?"prevAll":"nextAll"]("li:not(.ui-multiselect-disabled, .ui-multiselect-optgroup-label)")[e?"last":"first"]();c.length?c.find("label").trigger("mouseover"): (c=this.menu.find("ul").last(),this.menu.find("label")[e?"last":"first"]().trigger("mouseover"),c.scrollTop(e?c.height():0))},_toggleState:function(a,b){return function(){this.disabled||(this[a]=b);b?this.setAttribute("aria-selected",!0):this.removeAttribute("aria-selected")}},_toggleChecked:function(a,b){var c=b&&b.length?b:this.labels.find("input"),e=this;c.each(this._toggleState("checked",a));c.eq(0).focus();this.update();var h=c.map(function(){return this.value}).get();this.element.find("option").each(function(){!this.disabled&& -1<d.inArray(this.value,h)&&e._toggleState("selected",a).call(this)});c.length&&this.element.trigger("change")},_toggleDisabled:function(a){this.button.attr({disabled:a,"aria-disabled":a})[a?"addClass":"removeClass"]("ui-state-disabled");this.menu.find("input").attr({disabled:a,"aria-disabled":a}).parent()[a?"addClass":"removeClass"]("ui-state-disabled");this.element.attr({disabled:a,"aria-disabled":a})},open:function(){var a=this.button,b=this.menu,c=this.speed,e=this.options;if(!(!1===this._trigger("beforeopen")|| a.hasClass("ui-state-disabled")||this._isOpen)){var h=b.find("ul").last(),g=e.show,f=a.offset();d.isArray(e.show)&&(g=e.show[0],c=e.show[1]||this.speed);h.scrollTop(0).height(e.height);d.ui.position&&!d.isEmptyObject(e.position)?(e.position.of=e.position.of||a,b.show().position(e.position).hide().show(g,c)):b.css({top:f.top+a.outerHeight(),left:f.left}).show(g,c);this.labels.eq(0).trigger("mouseover").trigger("mouseenter").find("input").trigger("focus");a.addClass("ui-state-active");this._isOpen= !0;this._trigger("open")}},close:function(){if(!1!==this._trigger("beforeclose")){var a=this.options,b=a.hide,c=this.speed;d.isArray(a.hide)&&(b=a.hide[0],c=a.hide[1]||this.speed);this.menu.hide(b,c);this.button.removeClass("ui-state-active").trigger("blur").trigger("mouseleave");this._isOpen=!1;this._trigger("close")}},enable:function(){this._toggleDisabled(!1)},disable:function(){this._toggleDisabled(!0)},checkAll:function(){this._toggleChecked(!0);this._trigger("checkAll")},uncheckAll:function(){this._toggleChecked(!1); this._trigger("uncheckAll")},getChecked:function(){return this.menu.find("input").filter("[checked]")},destroy:function(){d.Widget.prototype.destroy.call(this);this.button.remove();this.menu.remove();this.element.show();return this},isOpen:function(){return this._isOpen},widget:function(){return this.menu},_setOption:function(a,b){var c=this.menu;switch(a){case "header":c.find("div.ui-multiselect-header")[b?"show":"hide"]();break;case "checkAllText":c.find("a.ui-multiselect-all span").eq(-1).text(b); break;case "uncheckAllText":c.find("a.ui-multiselect-none span").eq(-1).text(b);break;case "height":c.find("ul").last().height(parseInt(b,10));break;case "minWidth":this.options[a]=parseInt(b,10);this._setButtonWidth();this._setMenuWidth();break;case "selectedText":case "selectedList":case "noneSelectedText":this.options[a]=b;this.update();break;case "classes":c.add(this.button).removeClass(this.options.classes).addClass(b)}d.Widget.prototype._setOption.apply(this,arguments)}})})(jQuery);
; 
 
//@ sourceURL=/js/jquery.multiselect.filter-1.4.min.js 
/*
 * jQuery MultiSelect UI Widget Filtering Plugin 1.4
 * Copyright (c) 2011 Eric Hynds
 *
 * http://www.erichynds.com/jquery/jquery-ui-multiselect-widget/
 *
 * Depends:
 *   - jQuery UI MultiSelect widget
 *
 * Dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
 *
*/
(function(a){var f=/[\-\[\]{}()*+?.,\\\^$|#\s]/g;a.widget("ech.multiselectfilter",{options:{label:"Filter:",width:null,placeholder:"Enter keywords",autoReset:!1},_create:function(){var e;var b=this,c=this.options,d=this.instance=a(this.element).data("multiselect");this.header=d.menu.find(".ui-multiselect-header").addClass("ui-multiselect-hasfilter");e=this.wrapper=a('<div class="ui-multiselect-filter">'+(c.label.length?c.label:"")+'<input placeholder="'+c.placeholder+'" type="search"'+(/\d/.test(c.width)?  'style="width:'+c.width+'px"':"")+" /></div>").prependTo(this.header),c=e;this.inputs=d.menu.find('input[type="checkbox"], input[type="radio"]');this.input=c.find("input").bind({keydown:function(a){13===a.which&&a.preventDefault()},keyup:a.proxy(b._handler,b),click:a.proxy(b._handler,b)});this.updateCache();d._toggleChecked=function(c,d){var e=d&&d.length?d:this.labels.find("input"),i=this,e=e.not(b.instance._isOpen?":disabled, :hidden":":disabled").each(this._toggleState("checked",c));this.update(); var j=e.map(function(){return this.value}).get();this.element.find("option").filter(function(){!this.disabled&&-1<a.inArray(this.value,j)&&i._toggleState("selected",c).call(this)})};d=a(document).bind("multiselectrefresh",function(){b.updateCache();b._handler()});this.options.autoReset&&d.bind("multiselectclose",a.proxy(this._reset,this))},_handler:function(b){var c=a.trim(this.input[0].value.toLowerCase()),d=this.rows,g=this.inputs,h=this.cache;if(c){d.hide();var e=RegExp(c.replace(f,"\\$&"),"gi"); this._trigger("filter",b,a.map(h,function(a,b){return-1!==a.search(e)?(d.eq(b).show(),g.get(b)):null}))}else d.show();this.instance.menu.find(".ui-multiselect-optgroup-label").each(function(){var b=a(this),c=b.nextUntil(".ui-multiselect-optgroup-label").filter(function(){return"none"!==a.css(this,"display")}).length;b[c?"show":"hide"]()})},_reset:function(){this.input.val("").trigger("keyup")},updateCache:function(){this.rows=this.instance.menu.find(".ui-multiselect-checkboxes li:not(.ui-multiselect-optgroup-label)");this.cache=this.element.children().map(function(){var b=a(this);"optgroup"===this.tagName.toLowerCase()&&(b=b.children());return b.map(function(){return this.innerHTML.toLowerCase()}).get()}).get()},widget:function(){return this.wrapper},destroy:function(){a.Widget.prototype.destroy.call(this);this.input.val("").trigger("keyup");this.wrapper.remove()}})})(jQuery);
; 
 
//@ sourceURL=/js/qb.multiselect.js 
(function($){var _original_behavior_bindEvents=$.ech.multiselect.prototype._bindEvents;var _original_behavior_create=$.ech.multiselect.prototype._create;var _original_behavior_open=$.ech.multiselect.prototype.open;var _original_behavior_close=$.ech.multiselect.prototype.close;var defaultOpts={noneSelectedText:"Make a selection...",classes:"qbMultiselect",dbid:gReqDBID,maxChecked:gMultiUserFieldMaxEntries,selectedList:gMultiUserFieldMaxEntries,errorText:"You have reached the limit of "+gMultiUserFieldMaxEntries+" users.",height:"100%",errorElemId:"MVUFError_",onChangeFcn:"",fixIEScroll:false,minWidth:250,fixIEzindex:false};var defaultFilterOpts={label:"Search"};$.extend($.ech.multiselectfilter.prototype.options,defaultFilterOpts);$.extend($.ech.multiselect.prototype.options,defaultOpts);$.ech.multiselect.prototype.open=function(){_original_behavior_open.call(this);if(this.options.fixIEzindex&&IsIE()){this.menu.parent().css("z-index","7369")}},$.ech.multiselect.prototype.close=function(){_original_behavior_close.call(this);if(this.options.fixIEzindex&&IsIE()){this.menu.parent().css("z-index","")}},$.ech.multiselect.prototype._create=function(){_original_behavior_create.call(this);var errorElemId=this.options.errorElemId+this.element.attr("id");if(document.getElementById(errorElemId)==null){var elemtoInsertAfter=this.header.first();var elemToInsert="<div id= "+errorElemId+" class='MVUFErrorMsg nodisplay'><span>"+this.options.errorText+"</span></div>";elemToInsert=$(elemToInsert);elemToInsert.insertAfter(elemtoInsertAfter)}if(this.element.multiselect("getChecked").length>=this.options.maxChecked){this._disableUnchecked();$("#"+errorElemId).removeClass("nodisplay")}},$.ech.multiselect.prototype._bindEvents=function(){_original_behavior_bindEvents.call(this);var self=this;var el=this.element;var id=el.attr("id");var o=this.options;this.menu.delegate("._other","click",function(e){if(el.multiselect("getChecked").length>=o.maxChecked){return false}if(IsIE()){self.close()}OpenUserChooser(o.dbid,"su","aph=1&iau=1&qsel=1","","",id,"");return false});this.menu.delegate(":checkbox, :radio","click",function(e){var errorElemId="#"+o.errorElemId+id;if(el.multiselect("getChecked").length>=o.maxChecked){self._disableUnchecked();$(errorElemId).removeClass("nodisplay")}else{self._enableUnchecked();$(errorElemId).addClass("nodisplay")}self.onChange()})},$.ech.multiselect.prototype.refresh=function(init){var el=this.element,o=this.options,menu=this.menu,button=this.button,checkboxContainer=this.checkboxContainer,optgroups=[],id=el.attr("id"),errorElem=document.getElementById(o.errorElemId+id);checkboxContainer.empty();var nSelected=0;this.element.find("option").each(function(i){var _this=$(this),title=_this.html(),value=this.value,inputID=this.id||"ui-multiselect-"+id+"-option-"+i,$parent=_this.parent(),isDisabled=_this.is(":disabled"),labelClasses=["ui-corner-all"],label,input,li;if($parent.is("optgroup")){var optLabel=$parent.attr("label");if($.inArray(optLabel,optgroups)===-1){$('<li><a href="#">'+optLabel+"</a></li>").addClass("ui-multiselect-optgroup-label").appendTo(checkboxContainer);optgroups.push(optLabel)}}if(value.length>0){if(this.selected){++nSelected}if(isDisabled){labelClasses.push("ui-state-disabled")}if(value=="_other"){labelClasses.push("_other")}li=$("<li />").addClass(isDisabled?"ui-multiselect-disabled":"").appendTo(checkboxContainer);label=$("<label />").attr("for",inputID).addClass(labelClasses.join(" ")).appendTo(li);if(value=="_other"||value=="_div"){$('<input type="hidden" '+(this.selected?'checked="checked"':"")+' name="multiselect_'+id+'" />').attr({id:inputID,checked:this.selected,title:HTMLDecode(title),disabled:isDisabled,"aria-disabled":isDisabled,"aria-selected":this.selected}).val(value).appendTo(label).after("<span>"+title+"</span>")}else{$('<input type="'+(o.multiple?"checkbox":"radio")+'" '+(this.selected?'checked="checked"':"")+' name="multiselect_'+id+'" />').attr({id:inputID,checked:this.selected,title:HTMLDecode(title),disabled:isDisabled,"aria-disabled":isDisabled,"aria-selected":this.selected}).val(value).appendTo(label).after("<span>"+title+"</span>")}}});this.labels=menu.find("label");this._setButtonWidth();this._setMenuWidth();button[0].defaultValue=this.update();if(nSelected>=o.maxChecked){this._disableUnchecked();$(errorElem).removeClass("nodisplay")}else{if(!$(errorElem).hasClass("nodisplay")){$(errorElem).addClass("nodisplay")}}if(!init){this._trigger("refresh")}},$.ech.multiselect.prototype._toggleChecked=function(flag,group){var _inputs=(group&&group.length)?group:this.labels.find("input");_inputs.not(":disabled , :hidden").attr({checked:flag,"aria-selected":flag});this.update();var values=_inputs.map(function(){return this.value}).get();this.element.find("option").filter(function(){return !this.disabled&&$.inArray(this.value,values)>-1}).attr({selected:flag,"aria-selected":flag})},$.ech.multiselect.prototype.update=function(){var o=this.options,_inputs=this.labels.find("input"),_checked=_inputs.filter(":checked"),numChecked=_checked.length,value;var title="";if(numChecked===0){value='<span class="wrapper invisibleWrapper">'+o.noneSelectedText+"</span>"}else{if(/\d/.test(o.selectedList)&&o.selectedList>0&&numChecked<=o.selectedList){value='<span class="wrapper">';value+=_checked.map(function(){return HTMLEncode(this.title)}).get().join('</span><span class="wrapper">');value+="</span>"}else{value='<span class="wrapper invisibleWrapper">'+o.selectedText.replace("#",numChecked).replace("#",_inputs.length)+"</span>";title=_checked.map(function(){return this.title}).get().join(" ; ")}}this.buttonlabel.html(value);this.button.attr("title",title);var self=this;var pos=this.button.offset();this.menu.css({top:pos.top+this.button.outerHeight(),left:pos.left});return value},$.ech.multiselect.prototype._disableUnchecked=function(){var _inputs=this.labels.find("input").not(":disabled , :checked");_inputs.attr({disabled:true});_inputs.parent().addClass("ui-state-disabled");var _spans=_inputs.siblings("span");_spans.addClass("multiselect-disabled-span")},$.ech.multiselect.prototype._enableUnchecked=function(){var _inputs=this.labels.find("input:disabled").not(":checked");_inputs.attr({disabled:false});_inputs.parent().removeClass("ui-state-disabled");var _spans=_inputs.siblings("span");_spans.removeClass("multiselect-disabled-span")},$.ech.multiselect.prototype.onChange=function(){var o=this.options;if($.isFunction(o.onChangeFcn)){o.onChangeFcn.call(this.element.get(0))}}})(jQuery);; 
 
//@ sourceURL=/js/jquery.qbmenu.js 
/*
jQuery QB Menu Plugin v1.2
Copyright (c) 2011 Intuit QuickBase
*/
$.widget("ui.qbMenu",{options:{menuSelector:".Menu",bindSubmenus:true,unbindSubmenus:true,maxHeight:null,autoSizeFromBottom:false,menuNoSmallerThanTrigger:false,detachSubmenusInto:null,zindex:100,trigger:{selector:null,highlight:"Open",isContextMenu:false,showOnHover:false,disableTooltipOnMenuDeploy:true,tooltipAttribute:"data-original-title",showOnHoverFromOpenSibling:false,keepSubMenuOpenOnMouseLeave:false,position:{of:null,my:"left top",at:"left bottom",collision:"fit",offset:"0 0"}},triggers:[]},triggerOptions:{selector:null,highlight:"Open",isContextMenu:false,showOnHover:false,showOnHoverFromOpenSibling:false,position:{of:null,my:"left top",at:"left bottom",collision:"fit"}},_keyBindings:{vertical:{open:$.ui.keyCode.RIGHT,close:$.ui.keyCode.LEFT,prev:$.ui.keyCode.UP,next:$.ui.keyCode.DOWN},horizontal:{open:$.ui.keyCode.DOWN,close:$.ui.keyCode.UP,prev:$.ui.keyCode.LEFT,next:$.ui.keyCode.RIGHT}},addTrigger:function(elt){var triggerOptions=$.extend(true,{},this.options.trigger,{selector:elt});this.options.triggers.push(triggerOptions);this._bindToTrigger(triggerOptions,true)},showMenu:function(evt,el,triggerOptions){this._ShowMenu(evt,el,triggerOptions)},_ShowMenu:function(evt,el,triggerOptions){var self=this;if(evt.type=="mouseup"){if(triggerOptions.isContextMenu&&(evt.which!=3)){return}if(!triggerOptions.isContextMenu&&(evt.which!=1)){return}}this._HideMenu(evt,self.menu,triggerOptions);if(false===self._trigger("beforeOpen",evt,{originalTarget:el})){return}if(triggerOptions.disableTooltipOnMenuDeploy){self.triggerEl=$(triggerOptions.selector).first();self.triggerTooltipText=$(self.triggerEl).attr(triggerOptions.tooltipAttribute);$(self.triggerEl).removeAttr(triggerOptions.tooltipAttribute)}var pos=triggerOptions.position;var positionParams={of:(pos.of==null?el:(pos.of=="evt"?evt:pos.of)),my:pos.my,at:pos.at,collision:pos.collision,offset:pos.offset};self.IsOpen=true;this.menu.show();this.menu.data("currentTarget",evt.currentTarget);if(positionParams.of&&this.options.menuNoSmallerThanTrigger){var w=$(positionParams.of).outerWidth();if(w){this.menu.css("min-width",w+"px")}else{this.menu.css("min-width",null)}}else{this.menu.css("min-width",null)}if(this.options.maxHeight){var height=this.menu.height();var maxHeight=this.options.maxHeight;var viewportHeight=$(window).height();if(maxHeight=="auto"){if(window.menuPosTestElem==null){window.menuPosTestElem=$("<span></span>").css({width:"1px",height:"1px",position:"absolute",top:"0",left:"0",display:"none"});$(document.body).append(window.menuPosTestElem)}window.menuPosTestElem.show();window.menuPosTestElem.position(positionParams);var topOfMenu=window.menuPosTestElem.offset().top-$(window).scrollTop();window.menuPosTestElem.hide();maxHeight=viewportHeight-topOfMenu-8}if(height>maxHeight){if(this.options.autoSizeFromBottom){if(height<viewportHeight){var diff=height-maxHeight;this.menu.css("top",parseInt(this.menu.css("top"))-diff)}else{var diff=viewportHeight-maxHeight;this.menu.css("top",parseInt(this.menu.css("top"))-diff);this.menu.css("max-height",viewportHeight+"px");this.menu.addClass("Scrolling")}}else{this.menu.css("max-height",maxHeight+"px");this.menu.addClass("Scrolling")}}else{this.menu.removeClass("Scrolling")}}else{this.menu.removeClass("Scrolling")}this.menu.css({left:"0",top:"0"});this.menu.position(positionParams);if(evt.type&&evt.type.indexOf("key")==0){self._selectFirst()}if(triggerOptions.highlight){$(triggerOptions.selector).addClass(triggerOptions.highlight)}$(window).one("resize.ui-qbmenu",function(evt){if(self.IsOpen&&!Modernizr.touch){self._HideMenu(evt,self.menu,triggerOptions)}});self._trigger("open",evt,{originalTarget:el});self._tempDocClickHandler=(function(evt){self._HideMenu(evt,self.menu,triggerOptions)});setTimeout(function(){if(self._tempDocClickHandler){$(document).bind("click.ui-qbmenu",self._tempDocClickHandler)}},250)},hide:function(){this._HideMenu({},this,this.options.trigger)},_HideMenu:function(evt,el,triggerOptions){$(window).off("resize.ui-qbmenu");if(evt.type==="mouseup"||evt.type==="click"){if(!triggerOptions.isContextMenu&&evt.button===2){return false}if(!this.menu.is(".CloseMenu")){var closest=$(evt.target).closest(".NoCloseMenu");if(closest.length>0){return false}}}if(triggerOptions.disableTooltipOnMenuDeploy){if(this.triggerTooltipText&&this.triggerTooltipText!=$(this.triggerEl).attr(triggerOptions.tooltipAttribute)){$(this.triggerEl).attr(triggerOptions.tooltipAttribute,this.triggerTooltipText)}}if(this.menu.hasClass("Scrolling")){this.menu.scrollTop(0)}if(this.selectedItem){this._Select(null)}this.menu.hide();this.menu.css("max-height","");if(triggerOptions.highlight){$(triggerOptions.selector).removeClass(triggerOptions.highlight)}if(this._tempDocClickHandler){$(document).unbind("click.ui-qbmenu",this._tempDocClickHandler)}this._tempDocClickHandler=null;if(this.IsOpen){this._trigger("close",evt)}this.IsOpen=false;$.each(this.submenus||[],function(index,submenu){submenu.qbMenu("hide")})},GetTarget:function(){return this.menu.data("currentTarget")},_DefaultMoveMenu:function(){this.menu.position({of:document.body,my:"right bottom",at:"right top",offset:"-999px",collision:"none"})},_FocusMenuItem:function(menuItem,isMovingBackwards){var focusable=this._GetSelectableElement(menuItem);if(focusable==null){return false}if(menuItem.hasClass("SubFocusable")){var subfSelector=menuItem.attr(isMovingBackwards?"data-menu-lastfocus":"data-menu-firstfocus");if(subfSelector){focusable=menuItem.find(subfSelector).first();focusable.focus()}return false}menuItem.addClass("Selected");focusable.focus();focusable.blur(function(){menuItem.removeClass("Selected")});return true},_BlurMenuItem:function(menuItem){var focusable=this._GetSelectableElement(menuItem);if(focusable==null){return false}menuItem.removeClass("Selected");focusable.blur();return true},_Select:function(selectedItem,isMovingBackwards){if(this.selectedItem){this._BlurMenuItem(this.selectedItem);this.selectedItem=null}if(selectedItem&&selectedItem.length>0){this._FocusMenuItem(selectedItem,isMovingBackwards);this.selectedItem=selectedItem;return true}return false},_selectFirst:function(){return this._Select($(this.menu).children(".Selectable").first())},_selectLast:function(){return this._Select($(this.menu).children(".Selectable").last())},_GetPrevSelectable:function(elt){if(!elt||!elt.length){return null}var prev=elt.prev();while(prev.length>0&&!prev.hasClass("Selectable")){prev=prev.prev()}if(prev.length==0){return null}return prev},_GetNextSelectable:function(elt){if(!elt||!elt.length){return null}var next=elt.next(":visible");while(next.length>0&&!next.hasClass("Selectable")){next=next.next(":visible")}if(next.length==0){return null}return next},_selectPrev:function(){var prev=this._GetPrevSelectable(this.selectedItem);if(prev==null){return false}return this._Select(prev,true)},_selectNext:function(isPageLength){var next=this._GetNextSelectable(this.selectedItem);if(next==null){return false}return this._Select(next)},_bind:function(doBind,obj,evtType,listener){if(doBind){obj.bind(evtType,listener)}else{obj.live(evtType,listener)}},_HideOpenSiblings:function(triggerObj,triggerOptions){if(!triggerOptions){triggerOptions=this.options.triggerOptions}var trigger=$(triggerOptions.selector);var selectedSiblings=trigger.siblings(".Selected");if(selectedSiblings.length!=0){this._BlurMenuItem(selectedSiblings)}var openSiblings=trigger.siblings("."+triggerOptions.highlight);if(openSiblings.length==0){return false}var hider=openSiblings.data("ui-qbmenu-hide");if(typeof(hider)=="function"){hider.call()}this._BlurMenuItem(openSiblings);return true},_KeyHandler:function(event,onSelector,target,triggerOptions){var self=this;var keyCodes=$.ui.keyCode;var key,isKeyDown,isKeyPress,isKeyUp;var trigger=$(triggerOptions.selector);var eventTarget=$(event.target);isKeyDown=(event.type=="keydown");isKeyPress=(event.type=="keypress");isKeyUp=(event.type=="keyup");key=null;if(typeof event.which=="undefined"){key=event.keyCode}else{if(!isKeyPress&&event.which!=0){key=event.keyCode}else{return}}if(key==this._keyBindings.vertical.prev||key==this._keyBindings.vertical.next){event.stopPropagation();event.preventDefault()}if(!isKeyUp==((key!=keyCodes.TAB)&&(key!=keyCodes.ENTER))){return}var bindings=this._keyBindings.vertical;if(onSelector&&this.options.isMenuBarItem){bindings=this._keyBindings.horizontal}if(onSelector){if(key==bindings.open||key==keyCodes.ENTER){this._ShowMenu(event,target,triggerOptions);event.stopPropagation();return false}if(key==keyCodes.TAB&&!event.shiftKey&&this.IsOpen){this._selectFirst();event.stopPropagation();return false}if(!this.options.isMenuBarItem){return}if(key==keyCodes.ESCAPE){self._HideMenu(event,self.menu,triggerOptions);return false}if(key==keyCodes.TAB){this._HideMenu(event,self.menu,triggerOptions);trigger.removeClass("Selected");var itemToSelect=event.shiftKey?this._GetPrevSelectable(trigger):this._GetNextSelectable(trigger);if(itemToSelect==null){return true}this._FocusMenuItem(itemToSelect);event.stopPropagation();event.preventDefault();return false}if(key==bindings.prev||key==bindings.next){event.stopPropagation();event.preventDefault();var itemToSelect=(key==bindings.prev)?this._GetPrevSelectable(trigger):this._GetNextSelectable(trigger);if(itemToSelect!=null){this._HideMenu(event,self.menu,triggerOptions);this._BlurMenuItem(trigger);this._FocusMenuItem(itemToSelect)}return false}return}if(key==keyCodes.ENTER){event.stopPropagation();var a=null;if(eventTarget.is("a")){a=eventTarget}else{if(eventTarget.children("a").length>0){a=eventTarget.children("a").first()}}if(a&&a.length>0&&!a.attr("href")){a.click();$(document.body).trigger("click.ui-qbmenu");return false}return}if(key==keyCodes.ESCAPE||key==bindings.close){self._HideMenu(event,self.menu,triggerOptions);this._FocusMenuItem(trigger);return false}if(key==bindings.prev||(key==keyCodes.TAB&&event.shiftKey)){var success=this._selectPrev();if(!success){this._Select(null);this._FocusMenuItem(trigger)}event.preventDefault();event.stopPropagation();return false}if(key==bindings.next||key==keyCodes.TAB){this._selectNext();event.preventDefault();event.stopPropagation();return false}if(key==bindings.open){event.stopPropagation()}},hideTimeout:null,KeepOpen:function(){if(this.hideTimeout!=null){clearTimeout(this.hideTimeout);this.hideTimeout=null}},_isScrollbarClick:function(event){return event.originalTarget&&(""+event.originalTarget)=="[object XULElement]"},bindAdditionalTrigger:function(triggerObj){this.options.triggers.push(triggerObj);var triggerOptions=jQuery.extend(true,{},this.triggerOptions,triggerObj);this._bindToTrigger(triggerOptions,false)},_bindToTrigger:function(triggerOptions,doBind){var self=this;if(!triggerOptions.selector){return}var obj=$(triggerOptions.selector);if(obj.length==0){return}obj.data("ui-qbmenu-hide",function(){self._HideMenu({},self,triggerOptions)});obj.data("ui-qbmenu-show",function(){self._ShowMenu({},self,triggerOptions)});obj.data("ui-qbmenu-menu",self.menu);this._MarkSelectable(obj);var ShowMenu=(function(event){return self._ShowMenu(event,this,triggerOptions)});var HideMenu=(function(event){return self._HideMenu(event,this,triggerOptions)});var ToggleMenu=(function(event){if(self._isScrollbarClick(event)){return}if(self.IsOpen){return self._HideMenu(event,this,triggerOptions)}else{return self._ShowMenu(event,this,triggerOptions)}});var KeyPressSelector=(function(event){return self._KeyHandler(event,true,this,triggerOptions)});var KeyPressMenu=(function(event){return self._KeyHandler(event,false,this,triggerOptions)});var CancelHideTimeout=(function(event){self.KeepOpen()});var MouseEnter=(function(event){if(triggerOptions.selector&&triggerOptions.highlight&&triggerOptions.showOnHoverFromOpenSibling){var trigger=$(triggerOptions.selector);var foundOpenSiblings=true;if(!self._HideOpenSiblings(trigger,triggerOptions)){foundOpenSiblings=false}else{trigger.addClass("Selected").children("a").focus()}}var doShow=false;if(!foundOpenSiblings){if(triggerOptions.showOnHover){doShow=self._ShowMenu(event,this,triggerOptions)}}else{if(triggerOptions.showOnHoverFromOpenSibling){doShow=self._ShowMenu(event,this,triggerOptions)}}return doShow});var MouseLeave=(function(event){var relatedTarget=event.relatedTarget;var relatedTarget$=$(relatedTarget);var target=event.target;var target$=$(target);if(relatedTarget==self.menu[0]){return}if(relatedTarget==obj[0]){return}if(relatedTarget$.parent()[0]==obj[0]){return}if(triggerOptions.showOnHover){var targetParent=target$.parent()[0];if(triggerOptions.keepSubMenuOpenOnMouseLeave&&(targetParent==self.menu[0]||$(targetParent).parent()[0]==self.menu[0])){return}var evtThis=this;self.hideTimeout=setTimeout(function(){self._HideMenu(event,evtThis,triggerOptions)},25);return true}});self._bind(doBind,obj,"click.ui-qbmenu",ToggleMenu);if(triggerOptions.showOnHover||triggerOptions.showOnHoverFromOpenSibling){self._bind(doBind,obj,"mouseenter.ui-qbmenu",MouseEnter);self._bind(doBind,obj,"mouseleave.ui-qbmenu",MouseLeave);self._bind(doBind,self.menu,"mouseenter.ui-qbmenu",CancelHideTimeout);self._bind(doBind,self.menu,"mouseleave.ui-qbmenu",MouseLeave)}if(triggerOptions.isContextMenu){self._bind(doBind,obj,"contextmenu.ui-qbmenu",function(){return false})}else{if(triggerOptions.position.of!="evt"){self._bind(doBind,obj,"keydown.ui-qbmenu keypress.ui-qbmenu keyup.ui-qbmenu",KeyPressSelector);self.menu.bind("keydown.ui-qbmenu keypress.ui-qbmenu keyup.ui-qbmenu",KeyPressMenu)}}},_unbindFromTrigger:function(triggerOptions){if(!triggerOptions.selector){return}var obj=$(triggerOptions.selector);obj.die(".ui-qbmenu");obj.unbind(".ui-qbmenu");if(this.menu){this.menu.die(".ui-qbmenu");this.menu.unbind(".ui-qbmenu")}},setPosition:function(pos){if(!pos){return}this.options.trigger.position=$.extend(this.options.trigger.position,pos);return this.options.trigger.position},_FindSubMenus:function(){return $(this.element).find(this.options.menuSelector)},AddSubMenu:function(submenu){this.submenus.push(submenu)},RemoveSubMenu:function(submenu){if(!submenu){return}this.submenus=_.filter(this.submenus,function(menu){return submenu[0]==menu[0]})},_SetupSubMenus:function(){var submenus=this._FindSubMenus();this.submenus=[];for(var i=0;i<submenus.length;++i){var submenu=submenus.eq(i);var parent=submenu.parent();parent.addClass("SubMenu");submenu.data("parent",parent);var childmenu=submenu.qbMenu({zindex:this.options.zindex+1,trigger:{selector:parent,showOnHover:true,position:{my:"left top",at:"right top",collision:"flip"}}});this.submenus.push(childmenu);if(this.options.detachSubmenusInto){$(this.options.detachSubmenusInto).append(submenu.detach())}}},_MarkSelectable:function(elt){var self=this;var elt=$(elt);if(elt.hasClass("SubFocusable")){elt.bind("keydown keypress",function(event){if(event.keyCode!=$.ui.keyCode.TAB){return}var isMovingBackwards=event.shiftKey;var subfSelector=elt.attr(isMovingBackwards?"data-menu-firstfocus":"data-menu-lastfocus");if(subfSelector){focusable=elt.find(subfSelector).first();if(focusable&&focusable[0]==event.target){return}}event.stopPropagation()});return}var selectableElt=this._GetSelectableElement(elt);if(selectableElt!=null&&selectableElt.length>0){elt.addClass("Selectable");selectableElt.attr("tabindex",0)}else{elt.removeClass("Selectable")}},_GetSelectableElement:function(elt){var elt=$(elt);if(elt.hasClass("Separator")||elt.hasClass("SkipFocus")||elt.hasClass("Title")){return null}var a=elt.children("a").first();if(a.length>0){return a}return elt},_create:function(){if(this.options.triggers==null){$.Widget.prototype.destroy.apply(this,arguments);return}var self=this;this.menu=$(this.element).addClass("ui-qbmenu").hide();if(this.options.zindex){this.menu.css("z-index",this.options.zindex)}this._DefaultMoveMenu();this.menu.children().each(function(index,elt){self._MarkSelectable(elt)});this._bindToTrigger(this.options.trigger,true);$.each(this.options.triggers,function(index,val){var triggerOptions=jQuery.extend(true,{},self.triggerOptions,val);self._bindToTrigger(triggerOptions,false)});if(this.options.bindSubmenus){this._SetupSubMenus()}},destroy:function(){$.Widget.prototype.destroy.apply(this,arguments);if(this.options.unbindSubmenus){var submenus=this._FindSubMenus();for(var i=0;i<submenus.length;++i){var submenu=submenus.eq(i);submenu.menu("destroy");var parent=submenu.data("parent");parent.removeClass("SubMenu");parent.append(submenu.detach())}}$.Widget.prototype.destroy.apply(this,arguments);this._unbindFromTrigger(this.options.trigger);for(var triggerOptions in this.options.triggers){this._unbindFromTrigger(triggerOptions)}this.menu.unbind("ui-qbmenu");this.menu.removeClass("ui-qbmenu");this.menu.removeData("currentTarget");this.menu=null;if(this._tempDocClickHandler){$(document).unbind("click.ui-qbmenu",this._tempDocClickHandler);this._tempDocClickHandler=null}}});$.widget("ui.qbMenuBar",{options:{menuOptions:{trigger:{showOnHoverFromOpenSibling:true,highlight:"Open"}},menuTriggerSelector:null,menuBodySelector:".Menu"},_create:function(){var self=this;var menuTriggers=$(this.element).children();switch(this.options.menuTriggerSelector){case null:case"":case"*":break;default:menuTriggers=menuTriggers.filter(this.options.menuTriggerSelector)}self.menus=[];menuTriggers.each(function(index,elt){var trig=$(elt);var menu=trig.children(self.options.menuBodySelector);if(menu.length==0){return}var menuOptions=$.extend(true,{},self.options.menuOptions,{isMenuBarItem:true,trigger:{selector:trig}});menu.qbMenu(menuOptions);self.menus.push(menu)})},destroy:function(){$.Widget.prototype.destroy.apply(this,arguments);$.each(this.menus,function(index,elt){$(elt).qbMenu("destroy")})}});; 
 
//@ sourceURL=/js/jquery.placeholder.min.js 
/*! http://mths.be/placeholder v1.8.7 by @mathias */
(function(f,h,c){var a='placeholder' in h.createElement('input'),d='placeholder' in h.createElement('textarea'),i=c.fn,j;if(a&&d){j=i.placeholder=function(){return this};j.input=j.textarea=true}else{j=i.placeholder=function(){return this.filter((a?'textarea':':input')+'[placeholder]').not('.placeholder,.ignore-placeholder').bind('focus.placeholder',b).bind('blur.placeholder',e).trigger('blur.placeholder').end()};j.input=a;j.textarea=d;c(function(){c(h).delegate('form','submit.placeholder',function(){var k=c('.placeholder',this).each(b);setTimeout(function(){k.each(e)},10)})});c(f).bind('unload.placeholder',function(){c('.placeholder').val('')})}function g(l){var k={},m=/^jQuery\d+$/;c.each(l.attributes,function(o,n){if(n.specified&&!m.test(n.name)){k[n.name]=n.value}});return k}function b(){var k=c(this);if(k.val()===k.attr('placeholder')&&k.hasClass('placeholder')){if(k.data('placeholder-password')){k.hide().next().show().focus().attr('id',k.removeAttr('id').data('placeholder-id'))}else{k.val('').removeClass('placeholder')}}}function e(){var o,n=c(this),k=n,m=this.id;if(n.val()===''){if(n.is(':password')){if(!n.data('placeholder-textinput')){try{o=n.clone().attr({type:'text'})}catch(l){o=c('<input>').attr(c.extend(g(this),{type:'text'}))}o.removeAttr('name').data('placeholder-password',true).data('placeholder-id',m).bind('focus.placeholder',b);n.data('placeholder-textinput',o).data('placeholder-id',m).before(o)}n=n.removeAttr('id').hide().prev().attr('id',m).show()}n.addClass('placeholder').val(n.attr('placeholder'))}else{n.removeClass('placeholder')}}}(this,document,jQuery));; 
 
//@ sourceURL=/js/lscache.js 
/**
 * lscache library
 * Copyright (c) 2011, Pamela Fox
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *       http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 **************************************************************
 *
 * MODIFIED by mroper on 11/16/2012 for use by QuickBase
 * - Update the expiration entry with each 'GET' operation so that 
 * entries are eliminated by last accessed date and not last modified date.
 * - Fixes a bug where the expiration entry set operation was not surrounded by a 
 * try/catch block, leading to unhandled QUOTA_EXCEEDED_ERR exceptions in tests
 * - removes JSON.parse from the get method since quickbase has code to handle 
 * parsing that is shared across local and session storage.
 */

/*jshint undef:true, browser:true */

/**
 * Creates a namespace for the lscache functions.
 */
var lscache = function() {

  // Prefix for all lscache keys
  var CACHE_PREFIX = 'lscache-';

  // Suffix for the key name on the expiration items in localStorage
  var CACHE_SUFFIX = '-cacheexpiration';

  // expiration date radix (set to Base-36 for most space savings)
  var EXPIRY_RADIX = 10;

  // time resolution in minutes
  var EXPIRY_UNITS = 60 * 1000;

  // ECMAScript max Date (epoch + 1e8 days)
  var MAX_DATE = Math.floor(8.64e15/EXPIRY_UNITS);

  var cachedStorage;
  var cachedJSON;
  var cacheBucket = '';

  // Determines if localStorage is supported in the browser;
  // result is cached for better performance instead of being run each time.
  // Feature detection is based on how Modernizr does it;
  // it's not straightforward due to FF4 issues.
  // It's not run at parse-time as it takes 200ms in Android.
  function supportsStorage() {
    var key = '__lscachetest__';
    var value = key;

    if (cachedStorage !== undefined) {
      return cachedStorage;
    }

    try {
      setItem(key, value);
      removeItem(key);
      cachedStorage = true;
    } catch (exc) {
      cachedStorage = false;
    }
    return cachedStorage;
  }

  // Determines if native JSON (de-)serialization is supported in the browser.
  function supportsJSON() {
    /*jshint eqnull:true */
    if (cachedJSON === undefined) {
      cachedJSON = (window.JSON != null);
    }
    return cachedJSON;
  }

  /**
   * Returns the full string for the localStorage expiration item.
   * @param {String} key
   * @return {string}
   */
  function expirationKey(key) {
    return key + CACHE_SUFFIX;
  }

  /**
   * Returns the number of minutes since the epoch.
   * @return {number}
   */
  function currentTime() {
    return Math.floor((new Date().getTime())/EXPIRY_UNITS);
  }

  /**
   * Wrapper functions for localStorage methods
   */

  function getItem(key) {
    return localStorage.getItem(CACHE_PREFIX + cacheBucket + key);
  }

  function setItem(key, value) {
    // Fix for iPad issue - sometimes throws QUOTA_EXCEEDED_ERR on setItem.
    localStorage.removeItem(CACHE_PREFIX + cacheBucket + key);
    localStorage.setItem(CACHE_PREFIX + cacheBucket + key, value);
  }

  function makeSpaceInCache(key_, value_, targetSize) {
	// If we exceeded the quota, then we will sort
	// by the expire time, and then remove the N oldest
	var storedKeys = [];
	var storedKey;
	for (var i = 0; i < localStorage.length; i++) {
		storedKey = localStorage.key(i);

		if (storedKey.indexOf(CACHE_PREFIX + cacheBucket) === 0 && storedKey.indexOf(CACHE_SUFFIX) < 0) {
			var mainKey = storedKey.substr((CACHE_PREFIX + cacheBucket).length);
			var exprKey = expirationKey(mainKey);
			var expiration = getItem(exprKey);
			if (expiration) {
				expiration = expiration.split(",");
				expiration = parseInt(expiration[0]);
			} else {
				// TODO: Store date added for non-expiring items for smarter removal
				expiration = MAX_DATE;
			}
			storedKeys.push({
				key: mainKey,
				size: (getItem(mainKey)||'').length,
				expiration: expiration
				});
		}
	}
	// Sorts the keys with oldest expiration time last
	storedKeys.sort(function(a, b) { return (b.expiration-a.expiration); });

	while (storedKeys.length && targetSize > 0) {
		storedKey = storedKeys.pop();
		removeItem(storedKey.key);
		removeItem(expirationKey(storedKey.key));
		targetSize -= storedKey.size; //+ storedKey.key.length;
	}
	try {
		setItem(key_, value_);
	} catch (e) {
		// value may be larger than total quota
		return;
	}
  }
  
  function removeItem(key) {
    localStorage.removeItem(CACHE_PREFIX + cacheBucket + key);
  }

  return {

    /**
     * Stores the value in localStorage. Expires after specified number of minutes.
     * @param {string} key
     * @param {Object|string} value
     * @param {number} time
     */
    set: function(key, value, time) {
      if (!supportsStorage()) return;

      // If we don't get a string value, try to stringify
      // In future, localStorage may properly support storing non-strings
      // and this can be removed.
      if (typeof value !== 'string') {
        if (!supportsJSON()) return;
        try {
          value = JSON.stringify(value);
        } catch (e) {
          // Sometimes we can't stringify due to circular refs
          // in complex objects, so we won't bother storing then.
          return;
        }
      }

      try {
        setItem(key, value);
      } catch (e) {
        if (e.name === 'QUOTA_EXCEEDED_ERR' || e.name === 'NS_ERROR_DOM_QUOTA_REACHED' || e.name === 'Error') {
		  var targetSize = (value||'').length;
		  makeSpaceInCache(key, value, targetSize);
		}else{
			return;
		}
	  }
      // If a time is specified, store expiration info in localStorage
      if (time) {
		try{
			setItem(expirationKey(key), (currentTime() + time).toString(EXPIRY_RADIX) + ','+ time.toString(EXPIRY_RADIX));
		}catch (e){
			if (e.name === 'QUOTA_EXCEEDED_ERR' || e.name === 'NS_ERROR_DOM_QUOTA_REACHED' || e.name === 'Error') {
				var targetSize = (currentTime() + time).toString(EXPIRY_RADIX).length;
				makeSpaceInCache(expirationKey(key), (currentTime() + time).toString(EXPIRY_RADIX), targetSize);
			}else{
				return;
			}
		}
      } else {
        // In case they previously set a time, remove that info from localStorage.
        removeItem(expirationKey(key));
      }
    },

    /**
     * Retrieves specified value from localStorage, if not expired.
     * @param {string} key
     * @return {string|Object}
     */
    get: function(key) {
      if (!supportsStorage()) return null;

      // Return the de-serialized item if not expired
      var exprKey = expirationKey(key);
      var expr = getItem(exprKey);
	  
      if (expr) {
		expr = expr.split(",");
		for(var i = 0; i < expr.length; i++)
		{
			expr[i] = parseInt(expr[i], EXPIRY_RADIX);
		}

		var currTime = currentTime();
        // Check if we should actually kick item out of storage
        if (expr.length == 2 && currentTime() >= expr[0]) {
          removeItem(key);
          removeItem(exprKey);
          return null;
        }else{
			//update the expiry entry
			setItem(exprKey, (currentTime() + expr[1]).toString(EXPIRY_RADIX) + ',' + expr[1].toString(EXPIRY_RADIX));
		}
      }

      // Tries to de-serialize stored value if its an object, and returns the normal value otherwise.
      var value = getItem(key);
      return value;
    },

    /**
     * Removes a value from localStorage.
     * Equivalent to 'delete' in memcache, but that's a keyword in JS.
     * @param {string} key
     */
    remove: function(key) {
      if (!supportsStorage()) return null;
      removeItem(key);
      removeItem(expirationKey(key));
    },

    /**
     * Returns whether local storage is supported.
     * Currently exposed for testing purposes.
     * @return {boolean}
     */
    supported: function() {
      return supportsStorage();
    },

    /**
     * Flushes all lscache items and expiry markers without affecting rest of localStorage
     */
    flush: function() {
      if (!supportsStorage()) return;

      // Loop in reverse as removing items will change indices of tail
      for (var i = localStorage.length-1; i >= 0 ; --i) {
        var key = localStorage.key(i);
        if (key.indexOf(CACHE_PREFIX + cacheBucket) === 0) {
          localStorage.removeItem(key);
        }
      }
    },
    
    /**
     * Appends CACHE_PREFIX so lscache will partition data in to different buckets.
     * @param {string} bucket
     */
    setBucket: function(bucket) {
      cacheBucket = bucket;
    },
    
    /**
     * Resets the string being appended to CACHE_PREFIX so lscache will use the default storage behavior.
     */
    resetBucket: function() {
      cacheBucket = '';
    }
  };
}();
; 
 
//@ sourceURL=/js/qbPersistentUserPrefs.js 
/*
jQuery QB Persistent User Page Preferences Plugin v1.0
Copyright (c) 2012 Intuit QuickBase
*/
$.widget("ui.qbPersistentUserPrefs",{options:{sectionHeaderSelector:".shead",persistOnEveryAction:true,collapsedClass:"collapsed",expandedClass:"expanded",collapsedIconClass:"SectionCollapsedIcon",expandedIconClass:"SectionExpandedIcon",toggleWithIconOnly:false,persistKey:"",persistToServer:false,jsonFromServer:'{"collapsedSectionIds": {}}',initCallback:null,isSessionOnly:true,animate:true},_stateObject:null,toggleSection:function(sectHeadId,isInit){var sectHead=$("#"+sectHeadId);var sectionBody=sectHead.next();var self=this;if(sectionBody.hasClass("Divider")){sectionBody=sectionBody.next()}function triggerChange(){self.element.trigger("changedCollapseState",sectHeadId)}if(sectHead.hasClass(this.options.expandedClass)){if(this.options.animate&&!isInit){sectionBody.stop(true).show().slideUp(triggerChange)}else{sectionBody.stop(true).hide(0,triggerChange)}}else{if(this.options.animate&&!isInit){sectionBody.stop(true).hide().slideDown(triggerChange)}else{sectionBody.stop(true).show(0,triggerChange)}}sectHead.parent().toggleClass(this.options.expandedClass).toggleClass(this.options.collapsedClass);sectHead.toggleClass(this.options.expandedClass).toggleClass(this.options.collapsedClass);sectHead.find(".ToggleSectionIcon").toggleClass(this.options.expandedIconClass).toggleClass(this.options.collapsedIconClass);if(!isInit){this._rememberToggle(sectHeadId)}return false},_rememberToggle:function(sectHeadId){if(sectHeadId in this._stateObject.collapsedSectionIds){delete this._stateObject.collapsedSectionIds[sectHeadId]}else{this._stateObject.collapsedSectionIds[sectHeadId]=1}if(this.options.persistToServer){if(this.options.persistOnEveryAction){this._updateServer()}}else{QB.Storage.User.set(this.options.persistKey,this._stateObject,this.options.isSessionOnly)}},initBasedOnUserPrefs:function(){for(var sectId in this._stateObject.collapsedSectionIds){this.toggleSection(sectId,true)}if(this.options.initCallback){this.options.initCallback()}},getUserPreference:function(key){return this._stateObject[key]},setUserPreference:function(key,value){this._stateObject[key]=value},_updateServer:function(doSync){var persistString=JSON.stringify(this._stateObject);var jax=new jaxreq(gReqDBID+"?a=QBI_SaveUserPagePref");jax.AddValue("userPrefs",persistString);jax.AddValue("key",this.options.persistKey);jax.AddValueFromForm("PageToken");if(doSync){jax.DoSyncCmd()}else{jax.DoAsyncCmd()}},_create:function(){var self=this;if(this.options.persistToServer){self._stateObject=JSON.parse(this.options.jsonFromServer)}else{var storedState=QB.Storage.User.get(this.options.persistKey,"",this.options.isSessionOnly);if(storedState&&storedState!=""){self._stateObject=storedState}else{self._stateObject={collapsedSectionIds:{}}}}this.refresh();if(!this.options.persistOnEveryAction){$(window).unload(function(){self._updateServer(true)})}this.initBasedOnUserPrefs()},refresh:function(){var self=this;var toggleIcon='<span class="qbPersist ToggleSectionIcon '+self.options.expandedIconClass+'"></span>';this.element.find(this.options.sectionHeaderSelector).each(function(){var sectionTitle=$(this).children(".sectionTitle");if(sectionTitle&&sectionTitle.text()!=""&&!sectionTitle.data("qbPersist.initialized")){sectionTitle.data("qbPersist.initialized",true);var sect=$(this);sect.prepend(toggleIcon);if(!self.options.toggleWithIconOnly){sectionTitle.off(".qbPersist").on("click.qbPersist",function(){self.toggleSection(sect.attr("id"))})}$(this).find(".ToggleSectionIcon").off(".qbPersist").on("click.qbPersist",function(){self.toggleSection(sect.attr("id"))})}})},destroy:function(){$.Widget.prototype.destroy.apply(this,arguments)}});; 
 
//@ sourceURL=/js/std_head.js 
var gMainBodyDiv=null;var gMainBodyTable=null;var gFontSizeRefElem=-1;var gFontSizeRefWidth=0;var gOldMainBodyDivHeight=0;var kCustomColumnFID=-1;var kSomeFileRelevancyColumnFID=-11;var kFileRelevancyColumnAlias="<File Search Hits>";var gStdTableTabset;var gAutoLoadQuickTour=false;var gRinfoLastIndex=-1;function RelInfo(mfid,mdbid,dfid,ddbid,external){this.mfid=mfid;this.mdbid=mdbid;this.dfid=dfid;this.ddbid=ddbid;this.external=external}function RinfoFind(ddbid,dfid){if(gRinfoLastIndex!=-1&&gRinfoLastIndex<rinfo.length){if(rinfo[gRinfoLastIndex].ddbid==ddbid&&rinfo[gRinfoLastIndex].dfid==dfid){return rinfo[gRinfoLastIndex]}}for(var n=0;n<rinfo.length;++n){if(rinfo[n].ddbid==ddbid&&rinfo[n].dfid==dfid){gRinfoLastIndex=n;return rinfo[n]}}return null}function RinfoGetMasterDBID(ddbid,dfid){var ri=RinfoFind(ddbid,dfid);if(ri){return ri.mdbid}return 0}function IsMasterTable(dbid){for(var n=0;n<rinfo.length;++n){if(rinfo[n].mdbid==dbid){return true}}return false}function RelDInfo(mdbid,dfid,ddbid,external){this.mdbid=mdbid;this.dfid=dfid;this.ddbid=ddbid;this.external=external}function TableInfo(name,snoun,pnoun,inQS,extApp,appID,alias,kfid,kfname,chfid0,chfid1,chfid2,replicationType){this.name=name;this.snoun=snoun;this.pnoun=pnoun;this.inQS=inQS;this.extApp=extApp;this.appID=appID;this.alias=alias;this.kfid=kfid;this.kfname=kfname;this.chfid0=chfid0;this.chfid1=chfid1;this.chfid2=chfid2;this.replicationType=replicationType;this.fullyPopulated=false;this.finfo=new Object();this.forminfo=null;this.qinfo=new Object()}function GetTableName(dbid){if(gTableInfo[dbid]){return gTableInfo[dbid].name}return"???"}function NumAppTables(){var count=0;for(var dbid in gTableInfo){if(!gTableInfo[dbid].extApp){++count}}return count}TableInfo.prototype.IsFullyPopulated=function(){return(this.fullyPopulated)};var gCompareFinfo;var gCompareCCFinfo;var gCompareRCFinfo;TableInfo.prototype.GetSortedFieldArray=function(filterfunc,qid){var farr=new Array();for(var fid in this.finfo){if(filterfunc&&!filterfunc(this.finfo[fid],fid)){continue}farr.push(fid)}if(qid&&this.qinfo[qid]){gCompareCCFinfo=this.qinfo[qid][kCustomColumnFID];gCompareRCFinfo=this.qinfo[qid][kSomeFileRelevancyColumnFID];if(gCompareCCFinfo&&gCompareCCFinfo.type&&gCompareCCFinfo.type!=""){if(!filterfunc||filterfunc(gCompareCCFinfo,kCustomColumnFID)){farr.push(kCustomColumnFID)}}if(gCompareRCFinfo&&gCompareRCFinfo.type&&gCompareRCFinfo.type!=""){if(!filterfunc||filterfunc(gCompareRCFinfo,kSomeFileRelevancyColumnFID)){farr.push(kSomeFileRelevancyColumnFID)}}}gCompareFinfo=this.finfo;farr.sort(compareFieldsByName);return farr};function compareFieldsByName(fid1,fid2){if(fid1==kCustomColumnFID){var fname1=gCompareCCFinfo.name.toLowerCase()}else{var fname1=gCompareFinfo[fid1].name.toLowerCase()}if(fid2==kCustomColumnFID){var fname2=gCompareCCFinfo.name.toLowerCase()}else{var fname2=gCompareFinfo[fid2].name.toLowerCase()}if(fid1==kSomeFileRelevancyColumnFID){var fname1=gCompareRCFinfo.name.toLowerCase()}else{var fname1=gCompareFinfo[fid1].name.toLowerCase()}if(fid2==kSomeFileRelevancyColumnFID){var fname2=gCompareRCFinfo.name.toLowerCase()}else{var fname2=gCompareFinfo[fid2].name.toLowerCase()}if(fname1>fname2){return 1}if(fname1<fname2){return -1}return 0}function GetFinfoArray(dbid){if(dbid){if(gTableInfo[dbid]){return gTableInfo[dbid].finfo}}else{if(gTableInfo[gReqDBID]){return gTableInfo[gReqDBID].finfo}}return null}function GetFinfo(fid,dbid,qid){if(fid==0){return kNullFinfo}if(typeof dbid=="undefined"||dbid==null){var dbid=gReqDBID}if(fid==kCustomColumnFID&&qid){var qinfo=gTableInfo[dbid].qinfo[qid];for(var qi in qinfo){if(qi.CCfinfo){return qi.CCfinfo}}}if(fid==kSomeFileRelevancyColumnFID&&qid){var qinfo=gTableInfo[dbid].qinfo[qid];for(var qi in qinfo){if(qi.RCfinfo){return qi.RCfinfo}}}if(gTableInfo[dbid]&&gTableInfo[dbid].finfo[fid]){return gTableInfo[dbid].finfo[fid]}return kNullFinfo}function IsFIDaNumber(fid){return !isNaN(Number(fid))}function CDD(dbid,fid,rp,filterFid,proxyFor,matchDBID,matchFID){this.dbid=dbid;this.fid=fid;this.rp=rp;this.filterFid=filterFid;this.proxyFor=proxyFor;this.matchDBID=matchDBID;this.matchFID=matchFID}function addCDD(dbid,fid,rp,filterFid,proxyFor,matchDBID,matchFID){if(!gCDD[dbid]){gCDD[dbid]=new Array()}gCDD[dbid].push(new CDD(dbid,fid,rp,filterFid,proxyFor,matchDBID,matchFID))}function BuildCDDMenu(cddInfo,menu,value,rpfid,rpqid,selectedValue){if(cddInfo.rp==1){return}var url=cddInfo.dbid+"?a=QBI_GetMatchingRecords&cddfid="+cddInfo.fid+"&matchValue="+urlencode(value);if(selectedValue&&selectedValue!=""){url+="&selectedValue="+urlencode(selectedValue)}url+="&rpqid="+rpqid;var jax=new jaxreq(url);jax.DoSyncCmd();if(jax.errcode==0){var status=jax.GetValue("status");if(status=="UsePicker"){var func;if(typeof(window.chooseRecordPicker)=="function"){func=chooseRecordPicker}else{if(typeof(window.GE_chooseRecordPicker)=="function"){func=GE_chooseRecordPicker}}addEvent(menu,"change",function(){func(menu,cddInfo.matchDBID,"","&showNewMaster=1")},false);var selectedIndex=menu.selectedIndex;var selectedOption=menu.options[menu.selectedIndex];menu.length=0;if(selectedOption.value==""){AppendMenuOption(menu,"","")}else{AppendMenuOption(menu,selectedOption.text,selectedOption.value)}AppendMenuOption(menu,"< Browse choices... >","x3recpcker#");return}var selValueFound=false;var other,other_1;var menuArray=new Array();if(menu.options[menu.options.length-1].value=="_other"){other=menu.options[menu.options.length-1];other_1=menu.options[menu.options.length-2];if(selectedValue&&selectedValue!=""){menu.options[menu.options.length-1].selected=false;menu.options[menu.options.length-2].selected=false}}menu.length=0;AppendMenuOption(menu,"Make a Selection...","","#888888");var qbnode=jax.GetXML();var records=qbnode.getElementsByTagName("records");if(records&&records.length>0){for(var i=0;i<records[0].childNodes.length;++i){var record=records[0].childNodes[i];if(record.nodeName=="record"){var text=record.firstChild?record.firstChild.nodeValue:"";var keyValue;var attrs=record.attributes;for(var j=0;j<attrs.length;++j){if(attrs[j].name=="keyValue"){keyValue=attrs[j].value;break}}if(keyValue==selectedValue){selValueFound=true}var o=new Object();o.text=text;o.value=keyValue;menuArray.push(o)}}}if(selectedValue&&selectedValue!=""&&!selValueFound){var selectedText=jax.GetValue("selText");AppendMenuOption(menu,selectedText,selectedValue,false,"red");menu.options[menu.options.length-1].selected=true;AppendMenuDivider(menu,"")}for(var i=0;i<menuArray.length;++i){AppendMenuOption(menu,menuArray[i].text,menuArray[i].value,false);if(selectedValue&&selectedValue==menuArray[i].value){menu.options[menu.options.length-1].selected=true}}if(other){AppendMenuOption(menu,other_1.text,other_1.value,false);AppendMenuOption(menu,other.text,other.value,false)}}else{jax.ShowErrAlert()}}function onClickCDD(elem,clickThisFirst){var msg="First choose a <span id='relatedfilter'>"+clickThisFirst+"</span>.";QB.Dialog.alert({title:"This is a Conditional Dropdown",type:"Warning",size:"small",contents:msg,contentType:"html",id:"FirstChooseA",confirm:{click:function(){$(this).dialog("close")}}});return false}function FINFO(name,abbrev,flags,reffid,proxyFid,proxyForFid,replicationType){this.name=name;this.type=abbrev;this.flags=flags;this.reffid=reffid;this.proxyFid=proxyFid;this.proxyForFid=proxyForFid;this.replicationType=replicationType}FINFO.prototype.IsMC=function(){return((this.flags&1)!=0)};FINFO.prototype.IsBI=function(){return((this.flags&2)!=0)};FINFO.prototype.HasFormula=function(){return((this.flags&4)!=0)};FINFO.prototype.Wraps=function(){return((this.flags&8)!=0)};FINFO.prototype.IsReference=function(){return((this.flags&64)!=0)};FINFO.prototype.IsLookupable=function(){return((this.flags&128)!=0)};FINFO.prototype.IsSummary=function(){return((this.flags&256)!=0)};FINFO.prototype.IsLookup=function(){return((this.flags&512)!=0)};FINFO.prototype.IsRequired=function(){return((this.flags&1024)!=0)};FINFO.prototype.SupportsUniqueness=function(){return((this.flags&2048)!=0)};FINFO.prototype.GetIsConditional=function(){return((this.flags&4096)!=0)};FINFO.prototype.IsLookupEnabled=function(){return((this.flags&8192)==0)};FINFO.prototype.PreferRecordPicker=function(){return((this.flags&16384)!=0)};FINFO.prototype.IsReportable=function(){return((this.flags&32768)>0)};FINFO.prototype.IsComposite=function(){return((this.flags&65536)>0)};FINFO.prototype.IsCompositeSubField=function(){return((this.flags&131072)>0)};FINFO.prototype.IsReplicated=function(){return((this.flags&262144)>0)};FINFO.prototype.Justification=function(){if((this.flags&16)!=0){return"center"}if((this.flags&32)!=0){return"right"}return"left"};FINFO.prototype.IsDerived=function(){return this.HasFormula()||this.IsSummary()||this.IsLookup()||this.IsComposite()};FINFO.prototype.GetConditionalFidsToUpdate=function(fid){var finfo=GetFinfo(fid);var arr=new Array();if(gCDD[gReqDBID]){for(var i=0;i<gCDD[gReqDBID].length;++i){if(gCDD[gReqDBID][i].filterFid==fid||gCDD[gReqDBID][i].proxyFor==fid){arr.push(gCDD[gReqDBID][i])}}}return arr};FINFO.prototype.GetCDD=function(fid,dbid){var db=gReqDBID;if(dbid&&dbid!=""){db=dbid}if(gCDD[db]){for(var i=0;i<gCDD[db].length;++i){if(gCDD[db][i].fid==fid){return gCDD[db][i]}}}return null};function af(n,fid,name,abbrev,flags,reffid,proxyFid,proxyForFid,replicationType){gFI[n][fid]=new FINFO(name,abbrev,flags,reffid,proxyFid,proxyForFid,replicationType)}var kNullFinfo=new FINFO("","",0,0,0,0,0);function FINFOgetAll(dbids){if(typeof dbids=="string"){var dbid=dbids;dbids=new Array();dbids.push(dbid)}if(dbids.length==0){return 0}var appID=gTableInfo[dbids[0]].appID;var url=appID+"?a=QBI_GetFieldList";var jax=new jaxreq(url);var k=0;var numChanged=0;for(var n=0;n<dbids.length;++n){var dbid=dbids[n];if(gTableInfo[dbid].appID!=appID){alert("error in FINFOgetAll");return}if(!gTableInfo[dbid].IsFullyPopulated()){var vname="dbid_"+k++;jax.AddValue(vname,dbid)}}jax.DoSyncCmd();if(jax.errcode==0){var num=jax.GetValue("numFields");var pdbid="";for(var n=0;n<num;++n){var dbid=jax.GetValue("fdb"+n);var fid=jax.GetValue("fi"+n);var fname=jax.GetValue("fn"+n);var fabbv=jax.GetValue("fa"+n);var fflags=jax.GetValue("ff"+n);var fref=jax.GetValue("fr"+n);var frt=Number(jax.GetValue("frt"+n));if(pdbid!=dbid){var finfo=gTableInfo[dbid].finfo;pdbid=dbid}if(fid&&typeof finfo[fid]=="undefined"){finfo[fid]=new FINFO(fname,fabbv,fflags,fref,frt);numChanged++}}for(var n=0;n<dbids.length;++n){var dbid=dbids[n];gTableInfo[dbid].fullyPopulated=true}}return numChanged}function GetFieldName(fid,dbid,fullyQualified){if(typeof dbid=="undefined"||dbid==null){var dbid=gReqDBID}var dbname="";if(fullyQualified){if(dbid&&gTableInfo[dbid]){dbname=HTMLEncode(gTableInfo[dbid].name)+":"}else{dbname="???:"}}var finfo=GetFinfo(fid,dbid);if(finfo){return dbname+finfo.name}return""}function GetFieldNameHTML(fid,dbid){var finfo=GetFinfo(fid,dbid);if(finfo){if(typeof finfo.htmlname=="undefined"){finfo.htmlname=HTMLEncode(finfo.name)}return finfo.htmlname}return""}function GetFieldTypeAbbrev(fid,dbid){var finfo=GetFinfo(fid,dbid);if(finfo){return finfo.type}return null}function QINFO(qname,CCtype,CCname,CCabbrev,CCflags){this.qname=qname;if(CCtype==kCustomColumnFID){this.CCfinfo=new FINFO(CCname,CCabbrev,CCflags,0,null,null,0)}else{if(CCtype==kSomeFileRelevancyColumnFID){this.RCfinfo=new FINFO(CCname,CCabbrev,CCflags,0,null,null,0)}}}function aq(n,qid,qname,CCtype,CCname,CCabbrev,CCflags){if(!gQI[n][qid]){gQI[n][qid]=new Array()}gQI[n][qid].push(new QINFO(qname,CCtype,CCname?CCname:"",CCabbrev?CCabbrev:"",CCflags?CCflags:0))}function FindQinfo(tableDBID,qid){if(gTableInfo[tableDBID]){var tinfo=gTableInfo[tableDBID];if(tinfo.qinfo&&tinfo.qinfo[qid]){return tinfo.qinfo[qid]}}return null}function HasCCfinfo(dbid,qid,type){if(gTableInfo[dbid]&&gTableInfo[dbid].qinfo&&gTableInfo[dbid].qinfo[qid]){var ccfinfo;if(type==kCustomColumnFID){ccfinfo=gTableInfo[dbid].qinfo[qid].CCfinfo}else{if(type==kSomeFileRelevancyColumnFID){ccfinfo=gTableInfo[dbid].qinfo[qid].RCfinfo}}return(ccfinfo.type!=null&&ccfinfo.type!="")}return false}function GetCCfinfo(dbid,qid,type){if(HasCCfinfo(dbid,qid,type)){if(type==kSomeFileRelevancyColumnFID){return gTableInfo[dbid].qinfo[qid].RCfinfo}return gTableInfo[dbid].qinfo[qid].CCfinfo}return kNullFinfo}function FORMinfo(dfid,name,flags){this.dfid=dfid;this.name=name;this.flags=flags}function afm(n,dfid,name,flags){gFMI[n].push(new FORMinfo(dfid,name,flags))}var kFRM_PromptNewFields=1;var kFRM_AutoAddFields=2;function ROLEinfo(roleID,name,curUserHasPermsToRole){this.roleID=roleID;this.name=name;this.curUserHasPermsToRole=curUserHasPermsToRole}function ROLEinfoFind(roleID){for(var n=0;n<gRofo.length;++n){if(gRofo[n].roleID==roleID){return gRofo[n]}}return null}function GetRoleName(roleID){var info=ROLEinfoFind(roleID);if(info){return info.name}return"???"}function Qspec(dbid,qid){this.dbid=dbid;this.qid=qid}function IsAppRequest(){return(gReqDBID!="main"&&gReqDBID!="")}function IsMainRequest(){return(!IsAppRequest())}var gMouseIsDown=false;var gClickWasInSRT=false;var kGIDInvalid=0;var kRoleID_none=9;function OpenHelp(pageName){var url="main?act=dohelp&page="+pageName;var w=window.open(url,"Help","width=650,height=550,resizable,scrollbars");w.focus();return false}function OpenHelpSwitched(pageName){var url="main?act=dohelp&switched=1&page="+pageName;var w=window.open(url,"Help","width=650,height=550,resizable,scrollbars");w.focus();return false}function ShowFieldsMenu(dbid){ShowMenu("FieldsMenu_"+dbid,"fieldsButton_"+dbid,true,2,"auto")}function _AddCrumb(crumbString,text,url){if(text){if(crumbString!=""){crumbString+=" &nbsp;<span class=crdlm>&raquo;</span>&nbsp; "}if(url){crumbString+="<a href='"+url+"'>"+text+"</a>"}else{crumbString+=text}}return crumbString}function SetBreadCrumb(t0,u0,t1,u1,t2,u2,container){var crumbString="";crumbString=_AddCrumb(crumbString,t0,u0);crumbString=_AddCrumb(crumbString,t1,u1);crumbString=_AddCrumb(crumbString,t2,u2);if(container){SetInnerHTML(container,crumbString)}else{SetInnerHTML("stdBreadCrumbs",crumbString)}}function stdSelectTableTab(tabcell,tabledbid){if(typeof SelectTableTabProc=="function"){SelectTableTabProc(tabledbid)}else{location=tabledbid+"?a=thome"}}var gPageLoadComplete=false;var gTrialFooter=null;var gCustomUIFooter=null;var gBottomSpacer=null;var gBottomFooter=null;var gHasFooter=false;function _CheckForFontSizeChange(){if(gFontSizeRefElem==-1){gFontSizeRefElem=document.getElementById("siaLbl");if(gFontSizeRefElem==null){gFontSizeRefElem=document.getElementById("ambHelp")}if(gFontSizeRefElem){gFontSizeRefWidth=gFontSizeRefElem.offsetWidth}}if(gFontSizeRefElem&&gFontSizeRefElem.offsetWidth!=gFontSizeRefWidth){gFontSizeRefWidth=gFontSizeRefElem.offsetWidth;if(typeof FontSizeChangedProc=="function"){FontSizeChangedProc()}}}function StdIdleProc(){_CheckForFontSizeChange();for(var n=0;n<gAutoResizeElement.length;++n){var obj=gAutoResizeElement[n];if(obj.needsFixing){FixUpScrollableDivs(obj)}if(obj.needsTweaking){TweakScrollableDivs(obj)}}if(typeof IdleProc=="function"){IdleProc()}if(typeof gMsgBoxSubMsg!="undefined"&&gMsgBoxSubMsg!=""){OpenMsgBox("",gMsgBoxSubMsg);gMsgBoxSubMsg=""}if(typeof gHistoNeeded!="undefined"&&gHistoNeeded){ldtimeHisto()}}var gLoadProcTasks=new Array();function AddLoadProcTask(task){gLoadProcTasks.push(task)}var gUnloadProcTasks=new Array();function AddUnloadProcTask(task){gUnloadProcTasks.push(task)}function RedirectDotNetSite(){if(gBoolDotNetList==true){window.location="/qb/Home/MyQB";return true}else{return false}}function StdLoadProc(){$(window).trigger("StdLoadProcStart");gMainBodyDiv=getElementBy("mainBodyDiv");gMainBodyTable=getElementBy("bodyTable");var defItem=document.getElementById("defFocus");if(defItem){defItem.focus()}gBottomFooter=document.getElementById("bottomFooter");gBottomSpacer=document.getElementById("bottomSpacer");var trialFooter=document.getElementById("trialFooter");var uiFooter=document.getElementById("customUIfooter");gHasFooter=true;openAndShowElem(gBottomFooter);if(gReqPrintFriendly){SetStyle("pageTitleCell","paddingLeft","1px");SetStyle(document.body,"backgroundColor","#fff");document.title=gReqAppName}if(typeof gMsgBoxMsg!="undefined"&&gMsgBoxMsg!=""){OpenMsgBox(gMsgBoxMsg)}if(typeof autoFAQ!="undefined"&&autoFAQ!=""){popFaqWin(autoFAQ)}if(GetInnerHTML("ladyBody")!=""){var greetPopup=new popupDiv("qbGreetDiv");greetPopup.SetAutoHide(true);greetPopup.Show()}$.jGrowl.defaults.position="center";ShowConfirmationMsg();var stdTableTabs=document.getElementById("stdTableTabs");if(stdTableTabs){gStdTableTabset=new TabSet(null,stdSelectTableTab,stdTableTabs)}if(typeof InitializeDatePicker=="function"){InitializeDatePicker()}var cursorIcon=document.getElementById("cursorIcon");if(cursorIcon){ScrollBodyDivToShow(cursorIcon)}for(var n=0;n<gLoadProcTasks.length;++n){eval(gLoadProcTasks[n])}if(typeof LoadProc=="function"){LoadProc()}if(typeof kIsSandboxApp!="undefined"&&kIsSandboxApp){document.body.style.background="url('/i/sandboxMark.png') repeat right top"}if(IsIE()){window.onscroll=StdScrollProc}gPageLoadComplete=true;if(!IsSafariMobile()){StdResizeProc();setInterval("StdIdleProc()",200)}SetValue("firstTimeLoaded","");setTimeout("StdDeferredLoadProc()",10);$(".Announcement:not(.hideOnLoad)").each(function(i,e){e=$(e);if(!isAnnouncementHidden(e.attr("id").split("_")[1])){e.show();setCompact(e,false,false)}});$(window).trigger("StdLoadProcEnd")}function StdDeferredLoadProc(){if(!gReqPrintFriendly){return}if(window.gWaitForPrintReady){$(document.body).on("print-ready",function(){setTimeout("window.print()",1000)})}else{setTimeout("window.print()",200)}}function IsFirstTimeLoaded(){return GetValue("firstTimeLoaded")!=""}var gBeforeUnloadDoCheck=false;var gBeforeUnloadForm="";var gBeforeUnloadOrigVal="";function SetCheckFormBeforeUnload(b,formname){gBeforeUnloadDoCheck=b;if(b){gBeforeUnloadForm=(formname?formname:"mainform");gBeforeUnloadOrigVal=FormValuesToQueryString(gBeforeUnloadForm,kFormExcludeHidden|kFormDoNotEncode)}}function HasStdFormChanged(){return(gBeforeUnloadOrigVal!=FormValuesToQueryString(gBeforeUnloadForm,kFormExcludeHidden|kFormDoNotEncode))}function ForceStdFormChanged(){gBeforeUnloadOrigVal=""}function StdBeforeUnloadProc(ev){if(gBeforeUnloadDoCheck&&HasStdFormChanged()){var retval="-----------------------------------------------------------\nYou've made changes to this page.\n\nTO SAVE THESE CHANGES:\n     click "+(IsChrome()?"Stay on this Page":"Cancel")+" below,\n     then click the Save button on the current page.\n-----------------------------------------------------------";ev.returnValue=retval;if(IsSafari()||IsChrome()){return retval}else{return ev.returnValue}}if(typeof stfBeforeUnload=="function"){stfBeforeUnload()}if(typeof BeforeUnloadProc=="function"){return BeforeUnloadProc(ev)}}function StdUnloadProc(){for(var n=0;n<gUnloadProcTasks.length;++n){eval(gUnloadProcTasks[n])}if(typeof UnloadProc=="function"){UnloadProc()}}function ShowConfirmationMsg(msg){var confMsgBox=document.getElementById("confMsgBox");if(msg){SetInnerHTML(confMsgBox,msg)}if(GetInnerHTML(confMsgBox)!=""){if($("#confMsgBox [class=fadingConf]").size()>0){notifyGreen($("#confMsgBox").html());return}openElem(confMsgBox);PositionX(confMsgBox,"center",0);if(confMsgBox.offsetWidth>300){confMsgBox.style.width="300px"}var botStripe=document.getElementById("tablesMenuBar");if(!botStripe){botStripe=document.getElementById("appMenuBar")}if(botStripe){var b=GetBox(botStripe);PositionY(confMsgBox,"top",b.bottom+8)}showElem(confMsgBox)}}function hideConfirmationMsg(){hideElem("confMsgBox")}function StdMouseUpProc(event){closeAndHideElem("confMsgBox");gMouseIsDown=false;if(typeof MouseUpProc=="function"){MouseUpProc(event)}return true}var confDialog={showFlag:false,eltID:"",options:{},setAndShow:function(element,options){this.options=options;this.showDialog($(element))},baseOptions:{width:"auto",buttons:{Done:function(){$(this).dialog("close")}},autoOpen:true,resizable:false,modal:true},showDialog:function(dialogdivInput){var dialogdiv=dialogdivInput||jQuery("#"+this.eltID);if(dialogdiv.size()>0){dialogdiv.removeClass("nodisplay");dialogdiv.removeClass("novisibility");var op;if(typeof this.options=="string"){op=window[this.options]}else{op=this.options}dialogdiv.dialog(op)}}};var subsconfDialogOptions={width:500,buttons:{"View all subscriptions":function(){$(this).dialog("close");window.location=emailListURL}}};var subsconfDialogOptions=jQuery.extend(true,{},confDialog.baseOptions,subsconfDialogOptions);var remindconfDialogOptions={width:500,buttons:{"View all reminders":function(){$(this).dialog("close");window.location=emailListURL}}};var remindconfDialogOptions=jQuery.extend(true,{},confDialog.baseOptions,remindconfDialogOptions);confDialog.options=confDialog.baseOptions;jQuery(function(){try{if(confDialog.showFlag){confDialog.showDialog()}}catch(e){exceptionMessage("Confirmation dialog constructor error",e)}});var gCurMenuBut=null;var gCurHilite=null;function GetMenuTarg(event){if(event!=null){var targ=EvGetTarget(event);if(targ==null){return null}if(GetHTMLattribute(targ,"qbmenu")){return targ}if(GetHTMLattribute(targ.parentNode,"qbmenu")){return targ.parentNode}}return null}function _IsClickInScrollbar(targ){if(!IsTag(targ,"div")){return}var contentsHeight=0;var divHei=targ.offsetHeight;for(var n=0;n<targ.childNodes.length;++n){var node=targ.childNodes[n];if(node.nodeType==kELEMENT_NODE){contentsHeight+=node.offsetHeight}}if(contentsHeight>divHei){return true}return false}function StdMouseDownProc(event){var targ=EvGetTarget(event);if(window.gDetectingTouchMouse){$(window).trigger("mousedown.modernizrtouchmouse")}if(IsTag(targ,"body")){return true}if(IsIE()&&_IsClickInScrollbar(targ)){return true}gMouseIsDown=true;var targ=GetMenuTarg(event);if(targ){var menuID=GetHTMLattribute(targ,"qbmenu");if(menuID){var menuSet=GetHTMLattribute(targ,"qbmset");var positioning=GetHTMLattribute(targ,"qbmpos");var wasDisplayed=ShowMenu(menuID,targ,true,menuSet,positioning)}}CaptureEventInfo(event);if(typeof MouseDownProc=="function"){MouseDownProc(event)}return true}function StdContextMenuProc(event){var targ=GetMenuTarg(event);if(targ){var menuID=GetHTMLattribute(targ,"qbmenu");if(menuID){return EvCancelAction(event)}}return true}function StdMouseOverProc(event){if(typeof MouseOverProc=="function"){MouseOverProc(event)}return true}function StdMouseMoveProc(event){if(GetTargetTag(event)=="body"){return true}CaptureEventInfo(event);if(typeof MouseMoveProc=="function"){MouseMoveProc(event)}var menutarg=GetMenuTarg(event);hiliteColor=GetHTMLattribute(menutarg,"qbmhicolor");if(menutarg!=gCurMenuBut){var menuID=GetHTMLattribute(menutarg,"qbmenu");var menuSet=GetHTMLattribute(menutarg,"qbmset");var isMenuBut=(menuID!=null);var isSomeMenuOpen=(gCurrentMenu!=null);if(isMenuBut){gCurMenuBut=menutarg}if(hiliteColor==null){hiliteColor="#e8e8e8"}if(isSomeMenuOpen&&menuSet&&menuSet==gCurrentMenuSet){HideMenus();ShowMenu(menuID,menutarg,true,menuSet)}}var targ=menutarg;if(targ==null){targ=EvGetTarget(event);hiliteColor=GetHTMLattribute(targ,"qbmhicolor");if(hiliteColor==null&&IsTag(targ,"img")){hiliteColor=GetHTMLattribute(targ.parentNode,"qbmhicolor");if(hiliteColor!=null){targ=targ.parentNode}}}var curHiliteIsCurMenuBut=(gCurHilite!=null&&gCurMenuBut==gCurHilite&&gCurrentMenu!=null);if(targ!=gCurHilite&&!curHiliteIsCurMenuBut){if(gCurHilite){Delite(gCurHilite)}gCurHilite=null;if(hiliteColor&&hiliteColor!="_none"){var eraseBkgdImg=GetHTMLattribute(targ,"qbmimg");Hilite(targ,hiliteColor,eraseBkgdImg);gCurHilite=targ}}return true}function StdClickProc(event){var retval=true;if(!gPageLoadComplete){return retval}var isDatePickerOpen=false;if(typeof g_Calendar!="undefined"&&g_Calendar.containerLayer){isDatePickerOpen=(g_Calendar.containerLayer.style.visibility=="visible")}function isAnyParent(event,test){return _.any($(EvGetTarget(event)).parents(),test)}var isInMenu=IsClickInOpenMenu(event);var isInInvokingElem=IsClickInElem(gMenuInvokingElem,event);if(!isInInvokingElem){isInInvokingElem=isAnyParent(event,function(elem){return elem==gMenuInvokingElem})}CaptureEventInfo(event);if(gCurrentMenu&&!isInInvokingElem&&!isDatePickerOpen&&(!event.ctrlKey&&!isInMenu||GetTargetTag(event)=="A"||isAnyParent(event,function(elem){return elem.tagName=="A"}))){HideMenus();Delite(gCurMenuBut);gCurMenuBut=null}if(TopPopupDiv()){TopPopupDiv().AutoHide()}if(typeof DatePickerClick=="function"){DatePickerClick(event)}CaptureSelectState(event);if(typeof ClickProc=="function"){retval=ClickProc(event)}var targ=GetMenuTarg(event);if(targ){return EvCancelAll(event)}return retval}function StdKeyDownProc(event){if(TopPopupDiv()&&TopPopupDiv().iOnEnterKey&&EvGetCharCode(event)==13){eval(TopPopupDiv().iOnEnterKey);return false}if(typeof GE_keyDown=="function"){GE_keyDown(event)}if(typeof KeyDownProc=="function"){return KeyDownProc(event)}return true}function StdKeyPressProc(event){if(typeof KeyPressProc=="function"){return KeyPressProc(event)}return true}var gAutoResizeElement=new Array();var gResizeTasks=new Array();function AddResizeTask(task){gResizeTasks.push(task)}function AddResizeElement(elem,bottomOffset,minHeight,rightOffset,minWidth){var obj=new Object();obj.elem=toElem(elem);if(!obj.elem){return obj}obj.bottomOffset=(typeof bottomOffset!="undefined"?bottomOffset:null);obj.rightOffset=(typeof rightOffset!="undefined"?rightOffset:null);obj.minHeight=(minHeight?minHeight:100);obj.maxHei=0;obj.minWidth=(minWidth?minWidth:200);obj.maxWid=0;obj.contentMaxWid=0;obj.innerContent="???";obj.doMonitorContentWidth=false;obj.limitToContentHeight=false;obj.limitToContentWidth=false;gAutoResizeElement.push(obj);return obj}function RemoveAutoResizeObj(obj){for(var n=0;n<gAutoResizeElement.length;++n){if(gAutoResizeElement[n].elem==obj){gAutoResizeElement.splice(n,1);--n}}}function _setAutoResizeMaxes(obj){if(obj.innerContent){var ic_offsetWidth=obj.innerContent.offsetWidth;if(obj.contentMaxWid<ic_offsetWidth){obj.contentMaxWid=ic_offsetWidth}}}function FindAutoResizeElement(elem){for(var n=0;n<gAutoResizeElement.length;++n){var obj=gAutoResizeElement[n];if(obj.elem==elem){return obj}}return null}function DoAutoResizeElement(obj){var isGeckoAndInvis=(IsGecko()&&!IsReallyDisplayed(obj.elem,8));if(isGeckoAndInvis){return}var footerHeight=GetElemHeight(gBottomFooter);if(obj.innerContent=="???"){obj.innerContent=QBselectSingleNode(obj.elem,"table")}_setAutoResizeMaxes(obj);if(obj.bottomOffset!=null){var newhei=ScrollBot()-GetElemTop(obj.elem)-obj.bottomOffset-footerHeight;if(newhei<obj.minHeight){newhei=obj.minHeight}obj.elem.style.height=newhei+"px"}if(obj.rightOffset!=null){var newwid=ScrollRight()-GetElemLeft(obj.elem)-obj.rightOffset;if(newwid<obj.minWidth){newwid=obj.minWidth}obj.elem.style.width=newwid+"px"}_setAutoResizeMaxes(obj);if(obj.innerContent){if(obj.doMonitorContentWidth&&IsIE()&&_IEversion<=7){obj.needsFixing=true}if(obj.limitToContentWidth||obj.limitToContentHeight||obj.maxWid||obj.maxHei){if(obj.needsFixing){obj.needsTweaking=true}else{TweakScrollableDivs(obj)}}}}function TweakScrollableDivs(obj){var scrollThickness=18;var newwid=GetStyleWidth(obj.elem);var newhei=GetStyleHeight(obj.elem);if(obj.limitToContentWidth&&obj.innerContent){var hasVertiScrollbar=(obj.innerContent.offsetHeight-obj.elem.offsetHeight)>0;var maxwid=obj.contentMaxWid+(hasVertiScrollbar?scrollThickness:0);if(newwid>maxwid){newwid=maxwid}}if(obj.limitToContentHeight&&obj.innerContent){var hasHorizScrollbar=(obj.innerContent.offsetWidth-obj.elem.offsetWidth)>0;var contentHei=obj.innerContent.offsetHeight+(hasHorizScrollbar?scrollThickness:0);if(obj.bottomOffset!=null){if(newhei>contentHei){newhei=contentHei}}else{newhei=contentHei}}if(obj.maxWid>0&&newwid>obj.maxWid){newwid=obj.maxWid}if(obj.maxHei>0&&newhei>obj.maxHei){newhei=obj.maxHei}obj.elem.style.width=newwid+"px";if(newhei!==0){obj.elem.style.height=newhei+"px"}_setAutoResizeMaxes(obj);obj.needsTweaking=false}function FixUpScrollableDivs(obj){if(!obj){return}if(obj.innerContent&&typeof obj.innerContent=="object"){var hasVerticalScrollBar=(obj.innerContent.offsetHeight-obj.elem.offsetHeight)>0;if(hasVerticalScrollBar){obj.innerContent.style.width=(obj.elem.offsetWidth-17)+"px"}else{obj.innerContent.style.width="100%"}}obj.needsFixing=false}var gRzWindowWidth=null;var gRzWindowHeight=null;var gInStdResizeProc=false;function StdResizeProc(event){if(gInStdResizeProc){return false}gInStdResizeProc=true;var doHideMenus=(gRzWindowWidth!=null&&gRzWindowWidth!=WindowWidth());var windowSizeChanged=(gRzWindowWidth!=WindowWidth()||gRzWindowHeight!=WindowHeight());gRzWindowWidth=WindowWidth();gRzWindowHeight=WindowHeight();if(doHideMenus){HideMenus()}for(var n=0;n<gAutoResizeElement.length;++n){DoAutoResizeElement(gAutoResizeElement[n])}for(var n=0;n<gResizeTasks.length;++n){eval(gResizeTasks[n])}if(typeof ResizeProc=="function"){ResizeProc(event)}if(gMainBodyDiv&&gMainBodyDiv.style.height!=gOldMainBodyDivHeight){SetCookie("mbdhei",gMainBodyDiv.style.height,60*24*7);gOldMainBodyDivHeight=gMainBodyDiv.style.height}gInStdResizeProc=false;return true}function StdScrollProc(event){if(typeof ScrollProc=="function"){ScrollProc(event)}return true}var gAction;var gTableSelectorDiv;function popupTableSelector(action,heading){SetCookie("QB_REFERER",location.href);if(gSingleTableDBID!=""){location=gSingleTableDBID+"?a="+action;return false}gAction=action;HideMenus();if(heading&&heading!=""){SetInnerHTML("tselHeading",heading);openElem("tselForWhich")}else{SetInnerHTML("tselHeading","For which table?");closeElem("tselForWhich")}gTableSelectorDiv=ShowPopupDiv("tableSelector");return false}var userWin;function popupUserWin(id){try{userWin=window.open("main?a=userwin&uids="+id,"UserWin","width=435,height=230,resizable")}catch(e){alert(e)}if(userWin){userWin.focus()}return false}function pup(id){popupUserWin(id);return false}function OpenMsgBox(msg,submsg){if(msg&&msg!=""){var elem=getElementBy("msgBoxMsg");if(elem){elem.innerHTML=msg}}if(submsg&&submsg!=""){var elem=getElementBy("msgBoxSubMsg");if(elem){elem.innerHTML=submsg}}var popup=new popupDiv("msgBox");popup.SetAutoHide(true);popup.Show()}function SetMsgBoxSubMsg(submsg){if(typeof gMsgBoxSubMsg!="undefined"){gMsgBoxSubMsg=submsg}}function CloseMsgBox(){HidePopupDiv()}function OpenMoreIntro(){ShowPopupDiv("moreIntroBox")}function SetHref(elname,val){var elem=getElementBy(elname);if(elem){elem.href=val}}function IsInDebugMode(){return kRuntimeMode=="debug"}function ShowHideCustButs(doShow){openCloseElem("czThisBut",doShow)}function OnRclickHFoot(){location="main?a=mhedit&tname="+gReqTemplName;return false}function ShowMiniHelp(snippetID){var contents=$("#MINI_HELP_"+snippetID.toLowerCase()).clone();var h4s=contents.find("h4");var title=h4s.text();h4s.remove();contents.find(".stdButton").remove();QB.Dialog.alert({contents:contents.html(),contentType:"html",title:title,size:"medium",id:"miniHelpDialog"});return false}function FetchAndShowMiniHelp(snippetID){var url="main?a=QBI_snippetGet&snpID="+snippetID;if(gReqAppDBID!=""){url+="&appID="+gReqAppDBID}var jax=JaxSyncCmd(url);if(!jax.success){jax.ShowErrAlert();return}var popup=new popupDiv("MINI_HELP_EMPTY");if(popup){var heading=QBselectSingleNode(popup.iElem,"h4");var body=QBselectSingleNode(popup.iElem,"div");SetInnerHTML(heading,jax.GetValue("snpTitle"));SetInnerHTML(body,jax.GetValue("snpBody"));popup.SetAutoHide(true);popup.Show()}return false}function popFaqWin(snippetID){HideMenus();w=window.open("main?a=snippet&mhid="+snippetID,"FAQ","width=600,height=400,resizable");w.focus();return false}function GotoMHedit(mhid){location="main?a=mhedit&mhid="+mhid;return false}function FetchDialog(dialogName,autoShow){if(!getElementBy(dialogName)){var jax=JaxSyncCmd(gReqAppDBID+"?a=QBI_GetDlg&dlgname="+dialogName);if(jax.success){var newDiv=document.createElement("div");newDiv.id=dialogName;newDiv.className="PopBox";newDiv.style.visibility="hidden";newDiv.style.display="none";newDiv.style.width="480px";document.body.appendChild(newDiv);SetInnerHTML(newDiv,jax.AssembleChunks("dlgbody"));var dlgHandlers=jax.AssembleChunks("dlghandlers");if(dlgHandlers!=""){dlgHandlers=dlgHandlers.replace(/\\r/g,"\r");dlgHandlers=dlgHandlers.replace(/\\n/g,"\n");dlgHandlers=dlgHandlers.replace(/\\s/g,"\\");if(window.execScript){window.execScript(dlgHandlers)}else{window.eval(dlgHandlers)}}}}if(typeof autoShow=="undefined"||autoShow==true){return ShowPopupDiv(dialogName)}return null}function OnClickAddCustItem(){QBalert("To create a new field or a new table, use the Customize menu")}function ShowTOS(){window.open("main?a=GenTermsOfService","TOS","width=778,height=550,resizable,scrollbars");return false}function GoHome(elem,ev){if(EvIsRightButton(ev)){var menu=FindOrCreateQBmenu2("homeDDmenu","");if(menu.mtables[0].rows.length==1){menu.AppendOnclick("Open Home Page in New Window",OpenHomeInNew);menu.AppendBotSpacer()}ShowMenu(menu.menuDiv,elem,true)}else{SetLocation(gReqAppDBID)}return false}function OpenHomeInNew(){HideMenus();window.open(gReqAppDBID,"ABC","height=800,width=1000")}function Open2minGuide(){window.open(gReqAppDBID+"?a=dbpage&pagename=TwoMinuteGuide.html","AppGuide",QBwopts="width=650,height=550,resizable,scrollbars")}function OpenHelpWin(pagename){window.open("main?a=dohelp"+(pagename?"&page="+pagename:""))}function OpenHelpWinUser(){window.open("main?a=dohelpuser")}function GoToPageCreate(){var url=gReqAppDBID+"?a=AppDBPages";document.location.href=url}var OTVwindows=new Array();function OpenTransformedView(qid,dbid,type,qURL){var title;if(type=="cal"){title="Calendar_"+dbid}else{if(type=="tl"){title="Timeline_"+dbid}}var w=OTVwindows[title];if(w==undefined||w.closed){var loc=dbid+"?a=s"+qURL;var features="width=750,height=650,resizable,scrollbars,location,menubar";var w=window.open(loc,title,features);OTVwindows[title]=w}w.focus()}function FindOrCreateQBmenu2(menuDivOrID,menuHeading,extraClass){var menuDiv=toElem(menuDivOrID);if(menuDiv&&menuDiv.QBmenuObj){return menuDiv.QBmenuObj}return new QBmenu2(menuDivOrID,menuHeading,extraClass)}function QBmenu2(menuOrID,menuHeading,extraClass){var isNew=false;var menu=toElem(menuOrID);if(!menu){var emptymenu=getElementBy("EmptyMenuV2");if(emptymenu){menu=emptymenu.cloneNode(true);menu.id=menuOrID;isNew=true}}if(menu==null){ldi("QBmenu2 error: menu == null",menuOrID);return}this.menuDiv=menu;this.hilitedRow=null;this.curSubmenu=null;this.mtables=new Array();if(isNew){document.body.appendChild(this.menuDiv)}if(this.menuDiv.QBmenuObj){alert("QBmenu2 error\n\nThe menu div:\n\n\t"+this.menuDiv.id+"\n\nalready has an associated QBmenu2 object")}this.menuDiv.QBmenuObj=this;var mtable=QBselectSingleNode(this.menuDiv,"table");if(mtable&&mtable.className&&StringStartsWith(mtable.className,"V2menu")){this._AddTable(mtable)}else{if(mtable){mtable.QBmenuObj=this;for(var r=0;r<mtable.rows.length;++r){var row=mtable.rows[r];for(var c=0;c<row.cells.length;++c){var cell=row.cells[c];var subtable=QBselectSingleNode(cell,"table");if(subtable){this._AddTable(subtable)}}}}}if(extraClass&&this.mtables[0]){this.mtables[0].className+=" "+extraClass}if(menuHeading){this.AppendTopHeading(menuHeading)}else{if(isNew){this.AppendTopSpacer()}}}QBmenu2.prototype._AddTable=function(mtable){this.mtables.push(mtable);mtable.QBmenuObj=this;mtable.qbPrefix=GetHTMLattribute(mtable,"qbPrefix");mtable.qbNumCols=1;for(var r=0;r<mtable.rows.length;++r){var row=mtable.rows[r];if(row.cells.length>mtable.qbNumCols){mtable.qbNumCols=row.cells.length}}};QBmenu2.prototype.ClearAllRows=function(leaveOne){for(var n=0;n<this.mtables.length;++n){TableRemoveAllRows(this.mtables[n],leaveOne)}};QBmenu2.prototype.SetURLprefix=function(URLprefix){for(var n=0;n<this.mtables.length;++n){this.mtables[n].qbPrefix=URLprefix}};QBmenu2.prototype.SetPickFunction=function(pickFunction){for(var n=0;n<this.mtables.length;++n){this.mtables[n].qbPickfunc=pickFunction}};function MenuRowSetsReferrer(row,b){if(row){row.QBsetRef=b}}QBmenu2.prototype.AppendTopSpacer=function(htext){this._AppendRow("tspc","<br>")};QBmenu2.prototype.AppendBotSpacer=function(htext){this._AppendRow("bspc","<br>")};QBmenu2.prototype.AppendTopHeading=function(htext){this._AppendRow("topHead",htext)};QBmenu2.prototype.AppendSectHeading=function(htext){this._AppendRow("sectHead",htext)};QBmenu2.prototype.AppendText=function(htext){this._AppendRow("htext",htext)};QBmenu2.prototype.AppendDivider=function(){this._AppendRow("hdiv","<hr>")};QBmenu2.prototype.AppendCascade=function(htext,cascadeMenu){var row=this._AppendRow(null,htext);this.AssignCascadeMenu(row,cascadeMenu);return row};QBmenu2.prototype.AssignCascadeMenu=function(row,cascadeMenu){if(row){this._AddCascadeIcon(row);var isQBmenu2=cascadeMenu&&cascadeMenu.menuDiv&&cascadeMenu.mtables;if(isQBmenu2){row.QBcascade=cascadeMenu}else{row.QBcascade=FindOrCreateQBmenu2(cascadeMenu)}}return row};QBmenu2.prototype.AppendPick=function(htext,url,usePopupSelector){var row=this._AppendRow(null,htext);if(row){row.QBurl=url;row.usePopupSelector=(usePopupSelector?true:false)}return row};QBmenu2.prototype.AppendPickSuffix=function(htext,URLsuffix,usePopupSelector){var row=this._AppendRow(null,htext);if(row){row.QBsfx=URLsuffix;row.usePopupSelector=(usePopupSelector?true:false)}return row};QBmenu2.prototype.SetPickSuffix=function(index,htext,URLsuffix,usePopupSelector){var row=this.mtables[0].rows[index];if(row){row.innerHTML=htext;row.QBsfx=URLsuffix;row.usePopupSelector=(usePopupSelector?true:false)}return row};QBmenu2.prototype.AppendOnclick=function(htext,onclick){var row=this._AppendRow(null,htext);if(row){row.onclick=QBmenu2onclick;row.qbClickProc=onclick}return row};function QBmenu2onclick(e){var targ=EvGetTarget(e);var row=QBselectParentNode(targ,"tr");if(row){var proc=row.qbClickProc;if(proc){if(typeof proc=="string"){eval(proc)}else{if(typeof proc=="function"){proc(e,row)}}}}}QBmenu2.prototype.GetRow=function(rowIndex){if(this.mtables[0]&&this.mtables[0].rows.length>rowIndex){return this.mtables[0].rows[rowIndex]}return null};QBmenu2.prototype.SetupCascades=function(){for(var n=0;n<this.mtables.length;++n){var mtable=this.mtables[n];for(var r=0;r<mtable.rows.length;++r){var row=mtable.rows[r];var cascade=GetHTMLattribute(row,"QBcascID");if(cascade){this._AddCascadeIcon(row);row.QBcascade=FindOrCreateQBmenu2(cascade)}}}};QBmenu2.prototype._IsWhiteMenu=function(mtable){return(mtable.className=="V2menuW")};QBmenu2.prototype._AddCascadeIcon=function(row){var mtable=QBselectParentNode(row,"table");this._AddCascadeColumn(mtable);var labelCol=(this._IsWhiteMenu(mtable)?1:0);row.cells[labelCol].colSpan=1;TableCellAppend(row);row.cells[labelCol+1].innerHTML="<img src='"+(window.gResDir||"")+"/i/triRight.gif'>";row.cells[labelCol+1].style.padding="0px 8px 0px 0px"};QBmenu2.prototype._AddCascadeColumn=function(mtable){if(this._IsWhiteMenu(mtable)){if(mtable.qbNumCols==3){return}for(var n=0;n<mtable.rows.length;++n){var row=mtable.rows[n];if(row.cells.length==1){TableCellAppend(row)}row.cells[1].colSpan=2}mtable.qbNumCols=3;return}if(mtable.qbNumCols==2){return}for(var n=0;n<mtable.rows.length;++n){var row=mtable.rows[n];row.cells[0].colSpan=2}mtable.qbNumCols=2};QBmenu2.prototype._AppendRow=function(className,h1){if(this.mtables.length!=1){ldi(this.menuDiv.id+"   this.mtables.length == "+this.mtables.length);return}var mtable=this.mtables[0];var row=TableRowAppend(mtable);if(row){if(className){row.className=className}if(this._IsWhiteMenu(mtable)){var cell=TableCellAppend(row,"");cell.innerHTML="&nbsp;";cell.className="ic"}var cell=TableCellAppend(row,"");cell.colSpan=mtable.qbNumCols;var numCells=row.cells.length;row.cells[numCells-1].innerHTML=h1}return row};var gCurUSBmenu;function USBto(){gCurUSBmenu._UpdateSubMenuNow();gCurUSBmenu.usbID=0}QBmenu2.prototype._UpdateSubMenuNow=function(){if(this.curSubmenu){HideOneMenu(this.curSubmenu.menuDiv);this.curSubmenu.curSuperMenu=null;this.curSubmenu.curSuperRow=null;this.curSubmenu=null}var row=this.hilitedRow;if(row&&row.QBcascade){var mtable=QBselectParentNode(row,"table");var wasDisplayed=ShowMenu(row.QBcascade.menuDiv,row,"cascade");if(wasDisplayed){this.curSubmenu=row.QBcascade;this.curSubmenu.curSuperMenu=this;this.curSubmenu.curSuperRow=row}}};QBmenu2.prototype.HiliteRow=function(row){var kHiColor="#DCE8F4";Hilite(row,kHiColor);if(row.cells[0].className=="ic"){row.cells[0].style.backgroundColor=kHiColor;row.cells[0].style.borderRightColor=kHiColor}};QBmenu2.prototype.DeliteRow=function(row){if(row==null){return}Delite(row);if(row.cells.length>0&&row.cells[0].className=="ic"){row.cells[0].style.backgroundColor="";row.cells[0].style.borderRightColor=""}if(this.menuDiv.id!="MenuCtxtMenu"){QBmenuCtxtMenuClose()}};QBmenu2.prototype.HilitePick=function(row){if(!QBmenu2DoesRowHilite(row)){row=null}if(row==this.hilitedRow){return}if(this.usbID){clearTimeout(this.usbID);this.usbID=0}var timeout=0;if(this.hilitedRow){this.DeliteRow(this.hilitedRow);if(this.curSubmenu){timeout=140}}this.hilitedRow=null;if(row){this.HiliteRow(row);this.hilitedRow=row;if(this.curSuperMenu){if(this.curSuperMenu.hilitedRow!=this.curSuperRow){this.DeliteRow(this.curSuperMenu.hilitedRow);this.curSuperMenu.hilitedRow=this.curSuperRow;this.HiliteRow(this.curSuperMenu.hilitedRow)}}gCurUSBmenu=this;this.usbID=setTimeout("USBto()",timeout)}};QBmenu2.prototype.Cleanup=function(){this.mtables[0].QBm2targ=null;if(this.hilitedRow){this.DeliteRow(this.hilitedRow);this.hilitedRow=null}if(this.curSubmenu){HideOneMenu(this.curSubmenu.menuDiv);this.curSubmenu=null}};function QBmenu2DoesRowHilite(row){if(!row.className||row.className==""||row.className=="dtl"){return true}if(row.className=="V2cust"){return true}return false}function QBmenu2FromMenu(menuOrID){var menu=toElem(menuOrID);if(menu){var mtable=QBselectSingleNode(menu,"table");if(mtable&&mtable.QBmenuObj){return mtable.QBmenuObj}}return null}function QBmenu2InitFromTable(table){if(typeof table.QBmenuObj=="undefined"){var menu=QBselectParentNode(table,"div");if(menu){FindOrCreateQBmenu2(menu)}}if(!table.QBrowsInited){table.QBrowsInited=true;for(var r=0;r<table.rows.length;++r){var row=table.rows[r];var cascade=GetHTMLattribute(row,"QBcascID");if(cascade){row.QBcascade=FindOrCreateQBmenu2(cascade)}}}}function QBmenu2Mmove(ev,table){QBmenu2InitFromTable(table);var targ=EvGetTarget(ev);if(IsTag(targ,"img")){targ=QBselectParentNode(targ,"td")}if(IsTag(targ,"dt")||IsTag(targ,"dt")||IsTag(targ,"dd")){targ=QBselectParentNode(targ,"td")}if(table.QBm2targ&&table.QBm2targ==targ){return}table.QBm2targ=targ;if(targ&&IsTag(targ,"td")){var mtable=QBselectParentNode(targ,"table");if(mtable&&mtable.QBmenuObj&&mtable.className!="V2menuMultiSection"){var row=QBselectParentNode(targ,"tr");mtable.QBmenuObj.HilitePick(row);if(QBmenu2DoesRowHilite(row)){return}}}if(table&&table.QBmenuObj){var menu=table.QBmenuObj;table.QBmenuObj.DeliteRow(menu.hilitedRow);menu.hilitedRow=null;if(menu.usbID==0){gCurUSBmenu=menu;menu.usbID=setTimeout("USBto()",140)}}}var gQBmenuTargURL=null;function QBmenu2Ctxt(ev,table){var retval=QBmenu2Click(ev,table,true);return retval}function QBmenu2Click(ev,table,isCtxtMenu){QBmenu2InitFromTable(table);var targ=EvGetTarget(ev);if(targ&&IsTag(targ,"td")){var mtable=QBselectParentNode(targ,"table");if(mtable&&mtable.QBmenuObj){var row=QBselectParentNode(targ,"tr");var url=null;var newWindow=null;var URLattr=GetHTMLattribute(row,"QBurl");if(URLattr){url=URLattr;newWindow=GetHTMLattribute(row,"QBnw")}var ACTattr=GetHTMLattribute(row,"QBactT");if(ACTattr){url=ACTattr;row.usePopupSelector=true}var ACTattr=GetHTMLattribute(row,"QBactA");if(ACTattr){url=gReqAppDBID+"?a="+ACTattr}var URLsuffix=GetHTMLattribute(row,"QBsfx");var GATrackLeavePage=false;if(URLsuffix){if(URLsuffix=="share"){openAddUserAutocomplete();HideMenus();QBTrackPageView("AppMenus/Users/ShareWithANewUser");return false}if(URLsuffix=="share&isImport=1"){GATrackLeavePage=true}url=mtable.qbPrefix+URLsuffix}if(url){var setRefCookie=GetHTMLattribute(row,"QBsetRef");SetCookie("QB_REFERRER",setRefCookie?location.href:"");var mtext=GetInnerHTML(row.cells[1]);if(mtable.qbPickfunc){mtable.qbPickfunc(url)}else{if(row.usePopupSelector){popupTableSelector(url,mtext)}else{if(isCtxtMenu){gQBmenuTargURL=url;ShowMenu("MenuCtxtMenu",targ,"cascade")}else{if(newWindow!=null){var w=window.open(url,newWindow,"height=768,width=900, toolbar=1, menubar=1, location=1, status=1, scrollbars=1, resizable=1");HideMenus();w.focus()}else{if(GATrackLeavePage){setupGATrackAndCallback(function(){SetLocation(url)},"AppMenus/Users/ImportUsers")}else{SetLocation(url)}}}}}return false}}}return true}function QBmenuOldWin(){SetLocation(gQBmenuTargURL);QBmenuCtxtMenuClose()}function QBmenuNewWin(){window.open(gQBmenuTargURL);QBmenuCtxtMenuClose()}function QBmenuCtxtMenuClose(){if(gQBmenuTargURL){gQBmenuTargURL=null;HideOneMenu("MenuCtxtMenu")}}function Scroller(table,container,hasInsets,frozenCol,numFrozenCols,frozenRow,numFrozenRows){this.table=toElem(table);this.container=toElem(container);this.lastX=0;this.lastY=0;this.insetLeft=0;this.insetTop=0;this.hasInsets=(hasInsets?true:false);this.frozenCol=(typeof frozenCol=="undefined"?1:frozenCol);this.numFrozenCols=(typeof numFrozenCols=="undefined"?1:numFrozenCols);this.frozenRow=(typeof frozenRow=="undefined"?0:frozenRow);this.numFrozenRows=(typeof numFrozenRows=="undefined"?1:numFrozenRows);this.stylesInited=false;if(this.table&&this.hasInsets){this.AdjustInsets()}}new Scroller("","");Scroller.prototype.InitCornerCells=function(){if(this.cornerCellsInited){return}this.cornerCellsInited=true;for(var r=this.frozenRow;r<this.frozenRow+this.numFrozenRows;++r){for(var c=this.frozenCol;c<this.frozenCol+this.numFrozenCols;++c){if(this.table.rows[r].cells[c]){this.table.rows[r].cells[c].style.zIndex=7}}}};Scroller.prototype.AdjustFrozenCol=function(force){if(IsGecko()){return}if(!gPageLoadComplete){return}this.InitCornerCells();if(this.container){scrollLeft=this.container.scrollLeft}else{scrollLeft=$(window).scrollLeft()-GetElemLeft(this.table)}if(scrollLeft!=this.lastX||force){var newHpos=Max(scrollLeft-this.insetLeft,0);this.lastX=scrollLeft;if(this.table){var len=this.table.rows.length;var lastFrozCol=this.numFrozenCols+this.frozenCol-1;for(var r=0;r<len;++r){var row=this.table.rows[r];var numCols=0;var colspan;for(var c=this.frozenCol;c<=lastFrozCol;c+=colspan){if(row.cells[c]){var cell=row.cells[c];colspan=Number(cell.colSpan);if(colspan==0){colspan=1}numCols+=colspan;cell.style.left=newHpos+"px";if(cell.colSpan>1){c+=cell.colSpan}}}}}}};Scroller.prototype.AdjustFrozenRow=function(force){if(IsGecko()){return}if(!gPageLoadComplete){return}this.InitCornerCells();var scrollTop;if(this.container){scrollTop=this.container.scrollTop}else{if(gMainBodyDiv){scrollTop=gMainBodyDiv.scrollTop-GetElemTop(this.table,gMainBodyDiv)}else{scrollTop=ScrollTop()}}if(scrollTop!=this.lastY||force){var newVpos=Max(scrollTop-this.insetTop,0);this.lastY=scrollTop;if(this.table&&this.table.rows.length>0){for(var r=this.frozenRow;r<this.numFrozenRows;++r){var row=this.table.rows[r];var len=row.cells.length;for(var c=0;c<len;++c){row.cells[c].style.top=newVpos+"px"}}}}};Scroller.prototype.AdjustInsets=function(){if(!this.hasInsets){return false}var oldTop=this.insetTop;var oldLeft=this.insetLeft;if(this.table){var b=GetBox(this.table);this.insetTop=b.top+1;if(this.table.rows.length>0&&this.table.rows[0].cells.length>0){b=GetBox(this.table.rows[0].cells[this.frozenCol]);if(b){this.insetLeft=b.left}}}var somethingChanged=(this.insetTop!=oldTop||this.insetLeft!=oldLeft);var force=somethingChanged;this.AdjustFrozenCol(force);this.AdjustFrozenRow(force);return somethingChanged};var kColAscending=1;var kColDescending=-1;var kColVisible=true;var kColHidden=false;function ColInfo(defsort,alignmt,spot,visible){this.defsort=defsort;this.alignmt=alignmt;this.spot=spot;this.visible=(!isDefined(visible)||visible)}var gColInfo=new Array();var gColSortBy=-1;var gColSortDir=kColAscending;var gColDefaultSortBy=-1;gColInfo.UpdateSortIcons=function(){var img=(gColSortDir==kColAscending?"<img src='"+(window.gResDir||"")+"/i/sbup.gif'>":"<img src='"+(window.gResDir||"")+"/i/sbdown.gif'>");var spacer;var alignment=(gColInfo[gColSortBy]?gColInfo[gColSortBy].alignmt:"left");if(alignment=="right"){img=img+"&nbsp;"}else{img="&nbsp;"+img}for(var index in gColInfo){var elem=getElementBy(gColInfo[index].spot);if(elem){spacer=(gColInfo[index].alignmt=="center"?"":"&nbsp;&nbsp;&nbsp;");elem.innerHTML=(gColSortBy==index?img:spacer)}}};gColInfo.SetSortInfo=function(sortBy){if(!isNull(sortBy)&&!isUndefined(sortBy)){if(gColSortBy==sortBy){gColSortDir=-gColSortDir}else{if(gColInfo[sortBy]){gColSortDir=gColInfo[sortBy].defsort}else{gColSortDir=kColAscending}}gColSortBy=sortBy}if(gColSortBy>=0&&(!gColInfo[gColSortBy]||!gColInfo[gColSortBy].visible)){gColSortBy=gColDefaultSortBy;gColSortDir=gColInfo[gColSortBy].defsort}};gColInfo.SetSortFromDefault=function(defaultSortBy,localVarName){gColDefaultSortBy=defaultSortBy;var temp=new Array();if(localVarName){temp=GetLocalVar(localVarName).split(",")}if(temp.length>0&&temp[0]!=""){gColSortBy=temp[0]}if(temp.length>1&&temp[1]!=""){gColSortDir=temp[1]}};gColInfo.HideShowColumn=function(table,which,value){gColInfo[which].visible=value;var tlen=table.rows.length;for(var k=1;k<tlen;++k){var elem=table.rows[k].cells[which];if(value){elem.style.display="";elem.style.visibility=""}else{elem.style.display="none";elem.style.visibility="hidden"}}};var kSortTypeNone=0;var kSortTypeText=1;var kSortTypeNumeric=2;var kHSTlink=3;var kHSTcheckbox=4;var gTinfo;var gHST=new Object();function HSTcompareFunc(a,b){if(gTinfo.curSortType==kSortTypeNumeric){var an=Number(a.val);var bn=Number(b.val);if(an<bn){return -1*gTinfo.curSortOrder}if(an>bn){return 1*gTinfo.curSortOrder}return 0}if(a.val<b.val){return -1*gTinfo.curSortOrder}if(a.val>b.val){return 1*gTinfo.curSortOrder}return 0}function HSTsetSortImg(table,colIndex,sortOrder){var imgtag=DOMfindNthTagNode(table.rows[0].cells[colIndex],"img",0);if(imgtag){if(sortOrder==kColAscending){imgtag.src=(window.gResDir||"")+"/i/sbup.gif"}if(sortOrder==kColDescending){imgtag.src=(window.gResDir||"")+"/i/sbdown.gif"}if(sortOrder==0){imgtag.src=(window.gResDir||"")+"/i/clear2x2.gif"}}}function _HSTdeferredPreselect(tablename,rowIndex){var tinfo=HSTgetTinfo(tablename);var row=tinfo.table.rows[rowIndex];if(row){HSTsetRowAppearance(tinfo,row,true);tinfo.curSelectedRow=row}}function HSTinfo(tablename,rowSelectMode,contextMenuProc,selectRowProc,hasCheckboxes,presortCol,presortOrd,handleInvisibleRows,freezeCol,preselectedRow){this.colInfo=new Array();this.curHiliteRC=new RCpoint();this.table=null;this.rowSelectMode=rowSelectMode;this.contextMenuProc=contextMenuProc;this.selectRowProc=selectRowProc;this.curSelectedRow=null;this.curSortType=kSortTypeText;this.hasCheckboxes=(hasCheckboxes?hasCheckboxes:false);this.curSortCol=presortCol;this.curSortOrder=(presortOrd?presortOrd:0);this.handleInvisibleRows=(handleInvisibleRows?handleInvisibleRows:false);this.freezeCol=(freezeCol!=null?freezeCol:-1);this.selectBGcolor="#ececd0";this.selectTXcolor="";this.selectTXweight="";if(preselectedRow!=-1){AddLoadProcTask("_HSTdeferredPreselect('"+tablename+"',"+preselectedRow+")")}}HSTinfo.prototype.SetSelectBGcolor=function(color){this.selectBGcolor=color};HSTinfo.prototype.SetSelectTXcolor=function(color){this.selectTXcolor=color};HSTinfo.prototype.SetSelectTXweight=function(weight){this.selectTXweight=weight};HSTinfo.prototype.RedrawSelection=function(){HSTsetRowAppearance(this,this.curSelectedRow,true)};function HSThasTinfo(tablename){if(gHST[tablename]){return true}return false}function HSTgetTinfo(tablename){if(!HSThasTinfo(tablename)){}if(gHST[tablename].table==null){var table=getElementBy(tablename);gHST[tablename].table=table;table.qbHST=gHST[tablename]}return gHST[tablename]}function HSTclickCol(colHeadCell,tablename,n,hasValues,defaultSortOrder,menuID){if(tablename!="subfieldListTable"){if(menuID==""||menuID==null){HSTdosort(tablename,n,hasValues,defaultSortOrder)}else{ShowMenu(menuID,colHeadCell,true)}}}function HSTforgetSort(tablename){var tinfo=HSTgetTinfo(tablename);tinfo.curSortCol=null}function HSTresort(tablename){var tinfo=HSTgetTinfo(tablename);if(tinfo.curSortCol!=null){HSTsort(tinfo)}}function HSTdosort(tablename,n,hasValues,defaultSortOrder){var table=getElementBy(tablename);if(table==null){return}HideMenus();if(ColResizeActive()){ColResizeClear();return}if(typeof hasValues=="undefined"){var hasValues=false}if(typeof defaultSortOrder=="undefined"){var defaultSortOrder=1}var tinfo=HSTgetTinfo(tablename);if(tinfo.curSortCol==n){tinfo.curSortOrder=(tinfo.curSortOrder==kColAscending?kColDescending:kColAscending)}else{tinfo.curSortOrder=defaultSortOrder;HSTsetSortImg(table,tinfo.curSortCol,0)}tinfo.curSortCol=n;tinfo.curSortType=tinfo.colInfo[n];tinfo.curHasValues=hasValues;if(table.rows.length>500){QBbusy("Sorting...");ggTinfo=tinfo;setTimeout("HSTsort (ggTinfo)",10)}else{HSTsort(tinfo)}}var ggTinfo;function HSTsort(tinfo){var table=tinfo.table;if(table==null){return}var startTime=(new Date()).getTime();var n=tinfo.curSortCol;HSTsetSortImg(table,tinfo.curSortCol,tinfo.curSortOrder);var numrows=table.rows.length;var a=new Array();for(var r=1;r<numrows;++r){var row=table.rows[r];var i=r-1;a[i]=new Object();a[i].index=r;a[i].row=row;if(IsIE()&&tinfo.hasCheckboxes){for(var c=0;c<row.cells.length;++c){var cb=DOMfindNthTagNode(row.cells[c],"input",0);if(cb&&cb.type=="checkbox"){if(!a[i].cbs){a[i].cbs=new Array()}a[i].cbs[c]=GetValue(cb)}}}var cell=row.cells[n];var widget=null;var img=null;var visibleText=null;if(cell.hasChildNodes()){widget=DOMfindNthTagNode(cell,"input",0);if(!widget){widget=DOMfindNthTagNode(cell,"select",0)}if(!widget){visibleText=DOMinnerText(cell,true,true);if(!visibleText||visibleText==""){img=DOMfindNthTagNode(cell,"img",0)}}}if(widget){a[i].val=GetValue(widget)}else{if(img){a[i].val=img.src}else{if(tinfo.curHasValues){a[i].val=(IsIE()?cell.hstv:GetHTMLattribute(cell,"hstv"))}else{if(visibleText){a[i].val=visibleText}else{a[i].val=DOMinnerText(cell,true,true)}}}}if(typeof a[i].val=="string"){a[i].val=a[i].val.toUpperCase()}if(typeof a[i].val=="undefined"||a[i].val==null){a[i].val=""}}var tbodyNode=DOMfindNthTagNode(table,"TBODY",0);var time1=(new Date()).getTime()-startTime;gTinfo=tinfo;a.sort(HSTcompareFunc);var time2=(new Date()).getTime()-startTime;var tbodyClone=tbodyNode.cloneNode(false);var theadClone=table.rows[0].cloneNode(true);table.replaceChild(tbodyClone,tbodyNode);tbodyClone.appendChild(theadClone);var time3=(new Date()).getTime()-startTime;for(var x=0;x<a.length;x++){tbodyClone.appendChild(a[x].row);if(IsIE()&&a[x].cbs){for(var c in a[x].cbs){var cb=DOMfindNthTagNode(a[x].row.cells[c],"input",0);if(cb){SetValue(cb,a[x].cbs[c])}}}}var time4=(new Date()).getTime()-startTime;QBbusyHide()}function HSTHiliteCell(table,rc,tinfo){var curHiCell=tinfo.curHiliteRC;if(IsNullPoint(rc)&&IsNullPoint(curHiCell)){return false}if(rc!=null&&curHiCell!=null&&rc.r==curHiCell.r&&rc.c==curHiCell.c){return false}if(!IsNullPoint(curHiCell)){var cell=table.rows[0].cells[curHiCell.c];cell.style.backgroundColor="";cell.style.color="";cell.style.fontWeight="";curHiCell.SetNull()}if(rc!=null&&rc.r==0&&tinfo.colInfo[rc.c]!=kSortTypeNone){table.rows[0].cells[rc.c].style.backgroundColor="#E1E1C2";curHiCell.r=rc.r;curHiCell.c=rc.c}return true}var gColResizeStart=-1;var gColResizeOrigWidth;var gColResizeCell=null;function ColResizeActive(){return(gColResizeCell!=null)}function ColResizeClear(){gColResizeCell=null}function ColResizeOnRightEdge(ev,cell){if(cell){var right=GetElemLeft(cell)+cell.offsetWidth;var x=GetMouseX(ev);if(x<=right&&x>right-7){return true}}return false}function ColResizeMouseMove(ev,cell){if(cell){if(gColResizeCell==null&&ColResizeOnRightEdge(ev,cell)){gColResizeCell=cell;gColResizeOrigWidth=cell.offsetWidth-8;gColResizeStart=-1}}if(gColResizeCell){if(IsIE()&&_IEversion>=6){gColResizeCell.style.cursor="col-resize"}else{if(!IsIE()){gColResizeCell.style.cursor="E-resize"}}if(gColResizeStart!=-1){var newwidth=gColResizeOrigWidth+GetMouseX(ev)-gColResizeStart;if(newwidth>20){gColResizeCell.width=newwidth}return EvCancelAll()}else{if(!ColResizeOnRightEdge(ev,gColResizeCell)){gColResizeCell.style.cursor="";gColResizeCell=null}}}}function ColResizeMouseDown(ev){if(gColResizeCell&&gColResizeStart==-1){gColResizeStart=GetMouseX(ev)}}function ColResizeMouseUp(){gColResizeStart=-1;if(gColResizeCell){gColResizeCell.style.cursor=""}}function HSTmouseMove(ev,table,tablename){if(!tablename){var tablename=table.id}var tinfo=HSTgetTinfo(tablename);var rc=FindCell(table,ev,tinfo.handleInvisibleRows);if(!ColResizeActive()){HSTHiliteCell(table,rc,tinfo)}var headcell=null;if(!IsNullPoint(rc)){if(rc.r==0){headcell=table.rows[0].cells[rc.c]}else{HSTglowRow(tinfo,table.rows[rc.r])}}ColResizeMouseMove(ev,headcell)}function HSTmouseOut(ev,table,tablename){if(!tablename){var tablename=table.id}var tinfo=HSTgetTinfo(tablename);var rc=FindCell(table,ev,tinfo.handleInvisibleRows);if(!ColResizeActive()){HSTHiliteCell(table,rc,tinfo)}HSTdeglow(tinfo)}function HSTcontextMenu(ev,table,tablename){var tinfo=HSTgetTinfo(tablename);var rc=FindCell(table,ev,tinfo.handleInvisibleRows);if(!IsNullPoint(rc)){var row=table.rows[rc.r];if(!HSTisRowSelected(table,row)){HSTselectRow(table,row)}if(IsTargetTag(ev,"a")){return true}if(typeof tinfo.contextMenuProc=="function"){return tinfo.contextMenuProc(table,rc.r,rc.c)}}return EvCancelBubble(ev)}function HSTmouseDown(ev,table,tablename){if(IsTargetTag(ev,"select")||IsTargetTag(ev,"input")){return true}if(!tablename){var tablename=table.id}var tinfo=HSTgetTinfo(tablename);var rc=FindCell(table,ev,tinfo.handleInvisibleRows);if(!IsNullPoint(rc)){ColResizeMouseDown(ev);if(rc.r==0){return true}var row=table.rows[rc.r];HSTselectRow(table,row)}return true}function HSTmouseUp(ev,table,tablename){if(!tablename){var tablename=table.id}ColResizeMouseUp()}function HSTdeselectAllRows(table){var tinfo=HSTgetTinfo(table.id);for(var r=1;r<table.rows.length;++r){var row=table.rows[r];if(HSTisRowSelected(table,row)){HSTsetRowSelect(tinfo,row,false)}}}function HSTselectRowByValue(table,value){for(var r=1;r<table.rows.length;++r){var row=table.rows[r];if(GetHTMLattribute(row,"qbVal")==value){HSTselectRow(table,row);return}}}function HSTselectRow(table,row){var tinfo=HSTgetTinfo(table.id);if(row.qbVal=="_noSelect"){tinfo.selectRowProc(row,true);return}var rowIsSelected=HSTisRowSelected(table,row);if(tinfo.rowSelectMode==1&&row!=tinfo.curSelectedRow){HSTdeglow(tinfo);try{if(tinfo.curSelectedRow){HSTsetRowSelect(tinfo,tinfo.curSelectedRow,false)}HSTsetRowSelect(tinfo,row,true);tinfo.curSelectedRow=row}catch(e){}}if(tinfo.rowSelectMode==2){HSTdeglow(tinfo);HSTsetRowSelect(tinfo,row,!rowIsSelected);tinfo.curSelectedRow=null;return false}}function HSTdeselectRow(table,row){if(HSTisRowSelected(table,row)){var tinfo=HSTgetTinfo(table.id);HSTsetRowSelect(tinfo,row,false)}}var kGlowColor="#f0f0f6";function HSTsetRowAppearance(tinfo,row,doSelect){if(!row){return}HSTsetRowBGcolor(tinfo,row,(doSelect?tinfo.selectBGcolor:""));row.style.color=(doSelect?tinfo.selectTXcolor:"");row.style.fontWeight=(doSelect?tinfo.selectTXweight:"")}function HSTsetRowSelect(tinfo,row,doSelect){if(row&&row!=tinfo.table.rows[0]){if(tinfo.selectRowProc){var qbval=GetHTMLattribute(row,"qbVal");if(qbval!=null){row.qbVal=qbval}tinfo.selectRowProc(row,doSelect)}HSTsetRowAppearance(tinfo,row,doSelect)}}function HSTdeglow(tinfo){if(tinfo.curGlowRow){HSTsetRowGlow(tinfo,tinfo.curGlowRow,false);tinfo.curGlowRow=null}}function HSTglowRow(tinfo,row){if(row==tinfo.curGlowRow){return}HSTdeglow(tinfo);if(row&&!HSTisRowSelected(tinfo.table,row)){HSTsetRowGlow(tinfo,row,true);tinfo.curGlowRow=row}}function HSTsetRowGlow(tinfo,row,doGlow){if(row!=tinfo.table.rows[0]){var bgcolor="";if(doGlow){if(!row.glowColor){var bcolor=row.style.backgroundColor;if(bcolor==""){bcolor="#ffffff"}row.glowColor=GetBlend(kGlowColor,bcolor,"0.3")}row.origColor=row.style.backgroundColor;bgcolor=row.glowColor}else{if(row.origColor){bgcolor=row.origColor}}HSTsetRowBGcolor(tinfo,row,bgcolor)}}function HSTsetRowBGcolor(tinfo,row,bgcolor){row.style.backgroundColor=bgcolor;if(tinfo.freezeCol!=-1){var color=(bgcolor==""?"#fff":"");row.cells[tinfo.freezeCol].style.backgroundColor=color}}function HSTisRowSelected(table,row){if(row){return(SameColor(row.style.backgroundColor,table.qbHST.selectBGcolor))}return false}function HSTisAnyRowSelected(table){for(var r=1;r<table.rows.length;++r){if(HSTisRowSelected(table,table.rows[r])){return true}}return false}function HSTgetSingleSelectedRow(table){var srow=null;for(var r=1;r<table.rows.length;++r){if(HSTisRowSelected(table,table.rows[r])){if(srow){return null}else{srow=table.rows[r]}}}return srow}function HSTscrollProc(ev,div,tablename){var tinfo=HSTgetTinfo(tablename);if(typeof tinfo.scroller=="undefined"){if(tinfo.freezeCol==-1){tinfo.scroller=new Scroller(tablename,div,false)}else{tinfo.scroller=new Scroller(tablename,div,false,tinfo.freezeCol)}}tinfo.scroller.AdjustFrozenRow();if(tinfo.freezeCol!=-1){tinfo.scroller.AdjustFrozenCol()}}function HSTresizeProc(tablename){var tinfo=HSTgetTinfo(tablename);if(tinfo.scroller){tinfo.scroller.AdjustFrozenRow();if(tinfo.freezeCol!=-1){tinfo.scroller.AdjustFrozenCol()}}}function PopupMenu(id){this.mainDiv=document.createElement("div");this.mainDiv.id=id;this.mainDiv.className="PopMenu";var mainTable=document.createElement("table");var mainTbody=document.createElement("tbody");var mainRow=document.createElement("tr");this.mainCell=document.createElement("td");this.mainCell.noWrap=true;this.mainDiv.appendChild(mainTable);mainTable.appendChild(mainTbody);mainTbody.appendChild(mainRow);mainRow.appendChild(this.mainCell);this.mainDiv.style.display="none";this.mainDiv.style.visibility="hidden";document.body.appendChild(this.mainDiv)}PopupMenu.prototype.GetID=function(){return this.mainDiv.id};PopupMenu.prototype.Add=function(text,onclickFunc){var anchor=document.createElement("a");anchor.href="#";anchor.innerHTML=text;anchor.onclick=onclickFunc;this.mainCell.appendChild(anchor);return anchor};function TabbedPageSet(containerID,initialPageID,pageChangeCallback){this.container=getElementBy(containerID);this.selectedPage=null;this.firstPage=null;this.initialPage=null;if(pageChangeCallback){this.pageChangeCallback=pageChangeCallback}var tabsDiv=document.createElement("div");this.container.insertBefore(tabsDiv,this.container.childNodes[0]);this.jtabs=new TabSet(tabsDiv,_TSonclickTab);var tabWidth=0;var containerWidth=0;if(this.container.style&&this.container.style.width){containerWidth=parseInt(this.container.style.width,10)}this.jtabs.SetMaxTabSetWidth(containerWidth?containerWidth-100:700);for(var n=1;n<1000;++n){var page=QBselectSingleNode(this.container,"div["+n+"]");if(page==null){break}var tabLabel=GetHTMLattribute(page,"qbTabLabel");var tabShow=(GetHTMLattribute(page,"qbTabShow")==true);var tabColor=GetHTMLattribute(page,"qbTabColor");var tabUnavailable=GetHTMLattribute(page,"qbTabUnavailable")?true:false;var tabExtraClasses=GetHTMLattribute(page,"qbTabExtraClasses")||"";if(tabShow||page.id==initialPageID){this.initialPage=page}if(this.firstPage==null){this.firstPage=page}var tabCell=this.jtabs.AddTab(tabLabel,page,tabUnavailable,tabExtraClasses);var tabid=GetHTMLattribute(page,"qbTabId");if(tabid!=null){tabCell.id=tabid}page.qbTab=tabCell;page.qbTabSet=this;page.qbTabLabel=tabLabel}if(this.initialPage){this.SelectPage(this.initialPage)}else{if(this.firstPage){this.SelectPage(this.firstPage)}}}TabbedPageSet.prototype.SetInitialPageIf=function(pageOrID){var page=toElem(pageOrID);if(this.initialPage==null&&page!=null){this.initialPage=page;this.SelectPage(page)}};TabbedPageSet.prototype.SelectPage=function(page){var pageElem=toElem(page);if(this.selectedPage==pageElem){return}if(pageElem){HideMenus();if(this.selectedPage){var pageID=this.selectedPage.id;var tabCell=this.selectedPage.qbTab;closeElem(this.selectedPage);this.selectedPage=null;if(this.pageChangeCallback){this.pageChangeCallback(this.container.id,pageID,false)}}this.selectedPage=pageElem;openElem(pageElem);var tabCell=pageElem.qbTab;this.jtabs.DisplayTabAsSelected(tabCell);if(this.pageChangeCallback){this.pageChangeCallback(this.container.id,this.selectedPage.id,true)}StdResizeProc()}};TabbedPageSet.prototype.GetSelectedTabID=function(){return this.selectedPage.id};TabbedPageSet.prototype.GetPageAttr=function(attrname,page){if(!page){return GetHTMLattribute(this.selectedPage,attrname)}return GetHTMLattribute(page,attrname)};TabbedPageSet.prototype.FindPageByAttr=function(attrname,value){for(var n=0;n<1000;++n){var page=QBselectSingleNode(this.container,"div["+n+"]");if(page==null){return null}if(GetHTMLattribute(page,attrname)==value){return page}}return null};function _TSonclickTab(tabCell,page){if(page&&page.qbTabSet){page.qbTabSet.SelectPage(page)}}function TabSet(tabContainer,clickHandler,tabTableID){this.iClickHandler=clickHandler;this.iTotalTabWidth=0;this.iNumTabs=0;this.iLastTab=null;this.iMaxTotalWidth=1600;this.iSelectedTab=null;this.iTable=null;if(tabTableID){this.iTable=toElem(tabTableID)}if(this.iTable){var row0=this.iTable.rows[0];for(var n=0;n<row0.cells.length;++n){var cell=row0.cells[n];if(cell.className&&StringContains(cell.className,"stdtab")){this.SetupTab(cell)}}}else{this.iTable=document.createElement("table");var tabBody=document.createElement("tbody");var tabRow=document.createElement("tr");var container=toElem(tabContainer);container.appendChild(this.iTable);this.iTable.appendChild(tabBody);tabBody.appendChild(tabRow);if(tabTableID){this.iTable.id=tabTableID}}this.iTabRow=QBselectSingleNode(this.iTable,"tbody/tr");this.iTable.className="stdTabTable";this.iTable.cellSpacing=0;this.iTable.cellPadding=0;this.iSelectedTab=null;this.iSelBGcolor="#31619c";this.iSelTXcolor="#ffffff";this.iUnselBGcolor="#d5e3f4";this.iUnselTXcolor="#666666";this.iUnavailableBGcolor="#f3f7fc";this.iUnavailableTXcolor="#878787";this.iTable.onclick=_JTabsOnClick;this.iTable.onmouseover=_JTabsMouseOver;this.iTable.onmouseout=_JTabsMouseOut;this.iTable.QBjtabs=this}TabSet.prototype.SetSelectColors=function(bgColor,txColor){this.iSelBGcolor=bgColor;this.iSelTXcolor=txColor;if(this.iSelectedTab){this.DisplayTabAsSelected(this.iSelectedTab,true)}};TabSet.prototype.SetUnselectColors=function(bgColor,txColor){this.iUnselBGcolor=bgColor;this.iUnselTXcolor=txColor};TabSet.prototype.SetMaxTabSetWidth=function(maxTotalWidth){this.iMaxTotalWidth=maxTotalWidth};TabSet.prototype.AddTab=function(text,value,isUnavailable,extraClasses,width){if(this.iTotalTabWidth>this.iMaxTotalWidth){return this.AddMoreItem(text,value)}var spacer=document.createElement("td");spacer.innerHTML=(this.iNumTabs==0?"&nbsp;&nbsp;":"&nbsp;");var tabcell=document.createElement("td");tabcell.innerHTML=text;if(typeof extraClasses=="undefined"){extraClasses=""}tabcell.className="stdtab "+extraClasses;tabcell.noWrap=true;if(typeof width!="undefined"){tabcell.style.width=width}this.iTabRow.appendChild(spacer);this.iTabRow.appendChild(tabcell);if(typeof value=="undefined"){var value=null}if(typeof isUnavailable=="undefined"){isUnavailable=false}this.SetupTab(tabcell,value,isUnavailable);this.iTotalTabWidth=this.iTotalTabWidth+20+(text.length*8);return tabcell};TabSet.prototype.SetupTab=function(tabcell,value,isUnavailable){if(typeof tabcell=="string"){tabcell=toElem(tabcell)}if(!tabcell){return}tabcell.QBjtabs=this;tabcell.style.backgroundColor=this.iUnselBGcolor;tabcell.style.color=this.iUnselTXcolor;tabcell.unavailable=false;if(typeof isUnavailable=="undefined"){isUnavailable=false}if(isUnavailable){tabcell.style.backgroundColor=this.iUnavailableBGcolor;tabcell.style.color=this.iUnavailableTXcolor;tabcell.unavailable=true}if(typeof value!="undefined"){tabcell.qbVal=value}++this.iNumTabs;this.iLastTab=tabcell};TabSet.prototype.AddMoreItem=function(text,value){var tabcell=this.iLastTab;if(!this.iMoreMenu){var menu=FindOrCreateQBmenu2("jtabs_moremenu");menu.AppendTopHeading("More");var menupick=menu.AppendOnclick(tabcell.innerHTML,_JTabsOnMorePick);menupick.qbVal=tabcell.qbVal;menupick.QBjtabs=this;menupick.qbIsMenuPick=true;var moreButStyle="text-decoration:none; border:1px solid #77a; color:Black; font-size:90%; font-weight:normal; font-style:italic; background-color:#eee; margin-left:10px; padding:0px 5px 1px 5px;";var tabText=tabcell.innerHTML;tabcell.innerHTML=tabText+"<span style='"+moreButStyle+"'>more <img src='/i/menu_icon.png' height=5 width=7 align=middle></span>";var moreBut=QBselectSingleNode(tabcell,"span");moreBut.qbmenu=menu.menuDiv.id;moreBut.qbmhicolor="#FFFFBB";this.iMoreMenu=menu}var menupick=this.iMoreMenu.AppendOnclick(text,_JTabsOnMorePick);menupick.qbVal=value;menupick.QBjtabs=this;menupick.qbIsMenuPick=true;return menupick};TabSet.prototype.PreselectTab=function(value){if(value){var tabcell=this._FindTabCell(value);if(tabcell){this.DisplayTabAsSelected(tabcell)}}};TabSet.prototype.GetSelectedTab=function(){return this.iSelectedTab};TabSet.prototype._FindTabCell=function(value){for(var r=0;r<this.iTable.rows.length;++r){var row=this.iTable.rows[r];for(var c=0;c<row.cells.length;++c){var cell=row.cells[c];if(cell.QBjtabs&&cell.qbVal==value){return cell}}}return null};TabSet.prototype.DisplayTabAsSelected=function(tabcell,force){if(tabcell==this.iSelectedTab&&!force){return}if(tabcell.qbIsMenuPick){_JTabsReplaceTabText(this.iLastTab,DOMinnerText(tabcell));this.iLastTab.qbVal=tabcell.qbVal;tabcell=this.iLastTab}if(this.iSelectedTab){this.iSelectedTab.style.backgroundColor=this.iUnselBGcolor;this.iSelectedTab.style.color=this.iUnselTXcolor;this.iSelectedTab=null}if(tabcell){tabcell.style.backgroundColor=this.iSelBGcolor;tabcell.style.color=this.iSelTXcolor;this.iSelectedTab=tabcell}};TabSet.prototype.SelectTab=function(tabcell_or_ID_or_val){var tabcell=toElem(tabcell_or_ID_or_val);if(tabcell==null){tabcell=this._FindTabCell(tabcell_or_ID_or_val)}if(tabcell==null){ldi("tab not found: "+tabcell_or_ID);return}if(this.iClickHandler){var value=(tabcell.qbVal?tabcell.qbVal:null);if(!tabcell.unavailable){this.iClickHandler(tabcell,value)}}if(!tabcell.unavailable){this.DisplayTabAsSelected(tabcell)}};function _JTabsOnClick(event){var targ=EvGetTarget(event);if(targ&&targ.QBjtabs){targ.QBjtabs.SelectTab(targ)}}function _JTabsOnMorePick(event,row){HideMenus();if(row.QBjtabs){row.QBjtabs.SelectTab(row)}}function _JTabsReplaceTabText(tabCell,newText){for(var n=0;n<tabCell.childNodes.length;++n){var node=tabCell.childNodes[n];if(node.nodeType==kTEXT_NODE&&!IsWhiteSpace(node.nodeValue)){node.nodeValue=newText;return}}}function _JTabsMouseOver(event){var targ=EvGetTarget(event);if(targ&&targ.QBjtabs&&!targ.unavailable){_JTabsSetGlow(targ,targ.QBjtabs)}}function _JTabsMouseOut(event){var targ=EvGetTarget(event);if(targ&&targ.QBjtabs&&!targ.unavailable){_JTabsSetGlow(null,targ.QBjtabs)}}function _JTabsSetGlow(tabcell,jtabs){glowtab=jtabs.iGlowTab;if(glowtab==tabcell){return}if(glowtab){var isSelected=(glowtab==jtabs.iSelectedTab);glowtab.style.backgroundColor=(isSelected?jtabs.iSelBGcolor:jtabs.iUnselBGcolor);glowtab.style.color=(isSelected?jtabs.iSelTXcolor:jtabs.iUnselTXcolor);jtabs.iGlowTab=null}if(tabcell&&tabcell!=jtabs.iSelectedTab){tabcell.style.backgroundColor=Darken(jtabs.iUnselBGcolor,8);tabcell.style.color=Darken(jtabs.iUnselTXcolor,60);jtabs.iGlowTab=tabcell}}function DivStack(container){this.container=toElem(container);this.selectedDiv=null;this.numlines=0;for(var n=0;n<1000;++n){var line=QBselectSingleNode(this.container,"div["+n+"]");if(line==null){break}line.qbDivStack=this;this.numlines++;this.SetOnclick(line)}}DivStack.prototype.SetSelectionChangeCB=function(cbfunc){this.selectionChangeCallback=cbfunc};DivStack.prototype.SetClearLineCB=function(cbfunc){this.clearLineCallback=cbfunc};DivStack.prototype.SetMoveUpButton=function(button){this.SetButton(button,"moveup")};DivStack.prototype.SetMoveDownButton=function(button){this.SetButton(button,"movedown")};DivStack.prototype.SetInsertButton=function(button){this.SetButton(button,"insert")};DivStack.prototype.SetRemoveButton=function(button){this.SetButton(button,"remove")};DivStack.prototype.SetButton=function(but,type){var button=toElem(but);this[type+"Button"]=button;if(button){button.qbDivStack=this;button.DStype=type;button.onclick=DSonclickOpButton}};function DSonclickOpButton(event){var button=EvGetTarget(event);if(button.qbDivStack){var ds=button.qbDivStack;if(button.DStype=="insert"){ds.InsertNewDiv()}if(button.DStype=="remove"){ds.RemoveSelection()}if(button.DStype=="moveup"){ds.MoveSelectionUp()}if(button.DStype=="movedown"){ds.MoveSelectionDown()}ds.UpdateButtons()}}DivStack.prototype.MoveSelectionUp=function(){if(this.selectedDiv){var index=this.LineToIndex(this.selectedDiv);if(index>0){var otherRow=this.IndexToLine(index-1);if(otherRow){var removedNode=this.container.removeChild(this.selectedDiv);this.container.insertBefore(removedNode,otherRow);return index-1}}}};DivStack.prototype.MoveSelectionDown=function(){if(this.selectedDiv){var index=this.LineToIndex(this.selectedDiv);if(index>=0){var otherRow=this.IndexToLine(index+1);if(otherRow){var removedNode=this.container.removeChild(otherRow);this.container.insertBefore(removedNode,this.selectedDiv)}}}};DivStack.prototype.RemoveSelection=function(){if(this.selectedDiv){if(this.numlines>1){var index=this.LineToIndex(this.selectedDiv);var div=this.selectedDiv;this.DeselectRow();this.container.removeChild(div);this.numlines--;var lineToSelect=this.IndexToLine(index);if(lineToSelect==null){lineToSelect=this.IndexToLine(index-1)}this.SelectRow(lineToSelect)}}};DivStack.prototype.InsertNewDiv=function(){var newDiv=null;var index=0;if(this.selectedDiv){var index=this.LineToIndex(this.selectedDiv);if(index>=0){newDiv=this.selectedDiv.cloneNode(true)}}else{if(this.numlines>0){index=this.numlines-1;var line=this.IndexToLine(index);if(line){newDiv=line.cloneNode(true)}}}if(newDiv){this.SetOnclick(newDiv);if(this.clearLineCallback){this.clearLineCallback(newDiv)}var otherRow=this.IndexToLine(index+1);if(otherRow){this.container.insertBefore(newDiv,otherRow)}else{this.container.appendChild(newDiv)}this.numlines++;this.SelectRow(newDiv)}};DivStack.prototype.GetSelectionIndex=function(){return this.LineToIndex(this.selectedDiv)};DivStack.prototype.SetOnclick=function(line){line.onclick=DSonClickLine};function FindLineThatContains(el){var elem=el;for(var i=0;i<10;++i){elem=QBselectParentNode(elem,"div");if(elem&&typeof elem.qbDivStack!="undefined"){return elem}}return null}function DSonClickLine(event){var targ=EvGetTarget(event);var line=FindLineThatContains(targ);if(line){var bullet=QBselectSingleNode(line,"img");if(targ==bullet){line.qbDivStack.SelectRow(line);EvCancelAll(event);return false}line.qbDivStack.DeselectRow()}}DivStack.prototype.UpdateButtons=function(){var index=this.GetSelectionIndex();if(typeof this.moveupButton!="undefined"){EnableDisable(index>0,this.moveupButton)}if(typeof this.movedownButton!="undefined"){EnableDisable(index<this.numlines-1,this.movedownButton)}if(typeof this.removeButton!="undefined"){EnableDisable(this.numlines>1,this.removeButton)}};DivStack.prototype.SelectRow=function(row){this.DeselectRow();if(row){this.selectedDiv=row;row.style.backgroundColor="#ccc";if(this.selectionChangeCallback){this.selectionChangeCallback(this.selectedDiv)}this.UpdateButtons()}};DivStack.prototype.DeselectRow=function(){if(this.selectedDiv){this.selectedDiv.style.backgroundColor="";this.selectedDiv=null;if(this.selectionChangeCallback){this.selectionChangeCallback(this.selectedDiv)}this.UpdateButtons()}};DivStack.prototype.LineToIndex=function(row){for(var n=0;n<1000;++n){var line=QBselectSingleNode(this.container,"div["+n+"]");if(line==null){break}if(line==row){return n}}return -1};DivStack.prototype.IndexToLine=function(index){for(var n=0;n<1000;++n){var line=QBselectSingleNode(this.container,"div["+n+"]");if(line==null){break}if(n==index){return line}}return null};var gColorChooserWin;var colorChooserTemplate="<html>\n<head>\n<style>\n</style>\n<script src='"+(window.gResDir||"")+"/js/jquery-1.7.2.min.js' type='text/javascript'><\/script>\n<script language='javascript1.5' src='"+(window.gResDir||"")+"/"+gJSdir+"/colorchooser.js' type='text/javascript'><\/script>\n<script language='javascript1.5' src='"+(window.gResDir||"")+"/"+gJSdir+"/utils.js' type='text/javascript'><\/script>\n</head>\n<body onload='CC_LoadProc();' style='margin:0px'>\n<table cellspacing=0 cellpadding=0>\n<tr><td colspan=2>\n<table id=mainTable style='margin-bottom:10px; width:100%' onMouseOver='CC_mouseOver(event)' onMouseUp='CC_mouseUp(event)'><tbody></tbody></table>\n</td></tr>\n<tr>\n<td id=swatch style='width:50%; height:40px; background-color:white;'>&nbsp;</td>\n<td id=hexval style='width:50%; text-align:center;'></td>\n</tr>\n</table>\n</body>\n</html>\n";var gCC_targetID=null;var gCC_initColor=null;var gCC_callback=null;var gCC_callback_param=null;function ColorChooser_Setup(){gColorChooserWin.ccTargetID=gCC_targetID;gColorChooserWin.ccCallback=gCC_callback;gColorChooserWin.ccParam=gCC_callback_param;if(gColorChooserWin.CC_SetColor){gColorChooserWin.CC_SetColor(gCC_initColor)}}function ColorChooser_Display(initColor,targetID,callback,callback_param){var sTop=(IsIE()?window.screenTop:window.screenY+100);var sLeft=(IsIE()?window.screenLeft:window.screenX);var top=GetMouseY()+sTop-60;var left=GetMouseX()+sLeft+200;var features="width=254,height=274,resizable,top="+top+",left="+left;gColorChooserWin=window.open("","_QuickBaseColorChooser",features);gColorChooserWin.document.open();gColorChooserWin.document.write(colorChooserTemplate);gColorChooserWin.document.title="Select a Color";gColorChooserWin.document.close();gColorChooserWin.focus();gCC_targetID=(targetID?targetID:null);gCC_initColor=(initColor?initColor:null);gCC_callback=(callback?callback:null);gCC_callback_param=null;if(typeof gCC_callback_param!="undefined"){gCC_callback_param=callback_param}setTimeout("ColorChooser_Setup()",300)}function ColorChooser_Close(){gColorChooserWin.close();gColorChooserWin=null}function AskNewRole(){QBprompt("Enter a name for the role you want to create:","DoNewRole()",null,null,"Untitled Role")}function DoNewRole(){var newname=GetValue("qbPromptInput");var pageToken=GetValue("PageToken");if(pageToken==""){var jaxToken=new jaxreq(gReqAppDBID+"?a=QBI_GetPageToken");jaxToken.DoSyncCmd();pageToken=jaxToken.GetValue("pageToken")}SetLocation(gReqAppDBID+"?a=QBI_AddRole&rolename="+urlencode(newname)+"&PageToken="+pageToken)}function GotoDebugApp(){if(gReqAppDBID==0){alert("This menu pick only works from application pages");HideMenus()}else{location=gReqAppDBID+"?a=debugDB"}}function ShowBetaFeedback(){ShowPopupDiv("betaFeedbackDiv")}function BN_DoChangeRole(value){var url=null;var GATrackString=null;if(value==-1){url=gReqAppDBID+"?a=QBI_RevertTemporaryRole";GATrackString="App/RevertTemporaryRole/"}else{var jaxToken=new jaxreq(gReqAppDBID+"?a=QBI_GetPageToken");jaxToken.DoSyncCmd();var pageToken=jaxToken.GetValue("pageToken");url=gReqAppDBID+"?a=QBI_SetTemporaryRole&roleid="+value+"&PageToken="+pageToken;GATrackString="App/SetTemporaryRole/"}var jax=new jaxreq(url);setupGATrackAndCallback(function(){JaxSyncCmdEx(jax,kAutoRefresh)},GATrackString)}function callbackSecuritySetup(forcesignout){if(forcesignout){SetCookie("showSecPrmpt",true,24*60);window.location="main?a=ForceSignout&nextURL="+urlencode(document.location);return}var grace=true;SetupSecurityPromptDialog(grace);$("#SecretQuestionDialog").dialog("open")}function StdCustThisProc(){if(typeof CustThisPageProc=="function"){CustThisPageProc()}else{if(typeof CustThisReportProc=="function"){CustThisReportProc()}}return false}function CMTableSelect(action){HideFauxToolTip();popupTableSelector(action)}function copyMasterDetailButtonHandler(urlparams,dbid){var masterDBID;if(dbid==null||dbid==""){masterDBID=gReqDBID}else{masterDBID=dbid}var jax=new jaxreq(masterDBID+"?a=QBI_CopyMasterDetail"+urlparams);var pagetoken=GetValue("PageToken");if(pagetoken==""){var jaxToken=new jaxreq(gReqAppDBID+"?a=QBI_GetPageToken");jaxToken.DoSyncCmd();pagetoken=jaxToken.GetValue("pageToken")}jax.AddValue("PageToken",pagetoken);jax.DoSyncCmd();if(jax.success){var parentRecordName=jax.GetValue("parentRecName");if(parentRecordName==null||parentRecordName==""){parentRecordName="Record"}var buttonName="Go To "+parentRecordName;var dialogButtons={};dialogButtons[buttonName]=function(){window.open(masterDBID+"?a=dr&rid="+jax.GetValue("parentrid"),"_top")};$("<div class='ConfNewSubDialog'><p class='confDialogMessage'>"+Numerize(jax.GetValue("numCreated"),"record")+" created.</br></p></div>").dialog({modal:true,width:"410px",resizable:false,title:"Records Copied",buttons:dialogButtons,close:function(event,ui){$(this).dialog("destroy").remove()}})}else{doErrorDialog("There was an error copying the records.  Contact the application administrator with the error details below. <br /><br />Error Details:<br />"+(jax.errdetails?jax.errdetails:jax.errtext))}}function hasReqFields(form){var result=true;var requireFields=$(form).find("[data-is-required]");for(var i=0;i<requireFields.length;++i){var elem=requireFields[i];if(elem){if(!isValidField(elem,elem.name)){result=false}}}if(!result){$.jGrowl("All required fields must be filled",{theme:"jGrowl-warning"})}return result}function isValidField(elem,fieldName){var labelID="#_"+fieldName;var label=$(labelID);var elemIsEmpty=(elem.value.length==0);label.toggleClass("errorLabel",elemIsEmpty);return !elemIsEmpty}function setupPasswordValidation(passwordField,confirmField,minLength,requireUpperLower,opts){if(!minLength||minLength<1){minLength=1}if(!opts){opts={}}var requirements={minLength:{value:minLength,message:"Must be at least "+minLength+" characters"},maxLength:{value:false},mixedAlNum:{value:true,callback:function(text,value){if(!/\d/.test(text)){return false}if(!/\D/.test(text)){return false}return true},message:"Must include both numbers and letters"},noWhitespace:{value:true,hideIfPassed:true,callback:function(text,value){if(text.indexOf(" ")>=0){return false}if(text.indexOf("\t")>=0){return false}if(text.indexOf("\r")>=0){return false}if(text.indexOf("\n")>=0){return false}return true},message:"Cannot include spaces, tabs, or returns"}};if("maxLength" in opts){requirements.maxLength={value:true,hideIfPassed:true,callback:function(text,value){return(text||"").length<=opts.maxLength},message:"Must be no more than "+opts.maxLength+" characters"}}if(requireUpperLower){requirements.mixedCase={value:true,callback:function(text,value){if(!/[a-z]/.test(text)){return false}if(!/[A-Z]/.test(text)){return false}return true},message:"Must include both upper- and lowercase letters"}}if(confirmField){requirements.matchField={value:confirmField,message:"The two passwords do not match",hideIfPassed:true}}requirements.noUnicode={value:true,hideIfPassed:true,callback:function(text,value){for(var i=0;i<text.length;i++){var ccode=text.charCodeAt(i);if(ccode<32||ccode>255){return false}}return true},message:"Cannot contain unicode characters"};var defaultText="";var bullet='<img src="/i/icons/16/check_gray.png" /> ';for(var k in requirements){if(!("message" in requirements[k])){continue}if(requirements[k].hideIfPassed||!requirements[k].value){continue}if(defaultText!=""){defaultText+="<br />\n"}defaultText+=bullet+requirements[k].message}var barInflation=2.8-minLength*0.09;if(barInflation<1){barInflation=1}$(passwordField).simplePassMeter({imgFail:"/i/icons/16/exclamation.png",imgPass:"/i/icons/16/check_green.png",scoreInflation:1.25,barInflation:barInflation,defaultText:defaultText,requirements:requirements,container:(opts.container||null)});if(opts.autoFocus){if(typeof(opts.autoFocus)=="boolean"){$(passwordField).focus()}else{$(opts.autoFocus).focus()}}if(opts.onValidate){$(passwordField).unbind("score.simplePassMeter").bind("score.simplePassMeter",function(evt,score,failed){opts.onValidate(evt,score,(!failed||failed.length==0),failed)})}}function SetupSecurityPromptDialog(graceperiod){var validated=false;var SecretQuestionValidator,SecretQuestionValidatorSettings={highlight:function(element,errorClass){$(element).addClass("sqInputValidationError")},unhighlight:function(element,errorClass){$(element).removeClass("sqInputValidationError")},invalidHandler:function(e,validator){var errors=validator.numberOfInvalids();var foundErrors=(errors>0);var message="Please check the form for following errors:<ul>";if(errors){if(validator.pwdvalidationfail){errors--;message+="<li> Your password doesn't meet the minimum requirements.</li>"}if(validator.nogoodanschars){errors--;message+="<li>The answer to your security question must contain one or more letters or numbers.</li>"}if(validator.secansdontmatch){errors=errors-2;message+="<li>The security answers must match.</li>"}if(errors){message+="<li>"+errors+" field(s) are missing. They have been highlighted below.</li>"}}message+="</ul>";if(validator.nogoodanschars||validator.pwdvalidationok||validator.secansdontmatch||errors>0){$("#SecurityPromptErrDiv").html(message);$("#SecurityPromptErrDiv").show()}else{$("#SecurityPromptErrDiv").hide()}}};$.validator.messages.required="";$.validator.messages.needschoice="";$.validator.messages.needspwdvalidation="";$.validator.messages.needsgoodanswerchars="";$.validator.messages.needsmatchinganswers="";$.validator.addMethod("needschoice",function(value,element){return $(element).val()&&$(element).val()!=""&&$(element).val()!="Select a question..."});$.validator.pwdvalidationfail=false;$.validator.addMethod("needspwdvalidation",function(value,element){this.pwdvalidationfail=!(!gNeedsPwdValidationPrompt||gIsNewPassword4PromptValid);return !this.pwdvalidationfail});$.validator.nogoodanschars=false;$.validator.addMethod("needsgoodanswerchars",function(value,element){var inputval=$(element).val();var result=inputval.replace(/[.|\s|,]/g,"");this.nogoodanschars=(result==""&&inputval!="");return(result!="")});$.validator.secansdontmatch=false;$.validator.addMethod("needsmatchinganswers",function(value,element){this.secansdontmatch=(typeof isQnAValid==="function")&&!isQnAValid();return !this.secansdontmatch});var ww=$(window).width()-50;var minwidth=664;var questDialog=$("#SecretQuestionDialog").dialog({modal:true,width:"750px",resizable:true,title:questDialogTitle,autoOpen:false,open:function(){SecretQuestionValidator=$("#SecretQuestionForm",this).validate(SecretQuestionValidatorSettings);var pos=$("#SecretQuestionDialog").dialog("option","position");$("#SecretQuestionDialog").dialog("option","position",[pos[0]-10,pos[1]]);$(".ui-widget-overlay").addClass("darkOverlay")},beforeClose:function(){var closing=(graceperiod||validated);if(closing&&hasCookie("showSecPrmpt")){ExpireCookie("showSecPrmpt")}return closing},buttons:{Update:function(evt){if($("#SecretQuestionForm",this).valid()){var dlg=this;var errorDetail="";var errorText="";if(gNeedsQAValidationPrompt){$.ajax({dataType:"xml",type:"POST",url:"main?"+$.param({a:"QBI_SetupQuestionAnswer",qadebug:1,cqa:gNeedsQAValidationPrompt?1:0,cpw:gNeedsPwdValidationPrompt?1:0,iso:$("#SecretQuestionDialog").dialog("isOpen")?1:0,efmc:(typeof evt.originalEvent!="undefined")?1:0,uid:gReqUID,msonp:(new Date()).getTime()-(gStartLoadTime||0),bonus:""}),async:false,dlg:dlg,data:$("#SecretQuestionForm").serialize(),success:(function(data){if($("errcode",data).text()!="0"){errorDetail=$("errdetail",data).text();errorText=$("errtext",data).text()}else{$(".ui-widget-overlay").removeClass("darkOverlay");validated=true;notifyGreen('<p style="padding:1em 1.75em 1em 1.75em">Your question and answer were successfully saved.</p>');$(this.dlg).dialog("close")}}),error:(function(request,textStatus,errorThrown){doErrorDialog("There was an error setting your Question and Answer. Refresh the page"+errorThrown)})})}if(gNeedsPwdValidationPrompt){$.ajax({dataType:"xml",type:"POST",url:"main?a=QBI_ChangePassword",async:false,dlg:dlg,data:$("#SecretQuestionForm").serialize()+"&nop=true",success:(function(data){if($("errcode",data).text()!="0"){errorDetail=$("errdetail",data).text();errorText=$("errtext",data).text()}else{$(".ui-widget-overlay").removeClass("darkOverlay");validated=true;notifyGreen('<p style="padding:1em 1.75em 1em 1.75em">Your password was successfully reset.</p>');$(this.dlg).dialog("close")}}),error:(function(request,textStatus,errorThrown){doErrorDialog("There was an error resetting your password. Refresh the page"+errorThrown)})})}if(errorText.length>0){doErrorDialog("There was an error during submit. <br /><br />Error details:<br />"+(errorDetail?errorDetail:errorText))}else{$("#SecurityInfoWarning").hide()}}}}});if(!graceperiod){questDialog.parents(":eq(0)").find(".ui-dialog-titlebar-close").hide()}else{questDialog.dialog("addbutton","Not Now",function(){$(this).dialog("close")})}$(questDialog).find("input").keypress(function(e){if((e.which&&e.which==13)||(e.keyCode&&e.keyCode==13)){e.preventDefault();$("button:contains(OK)",$("#SecretQuestionDialog").dialog("widget")).click()}})}function showVerificationRequiredDialog(trackingString){var analyticsString="VerificationRequiredDialog/"+trackingString;getCompanyName();$("#newEmailAddress").val(gReqUserEmail);QB.Dialog.dialog({contents:"#verificationRequiredDialog",contentType:"selector",title:"It's time to verify your email",focusedButton:".Confirm",cancel:{text:"Not Now",click:function(){$(this).dialog("close");QBTrackPageView(analyticsString+"/NotNow")}},confirm:{text:"Send verification email",click:function(){setupGATrackAndCallback(function(){var newYourCompanyName=GetValue("newYourCompanyName").Trim();if(newYourCompanyName==""){QBalert("Company name may not be blank.");return}var newEmailAddress=GetValue("newEmailAddress").Trim();if(newEmailAddress==""){QBalert("Email address may not be blank.");return}if(!IsRFC822ValidEmail(newEmailAddress)){QBalert("Please enter a valid email address.");return}window.location="main?a=DelayVerifyResendVerificationEmailChange&newEmailAddress="+urlencode($("#newEmailAddress").val())+"&newCompanyName="+urlencode($("#newYourCompanyName").val())},analyticsString+"/Verify")}}});QBTrackPageView(analyticsString)}function getCompanyName(){var jax=new jaxreq("main?a=QBI_GetDelayVerifyCompanyName");if(jax){jax.DoAsyncCmd(function(){getCompanyNameCallback(jax)})}}function getCompanyNameCallback(jax){if(jax.success){$("#newYourCompanyName").val(jax.GetValue("sDelayVerifyCompanyName"))}}function showVerificationCompletionDialog(trackingString){var analyticsString="VerificationCompletionDialog/"+trackingString;QB.Dialog.dialog({contents:"#verificationCompletionDialog",contentType:"selector",title:"Verify Information",cancel:{text:"Not Now",click:function(){$(this).dialog("close");QBTrackPageView(analyticsString+"/NotNow")}},confirm:{text:"Send verification email",click:function(){setupGATrackAndCallback(function(){window.location="main?a=DelayVerifyResendVerification"},analyticsString+"/Verify")}}});QBTrackPageView(analyticsString)}setupResizeTrigger();var browserCharset=document.charset;if(!browserCharset){browserCharset=document.characterSet}SetCookie("browserCharset",document.charset,60*24*7);(function(){if(!Modernizr.touch){return}$(document).bind("dialogcreate",function(event,ui){var elem=$(event.target);elem.prepend("<div tabindex='1'></div>")});if($.fn.tokenInput){$.fn.tokenInput.defaults.autoFocus=false}if($.ui&&$.ui.sortable){$.ui.sortable.prototype.options.delay=1000}if(CriteriaWidget){CriteriaWidget.defaultCriteriaOptions.showOnHover=false}if($(window).width()<600){window.QB=window.QB||{};window.QB.Nav=$.extend(true,{},window.QB.Nav,{options:{fixNavBars:false}});$("meta[name=viewport]").attr("content","width=980, initial-scale=0.25, maximum-scale=2.6, minimum-scale=0.25, user-scalable=yes")}$(function(){if(jQuery.jgrid){jQuery.extend(jQuery.jgrid.defaults,{hoverrows:false})}})})();; 
 
//@ sourceURL=/js/nav.js 
var QB=QB||{};QB.Nav=QB.Nav||{};QB.Nav=$.extend(true,{options:{fixNavBars:true},Models:{},Views:{},Instance:{}},QB.Nav);$(function(){if(window.self!==window.top){$(".InfoMsgBox").hide()}if($(document.body).hasClass("SettingsMode")){var lastPageURL=QB.Storage.UserApp.get("lastNonSettingsPage","");if(lastPageURL){$("#pageNavBarExitSettingsButton").prop("href",lastPageURL)}}else{if(!$(document.body).hasClass("ExcludeFromLastNonSettingsPage")&&window==window.top&&!GetURLParameterValue(document.location,"ifv")){var relativeURL=(document.location.pathname||"")+(document.location.search||"");var isAddTest=/(\?|&)a(ct)*=(api_genaddrecordform|nwr|gennewrecord|GenCopyRecord)/i;if(isAddTest.test(document.location.search)){var lastPageURL=QB.Storage.UserApp.get("lastNonSettingsPage","");if(!isAddTest.test(lastPageURL)){QB.Storage.UserApp.set("lastPageBeforeAdd",lastPageURL)}}QB.Storage.UserApp.set("lastNonSettingsPage",relativeURL)}}InitializeRightSideMenus();InitNewAppButton();var $refreshConnectedTableButton=$("#refreshDataAction");if($refreshConnectedTableButton.length>0){requirejs(["connect.refreshTable"],function(){angular.bootstrap($refreshConnectedTableButton,["qb.connect.refreshTable"])})}var $signOutButton=$("#signOutItem");if($signOutButton.length>0){requirejs(["connect.logout"],function(){angular.bootstrap($signOutButton,["qb.connect.logout"])})}if($("#pageNavBarMoreActionsMenu,#pageNavBarMoreActionsButton").length>=2){$("#pageNavBarMoreActionsMenu").detach().appendTo($(document.body)).qbMenu({zindex:99999,trigger:{selector:"#pageNavBarMoreActionsButton",position:{my:"right top",at:"right bottom",collision:"fit"}}})}if($("#newTableMenuButtonAppHome").length){$("#createTableMenuAppHome").detach().appendTo($(document.body)).qbMenu({zindex:99999,trigger:{selector:"#newTableMenuButtonAppHome",position:{my:"left top",at:"left bottom",collision:"fit"}}})}if($("#newTableMenuButton").length){$("#createTableMenuAppTable").detach().appendTo($(document.body)).qbMenu({zindex:99999,trigger:{selector:"#newTableMenuButton",position:{my:"right top",at:"right bottom",collision:"fit"}}})}var settingsTables=[];if($("#settingsJumpMenu_app").length){settingsTables.push({dbid:"app",name:$("#settingsJumpMenu_app").text()})}if($("#settingsJumpMenu_personal").length){settingsTables.push({dbid:"personal",name:$("#settingsJumpMenu_personal").text()})}var justTables=[];$.extend(true,justTables,gTablesJSON);_.each(justTables,function(table){var act=gReqAct;if(!gJumpTableAct||table.current){act="TableSettingsHome"}table.countForMinToFilter=true;table.act=act;table.displayName=$.trim(table.heading)});settingsTables=settingsTables.concat(justTables);if(settingsTables.length&&$("#settingsJumpMenuButton").length){var menu=$("#settingsJumpMenu");setupTriggeredListMenu({itemList:settingsTables,viewName:"settingsMenu",menuElement:$("#settingsJumpMenu"),triggerElement:$("#settingsJumpMenuButton"),position:{my:"left top",at:"left bottom",collision:"fit"}});menu.on("ListFiltered",function(){var beforeSepItems=menu.find("li.Filterable.BeforeSeparator:not(.DisplayNone)").length;var afterSepItems=menu.find("li.Filterable:not(.BeforeSeparator):not(.DisplayNone)").length;var separatorNeeded=(beforeSepItems>0&&afterSepItems>0);$("#settingsJumpMenu .Separator").toggleClass("DisplayNone",!separatorNeeded)})}if(typeof gPageBarReportTrayData!="undefined"){configurePageBarTray(gPageBarReportTrayData.reportGroups,"rpttry_")}});function configurePageBarTray(trayJSON,persistenceKey,JBIurl){if(!trayJSON&&!JBIurl){return false}var reportGroups,defaultReportTrayView;var pageNavTray=$("#pageNavBar").children(".Tray");var calloutArrow=pageNavTray.find(".CalloutArrow").first();$("#pageNavBar").on("click",".TrayToggler",function(evt){var isOpen=pageNavTray.hasClass("Open");var toggler=$(this);if(isOpen){pageNavTray.removeClass("Open").stop(true).show().slideUp(IsIE()?0:400);toggler.children(".ToggleArrow").removeClass("Open");pageNavTray.trigger("trayclose")}else{var isInitClick=false;if(typeof defaultReportTrayView=="undefined"){isInitClick=true;reportGroups=new QB.Nav.PageBar.TrayGroups(trayJSON,{});defaultReportTrayView=new QB.Nav.PageBarTrayMain({el:"#pageNavBarTray",collection:reportGroups,persistenceKey:persistenceKey});if(!trayJSON){defaultReportTrayView.$el.empty();defaultReportTrayView.lazyLoadTrayContents(persistenceKey,JBIurl)}}if(calloutArrow.length>0){var togglerLeft=toggler.offset().left;var togglerWidth=toggler.width();var left=togglerLeft+(togglerWidth/2)-(11/2);left=Math.round(left);calloutArrow.css("left",left+"px")}var afterOpen=function(){if(isInitClick){$("#pageNavBar .PageBarItemListTray").qbPersistentUserPrefs({persistKey:persistenceKey+gReqDBID,isSessionOnly:false,animate:false})}pageNavTray.trigger("trayopen")};pageNavTray.addClass("Open").stop(true).hide();if(IsIE()){pageNavTray.show();afterOpen()}else{pageNavTray.slideDown(400,afterOpen)}toggler.children(".ToggleArrow").addClass("Open");QBTrackPageView("/Prod/ReportTray/Open",true)}return false});$("#pageNavBarTray").data("traytogglerinitialized",true);$("#pageNavBarTray").trigger("traytogglerinitialized")}function InitializeRightSideMenus(){if($("#customBrandBarMenus").length>0){if($("#navRightMenus").children().length==0){$("#customBrandBarMenus").hide()}}$("#navRightMenus").qbMenuBar({menuOptions:{maxHeight:"auto",trigger:{position:{my:"right top",at:"right bottom",collision:"fit"},showOnHoverFromOpenSibling:false}}});QB.Nav.Favs.initHandlers("#favoritesMenu");$("#signedInAsMenu").qbMenu({maxHeight:"auto",triggers:[{selector:"#signedInAsButton",position:{my:"right top",at:"right bottom",collision:"fit"},showOnHoverFromOpenSibling:false}]});$("#createTableMenu").qbMenu({maxHeight:"auto",triggers:[{selector:"#createTableMenuBtn_tabMenu,#createTableMenuBtn_tabMenuLite",position:{my:"left top",at:"left bottom",collision:"fit"},showOnHoverFromOpenSibling:false}]});$("#findButton").one("click",function(){$("#searchPanelTabs").tabs({selected:1})});function setupClearable(input,icon){input.keyup(function(evt){var text=input.val()||"";input.toggleClass("Empty",text.length==0);icon.css("display",text.length==0?"none":"inline-block")});icon.click(function(){input.val("").addClass("Empty");icon.css("display","none")})}setupClearable($("#srchtxt"),$("#searchMenuAppClear"));setupClearable($("#srchtable"),$("#searchMenuTableClear"));$("#quickSearchForm").submit(function(){if($("#searchPanelTabs").length>0&&$("#searchPanelTabs").tabs("option","selected")===1){var text=$("#srchtable").val();window.location="/db/"+gReqDBID+"?a=QuickSearch2&srchtxt="+encodeURIComponent(text)}else{if(gSingleTableDBID){var text=$("#srchtxt").val();window.location="/db/"+gSingleTableDBID+"?a=QuickSearch2&srchtxt="+encodeURIComponent(text)}else{var text=$("#srchtxt").val();window.location="/db/"+gReqAppDBID+"?a=QuickSearch2&srchtxt="+encodeURIComponent(text)}}return false});$("#editProfileLink").click(function(){if(gReqUserDelayVerify){showVerificationRequiredDialog("EditProfile");var menuhider=$("#signedInAsButton").data("ui-qbmenu-hide");if(typeof menuhider=="function"){menuhider.call()}return false}else{return true}});$("#printPageLink").click(function(){ShowPrintFriendly()});$("#debugPageInfoLink").click(function(){ShowDebugInfo()});$("#togglePerfMonitorLink").click(function(evt){TogglePerfMonitor();$($(this).parent("li")[0]).toggleClass("Check");evt.preventDefault()});$("#testAsRoleShowRoles").click(function(){var toggler=$(this);if(toggler.hasClass("Open")){$("#testAsRoleChoices").hide();toggler.addClass("Closed").removeClass("Open")}else{$("#testAsRoleChoices").show();toggler.addClass("Open").removeClass("Closed")}return false});$("#testAsRoleShowRoles").bind("keydown",function(event){if(event){if(event.which==13){$("#testAsRoleShowRoles").click();return false}}});$("#testAsRoleChoices .testAsRoleLink").click(function(){BN_DoChangeRole($(this).attr("roleId"))});$("#signOutButton").button();function ToggleProfilerLinks(){if(QB.Nav.IsCurrentlyProfiling){$("#startProfilingLink a").text("Stop analyzing performance")}else{$("#startProfilingLink a").text("Analyze performance")}if(typeof gQBProfiler!="undefined"){$("#showProfilerLink").removeClass("DisabledLink").addClass("StyleAsLink")}else{if(QB.Nav.IsCurrentlyProfiling){$("#showProfilerLink").addClass("DisabledLink").removeClass("StyleAsLink");$("#showProfilerLink a").text("Get performance details (no details for the current page)");$("#showProfilerLink").show()}else{$("#showProfilerLink").hide()}}}if($("#startProfilingLink").length>0){requirejs(["mobile/qb.utils"],function(){var profileCookie=qb.utils.cookie("doProfile");QB.Nav.IsCurrentlyProfiling=(profileCookie!=null);ToggleProfilerLinks();$("#startProfilingLink").click(function(){var kProfilerMins=10;if(QB.Nav.IsCurrentlyProfiling){qb.utils.cookie("doProfile",null);QB.Nav.IsCurrentlyProfiling=false;ToggleProfilerLinks()}else{var date=new Date();date.setTime(date.getTime()+(kProfilerMins*60000));document.cookie="doProfile=1; expires= "+date.toUTCString();QB.Nav.IsCurrentlyProfiling=true;ToggleProfilerLinks();$.jGrowl("Performance will be measured for the next "+kProfilerMins+" minutes or until you stop it",{theme:"jGrowl-green"})}})});if(typeof gQBProfiler!="undefined"){$("#showProfilerLink").click(function(){if(typeof gQBProfiler!="undefined"){gQBProfiler.openProfileWindow()}else{alert("You haven't performed any actions that can be measured.  There's nothing to show.")}})}}$(document.body).on("click",".ShowCreateReport",function(){createNewReport()});ForminMenuSetup($("#quickSearchForm"));if($("#helpMenu").length){var helpSearchPanel=new QB.Nav.HelpSearchPanel()}}function createNewReport(dbid){if(!dbid){dbid=window.gReqDBID}QB.Dialog.dialog({title:"New report or chart",contents:$("#dialogAddNewReportContents"),contentType:"selector",id:"dialogAddNewReport",size:560,confirm:{text:"Create",type:"Success",click:function(){$("#dialogCustomizeCreateAskTable").hide();$(this).dialog("close");window.location="/db/"+dbid+"?a=ViewBuild&uid="+gReqUID+"&newReportType="+$("input[name=reportType]:checked").val()}}})}function ForminMenuSetup(form){form.setupClearables();form.find("button").button();form.bind("keydown keyup keypress",function(evt){if(evt.keyCode!=$.ui.keyCode.ESCAPE&&evt.keyCode!=$.ui.keyCode.TAB){evt.stopPropagation()}});form.bind("click",function(evt){evt.stopPropagation()});var Menu=form.parents(".Menu");if(Menu){Menu.bind("qbmenuopen",function(){Menu.find(".firstfocus").focus()})}form.bind("keydown",function(event){if(event){if(event.which==13){form.submit();return false}}})}ClearLastRealmCookie=function(){var date=new Date(2000,1,1);var domain=document.domain.substring(document.domain.indexOf("."));var cookie="lrealm=expired; expires="+date.toUTCString()+"; path=/; domain="+domain;document.cookie=cookie};QB.Nav.HelpSearchPanel=Backbone.View.extend({initialize:function(){var self=this;this.form$=$("#helpSearchForm");this.modelSetup();this.categoryMapSetup();this.searchBarSetup();this.searchResultsSetup();this.askTheExpertSetup();this.paginationSetup();this.menuSetup();this.searchableSetup();$("#helpOutputSection").hide();$("#helpAskAnExpertTopBar").hide()},modelSetup:function(){this.model={searchTerm:"",category:"",requestCount:0,total:0,page:1,status_code:200,posts:[]}},menuSetup:function(){var self=this;$("#helpMenu").bind("click",function(){self.showLastQueryAndResult()});var helpMenu=$(".HelpMenu");helpMenu.delegate(".PlainAnchor","click",function(){if(!$(this).hasClass("NoClose")){$(".HelpMenu").qbMenu("hide")}if(!$(this).hasClass("SameWindow")){window.open($(this).data("href"))}else{window.location=$(this).data("href")}return false});var appGuide=$("#HelpAppGuideMenu");appGuide.qbMenu({trigger:{selector:"#HelpAppGuideMenuLink",position:{my:"right top",at:"right bottom",collision:"fit"}},open:function(evt){appGuide.css("z-index",parseInt(helpMenu.css("z-index"))+1);$(".HelpSubMenuCloseHandlers").children().bind("click",closeSubMenu)},close:function(evt){$(".HelpSubMenuCloseHandlers").children().unbind("click",closeSubMenu)}});var closeSubMenu=function(evt){if(!$(evt.target).hasClass("SubMenuTrigger")){$(".HelpSubMenu").qbMenu("hide")}};$("#helpMySupportCasesLink").bind("click",function(event){event.stopPropagation();$(".HelpMenu").qbMenu("hide");window.open("/qb/support/ListCases")})},searchableSetup:function(){var self=this;this.form$.find(".searchableInput").wrap('<span class="searchableWrapper"></span>').after('<a href="#" class="Clear Icon"></a>');var wrapper=this.form$.find(".searchableWrapper"),input=wrapper.find(".searchableInput"),icon=wrapper.find(".Icon");var updateClearButton=(function(){var x=input[0];var hide=(x.value==""||x.value==input.attr("placeholder"));icon.toggle(!hide)});icon.click(function(){input.val("");updateClearButton(input[0]);input.focus();input.trigger("cleared")});input.bind("propertychange keyup input paste",function(x){setTimeout(function(){updateClearButton(input[0])},10)});updateClearButton();this.form$.bind("searchBegin",function(){icon.removeClass("Clear").addClass("Searching")});this.form$.bind("searchEnd",function(){icon.removeClass("Searching").addClass("Clear")})},categoryMapSetup:function(){var self=this;self.categoryModel={"quickbase online help":{displayTitle:"Online Help",hasBody:true,icon:"OnlineHelp",displayOrder:1},"quickbase knowledge base":{displayTitle:"Knowledge Base",hasBody:true,icon:"KnowledgeBase",displayOrder:2},"live community":{displayTitle:"Community",hasBody:true,icon:"QuickBaseCommunity",displayOrder:3},"quickbase videos":{displayTitle:"Videos",hasBody:true,icon:"Videos",displayOrder:4},"quickbase webinars":{displayTitle:"Webinars",hasBody:true,icon:"Webinars",displayOrder:5},"quickbase news":{displayTitle:"QuickBase News",hasBody:true,icon:"QuickBaseNews",displayOrder:6},"quickbase api guide":{displayTitle:"API Guide",hasBody:true,icon:"APIGuide",displayOrder:7},"quickbase formula functions":{displayTitle:"Formula Functions",hasBody:true,icon:"FormulaFunctions",displayOrder:8}};self.categoryModel.size=8;self.categoryModel.get=function(category){return self.categoryModel[$.trim(category.toLowerCase())]}},searchBarSetup:function(){var self=this;var form$=$("#helpSearchForm");ForminMenuSetup(form$);form$.bind("submit",function(){var searchTerm=$("#helpSearchtxt").val();if(self.setSearchTerm(searchTerm)){self.search()}return false});form$.delegate(".searchableInput","cleared",function(){self.busy(false);self.model.requestCount++;self.setSearchTerm("");$("#helpOutputSection").hide();$("#helpAskAnExpertTopBar").hide();$("#helpAskAnExpertSection").hide();$("#askAnExpertToggleLink").find(".ToggleSectionIcon").removeClass("SectionExpandedIcon");QB.Storage.User.set("helpLastQuery",null,false)})},searchResultsSetup:function(){var self=this;$("#helpSearchFilters").delegate("a","click",function(){var this$=$(this);self.filterBy(this$.data("filter"))});if(window.gReqAppDBID){$(".helpAppGuideLink").bind("click",function(){var link=$(this).data("href");OpenAppGuide(link)})}},paginationSetup:function(){var self=this;$("#helpSearchResultsSection").bind("scroll",function(event){var div=this;if(self.scrollTimeout){clearTimeout(self.scrollTimeout)}self.scrollTimeout=setTimeout(function(){self.scrollTimeout=null;var totalHeight=div.scrollHeight;var height=$(div).outerHeight();var top=div.scrollTop;var bottom=height+top;if(totalHeight-bottom<200){self.paginate()}},100)})},askTheExpertSetup:function(){var self=this;$("#helpAskAnExpertSection").hide();var asktheExpertIcon=$("#askAnExpertToggleLink").find(".ToggleSectionIcon");$("#askAnExpertToggleLink").bind("click",function(){$("#helpAskAnExpertSection").slideToggle("fast");asktheExpertIcon.toggleClass("SectionExpandedIcon");return false});asktheExpertIcon.removeClass("SectionExpandedIcon");$("#helpemailOwner").bind("click",function(){var searchTerm=$("#helpSearchtxt").val();var dialogContent='<table id="emailActionForm" cellspacing="4" cellpadding="0" style="margin:0px"><tr><td class="mhn"><span class="inviteSubjectLabel">Subject:&nbsp;<span></td><td style="width: 100%"><input type="text" id="emailSubject" name="subject" style="width: 100%" value="'+searchTerm+'"></input></td></tr><tr><td class="mhn"><span class="inviteMsgLabel">Message:&nbsp;</span></td><td style="width: 100%"><textarea rows="5" style="width: 100%" id="emailMessage" name="message"></textarea></td></tr></table>';$(".HelpMenu").qbMenu("hide");QB.Dialog.confirm({title:"Send Email",contents:dialogContent,contentType:"html",size:"medium",id:"dialogEmailAppOwner",confirm:{text:"Send",click:function(){var subject=$("#dialogEmailAppOwner #emailSubject").val();var message=$("#dialogEmailAppOwner #emailMessage").val();var pageToken=$("#helpSearchForm").data("page-token");if(pageToken==""){$.jGrowl("Email not sent.",{theme:"jGrowl-error"})}else{var data={contentType:"application/json; charset=utf-8",subject:subject,message:message,pagetoken:pageToken};self.emailOwner(data)}$(this).dialog("close");self.log("EmailOwner")}}});return false});$("#helpContactSupport").bind("click",function(){var searchTerm=$("#helpSearchtxt").val();openSupportURL("action=submitcase&casesubj="+encodeURIComponent(searchTerm));self.log("ContactSupport");$(".HelpMenu").qbMenu("hide");return false});$("#helpOpenNewSupportCase").bind("click",function(){var searchTerm=$("#helpSearchtxt").val();window.open("/qb/support/NewCase?subject="+encodeURIComponent(searchTerm));self.log("ContactSupport");$(".HelpMenu").qbMenu("hide");return false});$("#helpCommunityLink").bind("click",function(){var communityHost=$("#HelpLiveCommunityHost");if(!communityHost){return}var searchTerm=$("#helpSearchtxt").val();var returnpath=encodeURIComponent(communityHost.val()+"/questions/new?question[subject]="+searchTerm);var url=($("#HelpSignInState").val()=="1")?"/db/main?a=lc&returnpath="+returnpath:communityHost.val();self.log("CommunitySupport");window.open(url);$(".HelpMenu").qbMenu("hide");return false})},emailOwner:function(data){if(window.gReqAppDBID){var url="/db/"+window.gReqAppDBID+"?a=JBI_EmailOwner";$.post(url,data,function(resp){if(resp.errorcode==0||$(resp).find("errorcode").text()=="0"){$.jGrowl("Email sent.",{theme:"jGrowl-green",pool:1,life:1000})}else{$.jGrowl("Email not sent.",{theme:"jGrowl-error"})}})}},showLastQueryAndResult:function(){var localSaved$=QB.Storage.User.get("helpLastQuery","",false);if(localSaved$&&localSaved$!=null){$("#helpSearchtxt").val(localSaved$.searchTerm).trigger("propertychange");$.extend(this.model,localSaved$);this.refresh()}},busy:function(state){this.isBusy=state;if(this.isBusy&&this.model.page==1){$("#helpSearchResultsSection").find(".Results").empty()}$("#helpSearchResultsSection").find(".Spinner").toggle(state);this.form$.trigger(state?"searchBegin":"searchEnd")},setCategory:function(category){if(category==this.model.category){return false}this.model.category=category?category:"";this.model.page=1;return true},setSearchTerm:function(searchTerm){if(searchTerm==this.model.searchTerm){return false}this.model.searchTerm=searchTerm;this.setCategory();this.model.page=1;return true},search:function(){var self=this;if(!this.model.searchTerm){return}var communityHost=$("#HelpLiveCommunityHost");if(!communityHost){return}var url=communityHost.val()+"/api/v1/search/posts?q="+encodeURIComponent(this.model.searchTerm);if(this.model.category){url+="&f_ds="+this.model.category}if(this.model.page){url+="&page="+this.model.page}url+="&pagesize=25&status_in_response=true&sanitize=true&boost=published_at&callback=?";this.busy(true);var reqID=++this.model.requestCount;$.getJSON(url,function(response){if(reqID==self.model.requestCount){self.buildModel(response);self.refresh();self.busy(false)}}).error(function(){var internalError={status:{status_code:-1}};self.buildModel(internalError);self.refresh();self.busy(false)});if(!this.model.page||this.model.page==1){this.log("Search '"+this.model.searchTerm+"' in "+this.model.category)}},paginate:function(){if(this.isBusy){return}var total=0;if(this.model.category){total=this.model.facet_fields.data_source_name[this.model.category]}else{total=this.model.total}if(this.model.posts.length<total){this.model.page+=1;this.search()}},buildModel:function(result){this.model.status_code=result.status.status_code;this.model.facet_fields=result.facet_fields;this.model.total=result.total;if(this.model.page<=1){this.model.posts=[]}$.merge(this.model.posts,(result.posts||[]))},getIndividualPostDisplay:function(aPost){if(!aPost){return""}var category=this.categoryModel.get(aPost.data_source_name),icon=category&&this.model.category==""?"<span class='HelpCategoryIcon "+category.icon+"'></span>":"",title=$.trim(aPost.title),body=$.trim(aPost.snippet),body=(!title||!body||body.substring(0,title.length)!==title)?body:body.substring(title.length,body.length),cleanTitle=this.cleanText(title),cleanBody=this.cleanText(body),truncatedBody=cleanBody.length>85?cleanBody.substring(0,85).split(" ").slice(0,-1).join(" ")+" ...":cleanBody;if(category.displayTitle=="Online Help"){aPost.url=this.rewireHelptopics(aPost.url)}var postDisplay="<div class='Result'>"+icon+"<a class='PlainAnchor' data-href='"+aPost.url+"' onclick='return false;' target='_blank' class='Result' data-source='"+aPost.data_source_name+"'>";postDisplay+="<p class='header LinkText'>"+cleanTitle+"</p>";if(category&&category.hasBody){postDisplay+="<p data-original-title='"+cleanBody+"' class='Tipsy body'>"+truncatedBody+"</p>"}postDisplay+="</a></div>";return postDisplay},rewireHelptopics:function(aLink){var pattern=/(.*)(\/user-assistance\/)([^& | ^# | ^\/]*)$/i;var file=pattern.exec(aLink);if(file!=null&&file.length==4&&file[2]=="/user-assistance/"){aLink=file[1]+file[2]+"Default.html#"+file[3]}return aLink},cleanText:function(htmlText){return HTMLEncode($.trim(htmlText))},refresh:function(){this.refreshAskTheExpert();this.refreshSearchResults();this.refreshSearchSideBar();this.refreshLocalStorage();$("#helpOutputSection").slideDown("slow");$("#helpAskAnExpertTopBar").show()},refreshSearchResults:function(){var searchResultSection=$("#helpSearchResultsSection").find(".Results");var content;if(!this.model||this.model.status_code!=200){content="<div class='Result Error'>Help Search encountered a problem. Check back later, or try your search in the <a class= 'PlainAnchor' style='padding: 0;margin: 0;margin-left: 0px;display:inline' data-href='/user-assistance/'>online help</a> instead.</div>"}else{if(this.model.total==0||this.model.posts.length==0){content="<div class='Result'><b>No Results Found</b><br />We're very sorry, we did not find any results for your query.</div>"}else{content="";for(i=0;i<this.model.posts.length;++i){content+=this.getIndividualPostDisplay(this.model.posts[i])}}}searchResultSection.html(content);if(!this.model||!this.model.page||this.model.page==1){searchResultSection.scrollTop(0)}},refreshSearchSideBar:function(){var filterContent="";var total=0;if(!this.model||this.model.status_code!=200){filterContent=""}else{if(this.model.facet_fields&&this.model.facet_fields.data_source_name){var faceted_fields=this.model.facet_fields.data_source_name;var sorted_category=new Array(this.categoryModel.size);for(var key in faceted_fields){var qbCategory=this.categoryModel.get(key);if(qbCategory&&faceted_fields.hasOwnProperty(key)){sorted_category[qbCategory.displayOrder]=key}}for(var i=0;i<sorted_category.length;++i){lcCategory=sorted_category[i];if(lcCategory&&faceted_fields[lcCategory]>0){qbCategory=this.categoryModel.get(lcCategory);title=qbCategory?qbCategory.displayTitle:lcCategory;var icon=qbCategory?"<span class='HelpCategoryIcon "+qbCategory.icon+" WithText'></span>":"";filterContent+='<li><a class="HelpSearchFilter" href="#" data-categoryName="'+lcCategory+'" data-filter="'+lcCategory+'">'+icon+"<span>"+title+'</span><span class="Small"> ('+faceted_fields[lcCategory]+")</span></a></li>";total+=faceted_fields[lcCategory]}}}everythingFilter='<li><a class="HelpSearchFilter FS-H2 selected" href="#" data-categoryName="Everything" data-filter=""><span>Everything</span><span class="Small"> ('+total+")</span></a></li>";filterContent=everythingFilter+filterContent}if(total==0){filterContent=""}$("#helpSearchFilters").html(filterContent);this.toggleFilterDisplay(this.model.category)},refreshAskTheExpert:function(){var showAskExpert=(!this.model||this.model.total==0||this.model.status_code!=200);var isShowingAskExpert=$("#helpAskAnExpertSection").is(":visible");if(isShowingAskExpert!=showAskExpert){$("#askAnExpertToggleLink").click()}},refreshLocalStorage:function(){if(!this.model){return}QB.Storage.User.set("helpLastQuery",this.model,false)},log:function(action){QBTrackEvent("HelpSearchPanel",action)},filterBy:function(category){if(!this.model){return}if(this.setCategory(category)){this.search()}},toggleFilterDisplay:function(category){if(!category||category==""){category="Everything"}$("#helpSearchFilters a").removeClass("selected");var selectedLink=$("#helpSearchFilters").find("[data-categoryName='"+category+"']");if(selectedLink){selectedLink.addClass("selected")}}});function ShowPrintFriendly(){if(typeof BeforeShowPrintFriendlyHook=="function"){BeforeShowPrintFriendlyHook()}var url=location.href;url=RemoveURLparam(url,"origIID");url=AddReplaceURLparam(url,"prfry","1");window.open(url)}function ShareWithNewUser(){if(typeof gDialogShareWithNewUser=="undefined"){initAddUserDialog()}openAddUserAutocomplete();QBTrackPageView("AppMenus/Users/ShareWithANewUser");return false}function OpenUserManagementPage(){if(gReqUserDelayVerify){showVerificationRequiredDialog("UserManagement");var menuhider=$("#usersMenu").data("ui-qbmenu-hide");if(typeof menuhider=="function"){menuhider.call()}return false}else{return true}}function OpenAppGuide(link){var pageID=StringGetSuffix(link,"Page:");if(pageID==""){if(!StringStartsWith(link,"http")){link="http://"+link}}else{link="/db/"+gReqAppDBID+"?a=dbpage&isguide=1&pageid="+pageID}window.open(link,"AppGuide","width=700,height=800,resizable,scrollbars")}function ClearFlags(dialogElem){var doApp=dialogElem.find(":checked").val()=="all";var dbid=(doApp?gReqAppDBID:dialogElem.find("select").val());dialogElem.dialog("close");$.get("/db/"+dbid+"?a=QBI_ClearFlags&withConf=1",function(){window.location.reload()})}function OpenTableSelector(action,title,onclick){title=title||"Select a Table";if(gSingleTableDBID!=""){window.location="/db/"+gSingleTableDBID+"?a="+action}else{var selector=$("#createNewTableSelector");var links=$("a",selector);for(var i=0;i<links.length;++i){var a=links.eq(i);var dbid=a.attr("dbid");if(onclick){a.attr("href","#");a.attr("onclick",onclick+"('"+dbid+"')")}else{a.attr("href","/db/"+dbid+"?a="+action)}a.attr("href","/db/"+dbid+"?a="+action)}QB.Dialog.dialog({id:"dialogCustomizeCreateAskTable",contents:selector,contentType:"selector",title:title,size:"small",confirm:null,focusedButton:null});if(selector.height()>500){selector.dialog("option","height",500).dialog("close").dialog("open")}}}function OpenTableSelectorHelper(action,title,onclick){var self=this;return(function(){self.OpenTableSelector(action,title,onclick)})}function OpenTableSelectorHelperForEmail(action,title,trackingString){if(gReqUserDelayVerify){return(function(){showVerificationRequiredDialog(trackingString)})}else{return OpenTableSelectorHelper(action,title)}}function GetNewTableName(){var highestNum=0;for(var dbid in gTableInfo){var tinfo=gTableInfo[dbid];if(!tinfo.extApp){if(StringStartsWith(tinfo.name,"Table #")){var testNum=Number(tinfo.name.substr(7));if(!isNaN(testNum)){highestNum=testNum}}}}highestNum=Math.max(highestNum+1,NumAppTables()+1);return"Table #"+highestNum}function AskNewRole(validator){var newRoleDialogOpts={id:"dialogCustomizeCreateNewRole",title:"Create a New Role",contents:"#new-role-dialog",contentType:"selector",jqDialogOptions:{open:function(){$(this).find("input[type='text']").focus()},close:function(){if(!_.isUndefined(validator)){validator.resetForm()}}},focusedButton:null,confirm:{click:function(){if($("#roleAddForm",this).valid()){var pageTokenElem=$($("[name=PageToken]")[0]);var pageToken=pageTokenElem.val();if(pageToken==""){$.ajax({url:"/db/"+gReqAppDBID+"?a=QBI_GetPageToken",success:function(result){if($(result).find("errcode").text()=="0"){pageToken=$(result).find("pageToken").text();pageTokenElem.val(pageToken);$("#roleAddForm")[0].submit()}}})}else{$("#roleAddForm")[0].submit()}}}}};QB.Dialog.dialog(newRoleDialogOpts)}$(function(){QB.Nav.setAppTabRedirect();$("#navTopAppBar").delegate(".CloseTab","click",function(evt){var tab=$(this).closest("li");var closeDBID=tab.attr("data-dbid");if(!closeDBID){return false}$("body > .tooltip").hide();var jaxData={dbid:closeDBID};$.post("/db/main?a=QBI_RemoveAppFromNavBar",jaxData,function(returndata,textStatus,resp){tab.fadeOut(200,function(){tab.remove();$("body > .tooltip").hide();if(closeDBID==gReqAppDBID){document.location="/db/main?a=myqb"}else{var menuItems=$("#navTopAppBar .ui-tabs-nav > li");var numMenuItemWidth=100/menuItems.size();menuItems.css("width",numMenuItemWidth.toString()+"%")}})});return false})});QB.Nav.setAppTabRedirect=function(home){if(GetURLParameterValue(document.location,"ifv")||window!=window.top){return}if(home==true){QB.Storage.User.remove("lastVisited"+window.gReqAppDBID)}else{var relativeURL=(document.location.pathname||"")+(document.location.search||"");if(relativeURL!=""){var storageString="{\x22url\x22:\x22"+relativeURL+"\x22, \x22timestamp\x22:"+new Date().getTime().toString()+"}";QB.Storage.User.set("lastVisited"+window.gReqAppDBID,storageString)}}};$(function(){var appTabs=$("#navTopAppBar li").each(function(){var dbid=$(this).data("dbid");if(dbid){var urlString=QB.Storage.User.get("lastVisited"+dbid,"");if(urlString==""||window.gReqAppDBID==dbid){return true}var urlJSON;try{urlJSON=$.parseJSON(urlString)}catch(e){return true}var currTimeStamp=new Date().getTime();if(!urlJSON.timestamp||urlJSON.timestamp<currTimeStamp-1000*60*60*8){return true}$(this).find("a").attr("href",urlJSON.url)}})});$(function(){if(Modernizr.touch){return}$.fn.tooltip.defaults.placement="bottom";$.fn.tooltip.defaults.delay={show:500,hide:50};$.fn.tooltip.defaults.html=true;$(document.body).delegate(".Tipsy","mouseover",function(evt){var elt=$(this).closest(".Tipsy");elt.removeClass("Tipsy").addClass("Tipsified");elt.tooltip();elt.tooltip("fixTitle");var timeout=setTimeout(function(){elt.off("mouseleave.autotipify");if(elt.closest(document.body).length==0){elt.tooltip("disable").tooltip("hide").off()}else{elt.tooltip("show")}},500);$(this).on("mouseleave.autotipify click.autotipify",function(evt2){clearTimeout(timeout)})});$(document.body).delegate(".Tipsified","click",function(evt){$(this).tooltip("hide")})});function getBackgroundLuma(elt){var rex=/rgb\((\d+), ?(\d+), ?(\d+)\)/i;var bgc=$(elt).css("backgroundColor");if(!bgc){return}bgc=NormalizeColor(bgc);var r=parseInt(bgc.substring(0,2),16);var g=parseInt(bgc.substring(2,4),16);var b=parseInt(bgc.substring(4,6),16);var y=0.299*r+0.587*g+0.114*b;return y}function getUseWhiteBackToTopArrow(elt){var luma=getBackgroundLuma(elt);if(luma==null){return false}return luma<=186}var gPageBarTopBorderWhenFrozen=6;$(function(){if(!QB.Nav.options.fixNavBars){return}var brandBar=$("#brandBarHeader");var brandBarSpacer=$("#brandBarSpacer").show();var brandSpacerHeight=brandBarSpacer.height();var backToTop=$("#backToTop");var useWhite=getUseWhiteBackToTopArrow(backToTop);backToTop.children(".Icon").toggleClass("WhiteArrow",useWhite).toggleClass("BlackArrow",!useWhite);brandBarSpacer.hide();var pageNavBar=$("#pageNavBar");var hasPageNavBar=(pageNavBar.length>0);var pageNavSpacer=$('<div class="Hidden"></div>');if(hasPageNavBar){pageNavSpacer.hide();pageNavSpacer.insertAfter(pageNavBar)}var brandHeight=brandBar.height();var autosize=function(){brandHeight=brandBar.height();if(hasPageNavBar){var pageNavHeight=pageNavBar.outerHeight();pageNavSpacer.height(pageNavHeight)}};var currentZoomLevel=1;if(hasPageNavBar){if(Modernizr.touch){var updateZoomLevel=function(){var cliW=document.documentElement.clientWidth||0;var winW=window.innerWidth||0;if(cliW&&winW){var ratio=cliW/winW;currentZoomLevel=Math.round(100*ratio)/100}};$(window).on("resize scroll",updateZoomLevel);updateZoomLevel()}var wasPageNavFixed=null;var checkPinPageNavBar=function(){var barTop=0;if(pageNavBar.hasClass("Fixed")){barTop=pageNavSpacer.offset().top}else{barTop=pageNavBar.offset().top}var scrollTop=$(window).scrollTop();var brandSpaceTop=brandHeight-brandSpacerHeight;var isBrandFixed=(scrollTop>=brandSpaceTop);brandBarSpacer.toggle(isBrandFixed).toggleClass("Fixed",isBrandFixed);var top=barTop-scrollTop-brandSpacerHeight-gPageBarTopBorderWhenFrozen;if(!QB.Nav.options.fixNavBars){top=1}var isPageNavFixed=(top<=0);if(currentZoomLevel!=1){isPageNavFixed=false}pageNavBar.toggleClass("Fixed",isPageNavFixed);var backToTop=$("#backToTop");if(isPageNavFixed&&(!wasPageNavFixed||wasPageNavFixed===null)){$(backToTop).stop(true,true).slideDown("fast")}else{if(!isPageNavFixed&&(wasPageNavFixed||wasPageNavFixed===null)){$(backToTop).stop(true,true).slideUp("fast")}}pageNavSpacer.toggle(isPageNavFixed);if(isPageNavFixed){pageNavBar.css({top:brandSpacerHeight+"px",paddingTop:gPageBarTopBorderWhenFrozen+"px"});pageNavBar.data("bottom",brandSpacerHeight+pageNavSpacer.height())}else{pageNavBar.css({top:"",paddingTop:""});pageNavBar.data("bottom",null)}wasPageNavFixed=isPageNavFixed};$(window).on("scroll",checkPinPageNavBar);if(Modernizr.touch){setTimeout(checkPinPageNavBar,250)}}if(QB.Nav.options.fixNavBars){var lastScrollLeft=-1;var pageNavBars=$("#navBars");var adjustHorizScroll=function(){var left=$(window).scrollLeft();if(left<0){left=0}if(left!=0){var ww=$("#bodyTable").outerWidth()-$(window).width();if(left>ww){left=ww}if(left<0){left=0}}if(currentZoomLevel!=1){left=0}if(left!=lastScrollLeft){lastScrollLeft=left;pageNavBars.css("left",left+"px")}};$(window).on("scroll",adjustHorizScroll)}$("#backToTop").click(function(evt){if(hasPageNavBar){checkPinPageNavBar()}$("html, body").animate({scrollTop:0},"fast")});$(window).bind("resizeidle.qb",autosize);$("#customBrandBar img").bind("load",autosize);autosize();window.lastFixedNavBarState=false;QB.Nav.toggleFixedNavBars=function(fixNavBars){if(currentZoomLevel!=1){fixNavBars=false}window.lastFixedNavBarState=!!fixNavBars;QB.Nav.options.fixNavBars=fixNavBars;brandBar.toggleClass("Fixed",fixNavBars);brandBarSpacer.toggle(fixNavBars);$(window).scroll()}});var gMinItemsForLiveFilter=10;var gMaxCharsTableMenu=30;var gTablesJSON=[];function setupTriggeredListMenu(opts){var navinst=QB.Nav.Instance;navinst.tableMenuView=navinst.tableMenuView||[];navinst.tableMenuCollection=navinst.tableMenuCollection||[];navinst.tableMenuView[opts.viewName]={};function buildViewAndCollection(){var coll=navinst.tableMenuCollection[opts.viewName]=new QB.Nav.Models.TablesCollection(opts.itemList);navinst.tableMenuView[opts.viewName]=new QB.Nav.Views.TableList(_.extend({el:opts.menuElement,collection:coll,minItemsforFilter:gMinItemsForLiveFilter},opts));opts.menuElement.find("input, textarea").placeholder();opts.triggerElement.click();_.defer(function(){var minw=$(opts.menuElement).width();$(opts.menuElement).css("width",minw)})}opts.triggerElement.one("click.initView nearTrigger.initView",buildViewAndCollection);return navinst.tableMenuView[opts.viewName]}function manualTipsify(el,title){$(el).find(".Tipsy").addClass("Tipsified").tooltip({html:false,title:title});$(el).find(".Tipsy").removeClass(".Tipsy")}QB.Nav.Models.Table=Backbone.Model.extend({idAttribute:"dbid",testString:function(text,terms){if(_.isUndefined(text)){return false}text=text.toLowerCase();var match=true;_.each(terms,function(term){if(text.indexOf(term)<0){match=false}return false});return match},matches:function(terms){return this.testString(this.get("displayName"),terms)||this.testString(this.get("name"),terms)||this.testString(this.get("secondaryName"),terms)}});QB.Nav.Models.TablesCollection=Backbone.Collection.extend({model:QB.Nav.Models.Table});QB.Nav.Views.Table=Backbone.View.extend({events:{},initialize:function(){_.bindAll(this,"render","unrender","remove");if(_.isUndefined(this.model.get("displayName"))){this.model.set("displayName",$.trim(this.model.get("name")))}var displayName=$.trim(this.model.get("displayName"));this.model.set("shortenedName",Ellipsize(displayName,gMaxCharsTableMenu));var titleName=this.model.get("titleName");if(_.isUndefined(titleName)){titleName=$.trim(this.model.get("heading"))}if(this.model.get("shortenedName")==titleName){titleName=""}this.model.set("titleName",$.trim(titleName))},render:function(){this.$el=ich.tableListDropdownItem(this.model.toJSON());this.el=this.$el[0];this.$el.attr("id",this.getEltId());var title=this.model.get("titleName");if(!(_.isUndefined(title))){manualTipsify(this.$el,title)}return this},getEltId:function(){return this.options.parentView.getEltId(this.model.id)},unrender:function(){$(this.el).remove()},remove:function(){this.model.destroy()}});QB.Nav.Views.TableList=Backbone.View.extend({events:{},initialize:function(){_.bindAll(this,"render","appendItem","renderFiltered","updateIcons");this.collection.bind("add",this.appendItem);this.render();this.updateIcons();$(this.el).find(".FilterTableListText").bind("keyup cleared",this.updateIcons);$(this.el).find(".FilterTableListText").bind("keyup cleared",_.throttle(this.renderFiltered,200));if(this.options.triggerElement){var pos=this.options.position||{my:"right top",at:"right bottom",collision:"fit"};this.options.qbmenuOptions=this.options.qbmenuOptions||{};var menuMargin=160;$(this.el).detach().appendTo($(document.body)).qbMenu(_.extend({},{trigger:{selector:this.options.triggerElement.selector,position:pos},zindex:1049,maxHeight:"auto"},this.options.qbmenuOptions));$(this.el).setupClearables();if(!Modernizr.touch){$(this.el).on("qbmenuopen",function(){$(this).find(".FocusOnOpen").focus()})}}},appendItem:function(item){var myTableView=new QB.Nav.Views.Table({parentView:this,viewName:this.options.viewName,model:item});var docelt=$("#"+this.getEltId(item.id));var parelt=this.$el.find("#"+this.getEltId(item.id));if(docelt.length==0&&parelt.length==0){var newel=myTableView.render().el;$(this.el).append(newel);$(this.el).trigger("ItemAppended")}else{if(parelt.length){myTableView.el=docelt}else{if(docelt.length){myTableView.el=docelt}}}},getEltId:function(modelid){return this.options.viewName+"_list_"+modelid},render:function(){var self=this;var parent=$(this.el).parent();var viewel=$(this.el).detach();this.collection.each(function(item){self.appendItem(item)},this);parent.append(viewel);var howManyMinFilterItems=this.collection.where({countForMinToFilter:true}).length;if(howManyMinFilterItems>this.options.minItemsforFilter){$(this.el).find(".FilterBoxAfterHere").after(ich.tableListFilter());$(this.el).append(ich.tableBarDropdownNoResults());this.textbox=$(this.el).find(".FilterTableListText");this.menu=$(this.el);this.ifNoResults=$(this.el).find(".AllTablesQuickPickNoResults")}else{if($(this.el).find(".Header").text()==""){$(this.el).find(".Header").removeClass("Header")}else{$(this.el).addClass("NoSearch")}}},renderFiltered:function(){var allTerms={};_.each(this.textbox.val().toLowerCase().split(/ +/),function(term){allTerms[term]=term});var numMatches=0;var self=this;this.collection.each(function(model){var isMatch=model.matches(allTerms);var elem=$("#"+self.getEltId(model.id));$(elem).toggleClass("DisplayNone",!isMatch);if(isMatch){++numMatches}});$(this.ifNoResults).toggle(numMatches==0);$(this.el).trigger("ListFiltered")},updateIcons:function(){var box=$(this.textbox);box.toggleClass("Empty",box.val()=="")}});$(function(){var homeAndUserEl=$("#homeAndUsersBar");var homeAndUsersWidth=$(homeAndUserEl).outerWidth();$("#tablesBar").css("margin-left",homeAndUsersWidth+"px");var tablesMenuBar=$("#tablesBar");var newTableChiclet=$("#createTableChiclet");var newTableMenuChiclet=$("#qbCreateTableMenuList");var leftGroup=$("#tableBarLeftGroup");var scrollLeft=leftGroup.find(".ScrollLeft");var rightGroup=$("#tableBarRightGroup");var scrollRight=rightGroup.find(".ScrollRight");var iconStack=rightGroup.find(".IconStack");rightGroup.show();iconStack.show();scrollRight.show();var iconStackWidth=iconStack.outerWidth(true);var rightGroupWidth=rightGroup.outerWidth(true);rightGroup.hide();var totalWidth=$("#homeAndUsersBar").width();var totalWidthWithoutTable=0;var tables=[];tablesMenuBar.scrollLeft(0).children("li").each(function(){var el=$(this);var width=$(this).outerWidth(true);el.data("width",width);el.data("left",totalWidth);totalWidth+=width;if(el.hasClass("RealTable")){tables.push({dbid:el.attr("data-dbid"),icon:el.attr("data-icon"),name:el.children("a").text(),current:el.hasClass("tableMenuSelected")})}});if(newTableChiclet.length>0){totalWidthWithoutTable=totalWidth-newTableChiclet.outerWidth(true)}else{totalWidthWithoutTable=totalWidth-newTableMenuChiclet.outerWidth(true)}function autosizeTableBar(){var availableWidth=$(window).width();if(totalWidth<=availableWidth){leftGroup.hide();rightGroup.hide();if(newTableChiclet.length>0){newTableChiclet.show()}else{newTableMenuChiclet.show()}tablesMenuBar.css("margin-right","0")}else{if(availableWidth-iconStackWidth>=totalWidthWithoutTable){if(newTableChiclet.length>0){newTableChiclet.hide()}else{newTableMenuChiclet.hide()}scrollLeft.hide();leftGroup.hide();scrollRight.hide();iconStack.show();rightGroup.show();tablesMenuBar.css("margin-right",iconStackWidth+"px")}else{if(newTableChiclet.length>0){newTableChiclet.hide()}else{newTableMenuChiclet.hide()}scrollLeft.show();leftGroup.show();scrollRight.show();iconStack.show();rightGroup.show();tablesMenuBar.css("margin-right",(rightGroupWidth)+"px");scrollRight.toggleClass("Disabled",false);scrollLeft.toggleClass("Disabled",true)}}}$(window).on("resizeidle.qb",autosizeTableBar);autosizeTableBar();var scrollSpeed=1000;function scroll(delta,isAbsolute,skipAnimate){var currentPosition=tablesMenuBar.scrollLeft();var newPosition=0;if(isAbsolute){newPosition=delta}else{delta*=($(window).width()-8-24-24-24-homeAndUsersWidth);delta*=0.7;newPosition=delta+currentPosition}var pos=0;tablesMenuBar.children("li").each(function(){var w=parseInt($(this).data("width"));if(newPosition>=pos&&newPosition<pos+w){if(delta>0){newPosition=pos+w+16}else{if(pos<=0){newPosition=0}else{newPosition=pos+16}}return false}else{pos+=w}});var isAtLeftEnd=false;if(newPosition<=0){isAtLeftEnd=true;newPosition=0}scrollLeft.toggleClass("Disabled",isAtLeftEnd);var isAtRightEnd=false;tablesMenuBar.stop().scrollLeft(newPosition);if(newPosition>tablesMenuBar.scrollLeft()){isAtRightEnd=true}scrollRight.toggleClass("Disabled",isAtRightEnd);if(!skipAnimate){tablesMenuBar.scrollLeft(currentPosition);tablesMenuBar.stop().animate({scrollLeft:newPosition})}}scrollLeft.click(function(){scroll(-1)});scrollRight.click(function(){scroll(+1)});var active=tablesMenuBar.children(".tableMenuSelected").first();var posn=parseInt(active.data("left"))+parseInt(active.data("width"));if(posn>$(window).width()){var desiredCenter=posn-0.5*$(window).width();setTimeout(function(){scroll(desiredCenter,true,true)},10)}QB.Nav.Instance.tables=new QB.Nav.Models.TablesCollection(gTablesJSON);var allowedToAddTo=[];if(gTablesJSON&&$("#globalAddRecordButton").length){var newList=_.filter(gTablesJSON,function(tab){return tab.userCanAdd&&!tab.otherApp});$.extend(true,allowedToAddTo,newList);var dupCountHash={};_.each(allowedToAddTo,function(item){var val=$.trim(item.snoun.toLowerCase());var cur=dupCountHash[val];if(_.isUndefined(cur)){cur={count:0,dbs:[]}}cur.dbs.push(item.dbid);dupCountHash[val]={count:cur.count+1,dbs:cur.dbs}});_.each(allowedToAddTo,function(table){var record=$.trim(table.snoun);var hasDup=dupCountHash[record.toLowerCase()].count>1;table.countForMinToFilter=true;table.act="nwr&AddFromGlobalBar=true";table.titleName="";if(record.length>gMaxCharsTableMenu||hasDup&&table.name.length>gMaxCharsTableMenu){table.titleName=record+(hasDup?" in "+table.name:"")}table.displayName=record;table.overlayIcon="AddIcon";table.secondaryName=hasDup?table.name:""})}if(allowedToAddTo.length&&!_.isUndefined(ich.ListMenu)){var $elt=ich.ListMenu({id:"addRecordMenu",headerText:"New Record"});setupTriggeredListMenu({itemList:allowedToAddTo,viewName:"addRecord",menuElement:$elt,triggerElement:$("#globalAddRecordButton")})}else{$("#globalAddRecordButton").addClass("DisplayNone")}var moreTables=[];if($("#moreTables_list_home").length){moreTables.push({dbid:"home",name:$("#moreTables_list_home").text()})}if($("#moreTables_list_users").length){moreTables.push({dbid:"users",name:$("#moreTables_list_users").text()})}var listedTables=_.filter(gTablesJSON,function(tab){return tab.isListed&&!tab.otherApp});var justTables=[];$.extend(true,justTables,listedTables);_.each(justTables,function(table){table.countForMinToFilter=true;table.act="td";table.displayName=$.trim(table.heading)});moreTables=moreTables.concat(justTables);if(moreTables.length&&$("#allTablesTrigger").length){setupTriggeredListMenu({itemList:moreTables,viewName:"moreTables",menuElement:$("#allTablesMenu"),triggerElement:$("#allTablesTrigger")})}$("input, textarea").placeholder()});var gAccountIdForDBCreation=null;var gAccountList=null;function InitNewAppButton(){var buttons=$("#newAppLightBoxDiv .CreateButton");$("body").on("click",".AddAppButton",function(){var gAddAppDial=$("#newAppLightBox");if(gAddAppDial.is(":data(dialog)")){gAddAppDial.dialog("open");return}gAddAppDial=QB.Dialog.dialog({contents:$("#newAppLightBoxDiv"),contentType:"selector",id:"newAppLightBox",confirm:null,cancel:null,size:800,jqDialogOptions:{height:550,maxHeight:1000},hideTitleBar:"true"});$("#newAppLightBoxDiv .CloseIcon").click(function(){gAddAppDial.dialog("close")}).blur();if(gAccountList===null){$.ajax({url:"main?a=QBI_GetAccountsWithPerms",type:"POST",success:function(result){gAccountList=$(result).find("AccountList").text();gHasCreatePerms=$(result).find("HasCreatePerms").text()=="true";gIsMiniRealm=$(result).find("IsMiniRealm").text()=="true";gThisRealmName=$(result).find("thisRealmName").text();gGlobalRealmHost=$(result).find("globalRealmHost").text();$(".thisRealmHostName").html(gThisRealmName);if(gAccountList!=""){gAccountList=eval(gAccountList);var acctSelectBox=$("#accountSelectBox");var numAccts=gAccountList.length;if(numAccts>1){for(var i=0;i<gAccountList.length;i++){var acctOption=$("<option value="+gAccountList[i].acctId+"></option>").html(gAccountList[i].accountName);if(i==0){acctOption.attr("selected","selected")}acctSelectBox.append(acctOption)}$("#accountPicker").removeClass("DisplayNone");$("#noAccountPicker").hide()}else{if(numAccts==1){gAccountIdForDBCreation=gAccountList[0].acctId}else{gAccountIdForDBCreation=0}}}}})}});buttons.click(function(){if(gAccountIdForDBCreation===null){gAccountIdForDBCreation=$("#accountSelectBox").val()}if(gAccountIdForDBCreation==0){window.location="main?a=createAppNoAccount&noaccount=1";return}else{if(!gHasCreatePerms){$("#newAppLightBoxDiv .CloseIcon").hide();$("#withCreateOptionsContent").animate({left:"-=800"},600);$(".withCreateOptions").hide();$(".noCreatePerms").show();$("#noCreatePermContent").animate({left:"-=800"},600,function(){$("#newAppLightBoxDiv .CloseIcon").show()});$("#newAppLightBoxDiv .DialogFooter .LeftSect").animate({width:"66%"},300);$.ajax({url:"main?a=QBI_CreateAppReqPerm",data:{accountid:gAccountIdForDBCreation},type:"POST"});$("#startTrial").click(function(){window.location="https://"+gGlobalRealmHost+"/db/main?act=trial&ps=CW&prod=cw&op=3&uid="+gReqUID})}else{window.location=$(this).data("href")+"&accountId="+gAccountIdForDBCreation}}})};; 
 
//@ sourceURL=/js/navPageBar.js 
var QB=QB||{};QB.Nav=QB.Nav||{};QB.Nav.PageBar=QB.Nav.PageBar||{};QB.Nav.PageBar.TrayItem=Backbone.Model.extend({defaults:{dbid:gReqDBID,active:false,displayName:""},maxDisplayStrLength:43,initialize:function(){if(this.get("name")){var shortname=this.ellipsizeDisplayName(this.get("name"));this.set("displayName",shortname)}},ellipsizeDisplayName:function(newName){return Ellipsize(newName,this.maxDisplayStrLength)},setNameAndDisplayName:function(newName){if(!newName||newName.length<1){return}this.set("displayName",this.ellipsizeDisplayName(newName));this.set("name",newName)}});QB.Nav.PageBar.TrayItems=Backbone.Collection.extend({model:QB.Nav.PageBar.TrayItem,initialize:function(models,options){}});QB.Nav.PageBar.TrayItemGroup=Backbone.Model.extend({initialize:function(){this.collection=new QB.Nav.PageBar.TrayItems(this.get("reports"),{});this.unset("reports",{silent:true});this.mainView=this.get("mainView")},changeName:function(newName){if(this.get("name")==newName){return true}if(!newName){return false}this.set("name",newName);this._changeNameAJAX(newName);return true},changeReportName:function(qid,newName){var success=false;if(!newName||!qid){return success}if(newName.length==0){return success}var report=this.collection.get(qid);if(!report){return success}if(report.get("name")!=newName){report.setNameAndDisplayName(newName);this._updateReportNameAJAX(qid,newName);success=true}return success},deleteReport:function(reportID){if(!reportID){return}var report=this.collection.get(reportID);if(!report){return}this.collection.remove(report);this._deleteReportAJAX(reportID,true)},_changeNameAJAX:function(newName){var model=this;$.ajax({type:"POST",url:"/db/"+gReqDBID+"?a=QBI_ReportGroup_Rename",data:{id:model.get("id"),name:newName},success:function(data,textStatus,jqXHR){var resp=$(data);var errcode=resp.find("errcode").text();if(errcode!="0"){model.trigger("reinitEditMode");QB.Dialog.error({headline:"Error Updating Category Name",contents:"Error "+errcode+": "+resp.find("errtext").text()});return}},error:function(data,textStatus,jqXHR){QB.Dialog.error({headline:"Could not reach QuickBase",contents:"There was a problem reaching QuickBase.  There may be a problem with your internet connection or a problem with QuickBase.  Try again later."})}})},_updateReportNameAJAX:function(qid,newName){if(!qid||!newName){return}var model=this;if(this.mainView){this.mainView.showSpinner()}$.ajax({type:"POST",data:{report:gReqDBID+"_"+qid,newName:newName},url:"/db/"+gReqDBID+"?a=JBI_RenameReport",dataType:"json",success:function(data,textStatus,jqXHR){if(model.mainView){model.mainView.cancelSpinner()}var resp=$(data);var success=data.updated;if(!success){model.trigger("reinitEditMode");QB.Dialog.error({headline:"Error while renaming report:",contents:"Error: "+resp.find("errorText").text()});return}},error:function(xhr,status,error){if(model.mainView){model.mainView.cancelSpinner()}QB.Dialog.error({headline:"Could not reach QuickBase",contents:"While saving your report name change, there was a problem reaching QuickBase.  There may be a problem with your internet connection or a problem with QuickBase.  Try again later."})}})},_deleteReportAJAX:function(reportID){var model=this;var reportsToDelete=[gReqDBID+"_"+reportID];if(this.mainView){this.mainView.showSpinner()}$.ajax({type:"POST",data:{reports:reportsToDelete.join(",")},url:"/db/"+gReqDBID+"?a=JBI_DeleteReports",dataType:"json",success:function(data,textStatus,jqXHR){if(model.mainView){model.mainView.cancelSpinner()}var resp=$(data);var deleteSuccess=true;_.each(reportsToDelete,function(item){if(resp[0][item]!="deleted"){deleteSuccess=false}});if(!deleteSuccess){model.trigger("reinitEditMode");QB.Dialog.error({headline:"Error while moving category:",contents:"Error "+errcode+": "+resp.find("errtext").text()});return}},error:function(xhr,status,error){if(model.mainView){model.mainView.cancelSpinner()}QB.Dialog.error({headline:"Could not reach QuickBase",contents:"In removing your category, there was a problem reaching QuickBase.  There may be a problem with your internet connection or a problem with QuickBase.  Try again later."})}})}});QB.Nav.PageBar.TrayGroups=Backbone.Collection.extend({model:QB.Nav.PageBar.TrayItemGroup,initialize:function(models,options){var collection=this;this.mainView=options.mainView;_.each(models,function(group){group.mainView=collection.mainView})},isValidGroupName:function(name){if(!name){return false}if(name==""){return false}name=name.toLowerCase();if(name=="common"||name=="recent"||name=="mine"){return false}return true},moveReports:function(reportIDs,targetGroupID,afterID){if(!reportIDs||targetGroupID===null){return}this._moveReportsModel(reportIDs,targetGroupID,afterID);this._moveReportsAJAX(reportIDs,targetGroupID,afterID);this._deleteEmptyGroups()},_moveReportsModel:function(reports,group,after){var targetGroup=this.get(group);if(targetGroup==null){return}var reportInsertIndex=0;if(after!==null){var afterReport=targetGroup.collection.get(after);if(afterReport){reportInsertIndex=1+(targetGroup.collection.indexOf(afterReport)||0)}}var groups=this;_.each(reports,function(reportID){groups.each(function(group){var rpt=group.collection.get(reportID);if(!rpt){return}if(group.id==targetGroup.id){var index=group.collection.indexOf(rpt);if(index<reportInsertIndex){--reportInsertIndex}}group.collection.remove(rpt);targetGroup.collection.add(rpt,{at:reportInsertIndex});++reportInsertIndex;return false})})},_moveReportsAJAX:function(reports,group,after){var model=this;if(after===null||typeof after=="undefined"){after="top"}model.mainView.showSpinner();$.ajax({type:"POST",url:"/db/"+gReqDBID+"?a=QBI_ReportGroup_MoveReports",data:{reports:reports.join(","),group:group,after:after},success:function(data,textStatus,jqXHR){model.mainView.cancelSpinner();var resp=$(data);var errcode=resp.find("errcode").text();if(errcode!="0"){model.trigger("reinitEditMode");QB.Dialog.error({headline:"Error while moving reports:",contents:"Error "+errcode+": "+resp.find("errtext").text()});return}},error:function(data,textStatus,jqXHR){model.mainView.cancelSpinner();QB.Dialog.error({headline:"Could not reach QuickBase",contents:"While moving your reports, there was a problem reaching QuickBase.  There may be a problem with your internet connection or a problem with QuickBase.  Try again later."})}})},getNextTempGroupID:function(){var nextID=0;var isUniqueID=false;while(!isUniqueID){isUniqueID=!this.get(nextID);if(!isUniqueID){++nextID}}return"pending"+nextID},createReportGroup:function(reportIDs,name){window.c=this;var deferred=new $.Deferred();var tempID=this._createReportGroupModel(reportIDs,name);var groups=this;this._createReportGroupAJAX(reportIDs,name).then(function(actualGroupID){groups.get(tempID).set("id",actualGroupID);deferred.resolve(actualGroupID)});return deferred.promise()},_createReportGroupModel:function(reportIDs,name,tempID){var tempID=tempID||this.getNextTempGroupID();var group=new QB.Nav.PageBar.TrayItemGroup({id:tempID,name:name,mainView:this.mainView});this.add(group);this._moveReportsModel(reportIDs,group.id,null);this._deleteEmptyGroups();return group.id},_createReportGroupAJAX:function(reportIDs,name){var model=this;var deferred=new $.Deferred();model.mainView.showSpinner();$.ajax({type:"POST",url:"/db/"+gReqDBID+"?a=QBI_ReportGroup_Create",data:{name:name,reports:reportIDs.join(",")},success:function(data,textStatus,jqXHR){model.mainView.cancelSpinner();var resp=$(data);var errcode=resp.find("errcode").text();if(errcode!="0"){model.trigger("reinitEditMode");QB.Dialog.error({headline:"Error while moving reports:",contents:"Error "+errcode+": "+resp.find("errtext").text()});deferred.reject(null);return}var newID=resp.find("id").text()||"";newID=parseInt(newID)||newID;deferred.resolve(newID)},error:function(data,textStatus,jqXHR){model.mainView.cancelSpinner();QB.Dialog.error({headline:"Could not reach QuickBase",contents:"Could not create your report group because of a problem reaching QuickBase.  Please try again later."});deferred.reject(null)}});return deferred.promise()},moveGroup:function(newGroupOrder){var self=this;var groups=_.map(newGroupOrder,function(groupID){return self.get(groupID)});this.reset(groups);var stringOrder=newGroupOrder.join(",");this._moveGroupAJAX(stringOrder)},_moveGroupAJAX:function(stringOrder){var model=this;$.ajax({type:"POST",url:"/db/"+gReqDBID+"?a=QBI_ReportGroup_Reorder",data:{order:stringOrder},success:function(data,textStatus,jqXHR){var resp=$(data);var errcode=resp.find("errcode").text();if(errcode!="0"){model.trigger("reinitEditMode");QB.Dialog.error({headline:"Error while moving category:",contents:"Error "+errcode+": "+resp.find("errtext").text()});return}},error:function(data,textStatus,jqXHR){QB.Dialog.error({headline:"Could not reach QuickBase",contents:"While reordering your groups, there was a problem reaching QuickBase.  There may be a problem with your internet connection or a problem with QuickBase.  Try again later."})}})},_deleteEmptyGroups:function(){var groups=this;this.each(function(group){if(group.collection.length==0&&group.id!=0){groups.remove(group)}})},deleteGroup:function(groupID,deleteReportsInGroup){if(!groupID||groupID==0){return}var group=this.get(groupID);if(!group){return}this.remove(group);if(!deleteReportsInGroup){this._deleteGroupAJAX(groupID);var commonGroup=this.get(0);group.collection.each(function(rpt){commonGroup.collection.push(rpt)})}else{this._deleteReportsAJAX(group)}},_deleteGroupAJAX:function(groupID){var model=this;this.mainView.showSpinner();$.ajax({type:"POST",url:"/db/"+gReqDBID+"?a=QBI_ReportGroup_Delete",data:{id:groupID},success:function(data,textStatus,jqXHR){model.mainView.cancelSpinner();var resp=$(data);var errcode=resp.find("errcode").text();if(errcode!="0"){model.trigger("reinitEditMode");QB.Dialog.error({headline:"Error while moving category:",contents:"Error "+errcode+": "+resp.find("errtext").text()});return}},error:function(data,textStatus,jqXHR){model.mainView.cancelSpinner();QB.Dialog.error({headline:"Could not reach QuickBase",contents:"In removing your category, there was a problem reaching QuickBase.  There may be a problem with your internet connection or a problem with QuickBase.  Try again later."})}})},_deleteReportsAJAX:function(group){var model=this;var reportsToDelete=group.collection.map(function(rpt){return gReqDBID+"_"+rpt.get("id")});var numReports=reportsToDelete.length;this.mainView.showSpinner();$.ajax({type:"POST",data:{reports:reportsToDelete.join(",")},url:"/db/"+gReqDBID+"?a=JBI_DeleteReports",dataType:"json",success:function(data,textStatus,jqXHR){model.mainView.cancelSpinner();var resp=$(data);var deleteSuccess=true;_.each(reportsToDelete,function(item){if(resp[0][item]!="deleted"){deleteSuccess=false}});if(!deleteSuccess){model.trigger("reinitEditMode");QB.Dialog.error({headline:"Error while moving category:",contents:"Error "+errcode+": "+resp.find("errtext").text()});return}},error:function(xhr,status,error){model.mainView.cancelSpinner();QB.Dialog.error({headline:"Could not reach QuickBase",contents:"In removing your category, there was a problem reaching QuickBase.  There may be a problem with your internet connection or a problem with QuickBase.  Try again later."})}})}});QB.Nav.PageBarTrayMain=Backbone.View.extend({initialize:function(){var view=this;this.editableTrayView=null;this.persistenceKey=this.options.persistenceKey||"tray_";this._initializeViewMode(true);this.on("refreshCollapsePersistence",this.refreshToggleState,this)},events:{"click #editMode":"_initializeEditMode","click #exitEditMode":"_exitEditMode"},_exitEditMode:function(){var newModel=this._buildViewModelFromEditModel();this.collection=new QB.Nav.PageBar.TrayGroups(newModel,{mainView:this});this._initializeViewMode()},_buildViewModelFromEditModel:function(){var oldViewModel=gPageBarReportTrayData.reportGroups||[];var newViewModel=_.filter(oldViewModel,function(grp){return grp.id<0});var recentGroup=_.find(newViewModel,function(grp){return grp.id==-2});var allReports={};this.editableTrayView.collection.each(function(group){var json=group.toJSON();json.reports=group.collection.toJSON();json.reports=_.reject(json.reports,function(r){return r.isRevealedByAdmin});if(json.reports.length>0){newViewModel.push(json);if(recentGroup){_.each(json.reports,function(r){allReports[r.id]=r})}}});if(recentGroup){var deletedReportIDs={};_.each(recentGroup.reports,function(report){if(allReports.hasOwnProperty(report.id)){_.extend(report,allReports[report.id])}else{deletedReportIDs[report.id]=true}});recentGroup.reports=_.reject(recentGroup.reports,function(r){return deletedReportIDs.hasOwnProperty(r.id)})}return newViewModel},_initializeViewMode:function(supressToggleStateInit){var self=this;if(this.editableTrayView){this.editableTrayView.collection.off();this.editableTrayView.$el.unbind();this.editableTrayView.remove()}var markup=ich.trayMarkup();this.$el.append(markup);markup.find(".UserInput").placeholder();this.searchableTrayView=new QB.Nav.PageBarSearchableTray({el:markup,collection:this.collection,dispatcher:this,mainView:this});if(!supressToggleStateInit){$("#pageNavBar .PageBarItemListTray").qbPersistentUserPrefs({persistKey:self.persistenceKey+gReqDBID,isSessionOnly:false,animate:false})}},_spinnerTimeout:null,showSpinner:function(delay){if(this._spinnerTimeout){window.clearTimeout(this._spinnerTimeout)}if(typeof delay==="undefined"){var delay=300}this._spinnerTimeout=window.setTimeout(function(){$("#reportTrayOverlaySpinner").stop().show(IsIE()?"":"fade","fast")},delay)},cancelSpinner:function(){if(this._spinnerTimeout){window.clearTimeout(this._spinnerTimeout);this._spinnerTimeout=null}$("#reportTrayOverlaySpinner").stop().hide(IsIE()?"":"fade","fast")},refreshToggleState:function(){$("#pageNavBar .PageBarItemListTray").qbPersistentUserPrefs("refresh")},_initializeEditMode:function(){if(this.isInitializingEditMode){return}this.isInitializingEditMode=true;var view=this;this.showSpinner(250);$.ajax({type:"POST",url:"/db/"+gReqDBID+"?a=JBI_ReportTray_LoadAll",success:function(data,textStatus,jqXHR){view.cancelSpinner();if(data.reportGroups){view.editCollection=new QB.Nav.PageBar.TrayGroups(data.reportGroups,{mainView:view});view._finishEditModeInit()}else{view.errorDialog=QB.Dialog.dialog({id:"dialogUnexpectedReportData",contents:"Error parsing JSON returned from the server. Please contact support.",contentType:"text",confirm:{text:"OK"},cancel:null,title:"Error",size:"small",focusedButton:null});view.isInitializingEditMode=false}},error:function(jqXHR,textStatus,errorThrown){view.errorDialog=QB.Dialog.dialog({id:"dialogUnexpectedReportData",contents:"The server is temporarily unavailable, your internet connection has been lost, or there was some other error. Please try again later.",contentType:"text",confirm:{text:"OK"},cancel:null,title:"Error",size:"small",focusedButton:null});view.isInitializingEditMode=false},dataType:"json"})},_reinitializeEditMode:function(){if(this.editableTrayView){this.editableTrayView.collection.off();this.editableTrayView.$el.unbind();this.editableTrayView.remove()}this._initializeEditMode()},_finishEditModeInit:function(){var view=this;if(this.searchableTrayView){this.searchableTrayView.$el.unbind();this.searchableTrayView.remove()}var markup=ich.editTrayMarkup();this.$el.append(markup);this.editableTrayView=new QB.Nav.PageBarEditableReportsTray({el:markup,collection:this.editCollection,dispatcher:this,mainView:this});$("#pageNavBar .PageBarItemListTray").qbPersistentUserPrefs({persistKey:"rpttry_"+gReqDBID,isSessionOnly:false,animate:false,toggleWithIconOnly:true});this.editableTrayView.collection.on("reinitEditMode",function(){view._reinitializeEditMode()});this.isInitializingEditMode=false},lazyLoadTrayContents:function(persistKey,JBIurl){if(this.isLazyLoadingTray){return}this.isLazyLoadingTray=true;var view=this;view.showSpinner();$.ajax({type:"POST",url:JBIurl,success:function(data){view.cancelSpinner();if(data.reportGroups.length>0){view.collection=new QB.Nav.PageBar.TrayGroups(data.reportGroups,{mainView:view});view._initializeViewMode()}else{view.$el.find("#categoriesWrapper").remove();var div=view.$el.find("#pageNavAcctRealmTrayHeader");div.html("Sorry - you don't have access to any other accounts or realms")}view.isLazyLoadingTray=false},error:function(jqXHR,textStatus,errorThrown){view.errorDialog=QB.Dialog.dialog({id:"dialogUnexpectedReportData",contents:"The server is temporarily unavailable, your internet connection has been lost, or there was some other error. Please try again later.",contentType:"text",confirm:{text:"OK"},cancel:null,title:"Error",size:"small",focusedButton:null});view.isLazyLoadingTray=false},dataType:"json"})}});QB.Nav.PageBarSearchableTray=Backbone.View.extend({maxReportsPerColumn:6,lastSearchTerm:"",initialize:function(){var view=this;this.mainView=this.options.mainView;if(this.options.maxReportsPerColumn){this.maxReportsPerColumn=this.options.maxReportsPerColumn}this.render();this.cats$=this.$(".Categories").first();this.input$=this.$(".SearchTerms");this.scrollArrows$=this.$(".ScrollArrow");this.preCacheColumnDimensions();$(window).on("resizeidle.qb",_.bind(this.onResize,this));this.onResize();if(Modernizr.touch){this.cats$.addClass("TouchDeviceScrollable")}this.$el.data("initialized",true).trigger("initialized");this.$el.parent().on("trayopen",_.bind(this.onTrayOpen,this))},events:{"click .ClearInput":"clearInputBox","keyup .SearchTerms":"onUserType","click .ScrollArrow":"onScrollClick",changedCollapseState:"_performToggle"},onTrayOpen:function(){if(!Modernizr.touch){this.input$.focus().select()}},render:function(){var self=this;var groupTemplates=[];var trayContents=$("<div id='pageNavReportCategories' class='Categories'></div>");this.collection.each(function(group,it){var categoryDiv=self._renderTrayCategory(group.toJSON());var groupContents=categoryDiv.find(".GroupContents");var columnText="";group.collection.each(function(report,it){if(it!=0&&it%self.maxReportsPerColumn==0){var renderableItemList=ich.trayList();renderableItemList.append(columnText);columnText="";groupContents.append(renderableItemList)}var json=report.toJSON();columnText+=self._renderTrayItem(json)});if(columnText){var renderableItemList=ich.trayList();renderableItemList.append(columnText);groupContents.append(renderableItemList)}trayContents.append(categoryDiv);if(group.collection.length==0){categoryDiv.hide()}});this.$el.find(".CategoriesWrapper").append(trayContents)},_renderTrayCategory:function(categoryObject){return ich.trayCategory(categoryObject)},_renderTrayItem:function(item){if(ich.trayItemTitle){var title=ich.trayItemTitle(item,true);item.htmlEncodedTitle=HTMLEncode(title)}return ich.trayItem(item,true)},preCacheColumnDimensions:function(){var view=this;var tray=this.$el.closest(".Tray");var trayWasHidden=false;if(!tray.is(":visible")){tray.show();trayWasHidden=true}this.scrollerContentsWidth=0;this.cats$.children(".Category:visible").each(function(index,cat){view.scrollerContentsWidth+=$(cat).outerWidth(true)});var visibleColumns=this.cats$.children(".Category").children(".GroupContents").children(".Column:visible");visibleColumns.children(".Spacer").hide();var widths=[];visibleColumns.each(function(index,col){widths[index]=$(col).width()}).each(function(index,col){col=$(col);var spacer=col.children(".Spacer");if(spacer.length==0){spacer=$('<li class="Spacer" />').hide();spacer.width(widths[index]);col.append(spacer)}else{spacer.css("width",widths[index]+"px")}});visibleColumns.children(".Spacer").show();this.onResize();if(trayWasHidden){tray.hide()}},showHideScrollButtons:function(isVisible){var isVisible=(isVisible||false);this.$el.toggleClass("Scrolling",isVisible)},isScrolling:false,_extraScrollWidth:function(){return 0},onResize:function(evt){var tray=this.$el.closest(".Tray");if(!tray.is(":visible")){return}var maxWidth=this.cats$.parent().width()-this._extraScrollWidth();if(this.scrollerContentsWidth>maxWidth){this.showHideScrollButtons(true);this.enableDisableScrollArrows();if(!this.isScrolling){this.trigger("scrollModeEnabled");this.isScrolling=true}}else{this.showHideScrollButtons(false);if(this.isScrolling){this.trigger("scrollModeDisabled");this.isScrolling=false}}},enableDisableScrollArrows:function(){var currentPosition=this.cats$.stop(true,true).scrollLeft();if(currentPosition==0){this.scrollArrows$.filter(".ScrollLeft").addClass("Disabled");this.scrollArrows$.filter(".ScrollRight").removeClass("Disabled");return}this.cats$.scrollLeft(currentPosition+1);var canMoveRight=this.cats$.scrollLeft()!=currentPosition;this.cats$.scrollLeft(currentPosition);if(!canMoveRight){this.scrollArrows$.filter(".ScrollLeft").removeClass("Disabled");this.scrollArrows$.filter(".ScrollRight").addClass("Disabled")}else{this.scrollArrows$.removeClass("Disabled")}},onScrollClick:function(evt){this.cats$.stop(true,true);var isToRight=$(evt.target).hasClass("ScrollRight");var oldScrollPos=this.cats$.scrollLeft();var width=this.cats$.width();var visibleColumns=this.cats$.children(".Category").not(".Collapsed").children(".GroupContents").children(".Column:visible");var visibleColumnLeftEdges=[];visibleColumns.each(function(index,elt){var left=oldScrollPos+$(elt).position().left;visibleColumnLeftEdges.push(left)});if(isToRight){newScrollPos=oldScrollPos+width;var lastVisibleEdge=0;for(var i=0;i<visibleColumnLeftEdges.length;i++){var edge=visibleColumnLeftEdges[i];if(edge>newScrollPos){break}lastVisibleEdge=edge}newScrollPos=lastVisibleEdge}else{newScrollPos=oldScrollPos-width;if(newScrollPos<0){newScrollPos=0}else{var firstVisibleEdge=0;for(var i=0;i<visibleColumnLeftEdges.length;i++){var edge=visibleColumnLeftEdges[i];firstVisibleEdge=edge;if(edge>newScrollPos){break}}newScrollPos=firstVisibleEdge}}this.cats$.animate({scrollLeft:newScrollPos},800,_.bind(this.enableDisableScrollArrows,this))},clearInputBox:function(evt){this.input$.val("").focus();this.input$.siblings(".ClearInput").hide();this.input$.addClass("SearchIcon");this.filterReportList();return false},multiKeywordMatches:function(text,keywords){if(!text){return false}text=text.toLowerCase();for(var i=0;i<keywords.length;i++){if(keywords[i]==""){continue}if(text.indexOf(keywords[i])<0){return false}}return true},onUserType:function(){var hideClearBtn=(this.input$.val()=="");this.input$.siblings(".ClearInput").toggle(!hideClearBtn);this.input$.toggleClass("SearchIcon",hideClearBtn);this.onUserTypeThrottled()},onUserTypeThrottled:_.throttle(function(){this.filterReportList()},333),filterReportList:function(){var view=this;var searchTerm=(this.input$.val()||"").toLowerCase();if(searchTerm==this.lastSearchTerm){return}else{this.lastSearchTerm=searchTerm}var keywordsToMatch=searchTerm.split(/\W+/);this.cats$.children(".Category").each(function(catIndex,catElem){var cat$=$(catElem);var reports=cat$.find(".Column").children(".TrayItem").detach();cat$.find(".Column").remove();var column=$('<ul class="Column"></ul>');var numVisibleInThisColumn=0;var numHiddenInThisColumn=0;var visibleReportsInThisCategory=0;reports.each(function(rptIndex,report){if(numVisibleInThisColumn>=view.maxReportsPerColumn){cat$.find(".GroupContents").append(column);column=$('<ul class="Column"></ul>');numVisibleInThisColumn=0;numHiddenInThisColumn=0}var reportText=(($(report).children("a").data("search-text")||"")+"").toLowerCase();if(searchTerm==""||view.multiKeywordMatches(reportText,keywordsToMatch)){$(report).show().appendTo(column);++numVisibleInThisColumn;++visibleReportsInThisCategory}else{$(report).hide().appendTo(column);++numHiddenInThisColumn}});if(numVisibleInThisColumn+numHiddenInThisColumn>0){if(numVisibleInThisColumn==0){column.hide()}cat$.find(".GroupContents").append(column)}cat$.toggle(visibleReportsInThisCategory>0)});this.preCacheColumnDimensions()},_performToggle:function(event,clickTarget){var evtObj=$("#"+clickTarget);evtObj.toggleClass("Collapsed");evtObj.parent().toggleClass("Collapsed");this.preCacheColumnDimensions()}});QB.Nav.PageBarEditableReportsTray=QB.Nav.PageBarSearchableTray.extend({helperElReportOffset:{top:-8,left:-10},helperElCategoryOffset:{top:-8,left:-26},initialize:function(){_.bindAll(this,"_handleCategoryNameEvent");var view=this;QB.Nav.PageBarSearchableTray.prototype.initialize.apply(this,arguments);if(Modernizr.touch){this.helperElReportOffset={top:0,left:-25};this.helperElCategoryOffset={top:0,left:-41}}this.initializeDragAndDrop();this.initializeCategoryDragAndDrop();if(IsIE()){this.$el.on("selectstart",function(evt){return false})}this.normalizeColumnHeights();this.initializeColumnDroppables()},events:_.extend({},QB.Nav.PageBarSearchableTray.prototype.events,{"click .Title .SaveChanges":"_onCategoryNameSave","submit .Title > form":"_onCategoryNameSave","click .Title .CancelChanges":"_categoryNameStopEditing","click .EditGroup":"_initCategoryNameEdit","click .Title .sectionTitle":"_handleCategoryNameEvent","doubletap .Title .sectionTitle":"_initCategoryNameEdit","click .DeleteGroup":"_deleteGroupPrompt","keyup .CategoryTitleEditor":"_categoryKeyPress","click .TrayItem .SaveChanges":"_onReportNameSave","submit .TrayItem form":"_onReportNameFormSubmit","click .TrayItem .CancelChanges":"_reportNameStopEditing","click .EditReport":"_initReportNameEdit","dblclick .TrayItem":"_initReportNameEdit","doubletap .TrayItem":"_toggleHovers","click .DeployHovers":"_toggleHovers","click .DeleteReport":"_deleteReportPrompt","keyup .ReportNameEditor":"_reportKeyPress","mouseleave .TrayItem":"_hideTrayItemHovers","click .TrayItem > a":"_handleSelection","click .Categories,CategoriesWrapper,.GroupContents":"_maybeDeselectReports","mouseenter .DraggingReport .Category.Collapsed":"_hoverOpenCollapsed","touchenter .DraggingReport .Category.Collapsed":"_hoverOpenCollapsed","mouseleave .DraggingReport .Category.Collapsed":"_hoverOpenCollapsedCancel","touchleave .DraggingReport .Category.Collapsed":"_hoverOpenCollapsedCancel",mousedown:"_clickOutside",touchstart:"_clickOutside"}),priorSelectedElement:null,rangeSelectPivot:null,selectedElements:{},selectionClass:"Selected",_handleSelection:function(evt){this._categoryNameStopEditing();this._reportNameStopEditing();var el=$(evt.currentTarget).parent().get(0);if(evt.shiftKey){this._selectRange(el)}else{if(evt.ctrlKey||evt.metaKey||evt.altKey||Modernizr.touch){this._selectToggle(el)}else{this._selectSingle(el)}}evt.preventDefault()},_maybeDeselectReports:function(evt){if(evt.currentTarget==evt.target||$(evt.target).hasClass("Column")){this._selectNone()}},_selectRange:function(el){var view=this;if(this.rangeSelectPivot==null){var firstColumn=$(el).closest(".Column").parent().children(".Column").first();var firstItem=firstColumn.children(".TrayItem").first();this.rangeSelectPivot=firstItem[0]||null}if(this.priorSelectedElement!==null&&this.rangeSelectPivot!==null){var oldRange=this._getTrayItemRange(this.rangeSelectPivot,this.priorSelectedElement);$(oldRange).removeClass(this.selectionClass);_.each(oldRange,function(trayItem){var qid=$(trayItem).data("qid");delete view.selectedElements[qid]})}var newRange=this._getTrayItemRange(this.rangeSelectPivot,el);$(newRange).addClass(this.selectionClass);_.each(newRange,function(trayItem){var qid=$(trayItem).data("qid");view.selectedElements[qid]=trayItem});this.priorSelectedElement=el;this._afterSelect()},_selectToggle:function(el){$(el).toggleClass(this.selectionClass);var isSelected=$(el).hasClass(this.selectionClass);var qid=$(el).data("qid");if(isSelected){this.selectedElements[qid]=el}else{delete this.selectedElements[qid]}this.priorSelectedElement=el;this.rangeSelectPivot=el;this._afterSelect()},_selectSingle:function(el){this._selectNone();if(el){$(el).addClass(this.selectionClass);this.selectedElements[$(el).data("qid")]=el}this.priorSelectedElement=el;this.rangeSelectPivot=el;this._afterSelect()},_selectNone:function(){var view=this;_.each(this.selectedElements,function(trayItem,qid){$(trayItem).removeClass(view.selectionClass)});this.selectedElements={};this._afterSelect()},_afterSelect:function(){var numSelected=0;_.each(this.selectedElements,function(){++numSelected});if(this.dropZone){this.dropZone.toggleClass("Active",numSelected>0)}},_getNextTrayItem:function($el){var next=$el.next(".TrayItem");if(next.length>0){return next}var nextColumn=$el.parent().next(".Column");if(nextColumn.length==0){var nextGroup=$el.closest(".Category").next(".Category");while(nextGroup.hasClass("Collapsed")){nextGroup=nextGroup.next(".Category")}if(nextGroup.length==0){return null}nextColumn=nextGroup.children(".GroupContents").children(".Column").first();if(nextColumn.length==0){return null}}next=nextColumn.children(".TrayItem").first();if(next.length==0){return null}else{return next}},_getTrayItemRange:function(el1,el2){if(el1==el2){return[el1]}var index1=null;var index2=null;var id1=$(el1).data("qid");var id2=$(el2).data("qid");var i=0;this.collection.each(function(group){group.collection.each(function(report){if(report.id==id1){index1=i}if(report.id==id2){index2=i}++i;if(index1!==null&&index2!==null){return false}});if(index1!==null&&index2!==null){return false}});if(index2<index1){var tmp=el2;el2=el1;el1=tmp}var elements=[];for($el=$(el1);$el!=null;$el=this._getNextTrayItem($el)){elements.push($el[0]);if($el[0]==el2){break}}return elements},_buildDragHelper:function(helper){var numReports=this.draggedReports.length;helper.addClass(this.selectionClass).addClass("DragHelper");if(numReports>1){helper.addClass("StackOfReports");helper.children("a").text(numReports+" reports")}},draggedReports:null,columns:null,initializeDragAndDrop:function(){var view=this;var reports=this.$(".TrayItem");view.columns=this.$(".Column");reports.draggable("destroy").draggable({opacity:1,helper:"clone",revert:"invalid",revertDuration:300,addClasses:false,distance:10,appendTo:this.$el,cursorAt:this.helperElReportOffset,drag:function(event,ui){var dropTarget=reports.filter(".HoverTarget").first();if(dropTarget.length==0){dropTarget=view.columns.filter(".HoverColumn").first();if(dropTarget.length>0){var lastChildPos=$(dropTarget).children(".TrayItem").last().offset().top;if(event.pageY>lastChildPos){dropTarget.children(".TrayItem").last().addClass("HoverTarget")}}return}var height=dropTarget.height();var clientY=ui.offset.top;var y=(clientY-dropTarget.offset().top)+view.helperElReportOffset.top;dropTarget.toggleClass("InsertAbove",y<height/2)},start:function(event,ui){view._categoryNameStopEditing();view.$el.addClass("NoToolTip DraggingReport");if(!view.selectedElements.hasOwnProperty($(this).data("qid"))){view._selectSingle(this);view.draggedReports=$(this)}else{elements=[];view.collection.each(function(group){group.collection.each(function(report){if(!view.selectedElements.hasOwnProperty(report.id)){return}elements.push(view.selectedElements[report.id])})});view.draggedReports=$(elements)}view.draggedReports.addClass("MovePending");view._buildDragHelper(ui.helper);view._startAutoScrolling()},stop:function(event,ui){view.$el.removeClass("NoToolTip DraggingReport");if(!view.isPendingCreateGroup){view.draggedReports.removeClass("MovePending")}view._stopAutoScrolling()}});reports.droppable("destroy").droppable({accept:".TrayItem",addClasses:false,tolerance:"pointer",greedy:true,hoverClass:"HoverTarget",drop:function(){var insertAbove=$(this).hasClass("InsertAbove");$(this).removeClass("InsertAbove");view.dropReports(insertAbove,this)}});this.dropZone&&this.dropZone.droppable("destroy").droppable({accept:".TrayItem",addClasses:false,tolerance:"pointer",hoverClass:"Dropping",drop:function(evt,ui){var catWidth=view.cats$.width();var lastVisibleCategory=null;view.cats$.children(".Category").each(function(idx,cat){var left=$(cat).position().left;if(left<=catWidth){lastVisibleCategory=$(cat)}});var newGroup=view._renderTrayCategory({id:view.collection.getNextTempGroupID(),name:"New group"});view.isPendingCreateGroup=true;view.pendingGroupReports=view.draggedReports;newGroup.addClass("PendingCreation");if(lastVisibleCategory){lastVisibleCategory.after(newGroup)}else{view.cats$.append(newGroup)}var beforeZone=view.cats$.children(".NewGroupDropZone");if(beforeZone.length>0){view.cats$.append(beforeZone)}view.$el.addClass("HideDropZone");var columnContainer=newGroup.children(".GroupContents");var reportClones=view.draggedReports.clone(false);reportClones.off().removeAttr("data-qid").data("qid",null);reportClones.children().off().removeClass("Tipsy Tipsified").removeAttr("title data-original-title");view._buildColumns(reportClones,columnContainer);view._categoryNameInitEditing(newGroup);view.scrollToShowGroup(newGroup)},over:function(event,ui){view.$el.addClass("HoveringOnCreateGroup")},out:function(event,ui){view.$el.removeClass("HoveringOnCreateGroup")}});this.on("scrollModeDisabled",function(){view.dropZone.removeClass("Frozen");view.cats$.append(view.dropZone)});this.on("scrollModeEnabled",function(){view.dropZone.addClass("Frozen");view.cats$.after(view.dropZone)});if(this.$el.hasClass("Scrolling")){this.trigger("scrollModeEnabled")}},initializeColumnDroppables:function(){var view=this;view.columns=this.$(".Column");view.columns.droppable("destroy").droppable({accept:".TrayItem",addClasses:false,hoverClass:"HoverColumn",tolerance:"pointer",drop:function(event,ui){$(this).children(".TrayItem").removeClass("HoverTarget");var lastChild=$(this).children(".TrayItem").last();var lastChildPos=lastChild.offset().top+lastChild.outerHeight();if(event.pageY>lastChildPos&&!view.$el.hasClass("HoveringOnCreateGroup")){view.dropReports(false,lastChild)}},out:function(event,ui){$(this).children(".TrayItem").removeClass("HoverTarget")}})},dropReports:function(insertAbove,insertElement){var view=this;if(!insertElement||view.draggedReports==null){return}if(view.dropZone.hasClass("Dropping")){return}var insertionPoint=$("<div/>");if(insertAbove){insertionPoint.insertBefore(insertElement)}else{insertionPoint.insertAfter(insertElement)}view.draggedReports.detach();var reportIDs=_.map(view.draggedReports,function(element){return $(element).data("qid")});var targetGroupID=insertionPoint.closest(".Category").data("group-id");var afterElement=null;if(insertionPoint.prev().length>0){afterElement=insertionPoint.prev()}else{if(insertionPoint.parent().prev().length>0){afterElement=insertionPoint.parent().prev().children(".TrayItem").last()}else{afterElement=null}}var afterID=afterElement==null?null:afterElement.data("qid");insertionPoint.replaceWith(view.draggedReports);insertionPoint.remove();view._rebalanceAllColumns();view.collection.moveReports(reportIDs,targetGroupID,afterID);view._removeNonexistentGroups();view.preCacheColumnDimensions()},scrollToShowGroup:function(group){var leftPos=group.position().left+this.cats$.scrollLeft();this.cats$.scrollLeft(leftPos)},initializeCategoryDragAndDrop:function(){var view=this;var categories=this.$(".Category");var draggedCategory=null;categories.draggable("destroy").draggable({opacity:1,handle:".Title",helper:function(){return $("<div class='DragHelper'><div>"+$(this).children().children(".sectionTitle").html()+"</div></div>")},revert:"invalid",revertDuration:300,addClasses:false,appendTo:this.$el,distance:10,cursorAt:this.helperElCategoryOffset,drag:function(event,ui){var dropTarget=categories.filter(".HoverTarget").first();if(dropTarget.length==0){return}var width=dropTarget.width();var clientX=ui.offset.left;var x=(clientX-dropTarget.offset().left)+view.helperElCategoryOffset.left;dropTarget.toggleClass("InsertLeft",x<width/2)},start:function(){view._categoryNameStopEditing();view.$el.addClass("NoToolTip");draggedCategory=$(this);draggedCategory.addClass("MovePending");view._startAutoScrolling()},stop:function(){view.$el.removeClass("NoToolTip");draggedCategory.removeClass("MovePending");view._stopAutoScrolling()}});categories.droppable("destroy").droppable({accept:".Category",addClasses:false,tolerance:"pointer",hoverClass:"HoverTarget",drop:function(){var insertLeft=$(this).hasClass("InsertLeft");$(this).removeClass("InsertLeft");draggedCategory.detach();var afterElement=null;if(insertLeft){afterElement=$(this).prev()}else{afterElement=$(this)}if(afterElement.length>0){draggedCategory.insertAfter(afterElement)}else{$(this).parent().prepend(draggedCategory)}view._saveGroupOrder()}})},_saveGroupOrder:function(){var newGroupOrder=$.map(this.cats$.children(".Category"),function(cat){return $(cat)[0].id!=""?$(cat).data("group-id"):null});this.collection.moveGroup(newGroupOrder)},_hoverOpenTimer:null,_hoverOpenCollapsed:function(evt){var view=this;if(this._hoverOpenTimer!==null){clearTimeout(this._hoverOpenTimer)}this._hoverOpenTimer=setTimeout(function(){$(evt.currentTarget).children(".Title").children(".ToggleSectionIcon").click();view._refreshDroppablePositions()},600)},_hoverOpenCollapsedCancel:function(){if(this._hoverOpenTimer!=null){clearTimeout(this._hoverOpenTimer)}},_refreshDroppablePositions:function(evt){this.$(".TrayItem").each(function(index,item){var droppable=$(item).data("droppable");if(droppable){$.ui.ddmanager.prepareOffsets(droppable,evt)}})},_rebalanceAllColumns:function(){var view=this;this.$el.children(".CategoriesWrapper").children(".Categories").children(".Category").each(function(catIndex,category){var columnContainer=$(category).children(".GroupContents");var reports=columnContainer.children(".Column").children(".TrayItem").not(".ui-draggable-dragging");view._buildColumns(reports,columnContainer)});view.normalizeColumnHeights();view.initializeColumnDroppables()},_buildColumns:function(elements,parent){var elements=$(elements);var parent=$(parent);elements.detach();parent.empty();for(var i=0;i<elements.length;i+=this.maxReportsPerColumn){var reportsForColumn=elements.slice(i,i+this.maxReportsPerColumn);var column=ich.trayList();column.append(reportsForColumn);parent.append(column)}},_removeNonexistentGroups:function(){var view=this;this.cats$.children(".Category").each(function(index,category){var category=$(category);var id=category.data("group-id");var categoryModel=view.collection.get(id);if(!categoryModel||categoryModel.collection.length==0){if(id==0){category.hide()}else{category.remove()}}})},_startAutoScrolling:function(){if(this.autoScrollInterval||!this.isScrolling){return}var speed=40;var area=34;var elt=this.cats$;var bounds=this.cats$.parent();var lastMouseX=null;this.$el.on("mousemove.pageNavReportsAutoScroll",function(evt){lastMouseX=evt.clientX});var leftEdge=bounds.offset().left;var rightEdge=leftEdge+bounds.outerWidth();this.autoScrollInterval=setInterval(function(){if(lastMouseX===null){return}var distFromLeft=Math.max(0,lastMouseX-leftEdge);var distFromRight=Math.max(0,rightEdge-lastMouseX);var goLeft=(distFromLeft<=area);var goRight=(distFromRight<=area);if(goLeft==goRight){return}var currentScroll=elt.scrollLeft();if(goLeft){var velocity=speed*(1-distFromLeft/area);elt.scrollLeft(currentScroll-Math.round(velocity))}else{var velocity=speed*(1-distFromRight/area);elt.scrollLeft(currentScroll+Math.round(velocity))}},50)},_stopAutoScrolling:function(){this.$el.off(".pageNavReportsAutoScroll");if(this.autoScrollInterval){clearInterval(this.autoScrollInterval);this.autoScrollInterval=null}},_renderTrayItem:function(json){var title=ich.editTrayItemTitle(json,true);json.htmlEncodedTitle=HTMLEncode(title);return ich.editTrayItem(json,true)},render:function(){QB.Nav.PageBarSearchableTray.prototype.render.apply(this,arguments);this.dropZone=ich.editTrayCreateGroupDropZone();this.$el.children(".CategoriesWrapper").children(".Categories").append(this.dropZone);return this},_extraScrollWidth:function(){if(this.isScrolling){return 0}else{var dzw=this.dropZone?this.dropZone.width():0;return dzw+24}},currGroupHeaderLabel:null,currGroupHeaderInput:null,_handleCategoryNameEvent:function(event){if(Modernizr.touch&&!$(event.currentTarget).hasClass("EditGroup")){var hoverControls=$(event.currentTarget).siblings(".HoverControls");if(hoverControls.length>0){if(hoverControls.css("visibility")=="visible"){hoverControls.css("visibility","")}else{this.$(".HoverControls").css("visibility","");hoverControls.css("visibility","visible")}}}else{this._initCategoryNameEdit(event)}},_initCategoryNameEdit:function(event){var title=$(event.target).closest(".Title");if(title.hasClass("Collapsed")){title.children(".ToggleSectionIcon").click()}var cat=$(event.currentTarget).closest(".Category");if(cat.hasClass("Immutable")){return}if($(event.target).parent().hasClass("Collapsed")){return}event.stopImmediatePropagation();this._categoryNameInitEditing(cat);this.currGroupHeaderLabel=event.target},currReportLabel:null,currReportForm:null,_initReportNameEdit:function(event){var trayItem=$(event.currentTarget).closest(".TrayItem");this._reportNameSetEditing(trayItem,true)},_reportNameStopEditing:function(event){if(!this.currReportLabel){return}var trayItem=$(this.currReportLabel).closest(".TrayItem");var groupID=trayItem.closest(".Category").data("group-id");var groupModel=this.collection.get(groupID);var rptModel=groupModel.collection.get(trayItem.data("qid"));var fullname=rptModel.get("name");var trayInput=trayItem.children("form").children("input");if(fullname.length>0){trayInput.val(fullname)}if(!trayItem){return}this._reportNameSetEditing(trayItem,false)},_reportNameSetEditing:function(report,isEditing){report=$(report);var view=this;var itemLabel=report.children("a");var itemForm=report.children("form");var groupID=report.closest(".Category").data("group-id");var groupModel=this.collection.get(groupID);var rptModel=groupModel.collection.get(report.data("qid"));var fullname=rptModel.get("name");if(itemForm.length==0){var listAll=false;if($(report).data("qid")=="1"){listAll=true}report.append(ich.editTrayItemHoverContent({id:$(report).data("qid"),name:fullname,dbid:gReqDBID,listall:listAll}));itemForm=report.children("form")}var itemHovers=$(report).children("div");itemLabel.toggle(!isEditing);itemHovers.toggle(!isEditing);itemForm.toggleClass("DisplayNone",!isEditing);$(report).css({zoom:1}).hide().show();var itemInput=itemForm.children("input");if(isEditing){this.currReportLabel=itemLabel;this.currReportForm=itemForm;itemInput.focus().select();if(IsIE()){itemInput.off(".navPageBar").on("selectstart.navPageBar",function(evt){evt.stopPropagation();setTimeout(function(){view._hideTooltips()},50)});setTimeout(function(){itemInput.select()},2)}if(itemInput[0].setSelectionRange&&Modernizr.touch){itemInput[0].setSelectionRange(0,999)}}else{if(itemInput[0].setSelectionRange&&Modernizr.touch){window.getSelection().removeAllRanges()}itemInput.blur().off(".navPageBar");this.currReportLabel=null;this.currReportForm=null}},_onReportNameSave:function(event){event.stopPropagation();event.preventDefault();var report=$(event.target).closest(".TrayItem");var groupID=report.closest(".Category").data("group-id");var input=report.find("input");var newName=$.trim(input.val());var groupModel=this.collection.get(groupID);var rptModel=groupModel.collection.get(report.data("qid"));if(newName&&newName.length>0){if(groupModel.changeReportName(report.data("qid"),newName)){var anchorEl=report.children("a");anchorEl.text(rptModel.get("displayName"));anchorEl.removeClass("Tipsified").addClass("Tipsy");anchorEl.removeData("original-title");anchorEl.attr("data-original-title",rptModel.get("name"))}this._reportNameStopEditing(event)}else{this._warnInvalidReportName(input,newName)}return false},_deleteReportPrompt:function(event){var view=this;var reportToDelete=$(event.target).closest(".TrayItem");var groupID=reportToDelete.closest(".Category").data("group-id");var reportName=reportToDelete.children("a").text();var reportID=reportToDelete.data("qid");var groupModel=this.collection.get(groupID);if(reportID){var deleteDialog=QB.Dialog.dialog({id:"deleteReportConfirmationDialog",contents:ich.deleteReportDialog({name:reportName}),contentType:"selector",confirm:{type:"Danger",text:"Delete Report",click:function(){reportToDelete.remove();view._rebalanceAllColumns();groupModel.deleteReport(reportID);view._removeNonexistentGroups();$(this).find("input").off();$(this).dialog("close")}},cancel:{click:function(){$(this).find("input").off();$(this).dialog("close")},text:"Cancel"},title:"Delete Report",size:400,focusedButton:null})}},_reportKeyPress:function(event){var key=event.keyCode||event.which;if(key==$.ui.keyCode.ESCAPE){this._reportNameStopEditing()}else{if(key==$.ui.keyCode.ENTER){this._onReportNameSave(event)}}},hoveredElement:null,_toggleHovers:function(event){var deployEl=$(event.currentTarget);if(!deployEl.hasClass("TrayItem")){deployEl=deployEl.closest(".TrayItem")}var qid=deployEl.data("qid");var groupID=deployEl.closest(".Category").data("group-id");var groupModel=this.collection.get(groupID);var rptModel=groupModel.collection.get(qid);var fullname=rptModel.get("name");var contents=deployEl.children("a").text();if(Modernizr.touch){this._clearHoverControls(qid)}if(!qid||!fullname){return}if(deployEl.children(".HoverControls").length==0){var listAll=false;if($(deployEl).data("qid")=="1"){listAll=true}deployEl.append(ich.editTrayItemHoverContent({id:qid,name:fullname,dbid:gReqDBID,listall:listAll}))}var hoverControls=deployEl.children(".HoverControls");hoverControls.toggleClass("Deployed");deployEl.children(".DeployHovers").toggleClass("Deployed");if(Modernizr.touch){if(hoverControls.hasClass("Deployed")){this.hoveredElement=deployEl}else{this.hoveredElement=null}}},_clearHoverControls:function(qid){if(this.hoveredElement&&this.hoveredElement.data("qid")!=qid){this.hoveredElement.children(".HoverControls, .DeployHovers").removeClass("Deployed")}},_categoryNameInitEditing:function(category){var catLabel=$(category).children(".Title").find(".sectionTitle");var catInput=catLabel.next();this.currGroupHeaderLabel=catLabel;this.currGroupHeaderInput=catInput;catInput.children("input").val(catLabel.text());this._categoryNameSetEditing(category,true);var categoryLeft=$(category).position().left;var categoriesCurrentScroll=this.cats$.scrollLeft();var hoverControl=$(category).children(".Title").children("form");var hoverControlRight=hoverControl.position().left+hoverControl.width();var categoriesLeft=this.cats$.position().left;var containerWidth=this.cats$.width();var scrollTo=categoriesCurrentScroll;if(categoryLeft<categoriesLeft){scrollTo=categoriesCurrentScroll-categoriesLeft-categoryLeft}else{if(hoverControlRight>containerWidth){scrollTo=categoriesCurrentScroll+hoverControlRight-containerWidth}}if(scrollTo!=categoriesCurrentScroll){this.cats$.animate({scrollLeft:scrollTo},800,_.bind(this.enableDisableScrollArrows,this))}},_categoryNameSetEditing:function(category,isEditing){var catLabel=$(category).children(".Title").find(".sectionTitle");var catInput=catLabel.next();var catHoverControls=catInput.next();$(category).toggleClass("Renaming",isEditing);catLabel.toggle(!isEditing);catInput.toggleClass("DisplayNone",!isEditing);catInput.children("input").toggle(isEditing);if(isEditing){catHoverControls.toggle(!isEditing)}else{catHoverControls.css("display","")}$(category).css({zoom:1}).hide().show();var input=catInput.children("input");if(isEditing){input.focus().select();if(IsIE()){input.off(".navPageBar").on("selectstart.navPageBar",function(evt){evt.stopPropagation()});setTimeout(function(){input.select()},2)}if(input[0].setSelectionRange&&Modernizr.touch){input[0].setSelectionRange(0,999)}}else{if(input[0].setSelectionRange&&Modernizr.touch){window.getSelection().removeAllRanges()}catInput.blur();input.blur().off(".navPageBar");this.currGroupHeaderLabel=null;this.currGroupHeaderInput=null}},_clickOutside:function(event){var title=$(event.target).closest(".Title");var trayItem=$(event.target).closest(".TrayItem");if(title.length>0&&title.parent().is(".Category.Renaming")){return}if(trayItem.length>0&&trayItem.data("qid")==$(this.currReportLabel).closest(".TrayItem").data("qid")){return}if($(event.target).closest(".ScrollArrow").length>0){return}this._categoryNameStopEditing();this._reportNameStopEditing();this._clearHoverControls(trayItem.data("qid"))},_categoryKeyPress:function(event){var key=event.keyCode||event.which;if(key==$.ui.keyCode.ESCAPE){this._categoryNameStopEditing()}else{if(key==$.ui.keyCode.ENTER){this._onCategoryNameSave(event)}}},_categoryNameStopEditing:function(){if(this.currGroupHeaderLabel){var category=$(this.currGroupHeaderLabel).closest(".Category");if(!category){return}if(category.hasClass("PendingCreation")){this._cancelPendingGroupCreation(category)}else{this._categoryNameSetEditing(category,false)}}},_cancelPendingGroupCreation:function(category){$(this.pendingGroupReports||null).removeClass("MovePending");$(category).remove();this.$el.removeClass("HideDropZone");this.pendingGroupReports=null;this.isPendingCreateGroup=false;this.$el.removeClass("HoveringOnCreateGroup");this._hideTooltips()},_confirmPendingGroupCreation:function(category){var view=this;var input=category.find("input");var name=$.trim(input.val());if(!this.collection.isValidGroupName(name)){this._warnInvalidCategoryName(input,name);return}category.children(".Title").children(".sectionTitle").text(name);this._categoryNameSetEditing(category,false);this.isPendingCreateGroup=false;var reports=this.pendingGroupReports.detach();this.pendingGroupReports=null;reports.removeClass("MovePending");var container=category.children(".GroupContents");this._buildColumns(reports,container);this._rebalanceAllColumns();this.$el.removeClass("HideDropZone");category.removeClass("PendingCreation");this.preCacheColumnDimensions();this.options.dispatcher.trigger("refreshCollapsePersistence");this.scrollToShowGroup(category);var reportIDs=_.map(reports,function(elt){return $(elt).data("qid")});this.collection.createReportGroup(reportIDs,name,category.data("group-id")).then(function(trueID){if(!trueID){return}category.attr({id:"trayGroup_"+trueID,"data-group-id":trueID});category.data("group-id",trueID);var title=category.children(".Title");title.attr("id","trayGroupHeader_"+trueID);view._saveGroupOrder()});this._removeNonexistentGroups();this.initializeDragAndDrop();this.initializeCategoryDragAndDrop();this.normalizeColumnHeights();this.initializeColumnDroppables();this.$el.removeClass("HoveringOnCreateGroup");this._selectNone();this._hideTooltips()},_onCategoryNameSave:function(event){event.stopPropagation();event.preventDefault();var category=$(event.target).closest(".Category");this._categoryNameSave(category);return false},_warnInvalidCategoryName:function(input,name){name=name.toLowerCase();var msg="";if(name.length==0){msg="Report group names cannot be blank. Please choose another name."}else{if(name=="common"||name=="recent"||name=="mine"){msg='Report groups cannot be named "Common", "Recent", or "Mine". Please choose another name.'}else{return}}QB.Dialog.alert({title:"Invalid report group name",contents:msg,contentType:"text",confirm:{click:function(){$(this).dialog("close");input.focus().select()}}})},_warnInvalidReportName:function(input,name){QB.Dialog.alert({title:"Invalid report name",contents:"Report names cannot be blank. Please choose another name.",contentType:"text",confirm:{click:function(){$(this).dialog("close");input.focus().select()}}})},_categoryNameSave:function(category){if(category.hasClass("PendingCreation")){this._confirmPendingGroupCreation(category);return}var groupID=category.data("group-id");var input=category.find("input");var newName=$.trim(input.val());var group=this.collection.get(groupID);if(!group){return}if(this.collection.isValidGroupName(newName)&&group.changeName(newName)){category.children(".Title").children(".sectionTitle").text(newName);this._categoryNameSetEditing(category,false)}else{this._warnInvalidCategoryName(input,newName)}},_performToggle:function(event,clickTarget){var evtObj=$("#"+clickTarget);evtObj.toggleClass("Collapsed");var hoverControls=evtObj.children(".HoverControls");if(evtObj.hasClass("Collapsed")){var topPos=evtObj.children(".sectionTitle").width()+"px";if($("body").hasClass("IE8")){topPos=evtObj.children(".sectionTitle").height()+"px"}hoverControls.css({right:"-6px",top:topPos,left:"0px"})}else{hoverControls.css({top:"",right:"",left:""})}evtObj.parent().toggleClass("Collapsed");$inputElement=evtObj.find("form");if(!$inputElement.hasClass("DisplayNone")){this._categoryNameStopEditing()}this.preCacheColumnDimensions();this.normalizeCategoryHeights()},deleteReportsWithGroup:false,_deleteGroupPrompt:function(event){var view=this;var groupToDelete=$(event.target).closest(".Category");var groupID=groupToDelete.data("group-id");var groupName=null;var grp=view.collection.get(groupID);if(grp){groupName=grp.get("name")}var reportsToMove=groupToDelete.children(".GroupContents").find(".TrayItem");var deleteDialog=QB.Dialog.dialog({id:"deleteGroupConfirmationDialog",contents:ich.deleteGroupDialog({numReports:reportsToMove.length,groupName:groupName||"report",plural:reportsToMove.length==1?"":"s"}),contentType:"html",confirm:{type:"Danger",text:"Delete Group",click:function(){reportsToMove.detach();groupToDelete.remove();view.deleteReportsWithGroup=true;var deleteReports=$(this).find("input").attr("checked")=="checked";if(!deleteReports){view._moveReportsToCommonGroup(reportsToMove)}view.collection.deleteGroup(groupID,deleteReports);$(this).find("input").off();$(this).dialog("close")}},cancel:{click:function(){$(this).find("input").off();$(this).dialog("close")},text:"Cancel"},title:"Delete a group",size:400,focusedButton:null});deleteDialog=$(deleteDialog[0]);deleteDialog.find("input").on("click",function(event){var buttonText=$("#deleteGroupConfirmationDialog button.Confirm > span");var reportString="Delete Group & Report";if(reportsToMove.length!=1){reportString+="s"}if(event.target.checked){buttonText.html(reportString)}else{buttonText.html("Delete Group")}$("#deleteGroupConfirmationDialog button").hide().show()})},_moveReportsToCommonGroup:function(reportsToMove){if(reportsToMove.length>0){var commonGroup=this.cats$.children(".Category[data-group-id=0]").show().css("display","inline-block");var columnContainer=commonGroup.children(".GroupContents");var lastColumn=columnContainer.children(".Column").last();if(lastColumn.length==0){lastColumn=ich.trayList().appendTo(columnContainer)}reportsToMove.detach().appendTo(lastColumn);this._rebalanceAllColumns();this._selectNone();reportsToMove.children().css("background-color","#E2EEFC");setTimeout(function(){reportsToMove.children().css("background-color","")},2000)}},_renderTrayCategory:function(categoryObject){return ich.editTrayCategory(categoryObject)},normalizeColumnHeights:function(){var cols=this.$el.find("#pageNavReportCategories .Column");var maxColHeight=0;_.each(cols,function(el,idx,list){if($(el).height()>maxColHeight){maxColHeight=$(el).height()}});cols.css("min-height",maxColHeight+"px")},normalizeCategoryHeights:function(){var categories=this.cats$.children(".Category");var maxCatHeight=0;_.each(categories,function(el,idx){if($(el).height()>maxCatHeight){maxCatHeight=$(el).height()}});categories.css("min-height",maxCatHeight+"px")},_hideTooltips:function(){$("body > .tooltip").remove()},_hideTrayItemHovers:function(event){var item=$(event.currentTarget);item.children(".HoverControls, .DeployHovers").removeClass("Deployed")},_onReportNameFormSubmit:function(){return false}});; 
 
//@ sourceURL=/js/navRecentsFavorites.js 
var QB=QB||{};QB.Nav=QB.Nav||{};QB.Nav.Favs=QB.Nav.Favs||{};QB.Nav.Favs.maxItemNameLength=100;QB.Nav.Favs.maxFavorites=50;var gFavoritesMenuData={favorites:[],recentRecords:[],recentReports:[]};QB.Nav.Favs.ItemTypes={Report:"q",Record:"r"};QB.Nav.Favs.API={_ajax:function(dbid,act,data){return $.ajax({type:"POST",url:"/db/"+dbid+"?a="+act,data:data,dataType:"json"})},addFavorite:function(appDBID,model){var params={dbid:model.get("dbid"),type:model.get("type"),id:model.get("itemID")};return this._ajax(appDBID,"JBI_UserFavorites_Add",params)},removeFavorite:function(appDBID,model){var params={dbid:model.get("dbid"),type:model.get("type"),id:model.get("itemID")};return this._ajax(appDBID,"JBI_UserFavorites_Remove",params)},reorderFavorites:function(appDBID,itemOrder){var itemlist="";_.each(itemOrder,function(model){itemlist+=(itemlist!="")?",":"";itemlist+=model.get("dbid")+"/"+model.get("type")+model.get("itemID")});var params={order:itemlist};return this._ajax(appDBID,"JBI_UserFavorites_Reorder",params)}};QB.Nav.Favs.Item=Backbone.Model.extend({getURL:function(){switch(this.get("type")){case QB.Nav.Favs.ItemTypes.Report:return"/db/"+this.get("dbid")+"?a=q&qid="+this.get("itemID");case QB.Nav.Favs.ItemTypes.Record:return"/db/"+this.get("dbid")+"?a=dr&rid="+this.get("itemID");default:return"/db/"+this.get("dbid")}},matchesFilters:function(keywordList){if(keywordList==null){return true}if(!_.isArray(keywordList)){keywordList=[keywordList]}var name=(this.get("name")||"").toLowerCase();var tableName=(this.get("tableName")||"").toLowerCase();for(var i=0;i<keywordList.length;i++){var keyword=keywordList[i];if(!keyword){continue}if(name&&name.indexOf(keyword)>=0){continue}if(tableName&&tableName.indexOf(keyword)>=0){continue}return false}return true}});QB.Nav.Favs.ItemList=Backbone.Collection.extend({model:QB.Nav.Favs.Item});QB.Nav.Favs.CoreModel=Backbone.Model.extend({_autoFillInfo:function(itemArray,invMap){_.each(itemArray,function(item){item.id=item.dbid+"/"+item.type+item.itemID;if(invMap.hasOwnProperty(item.dbid)){item.tableName=invMap[item.dbid].name;item.tableIcon=invMap[item.dbid].icon}else{item.tableName="Unknown Table";item.tableIcon="Chat_Exclamation"}})},_normalizeInputData:function(attrs){var tableLookup={};_.each(gTablesJSON,function(table){tableLookup[table.dbid]=table});this._autoFillInfo(attrs.recentRecords,tableLookup);this._autoFillInfo(attrs.recentReports,tableLookup);this._autoFillInfo(attrs.favorites,tableLookup);delete invMap;var favLookup={};_.each(attrs.favorites,function(f){favLookup[f.dbid+"/"+f.type+f.id]=!!f.fav});_.each(attrs.recentReports,function(report){var shortID=report.dbid+"/"+report.type+report.id;report.isFavorite=favLookup.hasOwnProperty(shortID)})},initialize:function(attrs,opts){this._normalizeInputData(attrs);this.maxFavorites=opts.maxFavorites;this.appDBID=opts.appDBID;this.set("favorites",new QB.Nav.Favs.ItemList(attrs.favorites));this.set("recentRecords",new QB.Nav.Favs.ItemList(attrs.recentRecords));this.set("recentReports",new QB.Nav.Favs.ItemList(attrs.recentReports));this.set("pageModel",opts.pageModel);this._updateTooMany();this.on("favorite-add",this._onFavoriteAdd,this);this.on("favorite-remove",this._onFavoriteRemove,this);this.on("favorites-clean",this.cleanUpFavoritesSection,this);this.on("change:tooManyFavorites",this._onTooManyChanged,this);this.on("favorites-reorder",this._onFavoriteReorder,this)},_onTooManyChanged:function(){this.trigger("favorites-setdisable",this.isTooManyFavorites())},_updateTooMany:function(){var actualFavorites=this.get("favorites").where({isFavorite:true});var isTooMany=(actualFavorites.length>=this.maxFavorites);this.set("tooManyFavorites",isTooMany)},_getAll:function(id){var out=[];var item=null;item=this.get("favorites").get(id);if(item){out.push(item)}item=this.get("recentRecords").get(id);if(item){out.push(item)}item=this.get("recentReports").get(id);if(item){out.push(item)}item=this.get("pageModel");if(item&&item.id==id){out.push(item)}return out},_setAll:function(id,attr,val){var items=this._getAll(id);_.each(items,function(item){item.set(attr,val)});return items},cleanUpFavoritesSection:function(){var favs=this.get("favorites");var purged=favs.filter(function(fav){return !fav.get("isFavorite")});if(purged.length==0){return}favs.remove(purged);this._updateTooMany()},_onFavoriteRemove:function(id){var items=this._setAll(id,"isFavorite",false);this._updateTooMany();if(items.length>0){QB.Nav.Favs.API.removeFavorite(this.appDBID,items[0])}},_onFavoriteAdd:function(id,model){var existing=this.get("favorites").get(model.id);if(!existing){this.get("favorites").add(model.clone(),{at:0})}this._setAll(model.id,"isFavorite",true);this._updateTooMany();QB.Nav.Favs.API.addFavorite(this.appDBID,model)},_onFavoriteReorder:function(moveItemId,afterItemId){var favorites=this.get("favorites");var movingModel=favorites.get(moveItemId);var moveIndex=favorites.indexOf(movingModel);var models=favorites.models;models.splice(moveIndex,1);var toIndex=0;if(!_.isUndefined(afterItemId)){toIndex=favorites.indexOf(favorites.get(afterItemId))+1}models.splice(toIndex,0,movingModel);favorites.models=models;QB.Nav.Favs.API.reorderFavorites(this.appDBID,favorites.where({isFavorite:true}));this.set("favorites",favorites)},isFavorite:function(id){var fav=this.get("favorites").get(id);if(!fav){return false}return fav.get("isFavorite")},isTooManyFavorites:function(){return this.get("tooManyFavorites")}});QB.Nav.Favs.MenuView=Backbone.View.extend({events:{click:"_stopEventPropagation","click .AccordionPanel.Collapsed .Collapser":"_onAccordionExpand",qbmenuclose:"_onMenuClose",qbmenubeforeopen:"_onMenuBeforeOpen",qbmenuopen:"_onMenuOpen","keyup .FavoritesSearch":"_onFilterType","click .SearchWrapper .ClearInput":"_filterClear"},_stopEventPropagation:function(evt){if(!this.dispatcher.midMove){evt.stopPropagation()}},initialize:function(options){this.dispatcher=options.dispatcher;this.filterbox$=this.$(".FavoritesSearch").placeholder();this.filterboxClear$=this.filterbox$.siblings(".ClearInput").hide();this.header$=this.$el.children(".Header");this.$el.on("scroll",_.bind(this._pinHeader,this));this.favorites=new QB.Nav.Favs.ItemListView({el:this.$(".ItemList.Favorites"),dispatcher:this.dispatcher,collection:this.model.get("favorites"),noStarAnimation:true,maxNameLength:this.options.maxNameLength,orderable:true});this.recentRecords=new QB.Nav.Favs.ItemListView({el:this.$(".ItemList.RecentRecords"),dispatcher:this.dispatcher,collection:this.model.get("recentRecords"),noStarAnimation:true,maxNameLength:this.options.maxNameLength,orderable:false});this.recentReports=new QB.Nav.Favs.ItemListView({el:this.$(".ItemList.RecentReports"),dispatcher:this.dispatcher,collection:this.model.get("recentReports"),noStarAnimation:true,maxNameLength:this.options.maxNameLength,orderable:false});this.dispatcher.on("closemenu",this._closeMenu,this);this.model.get("recentReports").on("add remove",this._checkHasRecents,this);this.model.get("recentRecords").on("add remove",this._checkHasRecents,this);this.render();this._expandAccordion("all")},_pinHeader:function(evt){var headstyle={top:this.$el.scrollTop()+"px"};if(this.dispatcher.midMove){headstyle.position="static"}this.header$.css(headstyle)},_closeMenu:function(){if(!this.dispatcher.midMove){this.$el.qbMenu("hide")}},_onMenuBeforeOpen:function(evt){this.$el.width("").height("");this._expandAccordion("all");this.$el.width(this.$el.width())},_onMenuOpen:function(evt){this._expandAccordion(this._getLastOpenPanel());this._filterClear()},_resize:function(leaveOpen){this.$el.width("");this._expandAccordion("all");this.$el.width(this.$el.width());this._expandAccordion(this._getLastOpenPanel())},_onMenuClose:function(evt){if(!this.dispatcher.midMove){this.dispatcher.trigger("favorites-clean")}},_getNumRecents:function(){return this.model.get("recentRecords").length+this.model.get("recentReports").length},render:function(){this.$el.width("");this.favorites.render();this.recentRecords.render();this.recentReports.render();this._checkHasRecents();this._resize();this._expandAccordion(this._getLastOpenPanel(),false);return this},_onAccordionExpand:function(evt){var panel=$(evt.currentTarget).closest(".AccordionPanel");var index=this.$el.children(".AccordionPanel").index(panel);this._expandAccordion(index,true)},_getLastOpenPanel:function(){return QB.Storage.Global.get("favoritesMenuLastOpenPanel")||0},_setLastOpenPanel:function(index){QB.Storage.Global.set("favoritesMenuLastOpenPanel",index||0)},_expandAccordion:function(index,animate){var panels=this.$el.children(".AccordionPanel");if(index==="all"){var openingPanels=panels.removeClass("Collapsed")}else{var openingPanels=panels.eq(index).removeClass("Collapsed")}var closingPanels=panels.not(openingPanels).addClass("Collapsed");if(animate){closingPanels.children(".AccordionContents").slideUp();openingPanels.children(".AccordionContents").slideDown()}else{closingPanels.children(".AccordionContents").hide();openingPanels.children(".AccordionContents").show()}if(!$(document.body).hasClass("IE8")){var searchText=openingPanels.data("searchbox-text")||"";if(searchText){this.filterbox$.attr("placeholder",searchText)}}if(index!=="all"){this._setLastOpenPanel(index)}},_checkHasRecents:function(){var isEmpty=(this._getNumRecents()==0);this.$(".EmptyMessage.Recents").toggle(isEmpty).siblings().toggle(!isEmpty)},_onFilterType:_.throttle(function(evt){var text=this.filterbox$.val()||"";this.filterbox$.toggleClass("Empty",text.length==0);this.filterboxClear$.toggle(text.length>0);var parts=text.toLowerCase().split(" ");var keywords=_.filter(parts,function(p){return !!p});this.filter(keywords)},IsIE()?250:100),_filterClear:function(evt){this.filterboxClear$.hide();this.filterbox$.addClass("Empty").val("");if(!Modernizr.touch){this.filterbox$.focus()}this.filter(null)},filter:function(keywords){this.favorites.filter(keywords);this.recentRecords.filter(keywords);this.recentReports.filter(keywords);this._pinHeader()}});QB.Nav.Favs.ItemListView=Backbone.View.extend({disableNewFavorites:false,subviews:{},events:{"click a[href]":"_closeMenu","click .Icon.Favorite":"_toggleFavorite"},_closeMenu:function(evt){if($(evt.target).hasClass("Icon Favorite")){return}if(this.dispatcher.midMove){return}this.dispatcher.trigger("closemenu")},_toggleFavorite:function(evt){if(this.dispatcher.midMove){return}evt.stopImmediatePropagation();evt.preventDefault();var star=$(evt.currentTarget);var id=star.closest(".Item").attr("data-short-id");if(star.hasClass("Favorited")){this.dispatcher.trigger("favorite-remove",id)}else{if(star.hasClass("Disabled")){}else{if(!this.options.noStarAnimation){QB.Nav.Fav.animateStar(star)}var model=this.collection.get(id);if(model){this.dispatcher.trigger("favorite-add",model.id,model)}}}},initialize:function(options){this.dispatcher=options.dispatcher;this.disableNewFavorites=this.dispatcher.isTooManyFavorites();this.dispatcher.on("favorites-setdisable",this._setDisableNewFavorites,this);this.subviews={};this.collection.on("add",this._onModelAdded,this);this.collection.on("change",this._onModelChanged,this);this.collection.on("remove",this._onModelRemoved,this);this.dispatcher.midMove=false;if(this.options.orderable){this._initOrderable()}},_getStarIconClass:function(item){if(!item.get("canFavorite")){return"Blank"}if(item.get("isFavorite")){return"Favorite Favorited"}if(this.disableNewFavorites){return"Favorite Disabled"}return"Favorite Unfavorited"},_getStarHoverText:function(item){if(!item.get("canFavorite")){return""}if(item.get("isFavorite")){return"Unfavorite this report"}if(this.disableNewFavorites){return"Please unfavorite some reports before favoriting more reports"}return"Favorite this report"},_getItemIconClass:function(item){switch(item.get("type")){case QB.Nav.Favs.ItemTypes.Report:return"Report-"+(item.get("reportType")||"Table");case QB.Nav.Favs.ItemTypes.Record:return"Table-Icon";default:return""}},_getIncludeTableIcon:function(item){return item.get("type")==QB.Nav.Favs.ItemTypes.Record},_getObjectForTemplate:function(item){var obj=item.toJSON();var trackFav=this.$el.hasClass("Favorites")?"&NavFrom=Favs":"&NavFrom=Recents";obj.url=item.getURL()+trackFav;obj.starTooltip=this._getStarHoverText(item);obj.starIconClass=this._getStarIconClass(item);obj.itemIconClass=this._getItemIconClass(item);obj.includeTableIcon=this._getIncludeTableIcon(item);var maxNameLength=this.options.maxNameLength||0;if(maxNameLength&&obj.name.length>=maxNameLength){var name=obj.name;obj.name=name.substring(0,maxNameLength)+"...";if(name.length>1024){name=name.substring(0,1024)+"..."}obj.untruncatedName=name}return obj},_renderItem:function(item){var obj=this._getObjectForTemplate(item);var elt=ich.favMenuItem(obj);if(obj.hasOwnProperty("untruncatedName")){elt.find(".ItemName").addClass("Tipsified").tooltip({html:false,title:obj.untruncatedName})}return elt},render:function(){var view=this;this.$el.empty();this.subviews={};this.collection.each(function(item){var elt=view._renderItem(item);view.subviews[item.id]=elt;view.$el.append(elt)});this._updateMessage();return this},_updateMessage:function(optionalClassIfNotEmpty){var optionalClassIfNotEmpty=optionalClassIfNotEmpty||null;var isEmpty=(this.collection.length==0);this._showMessage(isEmpty?".NoItems":optionalClassIfNotEmpty)},_showMessage:function(messageType){var showMessage=(messageType!=null);var messageContainer=this.$el.next(".EmptyMessage");this.$el.toggle(!showMessage);messageContainer.toggle(showMessage);if(showMessage){messageContainer.children().hide().filter(messageType).show()}},_updateSubView:function(model){if(!this.subviews.hasOwnProperty(model.id)){return false}var oldElt=this.subviews[model.id];var newElt=this._renderItem(model);this.subviews[model.id]=newElt;$(oldElt).find(".Tipsified").tooltip("hide").tooltip("disable");$(oldElt).replaceWith(newElt).remove();delete oldElt},_removeSubView:function(id){if(!this.subviews.hasOwnProperty(id)){return false}var oldElt=this.subviews[id];delete this.subviews[id];$(oldElt).remove();delete oldElt},_onModelChanged:function(model,info){this._updateSubView(model)},_onModelAdded:function(model,collection,args){var index=args.index||0;this._removeSubView(model.id);var newElt=this._renderItem(model);this.subviews[model.id]=newElt;if(index==0){this.$el.prepend(newElt)}else{var children=this.$el.children();if(index>children.length){this.$el.append(newElt)}else{$(newElt).insertAfter(children.eq(index-1))}}this._refilter()},_onModelRemoved:function(model,collection,options){if(!model||!model.id){return}this._removeSubView(model.id);this._refilter()},_currentFilters:null,filter:function(keywordList){var view=this;var numMatches=0;this._currentFilters=keywordList;this.collection.each(function(item){var matches=item.matchesFilters(keywordList);if(matches){++numMatches}if(view.subviews.hasOwnProperty(item.id)){$(view.subviews[item.id]).toggleClass("DisplayNone",!matches)}});this._updateMessage(numMatches==0?".NoneMatchSearch":null);this._setOrderingEnabledDisabled()},_refilter:function(){this.filter(this._currentFilters||null)},_setDisableNewFavorites:function(disableNew){this.disableNewFavorites=disableNew;this._updateIcons()},_updateIcons:function(){var view=this;this.collection.each(function(item){if(!view.subviews.hasOwnProperty(item.id)){return}var subview=$(view.subviews[item.id]);var icon=subview.children(".Icon.StarIcon");var iconClass=view._getStarIconClass(item);var iconHover=view._getStarHoverText(item);icon.removeClass("Blank Favorite Favorited Unfavorited Disabled").addClass(iconClass);icon.attr("data-original-title",iconHover)})},_initOrderable:function(){var view=this;_.defer(function(){var dndOptions={items:".Item",distance:5,axis:"y",scroll:true,tolerance:"pointer",cursor:"n-resize",containment:view.el,start:_.bind(view._onReorderStart,view),stop:_.bind(view._onReorderStop,view),update:_.bind(view._onReorderUpdate,view)};if(!$(document.body).hasClass("IE8")){dndOptions.placeholder="ui-state-highlight"}$(view.el).sortable(dndOptions);view._setOrderingEnabledDisabled()})},_setOrderingEnabledDisabled:function(){if(this.options.orderable){var orderingOK=$(this.el).find(".Item:not(.DisplayNone)").length>1;$(this.el).sortable("option","disabled",!orderingOK)}},_onReorderStart:function(evt,ui){this.dispatcher.midMove=true;var movingItem=ui.item;movingItem.addClass("FavMoving")},_onReorderStop:function(evt,ui){var view=this;var movedItem=ui.item;movedItem.removeClass("FavMoving");_.defer(function(){view.dispatcher.midMove=false})},_onReorderUpdate:function(evt,ui){var view=this;view.dispatcher.midMove=true;var movedItem=ui.item;var movedId=movedItem.data("shortId");var prevItem=movedItem.prev();var prevId=undefined;if(prevItem.length){prevId=prevItem.data("shortId")}this.dispatcher.trigger("favorites-reorder",movedId,prevId);_.defer(function(){view.dispatcher.midMove=false})}});QB.Nav.Favs.PageBarButton=Backbone.View.extend({tooManyFavorites:false,canFavoritePageReport:true,initialize:function(options){this.dispatcher=options.dispatcher;this.tooManyFavorites=this.dispatcher.isTooManyFavorites();this.dispatcher.on("favorites-setdisable",this._setTooManyFavorites,this);this.$icon=this.$el.children(".ActionIconSprite");this.model.on("change",this._rerender,this);this._rerender()},events:{click:"_onClick","favoriting-disable":"_onDisable","favoriting-enable":"_onEnable"},_setTooManyFavorites:function(isDisabled){this.tooManyFavorites=!!isDisabled;this._rerender()},_onDisable:function(){this.canFavoritePageReport=false;this._rerender()},_onEnable:function(){this.canFavoritePageReport=true;this._rerender()},_rerender:function(){this._setIsFavorite(!!this.model.get("isFavorite"))},_setIsFavorite:function(isFavorite){var message=null,cssClass=null,isDisabled=false;if(!this.canFavoritePageReport){message="Please save this report before favoriting it";cssClass="FavoriteDisabled";isDisabled=true}else{if(isFavorite){message="Unfavorite this report";cssClass="Favorited"}else{if(this.tooManyFavorites){message="Please unfavorite some reports before favoriting more reports";cssClass="FavoriteDisabled";isDisabled=true}else{message="Favorite this report";cssClass="Favoritable"}}}this.$el.attr("data-original-title",message);this.$el.toggleClass("Disabled",isDisabled);this.$icon.removeClass("Favorited Favoritable FavoriteDisabled").addClass(cssClass)},_onClick:function(evt){if(!this.canFavoritePageReport){}else{if(this.model.get("isFavorite")){this.dispatcher.trigger("favorite-remove",this.model.id);this.dispatcher.trigger("favorites-clean")}else{if(this.tooManyFavorites){}else{QB.Nav.Favs.animateStar(this.$icon);this.dispatcher.trigger("favorite-add",this.model.id,this.model)}}}}});QB.Nav.Favs.initModel=function(){if(!!this.model){return false}this.pageModel=this.getFakeModelFromPage();this.model=new this.CoreModel(gFavoritesMenuData,{pageModel:this.pageModel,maxFavorites:this.maxFavorites,appDBID:gReqAppDBID});if(this.pageModel){this.pageModel.set("isFavorite",this.model.isFavorite(this.pageModel.id))}return true};QB.Nav.Favs.getFakeModelFromPage=function(){var data={dbid:gReqDBID,canFavorite:true,isFavorite:false};if(window.gReqQID){data.type="q";data.reportType=gReqQType;data.itemID=gReqQID;data.name=gReqQName}else{return null}data.tableName="Unknown Table";data.tableIcon="Chat_Exclamation";data.id=data.dbid+"/"+data.type+data.itemID;var table=_.find(gTablesJSON,function(tbl){return tbl.dbid==data.dbid});if(table){data.tableName=table.name;data.tableIcon=table.icon}return new this.Item(data)};QB.Nav.Favs.animateStar=function(originElt){var originPos=$(originElt).offset();var originCss={top:originPos.top+"px",left:originPos.left+"px"};var destElt=$("#favoritesButton").children().children(".BrandBarIcon");var destPos=$(destElt).offset();if(destPos.top<-20){destPos.top=-20}var destCss={top:destPos.top+"px",left:destPos.left+"px"};var star=$('<div class="Icon Favorite Favorited AnimationStar"></div>');star.css(originCss);star.appendTo(document.body);var isIE8=$(document.body).hasClass("IE8");if(isIE8){star.show();star.animate(destCss,{duration:1000,queue:true,easing:"easeInOutQuad",complete:function(){setTimeout(function(){star.stop().remove()},500)}})}else{star.animate(destCss,{duration:1000,queue:true,easing:"easeInOutQuad"});star.delay(500);star.fadeOut({duration:500,queue:true,complete:function(){star.stop().remove()}})}};QB.Nav.Favs.initHandlers=function(){var favs=this;$("#favoritesMenu").one("qbmenubeforeopen.favorites-menu",function(evt){favs.initModel();favs.menu=new favs.MenuView({dispatcher:favs.model,model:favs.model,el:$("#favoritesMenu"),maxNameLength:favs.maxItemNameLength})});var favoriteButton=$("#favoriteThisAction");if(favoriteButton.length){this.initModel();this.pageBar=new this.PageBarButton({dispatcher:this.model,model:this.pageModel,el:favoriteButton})}};; 
 
//@ sourceURL=/js/supportUtils.js 
function openSupportURL(urlparams){var supportURL="http://quickbase.intuit.com/support/portal/#"+Base64.encode("realm="+window.location.hostname+"&"+urlparams);window.open(supportURL)}function openNewSupportSubmitURL(urlparams){var supportURL="/qb/support/NewCase?"+urlparams;window.open(supportURL)}var Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(input){var output="";var chr1,chr2,chr3,enc1,enc2,enc3,enc4;var i=0;input=Base64._utf8_encode(input);while(i<input.length){chr1=input.charCodeAt(i++);chr2=input.charCodeAt(i++);chr3=input.charCodeAt(i++);enc1=chr1>>2;enc2=((chr1&3)<<4)|(chr2>>4);enc3=((chr2&15)<<2)|(chr3>>6);enc4=chr3&63;if(isNaN(chr2)){enc3=enc4=64}else{if(isNaN(chr3)){enc4=64}}output=output+this._keyStr.charAt(enc1)+this._keyStr.charAt(enc2)+this._keyStr.charAt(enc3)+this._keyStr.charAt(enc4)}return output},_utf8_encode:function(string){string=string.replace(/\r\n/g,"\n");var utftext="";for(var n=0;n<string.length;n++){var c=string.charCodeAt(n);if(c<128){utftext+=String.fromCharCode(c)}else{if((c>127)&&(c<2048)){utftext+=String.fromCharCode((c>>6)|192);utftext+=String.fromCharCode((c&63)|128)}else{utftext+=String.fromCharCode((c>>12)|224);utftext+=String.fromCharCode(((c>>6)&63)|128);utftext+=String.fromCharCode((c&63)|128)}}}return utftext}};; 
 
//@ sourceURL=/js/analytics.js 
var IsGoogleAnalyticsEnabled=false;var AreWalkMeTutorialsEnabled=false;var IsAutotestEnabled=false;var isInTrial=false;var trackToLog=true;var GoogleAnalyticsTracker;var gGAAccountID="";var nonProd=true;var GoogleAnalyticsVarScope={visitor:1,session:2,page:3};function GetAndSetupGATracker(){if(!IsGoogleAnalyticsEnabled){return false}GoogleAnalyticsTracker=window._gaq||(window._gaq=[]);GoogleAnalyticsTracker.push(["_setAccount",gGAAccountID]);GoogleAnalyticsTracker.push(["_setDomainName","none"]);GoogleAnalyticsTracker.push(["_setAllowLinker",true]);if(nonProd){GoogleAnalyticsTracker.push(["_setSiteSpeedSampleRate",100])}GoogleAnalyticsTracker.push(["_setCustomVar",4,"trialer",isInTrial?"true":"false",GoogleAnalyticsVarScope.session]);GoogleAnalyticsTracker.push(["_setCustomVar",5,"uxv","2",GoogleAnalyticsVarScope.page]);return true}var PageCodes={"/Prod/AppCreate":1,"/Prod/AppCreate/FromScratch":2,"/Prod/AppCreate/FromScratch/Database":3,"/Prod/AppCreate/FromScratch/Database/AddRelationship":4,"/Prod/AppCreate/FromScratch/Database/AddTable":5,"/Prod/AppCreate/FromScratch/Database/AppCreateError":6,"/Prod/AppCreate/FromScratch/Database/AppCreated":7,"/Prod/AppCreate/FromScratch/Database/CancelFieldTypes":8,"/Prod/AppCreate/FromScratch/Database/ConfirmFieldTypes":9,"/Prod/AppCreate/FromScratch/Database/Create":10,"/Prod/AppCreate/FromScratch/Database/DefineFieldTypes":11,"/Prod/AppCreate/FromScratch/Database/InvalidFieldTypes":12,"/Prod/AppCreate/FromScratch/Database/RemoveRelationship":13,"/Prod/AppCreate/FromScratch/Database/RemoveTable":14,"/Prod/AppCreate/FromScratch/Spreadsheet":15,"/Prod/AppCreate/FromScratch/Spreadsheet/AppCreateError":16,"/Prod/AppCreate/FromScratch/Spreadsheet/AppCreated":17,"/Prod/AppCreate/FromScratch/Spreadsheet/CancelEmptySheet":18,"/Prod/AppCreate/FromScratch/Spreadsheet/CancelFieldTypes":19,"/Prod/AppCreate/FromScratch/Spreadsheet/ConfirmEmptySheet":20,"/Prod/AppCreate/FromScratch/Spreadsheet/ConfirmFieldTypes":21,"/Prod/AppCreate/GoToApp":22,"/Prod/AppCreate/Import":23,"/Prod/AppCreate/Import/copyPaste":24,"/Prod/AppCreate/Import/copyPaste/Next":25,"/Prod/AppCreate/Import/fromFile":26,"/Prod/AppCreate/Import/fromFile/Next":27,"/Prod/AppCreate/ImportStep2/Cancel":28,"/Prod/AppCreate/ImportStep2/Create":29,"/Prod/AppCreate/ImportStep2/NameDialogCancel":30,"/Prod/AppCreate/ImportStep2/NameDialogCreate":31,"/Prod/AppCreate/ReturnToMyQB":32,"/Prod/AppCreate/Templates":33,"/Prod/AppCreate/Templates/AppLibSubmit":34,"/Prod/AppCreate/Templates/Category":35,"/Prod/AppCreate/Templates/Filter/Featured":36,"/Prod/AppCreate/Templates/Filter/From_Intuit_QuickBase":37,"/Prod/AppCreate/Templates/Filter/From_Community":38,"/Prod/AppCreate/Templates/GetItNow":39,"/Prod/AppCreate/Templates/GetItNow/NameDialogCancel":40,"/Prod/AppCreate/Templates/GetItNow/NameDialogCreate":41,"/Prod/AppCreate/Templates/Search":42,"/Prod/AppCreate/Templates/Sort/date":43,"/Prod/AppCreate/Templates/Sort/installs":44,"/Prod/AppCreate/Templates/Sort/name":45,"/Prod/AppCreate/Templates/Sort/premier":46,"/Prod/AppMenus/Users/ShareWithANewUser":47,"/Prod/AppMenus/Users/ImportUsers":48,"/Prod/AccountUsers/GrantCreatePerms":49,"/Prod/AccountUsers/GrantCreatePerms/Grant":50,"/Prod/AccountUsers/GrantCreatePerms/Cancel":51,"/Prod/CustomizeTables/ShowVerboseWodinMessage":52,"/Prod/ListFields/XanaduAnnounceHelpLink":53,"/Prod/CopyMasterDetailSetup":54,"/Prod/CopyMasterDetailSetup/FieldCreated":55,"/Prod/AppMenus/Help/PartnerLink":56,"/Prod/AppSiteMap/PartnerLink":57,"/Prod/DashGetStarted/SelectTemplate":58,"/Prod/DashGetStarted/CustomizeFieldsForms":59,"/Prod/DashGetStarted/AddRecord":60,"/Prod/DashGetStarted/InviteCoworker":61,"/Prod/DashGetStarted/ContactUs":62,"/Prod/DashGetStarted/ViewGetStartVideo":63,"/Prod/DashGetStarted/ViewGetStartedGuide":64,"/Prod/DashGetStarted/ViewAboutQuickBase":65,"/Prod/VerificationRequiredDialog/Share":66,"/Prod/VerificationRequiredDialog/EditProfile":67,"/Prod/VerificationRequiredDialog/UserManagement":68,"/Prod/VerificationRequiredDialog/CreateNotification":69,"/Prod/VerificationRequiredDialog/CreateReminder":70,"/Prod/VerificationRequiredDialog/SubscribeToReport":71,"/Prod/VerificationRequiredDialog/EmailReport":72,"/Prod/VerificationRequiredDialog/EmailRecord":73,"/Prod/VerificationRequiredDialog/CreateEmail":74,"/Prod/VerificationRequiredDialog/CopyEmail":75,"/Prod/VerificationRequiredDialog/EditEmail":76,"/Prod/VerificationRequiredDialog/SubscribeFromNewsLinks":77,"/Prod/VerificationRequiredDialog/ManageAccount":78,"/Prod/VerificationRequiredDialog/SubscribeFromFooter":79,"/Prod/VerificationRequiredDialog/CreateSubscription":80,"/Prod/QuickTour/AppWelcome1":81,"/Prod/QuickTour/AppWelcome2":82,"/Prod/QuickTour/AppWelcome3":83,"/Prod/QuickTour/AppWelcome4":84,"/Prod/QuickTour/AppWelcome5":85,"/Prod/TableCentral/Fields/Tab":86,"/Prod/TableCentral/Fields/Search":87,"/Prod/TableCentral/Fields/ClearSearch":88,"/Prod/TableCentral/Fields/Filter":89,"/Prod/TableCentral/Fields/SortCol":90,"/Prod/TableCentral/Fields/ReturnFldOrder":91,"/Prod/TableCentral/Fields/AdvOpt":92,"/Prod/AppCentral/Pages/Tab":93,"/Prod/AppCentral/Pages/Search":94,"/Prod/AppCentral/Pages/ClearSearch":95,"/Prod/AppCentral/Pages/SortCol":96,"/Prod/AddUserToApp":97,"/Prod/TableCreate":98,"/Prod/TableCentral/Fields/Add":99,"/Prod/ReportTray/Open":100,"/Prod/TableDashboard/Filter":101,"/Prod/TableDashboard/Search":102,"/Prod/TableDashboard/Save":103,"/Prod/ProfileView/Preference/Density":104,"/Prod//DynamicFilters/ShowMigrationBanner":105,"/Prod//DynamicFilters/SetReportsAll":106,"/Prod/PMWizard/OnLoad":107,"/Prod/PMWizard/GuideMeClicked":108,"/Prod/PMWizard/ViewAllTemplates":109,"/Prod/PMWizard/BuildFromScratch":110,"/Prod/PMWizard/ImportSpreadsheet":111,"/Prod/PMWizard/AppTemplateClicked":112,"/Prod/AdvancedDashboard/AddWidget/Sidebar":113,"/Prod/AdvancedDashboard/AddWidget/MainLayout":114,"/Prod/AdvancedDashboard/DeleteWidget":115,"/Prod/AdvancedDashboard/CollapseWidget":116,"/Prod/AdvancedDashboard/FullScreenWidget":117,"/Prod/AdvancedDashboard/WidgetUrlHost":118,"/Prod/Exchange/QSP":119,"/Prod/PnPUpgrade/Clicked/AppCustomizeRoles/Settings":120,"/Prod/PnPUpgrade/Clicked/AppCustomizeRoles/Nav":121,"/Prod/PnPUpgrade/Clicked/AppCustomizeRoles/Users":122,"/Prod/PnPUpgrade/Clicked/AppCustomizePages/Settings":123,"/Prod/PnPUpgrade/Clicked/AppCustomizePages/Nav":124,"/Prod/PnPUpgrade/Clicked/AppSettingsBanner":125,"/Prod/PnPUpgrade/Clicked/DynamicFormRules/Settings":126,"/Prod/PnPUpgrade/Clicked/DynamicFormRules/Nav":127,"/Prod/PnPUpgrade/Clicked/DynamicFormRules/Tab":128,"/Prod/PnPUpgrade/Clicked/TableAccessByRoles/Settings":129,"/Prod/PnPUpgrade/Clicked/TableAccessByRoles/Nav":130,"/Prod/PnPUpgrade/Clicked/TableSettingsBanner":131,"/Prod/PnPUpgrade/Clicked/MarketplaceApp":132,"/Prod/PnPUpgrade/EmailDialog":133,"/Prod/PnPUpgrade/EmailDialog/EmailSent":134,"/Prod/PnPUpgrade/EnableTrialDialog":135,"/Prod/PnPUpgrade/EnableTrialDialog/TrialEnabled":136,"/Prod/PnPUpgrade/BillingPage":137,"/Prod/PnPUpgrade/DowngradeTrial/CSR":138,"/Prod/PnPUpgrade/UpgradeTrial/CSR":139,"/Prod/PnPUpgrade/UpgradeTrial/User":140,"/Prod/PnPUpgrade/EnableTrialDialog/LearnLink":141};var GoalCodes=[];GoalCodes[PageCodes["/Prod/AppCreate/ReturnToMyQB"]]="appcreate";GoalCodes[PageCodes["/Prod/AppCreate/GoToApp"]]="appcreate";function QBPgCode(trackitem){result=0;if(PageCodes.hasOwnProperty(trackitem)){result=PageCodes[trackitem]}return result}function QBlogtrack(lg,skipLogToSBServer){if(typeof skipLogToSBServer!="boolean"){skipLogToSBServer=false}if(trackToLog&&lg){var trackitem=lg;var extra="";var details=lg.indexOf("?");if(details!=-1){trackitem=lg.substring(0,details);extra=lg.substring(details+1).replace(/&/g,"~~")}GoogleAnalyticsTracker.push(["_setCustomVar",2,"viewed",trackitem+(extra.length?"~~"+extra:""),GoogleAnalyticsVarScope.page]);var code=QBPgCode(trackitem);if(GoalCodes[code]!==undefined){GoogleAnalyticsTracker.push(["_setCustomVar",3,"completed",GoalCodes[code],GoogleAnalyticsVarScope.session])}if(skipLogToSBServer){return}var Xtparam="&Xt="+extra;var isapinfo="&isapinfo=ga."+code;$.ajax({url:"main?a=QBI_logtrack&lg="+lg+isapinfo+Xtparam,success:function(html){},error:function(err){}})}}function QBTrackPageviewAndEvent(pg,category,action,optLabel,optValue){QBTrackPageView(pg);QBTrackEvent(category,action,optLabel,optValue)}function QBTrackPageView(pg,skipLogToSBServer){if(typeof skipLogToSBServer!="boolean"){skipLogToSBServer=false}if(GetAndSetupGATracker()){if(pg&&pg[0]!="/"){pg=pg.replace(/ /gi,"_");pg="/Prod/"+pg}QBlogtrack(pg||window.location.href,skipLogToSBServer);GoogleAnalyticsTracker.push(["_trackPageview",pg])}}function QBTrackEvent(category,action,optLabel,optValue){if(GetAndSetupGATracker()){if(typeof(optLabel)=="undefined"){GoogleAnalyticsTracker.push(["_trackEvent",category,action])}else{GoogleAnalyticsTracker.push(["_trackEvent",category,action,optLabel,optValue])}}}function QBTrackTiming(category,variable,time,opt_label,opt_sample){if(GetAndSetupGATracker()){var hourInMillis=1000*60*60;if(0<time&&time<hourInMillis){var params=["_trackTiming",category,variable,time];if(opt_label){params.push(opt_label)}if(opt_sample){params.push(opt_sample)}GoogleAnalyticsTracker.push(params)}}}function setupGATrackAndCallback(jsStatement,pg,category,action,optLabel,optValue){var evt=category||false;if(!evt){QBTrackPageView(pg)}else{QBTrackPageviewAndEvent(pg,category,action,optLabel,optValue)}setTimeout(jsStatement,300)}function readCookieGoogle(name){var nameEQ=name+"=";var ca=document.cookie.split(";");for(var i=0;i<ca.length;i++){var c=ca[i];while(c.charAt(0)==" "){c=c.substring(1,c.length)}if(c.indexOf(nameEQ)==0){return c.substring(nameEQ.length,c.length)}}return null}jQuery.cachedScript=function(url,options){options=$.extend(options||{},{dataType:"script",cache:true,url:url});return jQuery.ajax(options)};function loadGoogleAnalytics(){if(typeof(_gat)!="object"){var gasrc="https://ssl.google-analytics.com/ga.js";if(!_.isUndefined(window.pm.getUrlVar("debugga"))){gasrc="https://ssl.google-analytics.com/u/ga_debug.js"}$.cachedScript(gasrc,{async:true})}}function GoogleAnalytics_Run(){if(GetAndSetupGATracker()){var GoogleAnalyticsPageURL="";var action="";var reqlevel="main";if(window.location.pathname!="/db/main"){reqlevel="_dbid_"}action=window.pm.getUrlVar("a");if(_.isUndefined(action)||action.length==0){action=window.pm.getUrlVar("act")}if(_.isUndefined(action)||action.length==0){action="dashboard"}GoogleAnalyticsPageURL="/db/"+reqlevel+"/"+action.toLowerCase();if($("title:contains('QuickBase Error')").length){GoogleAnalyticsPageURL+="/QBError"}GoogleAnalyticsTracker.push(["_trackPageview",GoogleAnalyticsPageURL]);pagecount=readCookieGoogle("__utmb");if(pagecount&&pagecount.match(/^[0-9]*\.1/)){customer=readCookieGoogle("luid");if(customer){GoogleAnalyticsTracker.push(["_setVar","Customer"])}else{GoogleAnalyticsTracker.push(["_setVar","Prospect"])}}}}function loadUserVoice(uvjs){var uv=document.createElement("script");uv.type="text/javascript";uv.async=true;uv.src=("https:"==document.location.protocol?"https://":"http://")+"widget.uservoice.com/"+uvjs;var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(uv,s)}function GetUserVoiceToken(){var jax=new jaxreq("main?a=QBI_GetUserVoiceTicket");jax.DoSyncCmd();if(jax.success){return encodeURIComponent(jax.GetValue("uservoiceTicket"))}else{doErrorDialog("There was an error in connecting to user voice. <br /><br />Error Details:<br />"+(jax.errdetails?jax.errdetails:jax.errtext))}}function ShowUserVoiceTab(){var x=GetUserVoiceToken();if(x){UserVoice.showPopupWidget({sso:x})}}$(function(){$("#userVoiceLink").click(ShowUserVoiceTab)});function SetupWalkMeTutorialScript(){var urlWalkme="https://d3b3ehuo35wzeh.cloudfront.net/users/6baf694b622440d7b067d959d3d19879/walkme_6baf694b622440d7b067d959d3d19879_https.js";var debug=IsAutotestEnabled||debugOnly;if(debug){urlWalkme="https://d3b3ehuo35wzeh.cloudfront.net/users/6baf694b622440d7b067d959d3d19879/test/walkme_6baf694b622440d7b067d959d3d19879_https.js"}var walkme=document.createElement("script");walkme.type="text/javascript";walkme.async=true;walkme.src=urlWalkme;var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(walkme,s)}function Timeline(timelineElement,events){this.events=events;this.timelineElement=timelineElement;this.minTime=Number.MAX_VALUE;this.maxTime=Number.MIN_VALUE;for(var i=0;i!=events.length;++i){var time=events[i].time;if(time>this.maxTime){this.maxTime=time}if(time<this.minTime){this.minTime=time}}this.backgroundColor="rgba(255, 0, 0, 0.05)";this.border="1px solid rgba(255, 0, 0, 0.2)";this.borderRadius="8px 8px 8px 8px";this.fontFamily="monospace";this.numTicks=5;this.padding=20;this.width=708;this.eventBorderLeftColor="rgba(255, 0, 0, 0.2)";this.eventBorderLeftStyle="solid";this.eventBorderLeftWidth=2;this.eventColor="#000";this.eventMargin=5;this.eventPadding=5;this.eventWidth=220;this.combineEvents=true;$(timelineElement).css({"background-color":this.backgroundColor,border:this.border,"border-radius":this.borderRadius,"font-family":this.fontFamily,padding:this.padding+"px",width:this.width+"px"})}Timeline.prototype={draw:function(){var i;for(i=0;i!=this.events.length;++i){var event=this.events[i];var eventDiv=$("<div />");eventDiv.append(event.eventName);var left=(event.time/this.maxTime)*(this.width-this.eventWidth-this.eventPadding-this.eventBorderLeftWidth);eventDiv.css({"border-left-color":this.eventBorderLeftColor,"border-left-style":this.eventBorderLeftStyle,"border-left-width":this.eventBorderLeftWidth+"px",color:this.eventColor,cursor:"pointer",left:left,"margin-bottom":this.eventMargin+"px","padding-left":this.eventPadding+"px",position:"relative",width:this.eventWidth+"px"});eventDiv.attr({title:event.time+"ms"});$(this.timelineElement).append(eventDiv)}var xAxisDiv=$("<div />");xAxisDiv.css({"border-top":"1px solid #ccc"});$(this.timeElement).append(xAxisDiv)}};var gorderedEventNames=["navigationStart","unloadEventStart","unloadEventEnd","redirectStart","redirectEnd","fetchStart","domainLookupStart","domainLookupEnd","connectStart","connectEnd","secureConnectionStart","requestStart","responseStart","responseEnd","domLoading","domInteractive","domContentLoadedEventStart","domContentLoadedEventEnd","domComplete","loadEventStart","loadEventEnd"];var html5perf=((typeof(window.performance)!=="undefined"&&typeof(window.performance.timing)!=="undefined"));function writeTimeline(timing){var events=[];var nonEvents=[];var minTime=Number.MAX_VALUE;for(eventName in timing){var time=parseInt(timing[eventName]);if(time===0){nonEvents.push(eventName)}else{if(eventName!=="toJSON"){events.push({eventName:eventName,time:time});if(time<minTime){minTime=time}}}}for(var i=0;i!=events.length;++i){events[i].time-=minTime}var orderedEventNames=gorderedEventNames;events.sort(function(a,b){if(a.time!==b.time){return a.time-b.time}else{return _.indexOf(orderedEventNames,a.eventName)-_.indexOf(orderedEventNames,b.eventName)}});var loadtimes="";_.each(events,function(item){var value=item.time;var name=item.eventName;var tm=""+((value/1000)+"s");if(value==0){tm=0}loadtimes+=("<tr><td><pre>"+name+":<pre></td><td><pre>"+tm+"</pre></td></tr>")});loadtimes='<pre><table id=clientPerfTimes cellspacing="0" cellpadding="4" border="0"><tbody>'+loadtimes+"</tbody></table></pre>";var outputElt$=$("#debugClientPerf");outputElt$.append(loadtimes);if(!html5perf){return}var timelineElement=document.querySelector("#timelinePerf");$(timelineElement).empty();var timelineObject=new Timeline(timelineElement,events);timelineObject.draw();var xAxisDiv=$("<div />");xAxisDiv.css({"border-top":"1px solid rgba(255, 0, 0, 0.4)",height:"40px",margin:"10px 0 20px 0",position:"relative"});var tickDivWidth=100;var tickDivCss={color:"rgba(255, 0, 0, 0.4)",position:"absolute","text-align":"center",top:"-3px",width:tickDivWidth+"px"};var zeroTickDiv=$("<div>|<br />0</div>").css(tickDivCss).css({left:-tickDivWidth/2});var maxTickDivLeft=timelineObject.width-timelineObject.eventWidth-timelineObject.eventPadding-timelineObject.eventBorderLeftWidth-(tickDivWidth/2)+1;var maxTickDiv=$("<div>|<br />"+timelineObject.maxTime+"ms</div>").css(tickDivCss).css({left:maxTickDivLeft});xAxisDiv.append(zeroTickDiv).append(maxTickDiv);$(timelineElement).append(xAxisDiv);$(timelineElement).append("<div id='nonEvents'>The following events did not occur:<br/>- "+nonEvents.join("<br />- ")+"</div>")}function writePerfTimeStats(w){if(perfTime){var alltimes=perfTime;if(html5perf){alltimes=_.extend(alltimes,performance.timing)}writeTimeline(alltimes)}}function writeDynamicTimeElements(){var docready=perfTime.InlineJsjQueryReady-perfTime.InlineJsPageTop;var windowload=perfTime.StdLoadProcStart-perfTime.InlineJsPageTop;var windowloadend=perfTime.InlineJsWindowOnLoadBottom-perfTime.InlineJsPageTop;QBTrackTiming("initialLoadTiming","docready",docready);QBTrackTiming("initialLoadTiming","windowload",windowload);QBTrackTiming("initialLoadTiming","windowloadend",windowloadend);$("#docreadyspan").text(docready/1000);$("#windowloadspan").text(windowload/1000);$("#windowloadendspan").text(windowloadend/1000);if(!(typeof(window.performance)!=="undefined"&&typeof(window.performance.timing)!=="undefined")){$("#timerStatsList").remove();return}var t=performance.timing;$("#timeForNetworkLatency").text((t.responseEnd-t.fetchStart)/1000+" s");$("#timeForPageLoad").text((t.loadEventEnd-t.responseEnd)/1000+" s");$("#timeForNavStart").text((t.loadEventEnd-t.navigationStart)/1000+" s");var navigationTypes=["clicking a link or entering a URL","reload","navigating through history"];var howIGotHere=navigationTypes[performance.navigation.type];$("#howGotHere").text("Got to this page by "+howIGotHere+".")}function popupTimings(){QB.Dialog.alert({size:"medium",contents:"#timerStats",contentType:"selector"})}function initPerfTiming(){var endScript=document.createElement("script");endScript.type="text/javascript";endScript.text="perfTime.InlineJsPageBottom = $.now(); $(function () {_.defer(function(){perfTime.InlineJsjQueryReadyPageBottom = $.now();})  }); $(window).load(function(){ _.defer(function(){perfTime.InlineJsWindowOnLoadBottom = $.now();})});";document.body.appendChild(endScript);perfTime.InlineJsjQueryReady=$.now();$(window).bind("StdLoadProcStart",function(){perfTime.StdLoadProcStart=$.now()});$(window).bind("StdLoadProcEnd",function(){perfTime.StdLoadProcEnd=$.now()});$(window).load(function(){_.defer(writeDynamicTimeElements)})};; 
 
//@ sourceURL=/js/featureSwitchMgr.js 
var QB=QB||{};(function(){var _switchCache=null;function _addToCache(switchName,status){_switchCache[switchName.toLowerCase()]=status}QB.FeatureSwitchMgr={init:function(data){if(_switchCache){return}delete QB.FeatureSwitchMgr.init;_switchCache={};for(var switchName in data){if(!data.hasOwnProperty(switchName)){continue}_addToCache(switchName,data[switchName])}},has:function(switchName){if(!_switchCache||!switchName){return false}var cached=_switchCache[switchName.toLowerCase()];return cached===null||cached===false||cached===true},isSwitchOn:function(switchName){if(!this.has(switchName)){return null}else{return _switchCache[switchName.toLowerCase()]}},ensureLoaded:function(switchName){var self=this;var defer=new $.Deferred();if(this.has(switchName)){defer.resolve(this.isSwitchOn(switchName));return defer.promise()}$.ajax({type:"POST",url:"/db/"+(window.gReqDBID||"main")+"?a=JBI_FeatureSwitch_Status&switches="+encodeURIComponent(switchName)+"&_="+(new Date().getTime()),dataType:"json"}).done(function(data,status,jqXHR){var statuses=data.switches||{};for(var i=0;i<statuses.length;i++){_addToCache(statuses[i].name,statuses[i].status)}defer.resolve(self.isSwitchOn(switchName))});return defer.promise()}}})();; 
 
