var gSaveDialogValidator;function CheckSharedViewName(newname){var unewname=newname.toUpperCase();for(var n in gShrdViewInfo){if(unewname==gShrdViewInfo[n]){return false}}return true}function CheckPersonalViewName(newname){var unewname=newname.toUpperCase();for(var n in gPersViewInfo){if(unewname==gPersViewInfo[n]){return false}}return true}function InitSaveAsValidators(){$.validator.addMethod("checkExistingShared",function(){var isShared=$("[name=saveAsReportType]:checked").val()=="shared";if(isShared){return CheckSharedViewName($("#saveAsReportName").val())}return true},"That name already exists.");$.validator.addMethod("checkExistingPersonal",function(){var isPersonal=$("[name=saveAsReportType]:checked").val()=="personal";if(isPersonal){return CheckPersonalViewName($("#saveAsReportName").val())}return true},"That name already exists.");var saveAsValidationSettings={errorClass:"validationError",onkeyup:false,highlight:function(element,errorClass){$(element).addClass(errorClass)},unhighlight:function(element,errorClass){$(element).removeClass(errorClass)},errorPlacement:function(error,element){$(element).before(error)}};gSaveDialogValidator=$("#saveAsReportForm").validate(saveAsValidationSettings);$("#saveAsReportName").keyup(function(evt){if(evt.which===13){evt.preventDefault();evt.stopPropagation();$("#saveAsReportDialog button.Success").trigger("click");return false}validateReportName()}).keydown(function(evt){if(evt.which===13){evt.preventDefault();evt.stopPropagation();return false}}).keypress(function(evt){if(evt.which===13){evt.preventDefault();evt.stopPropagation();return false}})}gCurrentReportNameTimeout=null;function validateReportName(){if(gCurrentReportNameTimeout){clearTimeout(gCurrentReportNameTimeout)}gCurrentReportNameTimeout=setTimeout(function(){gCurrentReportNameTimeout=null;gSaveDialogValidator.form()},500)}function overwriteReport(){var qidToSave=getQIDForSave();var askTheUserParams=gVPviews[0]?gVPviews[0].qbATUparams:"";var qParams="qid="+qidToSave+(gVPviews[0]?BuildDeltaParam(gVPviews[0]):"")+askTheUserParams;SetValue("queryParamsSave",qParams);SetValue("queryIDSave",qidToSave);var form=getElementBy("saveAsReportForm");if(form){$(form).attr("action",gDBID+"?a=ViewOverwrite");form.submit()}}function vpGetViewInfoCB(jax){var num=Number(jax.GetValue("numShrd"));for(var n=0;n<num;++n){var vname=jax.GetValue("svname"+n);if(vname){gShrdViewInfo[n]=vname.toUpperCase()}}var num=Number(jax.GetValue("numPers"));for(var n=0;n<num;++n){var vname=jax.GetValue("pvname"+n);if(vname){gPersViewInfo[n]=vname.toUpperCase()}}}function showSaveAsReportDialog(viewIsNew){$("#VSA_rolesList").change(function(){if($(this).val()==3){$("#VSA_whichRoles1").show()}else{$("#VSA_whichRoles1").hide()}});$("#VSA_DisableAccess").change(function(){if($(this).prop("checked")){$("#VSA_rolesList").attr("disabled","disabled")}else{$("#VSA_rolesList").removeAttr("disabled")}});$("#saveAsReportNew").click(function(){$("#saveAsReportNewOptions").show("fast")});$("#saveAsReportExisting").click(function(){$("#saveAsReportNewOptions").hide("fast")});$("#VSA_saveAsSharedReport").click(function(){$("#sharedReportOptions").removeClass("Hidden")});$("#VSA_saveAsPersonalReport").click(function(){$("#sharedReportOptions").addClass("Hidden")});if(viewIsNew){$("#saveAsReportName").val(kSSRorigQueryName)}var dialogOpts={id:"saveAsReportDialog",contents:"#saveAsReportDialogDiv",contentType:"selector",size:"medium",focusedButton:null,confirm:{text:"OK",click:function(){if($("#saveAsReportForm",this).valid()){var qidToSave;if(typeof getQIDForSave!=="undefined"){qidToSave=getQIDForSave()}if(!gSaveAsDialogIsForm){if(submitFunc(gEditForm)){$(this).dialog("close");$("#basics").detach();$("#saveAsDialogHolder").append($("#saveAsReportDialogContents"));gEditForm.submit()}}else{if($("[name=saveAsOption]:checked").val()=="overwrite"){var askTheUserParams=gVPviews[0]?gVPviews[0].qbATUparams:"";var qParams="qid="+qidToSave+(gVPviews[0]?BuildDeltaParam(gVPviews[0]):"")+askTheUserParams;SetValue("queryParamsSave",qParams);SetValue("queryIDSave",qidToSave);var form=getElementBy("saveAsReportForm");if(form){$(form).attr("action",gDBID+"?a=ViewOverwrite");form.submit()}}else{var table=gVPviews[0];var askTheUserParams=gVPviews[0]?gVPviews[0].qbATUparams:"";var qParams="qid="+qidToSave+BuildDeltaParam(table)+askTheUserParams;SetValue("VSA_queryParams",qParams);var form=getElementBy("saveAsReportForm");if(form){$(form).attr("action",gDBID+"?a=ViewSaveAs");form.submit()}}}}}},open:function(){gSaveDialogValidator.resetForm()},close:function(){gSaveDialogValidator.resetForm()}};QB.Dialog.dialog(dialogOpts);if(gShrdViewInfo==null){gShrdViewInfo=new Object();gPersViewInfo=new Object();JaxAsyncCmd(gReqDBID+"?a=QBI_GetViewInfo&uid="+gReqUID,vpGetViewInfoCB)}}$(function(){InitSaveAsValidators()});